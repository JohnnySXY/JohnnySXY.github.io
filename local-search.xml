<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Docker 安装 Plausible Analytics 自建网站统计</title>
    <link href="/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/"/>
    <url>/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<p>本文将指导如何在 Debian 11 下使用 Docker 安装 Plausible Analytics 自建网站统计。</p><p><em>PS：本文同时适用于任何可安装 Docker 的 Linux 发行版。</em></p><h2 id="为什么要自建网站统计？"><a href="#为什么要自建网站统计？" class="headerlink" title="为什么要自建网站统计？"></a>为什么要自建网站统计？</h2><p>原因很简单，自己网站的数据当然要自己保管，你希望你网站的数据都被第三方卖给「所谓的」大数据分析公司吗？</p><p><a href="https://github.com/plausible/analytics">Plausible Analytics</a> 是一款以隐私保护著称的网站统计软件，经过几个月的试用，基本可以满足所有的需求，可以取代商业化的 Google Analytics 等产品。</p><h2 id="安装-Plausible-Analytics"><a href="#安装-Plausible-Analytics" class="headerlink" title="安装 Plausible Analytics"></a>安装 Plausible Analytics</h2><p>建议安装在 <code>/opt/plausible</code> 目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /opt/plausible<br><span class="hljs-built_in">cd</span> /opt/plausible<br></code></pre></td></tr></table></figure><p>首先，我们需要建立一个 <code>docker-compose.yaml</code> 文件，请按照实际需求修改参数：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mail:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">bytemark/smtp</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><br>  <span class="hljs-attr">plausible_db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:12</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db-data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=postgres</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><br>  <span class="hljs-attr">plausible_events_db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">yandex/clickhouse-server:21.3.2.5</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">event-data:/var/lib/clickhouse</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./clickhouse/clickhouse-config.xml:/etc/clickhouse-server/config.d/logging.xml:ro</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./clickhouse/clickhouse-user-config.xml:/etc/clickhouse-server/users.d/logging.xml:ro</span><br>    <span class="hljs-attr">ulimits:</span><br>      <span class="hljs-attr">nofile:</span><br>        <span class="hljs-attr">soft:</span> <span class="hljs-number">262144</span><br>        <span class="hljs-attr">hard:</span> <span class="hljs-number">262144</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><br>  <span class="hljs-attr">plausible:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">plausible/analytics:latest</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">sh</span> <span class="hljs-string">-c</span> <span class="hljs-string">&quot;sleep 10 &amp;&amp; /entrypoint.sh db createdb &amp;&amp; /entrypoint.sh db migrate &amp;&amp; /entrypoint.sh db init-admin &amp;&amp; /entrypoint.sh run&quot;</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">plausible_db</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">plausible_events_db</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mail</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">geoip</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./geoip:/geoip:ro</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8000:8000</span><br>    <span class="hljs-attr">env_file:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">plausible-conf.env</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><br>  <span class="hljs-attr">geoip:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">maxmindinc/geoipupdate</span><br>    <span class="hljs-attr">env_file:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">geoip.env</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./geoip:/usr/share/GeoIP</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">db-data:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span><br>  <span class="hljs-attr">event-data:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span><br>  <span class="hljs-attr">geoip:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span><br></code></pre></td></tr></table></figure><p>然后我们在相同目录建立一个 <code>geoip</code> 的文件夹和 <code>plausible-conf.env</code> 的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p geoip<br><span class="hljs-built_in">touch</span> plausible-conf.env<br><span class="hljs-built_in">touch</span> geoip.env<br></code></pre></td></tr></table></figure><p>修改 <code>plausible-conf.env</code>，按照官网的<a href="https://plausible.io/docs/self-hosting-configuration">教程</a>进行配置，假设你的网址是 <code>https://stat.example.com/</code>，举例如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">ADMIN_USER_EMAIL=管理员邮箱<br>ADMIN_USER_NAME=管理员用户名<br>ADMIN_USER_PWD=管理员密码<br>BASE_URL=https://stat.example.com/<br>SECRET_KEY_BASE=随机字符<br>MAILER_EMAIL=网站通知邮箱<br>SMTP_HOST_ADDR=SMTP 主机名<br>SMTP_HOST_PORT=SMTP 端口<br>SMTP_USER_NAME=SMTP 用户名<br>SMTP_USER_PWD=SMTP 密码<br>DISABLE_REGISTRATION=<span class="hljs-literal">true</span><br>GEOLITE2_COUNTRY_DB=/geoip/GeoLite2-Country.mmdb<br></code></pre></td></tr></table></figure><p><code>SECRET_KEY_BASE</code> 需要一串 64 位的随机字符，可以试用 <code>openssl rand -base64 64</code> 或者 <code>pwgen 64</code> 生成。</p><p><code>DISABLE_REGISTRATION</code> 设置 <code>true</code> 即关闭用户注册。</p><p>SMTP 可以使用市面上所有的邮件发送产品，或者懒人也可以直接用 Gmail 之类的免费服务</p><p>然后我们注册个 <a href="https://www.maxmind.com/">Maxmind</a> 帐号，注册成功后在左侧菜单 <code>Account</code> &gt; <code>Manage License Keys</code> 里点击 <code>Generate new license key</code> 获取一个 <code>License key</code> 并记录 <code>Account ID</code> 和这个 <code>License key</code>：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/managekeys.png?raw=true" alt="image.png"></p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/accountid.png?raw=true" alt="image.png"></p><p>然后修改 <code>geoip.env</code>，并填入如下信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GEOIPUPDATE_EDITION_IDS=GeoLite2-Country<br>GEOIPUPDATE_FREQUENCY=168 <span class="hljs-comment"># update every 7 days 设置 7 天更新一次 GeoIP 数据库</span><br>GEOIPUPDATE_ACCOUNT_ID=你的 Account ID<br>GEOIPUPDATE_LICENSE_KEY=你的 License Key<br></code></pre></td></tr></table></figure><p>然后抓取镜像并启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose pull<br>docker-compose up -d<br></code></pre></td></tr></table></figure><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/docker-up.png?raw=true" alt="image.png"></p><p>启动完成后即可试用 <code>http://127.0.0.1:8000/</code> 访问 Plausible，如果需要对外进行服务，我们还需要配置 Nginx 反向代理。</p><h2 id="设置-Nginx-反代"><a href="#设置-Nginx-反代" class="headerlink" title="设置 Nginx 反代"></a>设置 Nginx 反代</h2><p>从 <code>docker-compose.yaml</code> 配置里可以看出，我们监听在本地 8080 端口，此时我们可以用 Nginx 反代并开启 HTTPS，您可以参考本站教程：</p><ul><li><a href="https://u.sb/debian-install-nginx-php-mysql/#2%E3%80%81%E5%A2%9E%E5%8A%A0%E7%83%A7%E9%A5%BC%E5%8D%9A%E5%AE%A2%E6%89%93%E5%8C%85%E7%9A%84-nginx-%E6%BA%90%E5%B9%B6%E5%AE%89%E8%A3%85-t2=">安装 Nginx</a></li><li><a href="https://u.sb/nginx-ssl/">Nginx 配置 SSL 证书</a></li><li><a href="https://u.sb/acme-sh-ssl/">使用 acme.sh 配置自动续签 SSL 证书</a></li></ul><p>然后直接反代本地 <code>8080</code> 端口，参考配置如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-NginX-Proxy <span class="hljs-literal">true</span>;<br><span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br><span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br><span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br><span class="hljs-attribute">proxy_set_header</span>        X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br><span class="hljs-attribute">proxy_connect_timeout</span>       <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_send_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_read_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">send_timeout</span>                <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8000;<br>&#125;<br></code></pre></td></tr></table></figure><p>重启 Nginx 后生效我们即可访问 <code>https://stat.example.com/</code></p><h2 id="配置-Plausible-Analytics"><a href="#配置-Plausible-Analytics" class="headerlink" title="配置 Plausible Analytics"></a>配置 Plausible Analytics</h2><p>访问刚搭建好的 Plausible 并使用配置文件里的管理员邮箱和密码登录（要使用邮箱登录哦，不是用户名）：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/login.png?raw=true" alt="image.png"></p><p>登录后新建第一个要统计的网站域名，点击 <code>+Add a website</code>：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/mysite.png?raw=true" alt="image.png"></p><p>输入要统计的网站域名，选择发送报告的时区，然后点击 <code>Add snippet →</code> 按钮：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/websiteseeting.png?raw=true" alt="image.png"></p><p>然后把统计代码插入你的网页即可进行统计：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/websiteseeting2.png?raw=true" alt="image.png"></p><h2 id="更新-Plausible-Analytics"><a href="#更新-Plausible-Analytics" class="headerlink" title="更新 Plausible Analytics"></a>更新 Plausible Analytics</h2><p>万能的 Docker 更新大法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 抓取最新的 Docker 镜像</span><br>docker-compose pull<br><span class="hljs-comment"># 重启所有 Docker 镜像</span><br>docker-compose up -d<br><span class="hljs-comment"># 清理 Docker 旧容器和残留镜像</span><br>docker system prune<br></code></pre></td></tr></table></figure><h2 id="备份-Plausible-Analytics"><a href="#备份-Plausible-Analytics" class="headerlink" title="备份 Plausible Analytics"></a>备份 Plausible Analytics</h2><p>其实主要是备份数据库，相关命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -t plausible_plausible_db_1 pg_dumpall -c -U postgres | gzip &gt; dump_$(<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%Y-%m-%d_%H_%M_%S&quot;</span>).gz<br></code></pre></td></tr></table></figure><p>即可按照当前时间 dump 出 PostgreSQL 数据库并使用 <code>gzip</code> 压缩打包。</p><h2 id="卸载-Plausible-Analytics"><a href="#卸载-Plausible-Analytics" class="headerlink" title="卸载 Plausible Analytics"></a>卸载 Plausible Analytics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose down<br><span class="hljs-built_in">rm</span> -rf /opt/plausible<br>docker image <span class="hljs-built_in">rm</span> postgres:12<br>docker image <span class="hljs-built_in">rm</span> maxmindinc/geoipupdate:latest<br>docker image <span class="hljs-built_in">rm</span> plausible/analytics:latest<br>docker image <span class="hljs-built_in">rm</span> yandex/clickhouse-server:21.3.2.5<br>docker image <span class="hljs-built_in">rm</span> bytemark/smtp:latest<br>docker volume <span class="hljs-built_in">rm</span> plausible_db-data<br>docker volume <span class="hljs-built_in">rm</span> plausible_event-data<br></code></pre></td></tr></table></figure><h2 id="WordPress-添加方法"><a href="#WordPress-添加方法" class="headerlink" title="WordPress 添加方法"></a>WordPress 添加方法</h2><p>直接修改你使用的主题的 <code>header.php</code> 文件，在 <code>&lt;?php wp_head(); ?&gt;</code> 后面添加统计代码即可。</p><p>不想修改主题的也可以直接装官方的<a href="https://wordpress.org/plugins/plausible-analytics/">插件</a>。</p><h2 id="VuePress-添加方法"><a href="#VuePress-添加方法" class="headerlink" title="VuePress 添加方法"></a>VuePress 添加方法</h2><p>如果你使用 <code>VuePress v1.x</code>，那么修改 <code>.vuepress/config.js</code> 文件，在 <code>module.exports</code> 加入：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">[<span class="hljs-string">&#x27;script&#x27;</span>, &#123;&#125;, <span class="hljs-string">`</span><br><span class="hljs-string">const script = document.createElement(&#x27;script&#x27;);</span><br><span class="hljs-string">script.async = true;</span><br><span class="hljs-string">script.defer = true;</span><br><span class="hljs-string">script[&#x27;data-domain&#x27;] = &#x27;统计域名&#x27;;</span><br><span class="hljs-string">script.src = &#x27;https://stat.example.com/js/plausible.js&#x27;;</span><br><span class="hljs-string">document.head.appendChild(script);`</span><br>],<br></code></pre></td></tr></table></figure><p>如果你试用 <code>VuePress v2.x</code>，那么修改 <code>.vuepress/config.ts</code> 文件，在 <code>export default</code> 加入：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript">[<span class="hljs-string">&#x27;script&#x27;</span>, &#123;&#125;, <span class="hljs-string">`</span><br><span class="hljs-string">const script = document.createElement(&#x27;script&#x27;);</span><br><span class="hljs-string">script.async = true;</span><br><span class="hljs-string">script.defer = true;</span><br><span class="hljs-string">script[&#x27;data-domain&#x27;] = &#x27;统计域名&#x27;;</span><br><span class="hljs-string">script.src = &#x27;https://stat.example.com/js/plausible.js&#x27;;</span><br><span class="hljs-string">document.head.appendChild(script);`</span><br>],<br></code></pre></td></tr></table></figure><h2 id="Next-js-添加方法"><a href="#Next-js-添加方法" class="headerlink" title="Next.js 添加方法"></a>Next.js 添加方法</h2><p>安装 <a href="https://github.com/4lejandrito/next-plausible">next-plausible</a> 这个包，然后使用类似如下的代码：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">PlausibleProvider</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next-plausible&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params">&#123; Component, pageProps &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">PlausibleProvider</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&quot;统计域名&quot;</span> <span class="hljs-attr">customDomain</span>=<span class="hljs-string">&quot;https://stat.example.com&quot;</span> <span class="hljs-attr">selfHosted</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> &#123;<span class="hljs-attr">...pageProps</span>&#125; /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">PlausibleProvider</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></figure><p>更多的添加方法请查看官网的<a href="https://plausible.io/docs/integration-guides">文档</a>。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Plausible Analytics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 Docker 安装 Shlink 自建短网址</title>
    <link href="/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Shlink-%E8%87%AA%E5%BB%BA%E7%9F%AD%E7%BD%91%E5%9D%80/"/>
    <url>/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Shlink-%E8%87%AA%E5%BB%BA%E7%9F%AD%E7%BD%91%E5%9D%80/</url>
    
    <content type="html"><![CDATA[<p>本文将指导如何在 Debian 11 下使用 Docker 安装 Shlink 搭建自建短网址服务。</p><p><em>PS：本文同时适用于任何可安装 Docker 的 Linux 发行版。</em></p><h2 id="什么是短网址？"><a href="#什么是短网址？" class="headerlink" title="什么是短网址？"></a>什么是短网址？</h2><p>短网址，即 URL Shortener (缩略网址服务)，一般我们使用 <code>HTTP 协议</code>的 <code>301</code> 或 <code>302</code> 响应码，现在也有使用 <code>307</code> 或 <code>308</code> 来跳转一个长网址。</p><p>MDN 上有对这几个状态码的详细介绍：</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/301">301 Moved Permanently</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/302">302 Found</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/307">307 Temporary Redirect</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/308">308 Permanent Redirect</a></li></ul><p><code>301</code> 和 <code>302</code> 有一个最重要的区别，前者会在浏览器留下缓存，后者不会，导致如果你需要精确的统计访客，尤其是有一些使用一个浏览器的重复访客会不准确，但是影响不大，而使用 <code>302</code> 每次都会请求服务器造成服务器资源紧张，所以一般没有特殊需求的话，使用 <code>301</code> 就行。</p><p>举一个典型的 <code>301</code> 跳转的例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@debian ~ <span class="hljs-comment"># curl -I http://u.sb/ -A Mozilla</span><br>HTTP/1.1 301 Moved Permanently<br>Date: Tue, 26 Apr 2022 18:28:14 GMT<br>Content-Type: text/html<br>Content-Length: 162<br>Location: https://u.sb/<br></code></pre></td></tr></table></figure><p>我们可以看到，使用浏览器访问 <code>http://u.sb/</code> 的时候，会返回 <code>HTTP/1.1 301 Moved Permanently</code> 状态，对应跳转到 Location <code>https://u.sb/</code>。</p><h2 id="市面上开源和收费的短网址源码"><a href="#市面上开源和收费的短网址源码" class="headerlink" title="市面上开源和收费的短网址源码"></a>市面上开源和收费的短网址源码</h2><p>众所周知，本人的短域名贼多，对各种短网址程序都有所研究，市面上主要有这几款免费的短网址程序：</p><ul><li><a href="https://docs.blink.rest/">Blink</a> - Easy-to-host, SSO-integrated, CDN-powered link shortener (+decoupled analytics) for teams. (<a href="https://github.com/JaneJeon/blink">Source Code</a>) <code>AGPL-3.0</code> <code>Nodejs</code></li><li><a href="https://kutt.it/">Kutt</a> - A modern URL shortener with support for custom domains. (<a href="https://github.com/thedevs-network/kutt">Source Code</a>) <code>MIT</code> <code>Nodejs</code></li><li><a href="https://project.polr.me/">Polr</a> - Modern, minimalist, modular, and lightweight URL shortener. (<a href="https://github.com/Cydrobolt/polr">Source Code</a>) <code>GPL-2.0</code> <code>PHP</code></li><li><a href="https://shlink.io/">Shlink</a> - URL shortener with REST API and command line interface. Includes official progressive web application and docker images. (<a href="https://github.com/shlinkio/shlink">Source Code</a>, <a href="https://shlink.io/apps">Clients</a>) <code>MIT</code> <code>PHP</code></li><li><a href="https://yourls.org/">YOURLS</a> - YOURLS is a set of PHP scripts that will allow you to run Your Own URL Shortener. Features include password protection, URL customization, bookmarklets, statistics, API, plugins, jsonp. (<a href="https://github.com/YOURLS/YOURLS">Source Code</a>) <code>MIT</code> <code>PHP</code></li></ul><p>我基本上都安装使用过，数据量大了以后性能基本惨不忍睹，对比以后还是使用 <a href="https://www.php.net/manual/en/intro.swoole.php">PHP Swoole</a> 写的 <a href="https://shlink.io/">Shlink</a> 稍微占优，所以本文推荐安装 Shlink。</p><p>至于收费的？呵呵，没一个好用的，建议别去踩坑，我都帮你们踩过了。。。</p><h2 id="安装-Shlink-Server-和-Web-Client"><a href="#安装-Shlink-Server-和-Web-Client" class="headerlink" title="安装 Shlink Server 和 Web Client"></a>安装 Shlink Server 和 Web Client</h2><p>参考官网的<a href="https://shlink.io/documentation/install-docker-image/">安装教程</a>，我们可以把 Server 和 Web Client 装在一个地方方便管理。</p><p>首先我们新建 <code>/opt/shlink</code> 和 <code>/opt/shlink/data</code> 目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /opt/shlink<br><span class="hljs-built_in">mkdir</span> -p /opt/shlink/data<br></code></pre></td></tr></table></figure><p>然后我们新建一个 <code>docker-compose.yaml</code> 文件，假设你的域名是 <code>example.com</code>，放在 <code>/opt/shlink/docker-compose.yaml</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /opt/shlink/docker-compose.yaml &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">version: &#x27;3.8&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">services:</span><br><span class="hljs-string">    shlink:</span><br><span class="hljs-string">      image: shlinkio/shlink:stable</span><br><span class="hljs-string">      container_name: shlink</span><br><span class="hljs-string">      ports:</span><br><span class="hljs-string">        - &#x27;127.0.0.1:8080:8080&#x27;</span><br><span class="hljs-string">      environment:</span><br><span class="hljs-string">        - DEFAULT_DOMAIN=example.com</span><br><span class="hljs-string">        - IS_HTTPS_ENABLED=true</span><br><span class="hljs-string">        - GEOLITE_LICENSE_KEY=</span><br><span class="hljs-string">        - DB_DRIVER=maria</span><br><span class="hljs-string">        - DB_NAME=shlink</span><br><span class="hljs-string">        - DB_USER=shlink</span><br><span class="hljs-string">        - DB_PASSWORD=随机密码1</span><br><span class="hljs-string">        - DB_HOST=db</span><br><span class="hljs-string">        - DB_PORT=3306</span><br><span class="hljs-string">        - TIMEZONE=UTC</span><br><span class="hljs-string">        - REDIRECT_STATUS_CODE=301</span><br><span class="hljs-string">      restart: always</span><br><span class="hljs-string"></span><br><span class="hljs-string">    db:</span><br><span class="hljs-string">      image: mariadb:10.6</span><br><span class="hljs-string">      depends_on:</span><br><span class="hljs-string">        - shlink</span><br><span class="hljs-string">      container_name: db</span><br><span class="hljs-string">      ports:</span><br><span class="hljs-string">        - &#x27;127.0.0.1:3306:3306&#x27;</span><br><span class="hljs-string">      environment:</span><br><span class="hljs-string">        - MYSQL_ROOT_PASSWORD=随机 root 密码</span><br><span class="hljs-string">        - MYSQL_DATABASE=shlink</span><br><span class="hljs-string">        - MYSQL_USER=shlink</span><br><span class="hljs-string">        - MYSQL_PASSWORD=随机密码1</span><br><span class="hljs-string">      volumes:</span><br><span class="hljs-string">        - /opt/shlink/data:/var/lib/mysql</span><br><span class="hljs-string">      restart: always</span><br><span class="hljs-string"></span><br><span class="hljs-string">    shlink-web-client:</span><br><span class="hljs-string">        image: shlinkio/shlink-web-client:stable</span><br><span class="hljs-string">        container_name: shlink-web-client</span><br><span class="hljs-string">        ports:</span><br><span class="hljs-string">          - &#x27;127.0.0.1:8081:80&#x27;</span><br><span class="hljs-string">        restart: always</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p><code>GEOLITE_LICENSE_KEY</code> 需要在 <a href="https://www.maxmind.com/">Maxmind</a> 注册帐号获取，可以参考《[使用 Docker 安装 Plausible Analytics 自建网站统计]([Debian 11 使用 Docker 安装 Plausible Analytics 自建网站统计 - Johnny (johnnysxy.github.io)](<a href="https://johnnysxy.github.io/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Plausible-Analytics-%E8%87%AA%E5%BB%BA%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/">Docker 安装 Plausible Analytics 自建网站统计 - Johnny (johnnysxy.github.io)</a>)》</p><p><code>MYSQL_ROOT_PASSWORD</code> 和 <code>MYSQL_PASSWORD</code> 记得设置两个随机的密码，同时 <code>MYSQL_PASSWORD</code> 需要和 <code>DB_PASSWORD</code> 一致。</p><p>更多的环境变量参数可以参考<a href="https://shlink.io/documentation/environment-variables/">这里</a>。</p><p>然后拉取 Docker 镜像并运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /opt/shlink<br>docker-compose pull<br>docker-compose up -d<br></code></pre></td></tr></table></figure><p>然后获取一个 API Key：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it shlink shlink api-key:generate<br></code></pre></td></tr></table></figure><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Shlink-%E8%87%AA%E5%BB%BA%E7%9F%AD%E7%BD%91%E5%9D%80/termius.png?raw=true" alt="image.png"></p><p>注意第一个 <code>shlink</code> 是 Docker 容器名字，第二个 <code>shlink</code> 是命令名称。</p><p>所有 API 命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it shlink shlink<br></code></pre></td></tr></table></figure><p>记得保存你的 API Key，下面会要用到。</p><h2 id="安装配置-Nginx-反代"><a href="#安装配置-Nginx-反代" class="headerlink" title="安装配置 Nginx 反代"></a>安装配置 Nginx 反代</h2><p>我们的 Docker Compose 配置文件中，Shlink Server 服务监听在 <code>127.0.0.1:8080</code> 端口，Shlink Web Client 监听在 <code>127.0.0.1:8081</code> 端口，所以我们需要配置 Nginx 反代来访问，假设你短网址是 <code>https://example.com/</code> Web 客户端是 <code>https://app.example.com/</code></p><p><code>example.com</code> 段配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br><span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br><span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br><span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br><span class="hljs-attribute">proxy_set_header</span>        X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br><span class="hljs-attribute">proxy_connect_timeout</span>       <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_send_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_read_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">send_timeout</span>                <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>app.example.com</code> 段配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br><span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br><span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br><span class="hljs-attribute">proxy_redirect</span> <span class="hljs-literal">off</span>;<br><span class="hljs-attribute">proxy_set_header</span>        X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br><span class="hljs-attribute">proxy_connect_timeout</span>       <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_send_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_read_timeout</span>          <span class="hljs-number">300</span>;<br><span class="hljs-attribute">send_timeout</span>                <span class="hljs-number">300</span>;<br><span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8081;<br>&#125;<br></code></pre></td></tr></table></figure><p>最后记得参考本站 <a href="https://u.sb/nginx-ssl/">Nginx SSL 配置教程</a>加上 SSL 证书后，即可访问 <code>https://app.example.com/</code>：</p><p>点击 <code>+ Add a server</code> 添加你的 Shlink 服务：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Shlink-%E8%87%AA%E5%BB%BA%E7%9F%AD%E7%BD%91%E5%9D%80/shlinklogin.png?raw=true" alt="image.png"></p><p>输入名称，URL 和 API Key 以后点击 <code>Create server</code> 即可使用：</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/22/%E4%BD%BF%E7%94%A8-Docker-%E5%AE%89%E8%A3%85-Shlink-%E8%87%AA%E5%BB%BA%E7%9F%AD%E7%BD%91%E5%9D%80/newserver.png?raw=true" alt="image.png"></p><p>如果你懒得搭建 Web Client，也可以使用官方现成的服务：</p><p><a href="https://app.shlink.io/">Shlink Web Client</a></p><p>数据都是储存在浏览器本地的，可放心使用。</p><h2 id="升级-Shlink"><a href="#升级-Shlink" class="headerlink" title="升级 Shlink"></a>升级 Shlink</h2><p>直接使用 Docker Compose 升级并删除旧的镜像文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /opt/shlink<br>docker-compose pull<br>docker-compose up -d<br>docker system prune -f<br></code></pre></td></tr></table></figure><h2 id="备份-Shlink"><a href="#备份-Shlink" class="headerlink" title="备份 Shlink"></a>备份 Shlink</h2><p>我们可以定期备份数据库，导出命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> db /usr/bin/mysqldump -u root --password=随机 root 密码 shlink &gt; shlink-$(<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%Y_%m_%d_%I_%M_%p&quot;</span>).sql<br></code></pre></td></tr></table></figure><p>请替换 <code>随机 root 密码</code> 为你的数据库 <code>root</code> 密码。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shlink</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FileBeat-Log配置详解</title>
    <link href="/2023/05/19/FileBeat-Log%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <url>/2023/05/19/FileBeat-Log%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>本文主要介绍 Filebeat 7.5 版本中 Log 相关的各个配置项的含义以及其应用场景。</p><p>一般情况下，我们使用 log input 的方式如下，只需要指定一系列 paths 即可。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">filebeat.inputs:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">log</span><br>  <span class="hljs-attr">paths:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/var/log/messages</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">/var/log/*.log</span><br></code></pre></td></tr></table></figure><p>但其实除了基本的 paths 配置外，log input 还有大概十几个配置项需要我们关注。</p><p>这些配置项或多或少都会影响到 Filebeat 的使用方式以及性能。虽然其默认值基本足够日常使用，但是还是需要深刻理解每个配置项背后的含义，这样才能够对其完全把控。</p><p>同时，在 filebeat 的日常线上运维中，也会涉及到这些配置参数的调节。</p><h2 id="log-input-配置"><a href="#log-input-配置" class="headerlink" title="log input 配置"></a>log input 配置</h2><h3 id="paths"><a href="#paths" class="headerlink" title="paths"></a>paths</h3><p>我们可以指定一系列的 paths 作为信息输入源，在指定 path 的时候，注意以下规则：</p><ol><li>指定的路径必须是文件，不能是目录。</li><li>支持 Glob 模式。</li><li>默认支持递归路径，如 <code>/**/</code> 形式，Filebeat 将会展开 8 层嵌套目录。</li></ol><h4 id="Glob-模式"><a href="#Glob-模式" class="headerlink" title="Glob 模式"></a>Glob 模式</h4><p>Glob 模式支持通配符匹配，目前支持的语法有：</p><table><thead><tr><th>通配符</th><th>解释</th><th>示例</th><th>匹配</th></tr></thead><tbody><tr><td>*</td><td>匹配任意数目的任意字符</td><td><code>La*</code></td><td>Law, Lawyer</td></tr><tr><td>?</td><td>匹配任意的单字符</td><td><code>?at</code></td><td>Cat, cat, Bat or bat</td></tr><tr><td>[abc]</td><td>匹配一个在中括号的字符</td><td><code>[CB]at</code></td><td>Cat or Bat</td></tr><tr><td>[a-z]</td><td>匹配一个指定范围的字符</td><td><code>Letter[0-9]</code></td><td>Letter0, Letter1, Letter2 up to Letter9</td></tr></tbody></table><h4 id="递归的-Glob-模式"><a href="#递归的-Glob-模式" class="headerlink" title="递归的 Glob 模式"></a>递归的 Glob 模式</h4><p>此外，filebeat 对传统的 Glob 模式进行了扩展，支持用户指定 <code>/**/</code> 模式的路径，filebeat 可以将其展开为 8 层的 Glob 路径。</p><p>例如，假如指定了 <code>/home/data/**/my*.log</code>, filebeat 将会把 <code>/**/</code> 翻译成 8 层的子目录，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs none">/home/data/my*.log<br>/home/data/*/my*.log<br>/home/data/*/*/my*.log<br>/home/data/*/*/*/my*.log<br>/home/data/*/*/*/*/my*.log<br>/home/data/*/*/*/*/*/my*.log<br>/home/data/*/*/*/*/*/*/my*.log<br>/home/data/*/*/*/*/*/*/*/my*.log<br>/home/data/*/*/*/*/*/*/*/*/my*.log<br></code></pre></td></tr></table></figure><p>加上不带子目录的 Glob 路径，一共会有 8 条 Glob 路径。这些路径都会作为 input 的输入源路径进行搜索。</p><p>但是在使用的时候需要注意：</p><ol><li>filebeat 展开为 8 层子目录的规则，是直接 hardcode 在代码中的，无法通过配置修改匹配层数</li><li>只支持单纯的 <code>/**/</code> 模式，对于 <code>/data**/</code> 模式不支持</li><li>递归模式默认开启，可通过 <code>recursive_glob.enabled</code> 配置项关闭</li></ol><h3 id="recursive-glob-enabled"><a href="#recursive-glob-enabled" class="headerlink" title="recursive_glob.enabled:"></a>recursive_glob.enabled:</h3><p>是否开启递归的 Glob 模式，默认为 true。</p><h3 id="encoding"><a href="#encoding" class="headerlink" title="encoding"></a>encoding</h3><p>指定日志编码，默认是 plain。即 ASCII 模式</p><h3 id="exclude-lines"><a href="#exclude-lines" class="headerlink" title="exclude_lines"></a>exclude_lines</h3><p>可指定多个正则表达式，来去除某些不需要上报的行。例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">filebeat.inputs:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">log</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">exclude_lines:</span> [<span class="hljs-string">&#x27;^DBG&#x27;</span>]<br></code></pre></td></tr></table></figure><p>该配置将会去除以 <code>DBG</code> 开头的行。</p><h3 id="include-lines"><a href="#include-lines" class="headerlink" title="include_lines"></a>include_lines</h3><p>可指定多项正则表达式，来仅上报匹配的行。例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">filebeat.inputs:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">log</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">include_lines:</span> [<span class="hljs-string">&#x27;^ERR&#x27;</span>, <span class="hljs-string">&#x27;^WARN&#x27;</span>]<br></code></pre></td></tr></table></figure><p>该配置将会仅上报以 <code>ERR</code> 和 <code>WARN</code> 开头的行。</p><p>问题来了，如果同时指定了 exclude_lines 和 include_lines 会怎么处理？</p><p>对于这种情况，Filebeat 将会先校验 include_lines，再校验 exclude_lines，其代码实现如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h *Harvester)</span></span> shouldExportLine(line <span class="hljs-type">string</span>) <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(h.config.IncludeLines) &gt; <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">if</span> !harvester.MatchAny(h.config.IncludeLines, line) &#123;<br><span class="hljs-comment">// drop line</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(h.config.ExcludeLines) &gt; <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">if</span> harvester.MatchAny(h.config.ExcludeLines, line) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="exclude-files"><a href="#exclude-files" class="headerlink" title="exclude_files"></a>exclude_files</h3><p>可指定多个正则表达式，匹配到的文件名将不会被处理。</p><p>例如:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">exclude_files:</span> [<span class="hljs-string">&#x27;.gz$&#x27;</span>]<br></code></pre></td></tr></table></figure><p>这里需要注意的是，不管是 exclude_files，还是 exclude_lines、include_lines, 声明正则的时候，最好使用单引号引用正则表达式，不要用双引号。否则 yaml 会报转义问题</p><h3 id="harvester-buffer-size"><a href="#harvester-buffer-size" class="headerlink" title="harvester_buffer_size"></a>harvester_buffer_size</h3><p>读文件时的 buffer 大小，最终会应用在 golang 的 <code>File.Read</code> 函数上面。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *File)</span></span> Read(b []<span class="hljs-type">byte</span>) (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)<br></code></pre></td></tr></table></figure><p>默认是 16384。即 16k。</p><h3 id="max-bytes"><a href="#max-bytes" class="headerlink" title="max_bytes"></a>max_bytes</h3><p>表示一条 log 消息的最大 bytes 数目。超过这个大小，剩余就会被截断。<br>默认值为 10485760(即 10MB)。</p><h3 id="multiline"><a href="#multiline" class="headerlink" title="multiline"></a>multiline</h3><p>multiline 是为了解决需要多行聚合在一起发送的情况，例如 Java Stack Traces 信息等。<br>虽然 filebeat 默认不开启 multiline，但是官方的配置文件给了一个例子，可以支持 Java Stack Traces 或者是 C 语言式的换行连续符 <code>\</code>, 可在 <a href="https://www.elastic.co/guide/en/beats/filebeat/master/_examples_of_multiline_configuration.html">Examples of multiline configuration</a> 中查看。</p><p>由于大部分场景不涉及 multiline，本文不再进行深入讨论。关于 multiline 配置的详细资料可查看官方文档：<br><a href="https://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html">https://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html</a></p><h3 id="ignore-older"><a href="#ignore-older" class="headerlink" title="ignore_older"></a>ignore_older</h3><p>ignore_older 表示对于最近修改时间距离当前时间已经超过某个时长的文件，就暂时不进行处理。默认值为 0，表示禁用该功能。</p><p>注意：ignore_older 只是暂时不处理该文件，并不会在 Registrar 中改变该文件的状态。</p><p>其代码实现如下：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Input)</span></span> isIgnoreOlder(state file.State) <span class="hljs-type">bool</span> &#123;<br><span class="hljs-comment">// ignore_older is disable</span><br><span class="hljs-keyword">if</span> p.config.IgnoreOlder == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br>modTime := state.Fileinfo.ModTime()<br><span class="hljs-keyword">if</span> time.Since(modTime) &gt; p.config.IgnoreOlder &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="close-系列"><a href="#close-系列" class="headerlink" title="close_* 系列"></a>close_* 系列</h3><p>log input 中有一系列以 close_开头配置，这些配置决定了 Harvester 何时结束对文件的读取。</p><ol><li>close_eof<br>如果读取到了 EOF(即文件末尾)，是否要结束读取。如果为 true，则读取到文件末尾就结束读取，否则 Harvester 将会继续工作。默认只为 false。</li><li>close_inactive<br>如果配置了 close_eof 为 false，则 Harvester 即使读取到了文件末尾也不会终止。close_inactive 决定了最长没有读到新消息的时长，默认为 5m(即五分钟)。如果超过了 close_inactive 规定的时间依然没有新消息，则 Harvester 退出。</li><li>close_timeout<br>决定了一个 Harvester 的最长工作时间，如果 Harvester 工作了一段时间后依然没有停止，则强行停止 Harvester。默认为 0，表示不强行停止 Harvester。</li><li>close_renamed<br>文件更名时是否退出，默认为 false。文件更名一般发生在日志轮替的场景下。</li><li>close_removed<br>表示当文件被删除时 Harvester 是否要继续。默认为 true，表示当文件被删除时，Harvester 即刻停止工作。</li></ol><p>不过即使 Harvester 关闭了也关系不大。因为根据 filebeat 会定时扫描文件，如果关闭后又有了新增内容，filebeat 依然是可以检查出来的。</p><h3 id="clean-系列"><a href="#clean-系列" class="headerlink" title="clean_* 系列"></a>clean_* 系列</h3><p>clean_开头的一系列配置用来清理 Registrar 中的文件状态，同时也可以起到减小 Registrar 文件大小、防止 inode 复用等作用。</p><ol><li>clean_inactive<br>表示一个时间段。用于移除已经一长段时间没有新产生内容的日志文件，默认为 0，表示禁用该功能。</li><li>clean_removed<br>在 Registrar 中移除那些已经不存在的文件。默认为 true，表示当文件不存在时，则从 Registrar 中移除。</li></ol><h3 id="scan-frequency"><a href="#scan-frequency" class="headerlink" title="scan_frequency"></a>scan_frequency</h3><p>代表 input 的扫描频率，默认为 10s。<br>input 会按照此频率，启动定时器定时扫描路径，以发现新文件和文件的改动情况。</p><h3 id="scan-sort-和-scan-order"><a href="#scan-sort-和-scan-order" class="headerlink" title="scan.sort 和 scan.order"></a>scan.sort 和 scan.order</h3><p>这两个配置项需要放在一起讲。<br><code>scan.sort</code> 可取的值为: modtime 和 filename。默认值为空，不进行排序。<br><code>scan.order</code> 可取的值为：asc 和 desc。默认值为 asc。<code>scan.order</code> 仅在 <code>scan.sort</code> 非空时生效。</p><p>需要注意的是：该功能目前为实验功能，可能会在以后版本移除。</p><h3 id="tail-files"><a href="#tail-files" class="headerlink" title="tail_files"></a>tail_files</h3><p>默认情况下，Harvester 处理文件时，会文件头开始读取文件。开启此功能后，filebeat 将直接会把文件的 offset 置到末尾，从文件末尾监听消息。默认值是 false。</p><p>注意： 开启了 tail_files, 则所有文件中的当前内容将不会被上报，只有新产生消息时才会上报。</p><p>在真实的实现中，tail_files 被当做 <code>ignore_older=1ns</code> 处理。因此，在启动的时候，只要是新文件，里面的内容都会被忽略，直接把 offset 置为文件末尾。</p><p>所以使用该配置项时千万要谨慎！</p><h3 id="harvester-limit"><a href="#harvester-limit" class="headerlink" title="harvester_limit"></a>harvester_limit</h3><p>harvester_limit 决定了一个 input 最多同时有多少个 harvester 启动。默认为 0，代表不对 harvester 个数进行限制。<br>在使用时要注意两点：</p><ol><li>如果一个文件对应的 harvester 在本轮扫描时没能启动，那会在下次扫描时，有其他文件的 harvester 完全退出时，该文件的 harvester 才能启动。</li><li>harvester_limit 仅对针对配置的 input 进行了限制，多个 input 之间的 harvester_limit 互不影响。</li></ol><h3 id="symlinks"><a href="#symlinks" class="headerlink" title="symlinks"></a>symlinks</h3><p>代表是否要对符号链接进行处理，默认值为 false，代表不处理。</p><h3 id="backoff-相关配置"><a href="#backoff-相关配置" class="headerlink" title="backoff 相关配置"></a>backoff 相关配置</h3><p>我们上文讲到 <code>close_eof</code> 选项，当读取到 eof 时，且 close_eof 为 false，则 Harvester 还会一直尝试读取文件。</p><p>在这种情况下，Harvester 继续读取之前，其实 filebeat 还会等待一段时间。等待的时长就是由 <code>backoff</code>、<code>backoff_factor</code> 和 <code>max_backoff</code> 三个配置项共同决定。</p><p>对应的代码实现为：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(f *Log)</span></span> wait() &#123;<br><span class="hljs-comment">// Wait before trying to read file again. File reached EOF.</span><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-f.done:<br><span class="hljs-keyword">return</span><br><span class="hljs-keyword">case</span> &lt;-time.After(f.backoff):<br>&#125;<br><br><span class="hljs-comment">// Increment backoff up to maxBackoff</span><br><span class="hljs-keyword">if</span> f.backoff &lt; f.config.MaxBackoff &#123;<br>f.backoff = f.backoff * time.Duration(f.config.BackoffFactor)<br><span class="hljs-keyword">if</span> f.backoff &gt; f.config.MaxBackoff &#123;<br>f.backoff = f.config.MaxBackoff<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>其中，<code>backoff</code> 默认值为 1s, <code>backoff_factor</code> 默认值为 2，<code>max_backoff</code> 默认值为 10s。</p><p>该配置项意味着，如果读到 EOF，则 filebeat 将会等待一段时间再去读文件。<br>等待时间开始为 1s，如果一直是 EOF，则会逐渐增大等待时间，每次的等待时间是前一次的两倍，且一次最长等待 10s。</p><p>再结合 <code>close_inactive</code> 选项，如果等待时间超过了默认值 5 分钟，则 Harvester 结束。</p><p>此外，如果等待的时候文件又追加了新的数据，则 backoff 将会重新置为初始值。</p><h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><p>除了 log input 相关的属性外，有一些全局属性也需要我们注意。</p><h3 id="queue-相关配置"><a href="#queue-相关配置" class="headerlink" title="queue 相关配置"></a>queue 相关配置</h3><p>filebeat 会将 event 暂时存放在 queue 里面。filebeat 的 queue 目前有 mem 和 spool 两种实现，默认是 mem。<br>本文只介绍下 mem 的相关配置项。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">queue:</span><br>  <span class="hljs-attr">mem:</span><br>    <span class="hljs-attr">events:</span> <span class="hljs-number">4096</span><br>    <span class="hljs-attr">flush.min_events:</span> <span class="hljs-number">2048</span><br>    <span class="hljs-attr">flush.timeout:</span> <span class="hljs-string">1s</span><br></code></pre></td></tr></table></figure><p>events 代表 queue 最多能够承载的 event 的个数。如果个数达到最大值，则 input 将不能再向 queue 中插入数据，直至 output 将数据消费。</p><p><code>flush.min_events</code> 代表只有 queue 里面的数据到达了指定个数，才将数据发送给 output。设为 0 代表直接发送给 output，不进行等待。默认值是2048。</p><p><code>flush.timeout</code> 代表定时刷新 event 到 output 中，即使其个数没有达到 <code>flush.min_events</code>。该配置项只会在 <code>flush.min_events</code> 大于 0 时生效。</p><h3 id="registry-相关配置"><a href="#registry-相关配置" class="headerlink" title="registry 相关配置"></a>registry 相关配置</h3><ol><li>filebeat.registry.path<br>定制 registry 文件的目录，默认值是 <code>registry</code>。</li></ol><p>注意，这里指定的只是 registry 的目录，最终的 registry 文件的路径会是这样:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">$&#123;filebeat.registry.path&#125;/filebeat/data.json<br></code></pre></td></tr></table></figure><ol><li>filebeat.registry.flush<br>将 registry 文件内容定时刷新到磁盘中。默认为 0s，代表每次更新时直接写文件。<br>配置了该选项可以提高些 filebeat 的性能，避免频繁写磁盘，但是也增加了一定数据丢失的风险。</li><li>filebeat.registry.file_permissions<br>默认为 0600，即只有拥有者可以读写该用户, 其他用户不可以修改。</li></ol><h3 id="日志相关配置"><a href="#日志相关配置" class="headerlink" title="日志相关配置"></a>日志相关配置</h3><p>filebeat 可以对输出日志的进行相关配置，filebeat 提供了如下日志相关的配置:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">logging.level:</span> <span class="hljs-string">info</span> <span class="hljs-comment"># 日志输出的最小级别</span><br><span class="hljs-attr">logging.selectors:</span> [] <span class="hljs-comment"># 过滤器，用户可在 logp.NewLogger 时指定</span><br><span class="hljs-attr">logging.to_stderr:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 将日志输出到 stderr</span><br><span class="hljs-attr">logging.to_syslog:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 将日志输出到 syslog (主要用于 unix)</span><br><span class="hljs-attr">logging.to_eventlog:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 将日志输出到 windows 的 event log</span><br><span class="hljs-attr">logging.to_files:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 将日志输出到文件中</span><br><span class="hljs-attr">logging.files:</span><br><span class="hljs-attr">path:</span> <span class="hljs-string">$&#123;filebeat_bin_path&#125;/logs/</span> <span class="hljs-comment"># 日志目录</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">filebeat</span>  <span class="hljs-comment"># 文件名 filebeat filebeat.1 filebeat.2</span><br><span class="hljs-attr">rotateonstartup:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 在 filebeat 启动时进行日志轮替</span><br><span class="hljs-attr">rotateeverybytes:</span> <span class="hljs-number">10485760</span> <span class="hljs-comment"># = 10MB 日志轮替的默认值</span><br><span class="hljs-attr">keepfiles:</span> <span class="hljs-number">7</span> <span class="hljs-comment"># 日志保留个数</span><br><span class="hljs-attr">permissions:</span> <span class="hljs-number">0600</span> <span class="hljs-comment"># 日志权限</span><br><span class="hljs-attr">interval:</span> <span class="hljs-number">0</span> <span class="hljs-comment"># 日志轮替</span><br><span class="hljs-attr">logging.metrics.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">logging.metrics.period:</span> <span class="hljs-string">30s</span><br><span class="hljs-attr">logging.json:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>filebeat 可以选择将日志输出到许多地方，在线上运营时我们常常会将日志输出到文件, 所以接下来讲下文件相关的配置。</p><p>我们可以配置日志文件的所在目录以及文件名，分别对应 <code>logging.files.path</code> 和 <code>logging.files.name</code>。<br>默认情况下，日志的输出目录是在 filebeat 的 bin 文件所在目录下的 logs 文件。</p><p>filebeat 会进行日志轮替，一般情况下，常见的日志轮替规则有按大小和按时间，filebeat 两种规则均支持。<br>其中:</p><ol><li><code>rotateeverybytes</code> 决定了日志文件的最大值，如果日志文件超过了该值，将发生日志轮替，默认值为 10MB。</li><li><code>rotateonstartup</code> 是说明是否在每次启动时都进行一次日志轮替，这样的话，每次启动的日志都会从一个新文件开始。默认为 true</li></ol><p>按文件大小进行轮替后，日志文件名将会变成 filebeat、filebeat.1、filebeat.2 这种格式，后缀越大文件越旧。</p><p>filebeat 也支持按时间进行轮替，可以配置 <code>logging.files</code> 下的 interval 属性，支持按照秒、分钟、小时、周、月、年进行轮替，对应值为 <code>1s</code>,<code>1m</code>, <code>1h</code>, <code>24h</code>, <code>7*24h</code>, <code>30*24h</code>, 和 <code>365*24h</code>。当然，最小值是 1s。</p><p>按照时间进行轮替时，时间将会以连字符进行分割, 例如：按照 1 小时进行轮替的话，文件格式为：<code>filebeat-2019-11-28-15</code>。filebeat 目前还不支持日期格式的自定义。</p><p>同时，我们也可以指定日志的保留策略，目前只能通过设置 <code>keepfiles</code> 来决定保留日志的个数。</p><p>在日志里面还有 <code>logging.metrics</code> 相关配置，filebeat 会定时输出一些当前的运行指标，例如输出下当前 ack 成功的数目、当前的内存占用情况等：</p><ul><li><code>logging.metrics.enabled</code> 决定是否开启指标搜集</li><li><code>logging.metrics.period</code> 决定指标输出的间隔</li></ul><h3 id="使用环境变量"><a href="#使用环境变量" class="headerlink" title="使用环境变量"></a>使用环境变量</h3><p>我们可以在使用配置文件中直接使用环境变量，使用方式如下:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">fields:</span><br><span class="hljs-attr">env:</span> <span class="hljs-string">$&#123;ENV_NAME&#125;</span><br></code></pre></td></tr></table></figure><p>我们可以直接用 <code>$&#123;ENV_NAME&#125;</code> 来引用系统的环境变量。<br>除了直接引用外，filebeat 还提供了两个表达式配合使用:</p><ol><li><code>$&#123;VAR:default_value&#125;</code>。如果没有环境变量 <code>VAR</code>, 则使用默认值 default_value</li><li><code>$&#123;VAR:?error_text&#125;</code>。如果没有环境变量 <code>VAR</code>，则显示错误提示 <code>error_text</code></li></ol><p>filebeat 也支持在启动时指定命令行参数来提供环境变量: <code>-E name=$&#123;NAME&#125;</code></p><h2 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h2><ul><li><a href="https://www.cyhone.com/articles/analysis-of-filebeat/">Elastic-Filebeat 实现剖析</a></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html">https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html</a></li><li><a href="https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml">https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml</a></li><li><a href="https://en.wikipedia.org/wiki/Glob_(programming)">https://en.wikipedia.org/wiki/Glob_(programming)</a></li><li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/using-environ-vars.html">https://www.elastic.co/guide/en/beats/filebeat/current/using-environ-vars.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>日志</tag>
      
      <tag>FileBeat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8S 证书过期，报错：Unable to connect to the server: x509: certificate has expired or is not yet valid 解决方法</title>
    <link href="/2023/05/18/K8S-%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%EF%BC%8C%E6%8A%A5%E9%94%99%EF%BC%9AUnable-to-connect-to-the-server-x509-certificate-has-expired-or-is-not-yet-valid-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <url>/2023/05/18/K8S-%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%EF%BC%8C%E6%8A%A5%E9%94%99%EF%BC%9AUnable-to-connect-to-the-server-x509-certificate-has-expired-or-is-not-yet-valid-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>1、查看证书有效期</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm certs check-expiration<br><br><span class="hljs-comment"># 看到 invalid 全是过期的</span><br>[check-expiration] FYI: You can look at this config file with <span class="hljs-string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br>[check-expiration] Error reading configuration from the Cluster. Falling back to default configuration<br><br>CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED<br>admin.conf                 Sep 14, 2022 14:01 UTC   &lt;invalid&gt;                               no      <br>apiserver                  Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       ca                      no      <br>apiserver-etcd-client      Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       etcd-ca                 no      <br>apiserver-kubelet-client   Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       ca                      no      <br>controller-manager.conf    Sep 14, 2022 14:01 UTC   &lt;invalid&gt;                               no      <br>etcd-healthcheck-client    Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       etcd-ca                 no      <br>etcd-peer                  Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       etcd-ca                 no      <br>etcd-server                Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       etcd-ca                 no      <br>front-proxy-client         Sep 14, 2022 14:01 UTC   &lt;invalid&gt;       front-proxy-ca          no      <br>scheduler.conf             Sep 14, 2022 14:01 UTC   &lt;invalid&gt;                               no      <br><br>CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED<br>ca                      Sep 12, 2031 14:01 UTC   8y              no      <br>etcd-ca                 Sep 12, 2031 14:01 UTC   8y              no      <br>front-proxy-ca          Sep 12, 2031 14:01 UTC   8y              no<br><br><br><span class="hljs-comment"># 或者用 openssl 方法，查看也是过期的</span><br>openssl x509 -<span class="hljs-keyword">in</span> /etc/kubernetes/pki/apiserver.crt -noout -text |grep <span class="hljs-string">&#x27;Not&#x27;</span><br>            Not Before: Sep 14 14:01:12 2021 GMT<br>            Not After : Sep 14 14:01:12 2022 GMT<br></code></pre></td></tr></table></figure><p>2、 证书备份</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> -rp /etc/kubernetes /etc/kubernetes.bak<br></code></pre></td></tr></table></figure><p>3、重新生成证书，使用该命令不用提前删除过期证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm certs renew all<br></code></pre></td></tr></table></figure><p>4、再查看证书有效期</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 显示已经到2023年</span><br>x509 -<span class="hljs-keyword">in</span> /etc/kubernetes/pki/apiserver.crt -noout -text |grep <span class="hljs-string">&#x27;Not&#x27;</span><br>            Not Before: Sep 14 14:01:12 2021 GMT<br>            Not After : Sep 15 01:53:20 2023 GMT<br></code></pre></td></tr></table></figure><p>5、更新用户证书凭证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /etc/kubernetes/admin.conf ~/.kube/config<br></code></pre></td></tr></table></figure><p>6、重启 kubelet</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart kubelet<br></code></pre></td></tr></table></figure><p>7、重启apiserver，scheduler，controller-manager 容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps | grep apiserver<br>docker ps | grep scheduler<br>docker ps | grep controller-manager<br><br>docker restart containerID<br></code></pre></td></tr></table></figure><p>8、检测状态，成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status kubelet<br><br><br><span class="hljs-comment"># 成功</span><br>● kubelet.service - kubelet: The Kubernetes Node Agent<br>   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)<br>  Drop-In: /usr/lib/systemd/system/kubelet.service.d<br>           └─10-kubeadm.conf<br>   Active: active (running) since Thu 2022-09-15 09:56:24 CST; 2min 6s ago<br>     Docs: https://kubernetes.io/docs/<br> Main PID: 10193 (kubelet)<br>    Tasks: 15<br>   Memory: 42.5M<br>   CGroup: /system.slice/kubelet.service<br>           └─10193 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=registry.aliyu...<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>命令</tag>
      
      <tag>K8S</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix配置钉钉告警</title>
    <link href="/2023/05/17/Zabbix%E9%85%8D%E7%BD%AE%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/"/>
    <url>/2023/05/17/Zabbix%E9%85%8D%E7%BD%AE%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/</url>
    
    <content type="html"><![CDATA[<p>当我们把zabbix的基础建设构建完成之后，就能够对Linux服务器的一些基本项进行监控了，在web界面也可以看到相关问题的一些报警了，但是这样的报警显然是不够的，我们需要的是那种与实际工作常用工具相结合的报警，这样既容易发现告警，先显得比较高端，再加上一些基础的服务器信息以及告警项，做出对应的处理就非常容易了。</p><p>今天我们就来整理一下zabbix结合钉钉机器人的报警配置。</p><h3 id="1-首先是钉钉客户端配置。"><a href="#1-首先是钉钉客户端配置。" class="headerlink" title="1. 首先是钉钉客户端配置。"></a>1. 首先是钉钉客户端配置。</h3><h3 id="2-建立一个钉钉群组。"><a href="#2-建立一个钉钉群组。" class="headerlink" title="2. 建立一个钉钉群组。"></a>2. 建立一个钉钉群组。</h3><h3 id="3-添加一个机器人。"><a href="#3-添加一个机器人。" class="headerlink" title="3. 添加一个机器人。"></a>3. 添加一个机器人。</h3><p><img src="http://t.eryajf.net/imgs/2021/09/a9f43eb07c4a49ef.jpg" alt="image"></p><p>注意，这里要复制下来这个wenhook值，等会要用到的。</p><h3 id="4-zabbix服务器端配置。"><a href="#4-zabbix服务器端配置。" class="headerlink" title="4. zabbix服务器端配置。"></a>4. zabbix服务器端配置。</h3><h3 id="5-Zabbix-配置文件中查找”Alert”查看告警脚本存放路径。"><a href="#5-Zabbix-配置文件中查找”Alert”查看告警脚本存放路径。" class="headerlink" title="5. Zabbix 配置文件中查找”Alert”查看告警脚本存放路径。"></a>5. Zabbix 配置文件中查找”Alert”查看告警脚本存放路径。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost ~]<span class="hljs-comment"># vim /etc/zabbix/zabbix_server.conf</span><br>AlertScriptsPath=/usr/lib/zabbix/alertscripts（455行，默认的，不用修改）<br></code></pre></td></tr></table></figure><h3 id="6-进入配置中路径创建配置文件，并添加监听脚本。"><a href="#6-进入配置中路径创建配置文件，并添加监听脚本。" class="headerlink" title="6. 进入配置中路径创建配置文件，并添加监听脚本。"></a>6. 进入配置中路径创建配置文件，并添加监听脚本。</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">[root@localhost ~]# cd /usr/lib/zabbix/alertscripts/<br></code></pre></td></tr></table></figure><h3 id="7-然后添加脚本。"><a href="#7-然后添加脚本。" class="headerlink" title="7. 然后添加脚本。"></a>7. 然后添加脚本。</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost alertscripts]<span class="hljs-comment"># vim token.sh</span><br><br><span class="hljs-comment">#!/bin/bash</span><br>to=<span class="hljs-variable">$1</span><br>subject=<span class="hljs-variable">$2</span><br>text=<span class="hljs-variable">$3</span><br>curl <span class="hljs-string">&#x27;xxxxxxxxx&#x27;</span> \      <span class="hljs-comment">#此处的xxxxx就是刚刚复制存留的api接口地址。</span><br>-H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>-d <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#123;&quot;msgtype&quot;: &quot;text&quot;,</span><br><span class="hljs-string">&quot;text&quot;: &#123;</span><br><span class="hljs-string">&quot;content&quot;: &quot;&#x27;</span><span class="hljs-string">&quot;<span class="hljs-variable">$text</span>&quot;</span><span class="hljs-string">&#x27;&quot;</span><br><span class="hljs-string">&#125;,</span><br><span class="hljs-string">&quot;at&quot;:&#123;</span><br><span class="hljs-string">&quot;atMobiles&quot;:[</span><br><span class="hljs-string">&quot;&#x27;</span><span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><span class="hljs-string">&#x27;&quot;</span><br><span class="hljs-string">],</span><br><span class="hljs-string">&quot;isAtAll&quot;:false</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="8-配置执行文件权限与归属"><a href="#8-配置执行文件权限与归属" class="headerlink" title="8. 配置执行文件权限与归属"></a>8. 配置执行文件权限与归属</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@localhost alertscripts]<span class="hljs-comment"># chown zabbix.zabbix token.sh</span><br>[root@localhost alertscripts]<span class="hljs-comment"># chmod +x token.sh</span><br></code></pre></td></tr></table></figure><p>切换至 zabbix 用户测试脚本是否执行成功。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">bash  token.sh 11 22 33<br></code></pre></td></tr></table></figure><p>如果钉钉已经有了提示消息，说明配置成功。</p><h3 id="9-设置前端创建脚本及报警媒介"><a href="#9-设置前端创建脚本及报警媒介" class="headerlink" title="9. 设置前端创建脚本及报警媒介"></a>9. 设置前端<code>创建脚本</code>及<code>报警媒介</code></h3><p>再添加以下 3 个参数，分别对应脚本需要的 3 个参数：收件人地址、主题、详细内容。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">&#123;ALERT.SENDTO&#125;<br>&#123;ALERT.SUBJECT&#125;<br>&#123;ALERT.MESSAGE&#125;<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/cfcda5d9a12427b7.jpg" alt="image"></p><h3 id="10-创建动作"><a href="#10-创建动作" class="headerlink" title="10. 创建动作"></a>10. 创建动作</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">配置<br>---&gt;动作<br>---&gt;右上角触发器<br>---&gt;创建动作<br>---&gt;名称(钉钉)<br>---&gt;新的触发条件(触发器示警度---&gt;大于等于---&gt;警告)<br>---&gt;添加(上边出现了两条---&gt;计算方式选和)<br>---&gt;选择右边操作<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/613360e480a91eab.jpg" alt="image"></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs text">---&gt;步骤时间---&gt;1000<br>---&gt;标题(故障&#123;TRIGGER.STATUS&#125;,服务器:&#123;HOSTNAME1&#125;发生: &#123;TRIGGER.NAME&#125;故障!)<br>or: 服务故障告警：&#123;TRIGGER.STATUS&#125;: &#123;TRIGGER.NAME&#125;<br>---&gt;默认信息下边的添加<br><br>告警主机:&#123;HOSTNAME1&#125;<br>告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<br>告警等级:&#123;TRIGGER.SEVERITY&#125;<br>告警信息: &#123;TRIGGER.NAME&#125;<br>告警项目:&#123;TRIGGER.KEY1&#125;<br>问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br>当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;<br>事件 ID:&#123;EVENT.ID&#125;<br><br>or:<br>服务故障告警：&#123;TRIGGER.STATUS&#125;: &#123;TRIGGER.NAME&#125;<br>告警主机：&#123;HOST.NAME&#125;<br>主机IP：&#123;HOST.IP&#125;<br>告警时间：&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<br>告警等级：&#123;TRIGGER.SEVERITY&#125;<br>告警信息：&#123;TRIGGER.NAME&#125;<br>问题详情：&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br>当前状态：&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;<br>事件ID：&#123;EVENT.ID&#125;<br><br>---&gt;操作添加<br>---&gt;步骤---&gt;5 表示触发 5 次动作<br>---&gt;步骤持续时间---&gt;每隔 120 秒触发一次<br>---&gt;告警发给 admin 用户<br>---&gt;用”钉钉”媒介发送。<br>---&gt;点击小”add”添加选项，否则等于没写<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/33a92e533b50a4f0.jpg" alt="image"></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs text">点击添加之后<br>---&gt;右边恢复操作，相当于服务正常之后的操作<br>---&gt;标题改为---&gt;恢复&#123;TRIGGER.STATUS&#125;, 服务器:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;已恢复!<br>or: 服务故障恢复告警：&#123;TRIGGER.STATUS&#125;: &#123;TRIGGER.NAME&#125;<br>---&gt;信息改为---&gt;<br><br>告警主机:&#123;HOSTNAME1&#125;<br>告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<br>告警等级:&#123;TRIGGER.SEVERITY&#125;<br>告警信息: &#123;TRIGGER.NAME&#125;<br>告警项目:&#123;TRIGGER.KEY1&#125;<br>问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br>当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;<br>事件 ID:&#123;EVENT.ID&#125;<br><br>or:<br>服务故障恢复告警：&#123;TRIGGER.STATUS&#125;: &#123;TRIGGER.NAME&#125;<br>告警主机：&#123;HOST.NAME&#125;<br>主机IP：    &#123;HOST.IP&#125;<br>告警时间：&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;<br>告警等级：&#123;TRIGGER.SEVERITY&#125;<br>告警信息：&#123;TRIGGER.NAME&#125;<br>问题详情：&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;<br>当前状态：&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;<br>事件ID：   &#123;EVENT.ID&#125;<br><br>---&gt;点击”新的”添加发送选项<br>---&gt;添加群组<br>---&gt;添加用户 Admin<br>---&gt;仅送到---&gt;钉钉<br>---&gt;点击小”添加”添加选项，否则等于没写<br>点击小 add 添加选项后再点击大 ADD 完成动作增加。<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/c8d52a183b4cb0b4.jpg" alt="image"></p><h3 id="11-添加报警媒介"><a href="#11-添加报警媒介" class="headerlink" title="11. 添加报警媒介"></a>11. 添加<code>报警媒介</code></h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">---&gt;点击右上角用户头像<br>---&gt;点击报警媒介<br>---&gt;添加<br>---&gt;类型---&gt;钉钉<br>---&gt;收件人---&gt;要@的人的手机号<br>---&gt;当启用时---&gt;这个设置的是报警的时间设置<br>---&gt;添加<br>---&gt;然后直接点击更新<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/c88601a9e6538c25.jpg" alt="image"></p><p>更新。</p><p><img src="http://t.eryajf.net/imgs/2021/09/7473c97e11ff90f2.jpg" alt="image"></p><h3 id="12-配置提示"><a href="#12-配置提示" class="headerlink" title="12. 配置提示"></a>12. 配置提示</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">---&gt;点击右上角用户头像<br>---&gt;选择正在发送消息<br>---&gt;选中前端消息<br>---&gt;下边的全选中，，更新。<br></code></pre></td></tr></table></figure><p><img src="http://t.eryajf.net/imgs/2021/09/c216ff87b55c344d.jpg" alt="image"></p><p>测试 直接把监控的nginx服务器网卡断掉，然后等待报警！！！</p><p><img src="http://t.eryajf.net/imgs/2021/09/3aae964bb5c5fc90.jpg" alt="image"></p><p>现在再将网卡链接，看等会儿会是怎样的报警。</p><p>这样，一个非常给力好用的zabbix结合钉钉的报警就配置完成了。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-compose-volumes的说明</title>
    <link href="/2023/05/15/docker-compose-volumes%E7%9A%84%E8%AF%B4%E6%98%8E/"/>
    <url>/2023/05/15/docker-compose-volumes%E7%9A%84%E8%AF%B4%E6%98%8E/</url>
    
    <content type="html"><![CDATA[<h3 id="docker-compose中有两种方式可以设置数据持久化。"><a href="#docker-compose中有两种方式可以设置数据持久化。" class="headerlink" title="docker-compose中有两种方式可以设置数据持久化。"></a>docker-compose中有两种方式可以设置数据持久化。</h3><h4 id="1-绝对路径"><a href="#1-绝对路径" class="headerlink" title="1.绝对路径"></a>1.绝对路径</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mariadb:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> [<span class="hljs-string">直接使用宿主机的本地路径</span>]<span class="hljs-string">:/var/lib/mysql</span><br></code></pre></td></tr></table></figure><p>使用绝对路径直接挂载到本地，直观易于查看，但需要管理本地的路径。</p><h4 id="2-卷标"><a href="#2-卷标" class="headerlink" title="2.卷标"></a>2.卷标</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mariadb:latest</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> [<span class="hljs-string">卷标名称</span>]<span class="hljs-string">:/var/lib/mysql</span><br><br><span class="hljs-attr">volumes:</span><br>  [<span class="hljs-string">卷标名称</span>]<span class="hljs-string">:</span><br></code></pre></td></tr></table></figure><p>使用卷标的方式，简洁易于管理，但是数据实际存放的位置需要费点周折才能看到。</p><p>查看卷标的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker volume inspect [卷标名称]<br><span class="hljs-comment">#输出的信息中 Mountpoint 即为数据实际存放的位置</span><br></code></pre></td></tr></table></figure><p>还可以查看所有的卷标</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker volume <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><h3 id="volumes与Bind-Mount的区别"><a href="#volumes与Bind-Mount的区别" class="headerlink" title="volumes与Bind Mount的区别"></a>volumes与Bind Mount的区别</h3><table><thead><tr><th>不同点</th><th>volumes</th><th>bind mounts</th></tr></thead><tbody><tr><td>Source位置</td><td>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;…</td><td>可以任意指定</td></tr><tr><td>对已有挂载点影响</td><td>在容器第一次启动的时候，容器内映射目录的数据复制到volume</td><td>宿主机路径下的文件，覆盖掉容器内挂载路径文件的内容</td></tr><tr><td>是否支持单个文件映射</td><td>不支持，只能是目录</td><td>支持</td></tr><tr><td>权限控制</td><td>读写或者只读</td><td>读写或者只读</td></tr><tr><td>移植性</td><td>强，无需指定宿主机文件目录，默认在<code>/var/lib/docker/volumes/</code>目录下</td><td>弱，与宿主机绝对路径强绑定</td></tr></tbody></table><h4 id="1-关于volumes移植性强的解释"><a href="#1-关于volumes移植性强的解释" class="headerlink" title="1.关于volumes移植性强的解释"></a>1.关于volumes移植性强的解释</h4><p>假设我们现在有一百台服务器，我们希望nginx容器在任何一台服务器上启动都使用同样的配置，达到同样的运行效果，该怎么做？</p><ul><li><p>如果是Bind Mount，Source文件路径你可以随意指定、随意命名。如果想达到一定的规范度，只能从制度上进行规范，在技术上很难限制。</p></li><li><p>如果是volumes，运维人员创建的Volume只要名称是一致的，就可以认为文件路径是一致的，默认统一的放在&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;目录下。假如某天某个服务器&#x2F;var&#x2F;lib&#x2F;docker磁盘空间不足，我们只需要重新挂载一个服务器硬盘，将&#x2F;var&#x2F;lib&#x2F;docker的文件及目录整体迁移至新硬盘的新路径即可，修改docker默认存储路径为新路径，就对于容器的运行没有任何影响。</p></li></ul><h4 id="2-如何修改docker默认存储路径-x2F-var-x2F-lib-x2F-docker"><a href="#2-如何修改docker默认存储路径-x2F-var-x2F-lib-x2F-docker" class="headerlink" title="2.如何修改docker默认存储路径&#x2F;var&#x2F;lib&#x2F;docker"></a>2.如何修改docker默认存储路径&#x2F;var&#x2F;lib&#x2F;docker</h4><p>vim &#x2F;etc&#x2F;docker&#x2F;daemon.json ,添加如下内容:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;data-root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/data/docker&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>文件修改之后，重启docker引擎（需要注意的是：修改默认存储路径，如果你不希望原始的镜像及容器、数据卷等丢失，请先进行数据迁移。）</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload<br><span class="hljs-params">system</span>ctl restart docker <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>命令</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafka实战：跨机房传输数据</title>
    <link href="/2023/05/06/Kafka%E5%AE%9E%E6%88%98%EF%BC%9A%E8%B7%A8%E6%9C%BA%E6%88%BF%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE/"/>
    <url>/2023/05/06/Kafka%E5%AE%9E%E6%88%98%EF%BC%9A%E8%B7%A8%E6%9C%BA%E6%88%BF%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>工作中遇到Kafka跨机房传输到远程机房的场景，之前的方案是使用Flume消费后转发到目标kafka，当topic增多并且数据量变大后，维护性较差且Flume较耗费资源。</p></blockquote><h2 id="一、原理"><a href="#一、原理" class="headerlink" title="一、原理"></a>一、原理</h2><p>MirrorMaker 为Kafka 内置的跨集群&#x2F;机房数据复制工具，二进制包解压后bin目录下有kafka-mirror-maker.sh，Mirror Maker启动后，包含了一组消费者，这些消费者属于同一个group，并从多个topic上读取数据，所有的topic均使用该group.id，每个MirrorMaker 进程仅有一个生产者，该生产者将数据发送给目标集群的多个topic；</p><p>Kafka MirrorMaker的官方文档一直没有更新，因此新版Kafka为MirrorMaker增加的一些参数、特性等在文档上往往找不到，需要看Kafka MirrorMaker的源码，Kafka MirrorMaker启动脚步如下，发现其主类位于kafka.tools.MirrorMaker，尤其是一些参数的解析逻辑和主要的执行流程，会比较有助于我们理解和运维Kafka MirrorMaker；</p><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span> $(<span class="hljs-built_in">dirname</span> <span class="hljs-variable">$0</span>)/kafka-run-class.sh kafka.tools.MirrorMaker <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br></code></pre></td></tr></table></figure><p>　　</p><p>MirrorMaker 为每个消费者分配一个线程，消费者从源集群的topic和分区上读取数据，然后通过公共生产者将数据发送到目标集群上，官方建议尽量让 MirrorMaker 运行在目标数据中心里，因为长距离的跨机房网络相对而言更加不可靠，如果发生了网络分区，数据中心之间断开了连接，无法连接到集群的消费者要比一个无法连接到集群的生产者要安全得多。</p><p>如果消费者无法连接到集群，最多也就是无法消费数据，数据仍然会在 Kafka 集群里保留很长的一段时间，不会有丢失的风险。相反，在发生网络分区时如果 MirrorMaker 已经读取了数据，但无法将数据生产到目标集群上，就会造成数据丢失。所以说远程读取比远程生成更加安全。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/06/Kafka%E5%AE%9E%E6%88%98%EF%BC%9A%E8%B7%A8%E6%9C%BA%E6%88%BF%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE/v2-57c138d0b253e643d839821d558ca8df_720w.png?raw=true"></p><h3 id="建议："><a href="#建议：" class="headerlink" title="建议："></a>建议：</h3><ol><li>建议启动多个kafak-mirror-maker.sh 进程来完成数据同步，这样就算有进程挂掉，topic的同组消费者可以进行reblance；</li><li>建议将kafka-mirror-maker.sh进程启动在目标集群，原因上文有提及；</li><li>kafak-mirror-maker.sh启动默认不会后台运行，调用kafka-run-class.sh的启动内存256M，需要修改一下启动参数（内存大小、日志）；</li><li>建议对source 集群的whitelist中的topic的消费情况，加实时的积压量监控；</li><li>建议producer.properties配置中开启auto.create.topics.enable&#x3D;true；</li></ol><h2 id="二、使用和配置"><a href="#二、使用和配置" class="headerlink" title="二、使用和配置"></a>二、使用和配置</h2><ul><li>二进制包下载地址</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#官网下载页面：</span><br><span class="hljs-attribute">https</span>://kafka.apache.org/downloads<br><span class="hljs-comment">#根据需要选择版本</span><br><span class="hljs-attribute">https</span>://downloads.apache.org/kafka/<span class="hljs-number">3</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>/kafka_2.<span class="hljs-number">13</span>-<span class="hljs-number">3</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.tgz<br></code></pre></td></tr></table></figure><ul><li>消费端配置（consumer.properties）</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">‍zookeeper.<span class="hljs-attribute">connect</span>=zk1:2181,zk2:2181,zk3:2181<br> <br>group.<span class="hljs-attribute">id</span>=groupyzg-02<br> <br><span class="hljs-comment"># 选取镜像数据的起始 即镜像MirrorMaker启动后的数据，参数latest，还是镜像之前的数据，参数earliest</span><br> <br>auto.offset.<span class="hljs-attribute">reset</span>=largest<br> <br><span class="hljs-comment"># 更改分区策略，默认是range，虽然有一定优势但会导致不公平现象，特别是镜像大量的主题和分区的时候,0.10版本设置</span><br> <br>partition.assignment.<span class="hljs-attribute">strategy</span>=roundrobin<br></code></pre></td></tr></table></figure><p>　　</p><p>source kafka版本是1.0，配置bootstrap-server指定kafka集群地址，配置方式如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">bootstrap.servers</span>=kafka1:<span class="hljs-number">9092</span>,kafka2:<span class="hljs-number">9092</span>,kafka3:<span class="hljs-number">9092</span><br> <br><span class="hljs-attr">group.id</span>=groupyzg-<span class="hljs-number">02</span><br> <br>  <br> <br><span class="hljs-comment"># 选取镜像数据的起始？即镜像MirrorMaker启动后的数据，参数latest，还是镜像之前的数据，参数earliest</span><br> <br><span class="hljs-attr">auto.offset.reset</span>=latest<br> <br>  <br> <br><span class="hljs-comment"># 消费者提交心跳周期，默认3000，由于是远程镜像，此处设为30秒</span><br> <br><span class="hljs-attr">heartbeat.interval.ms</span>=<span class="hljs-number">30000</span><br> <br>  <br> <br><span class="hljs-comment"># 消费连接超时值，默认10000，由于远程镜像，此处设为100秒</span><br> <br><span class="hljs-attr">session.timeout.ms</span>=<span class="hljs-number">100000</span><br> <br>  <br> <br><span class="hljs-comment"># 更改分区策略，默认是range，虽然有一定优势但会导致不公平现象，特别是镜像大量的主题和分区的时候</span><br> <br><span class="hljs-attr">partition.assignment.strategy</span>=org.apache.kafka.clients.consumer.RoundRobinAssignor<br> <br>  <br> <br><span class="hljs-comment"># 单个poll()执行的最大record数，默认是500</span><br> <br><span class="hljs-attr">max.poll.records</span>=<span class="hljs-number">20000</span><br> <br>  <br> <br><span class="hljs-comment"># 读数据时tcp接收缓冲区大小，默认是65536（64KiB）</span><br> <br><span class="hljs-attr">receive.buffer.bytes</span>=<span class="hljs-number">4194304</span><br> <br>  <br> <br><span class="hljs-comment"># 设置每个分区总的大小，默认是1048576</span><br> <br><span class="hljs-attr">max.partition.fetch.bytes</span>=<span class="hljs-number">10485760</span><br></code></pre></td></tr></table></figure><p>　　</p><ul><li>生产者配置（producer.properties）</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">bootstrap.servers</span> = <span class="hljs-number">192.168</span>.xxx:<span class="hljs-number">9092</span>,<span class="hljs-number">192.168</span>.xxx:<span class="hljs-number">9092</span><br> <br><span class="hljs-attr">buffer.memory</span> = <span class="hljs-number">268435456</span><br> <br><span class="hljs-attr">batch.size</span> = <span class="hljs-number">104857</span><br> <br><span class="hljs-attr">acks</span>=<span class="hljs-number">0</span><br> <br><span class="hljs-attr">linger.ms</span>=<span class="hljs-number">10</span><br> <br><span class="hljs-attr">max.request.size</span> = <span class="hljs-number">10485760</span><br> <br><span class="hljs-attr">send.buffer.bytes</span> = <span class="hljs-number">10485760</span><br> <br><span class="hljs-attr">compression.type</span>=snappy<br></code></pre></td></tr></table></figure><p>　　</p><ul><li>启动、优化、日志监控</li></ul><p>启动命令kafka-mirror-maker.sh中添加端口约束和启动内存配置：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">export KAFKA_HEAP_OPTS=&quot;-Xmx4G -Xms4G&quot;<br> <br>export JMX_PORT=&quot;8888&quot;<br> <br>exec $(dirname $0)/kafka-run-class.sh kafka.tools.MirrorMaker&quot;$@&quot;<br></code></pre></td></tr></table></figure><p>　　</p><p>日志监控：若想输出日志数据，则使用一下命令启动，日志数据会保存在kafka&#x2F;logs&#x2F;_mirror_maker.out 中；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sh bin/kafka-run-class.sh -daemon -name mirror_maker -loggc kafka.tools.MirrorMaker --consumer.config config/consumer.properties --num.streams 2 --producer.config config/producer.properties  --whitelist=<span class="hljs-string">&#x27;testnet&#x27;</span><br></code></pre></td></tr></table></figure><p>　　</p><ul><li>积压监控：</li></ul><p>0.10版本的积压量监控：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./kafka-run-class.sh kafka.tools.ConsumerOffsetChecker--zookeeper xxxx:21810,xxx:21810,xxx:21810--topic testnet -group testnet-group<br></code></pre></td></tr></table></figure><p>　　</p><p>1.0版本的积压量监控：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./kafka-consumer-groups.sh --bootstrap-server xxx:9092--describe --group testnet-group<br></code></pre></td></tr></table></figure><ul><li>命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#查看消费组列表</span><br> ./kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list<br><br><span class="hljs-comment">#查看消费组消费情况</span><br> ./kafka-consumer-groups.sh --bootstrap-server 127.0.0.1:9092 --describe --group xxx<br><br><span class="hljs-comment">#查看topic列表</span><br>./kafka-topics.sh --bootstrap-server 127.0.0.1:9092 --list<br></code></pre></td></tr></table></figure><p>进程数监控：建议增加mirror-maker的进程数监控，及时发现并启动挂点进程；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br> <br><span class="hljs-comment">###################</span><br> <br><span class="hljs-comment">#</span><br> <br><span class="hljs-comment"># info :5 mins to check last 5mins logs</span><br> <br><span class="hljs-comment"># add by deploy</span><br> <br><span class="hljs-comment"># date:20190917</span><br> <br><span class="hljs-comment">#</span><br> <br><span class="hljs-comment">###################</span><br> <br>  <br> <br><span class="hljs-comment">#当前时间</span><br> <br>sj=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%F %T&quot;</span>`<br> <br><span class="hljs-comment">#当前时间5分钟前</span><br> <br>last_sj=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%F %T&quot;</span> -d <span class="hljs-string">&#x27;-5 min&#x27;</span>`<br> <br><span class="hljs-comment">#定义目录</span><br> <br>runlog=~/kafka_2.11-1.0.0/alarm/run.log<br> <br><span class="hljs-comment">#通知手机号</span><br> <br>noticetel=<span class="hljs-string">&quot;138XXXXXXXX&quot;</span><br> <br>province=~/kafka_2.11-1.0.0/alarm/province.cfg<br> <br>tmplog=~/kafka_2.11-1.0.0/alarm/tmp.log<br> <br>  <br> <br><span class="hljs-comment">###短信通知,也可以使用邮箱通知服务</span><br> <br><span class="hljs-function"><span class="hljs-title">smsnotice</span></span>()&#123;<br> <br>info=<span class="hljs-variable">$@</span><br> <br>IFS=<span class="hljs-string">&quot;,&quot;</span><br> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">$noticetel</span>;<span class="hljs-keyword">do</span><br> <br>curl -kd xx<br> <br><span class="hljs-comment">#curl -D - -kd xx</span><br> <br><span class="hljs-keyword">done</span><br> <br>&#125;<br> <br>  <br> <br>  <br> <br><span class="hljs-comment">###判断mirror-maker的进程个数；</span><br> <br>province_all=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$&#123;province&#125;</span>|<span class="hljs-built_in">wc</span> -l`<br> <br>mount=`ps -ef|grep -i mirror_maker-gc |<span class="hljs-built_in">wc</span> -l`<br> <br>  <br> <br>ps -ef|grep -i mirror_maker-gc &gt;<span class="hljs-variable">$&#123;tmplog&#125;</span><br> <br>  <br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;the mount of mirror-maker is `expr <span class="hljs-variable">$mount</span> - 1`!&quot;</span>&gt; <span class="hljs-variable">$runlog</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;the mount of province config is <span class="hljs-variable">$province_all</span> ! &quot;</span>&gt;&gt; <span class="hljs-variable">$runlog</span><br> <br><span class="hljs-keyword">if</span> [ `<span class="hljs-built_in">expr</span> <span class="hljs-variable">$mount</span> - 1` -ge <span class="hljs-variable">$province_all</span> ] ;<span class="hljs-keyword">then</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;`hostname -i` ----<span class="hljs-variable">$&#123;sj&#125;</span> ---- the mirrormaker is ok!&quot;</span> &gt;&gt; <span class="hljs-variable">$runlog</span><br> <br><span class="hljs-keyword">else</span><br> <br>message=<span class="hljs-string">&quot;`hostname -i` ----<span class="hljs-variable">$&#123;sj&#125;</span> ----the mount mirror-maker processor `expr <span class="hljs-variable">$mount</span> - 1` is less than the mount of province_config <span class="hljs-variable">$province_all</span>, &quot;</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;message&#125;</span> &gt;&gt; <span class="hljs-variable">$runlog</span><br> <br><span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line<br> <br><span class="hljs-keyword">do</span><br> <br>province_name=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;line&#125;</span>|awk -F <span class="hljs-string">&#x27;|&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>`<br> <br>province_code=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;line&#125;</span>|awk -F <span class="hljs-string">&#x27;|&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br> <br>mount_two=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$&#123;tmplog&#125;</span>|grep -i <span class="hljs-variable">$&#123;province_code&#125;</span> |<span class="hljs-built_in">wc</span> -l`<br> <br>  <br> <br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$mount_two</span> -ge 1 ] ;<span class="hljs-keyword">then</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;`hostname -i` ----<span class="hljs-variable">$&#123;sj&#125;</span> ---- the province of <span class="hljs-variable">$&#123;province_name&#125;</span> is ok!&quot;</span> &gt;&gt; <span class="hljs-variable">$runlog</span><br> <br><span class="hljs-keyword">else</span><br> <br>message_two=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;message&#125;</span> the province of [ <span class="hljs-variable">$&#123;province_name&#125;</span> ] mirror-maker processor is down, please check for it!&quot;</span><br> <br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$&#123;message_two&#125;</span> &gt;&gt; <span class="hljs-variable">$runlog</span><br> <br>smsnotice <span class="hljs-variable">$&#123;message_two&#125;</span><br> <br><span class="hljs-keyword">fi</span><br> <br><span class="hljs-keyword">done</span>&lt;<span class="hljs-variable">$&#123;province&#125;</span><br> <br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>中间件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Thanos介绍</title>
    <link href="/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/"/>
    <url>/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<p>鉴于Prometheus的火爆，目前市面上已有不少第三方的开源解决方案用于完善高可用、高并发和数据持久化等问题。</p><p>Thanos(灭霸）即是其中之一，也是目前较为流行的解决方案，本文将对其进行介绍。</p><h2 id="1、产品介绍"><a href="#1、产品介绍" class="headerlink" title="1、产品介绍"></a>1、产品介绍</h2><p>Thanos为英国游戏技术公司Improbable 开源的一套监控解决方案，它包含多个功能组件，可以使用无侵入的方式与Prometheus配合部署，从而实现全局查询 、跨集群存储等能力，能够较好地的提升Prometheus的高可用性与扩展性。</p><p>源码地址仓库：<a href="https://github.com/thanos-io/thanos">https://github.com/thanos-io/thanos</a></p><p>官网地址：<a href="https://thanos.io/">https://thanos.io/</a><br><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/Snipaste_2023-05-05_19-17-24.png?raw=true"></p><p>该产品具有以下特点：</p><p>1、可实现跨集群的全局查询功能；</p><p>2、兼容现有的Prometheus API 接口 ，从而实现无缝集成；</p><p>3、提供数据压缩和降准采样功能，提升查询速度；</p><p>4、重复数据删除与合并，可从Pormetheus HA 集群中收集指标；</p><p>5、支持多种对象存储系统，包括S3、微软Azure、腾讯COS、Google GCP、Openstack Swift 等，可支撑大规模数据的长期存储；</p><h2 id="2、功能组件"><a href="#2、功能组件" class="headerlink" title="2、功能组件"></a>2、功能组件</h2><p>Thanos包含以下主要功能组件：</p><p><strong>Sidecar（边车组件）</strong><br>Thanos通过该组件实现与Prometheus的集成，配置Sidecar连接Prometheus后，可读取数据给到Querier进行实时查询。另外，通过Sidecar还可以将Prometheus采集的数据上传到对象存储进行保存。</p><p>该组件必须与Prometheus运行在同一台机器或同一个Pod中。</p><p><strong>Querier（查询组件）</strong><br>该组件具有与Prometheus兼容的API并支持Prom语法，与其他组件（Sidecar或Store Gateway）一起协同工作，用于查询Prometheus的数据指标和做为Grafana的监控展示数据源。</p><p><strong>Store Gateway（存储网关）</strong><br>该组件实现与Sidercar一致的API提供给Querier进行查询，当Sidecar将数据存储到对象存储后，Prometheus会清理掉本地数据保证本地空间可用。当Querier需要调取历史数据时，则会通过Store Gateway读取对象存储中保存的数据。</p><p><strong>Comactor（压缩组件）</strong><br>主要用于对采集到的数据进行压缩和降采样，以提升对长期数据的查询效率。</p><p><strong>Ruler（规则组件）</strong><br>用于对多个Alertmanager的告警规则进行统一管理 。</p><p><strong>Receiver（接收器）</strong><br>接收Promehtus的 remote-write数据，用于Receiver模式下的数据收集。</p><p>Thanos有两种运行模式，分别为Sidecar和Receiver，区别在于Sidercar主动获取Prometheus数据，而Receiver则是被动接收remote-write传送的数据。由于Receiver模式很少使用，本文不做介绍，只讲解Sidercar模式。</p><p>Sidercar模式官方架构图：</p><p>Deployment with Thanos Sidecar for Kubernetes:</p><p><img src="https://docs.google.com/drawings/d/e/2PACX-1vSJd32gPh8-MC5Ko0-P-v1KQ0Xnxa0qmsVXowtkwVGlczGfVW-Vd415Y6F129zvh3y0vHLBZcJeZEoz/pub?w=960&h=720" alt="Sidecar"></p><p>Deployment via Receive in order to scale out or integrate with other remote write-compatible sources:</p><p><img src="https://docs.google.com/drawings/d/e/2PACX-1vRdYP__uDuygGR5ym1dxBzU6LEx5v7Rs1cAUKPsl5BZrRGVl5YIj5lsD_FOljeIVOGWatdAI9pazbCP/pub?w=960&h=720" alt="Receive"></p><h2 id="3、Prometheus配置"><a href="#3、Prometheus配置" class="headerlink" title="3、Prometheus配置"></a>3、Prometheus配置</h2><p>Thanos本身并不从目标实例处采集指标，监控指标的采集依然由Prometheus来完成。Thanos对Prometheus的版本有要求，需要部署2.21版本以上。</p><p>在本文示例中，我们部署两个Prometheus节点，分别为prom1和prom2，用于实现高可用的功能。</p><p>Prometheus相关的安装部署方法可参见前面的文章 ，此处不再过多叙述。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">prom1</span>：<span class="hljs-number">192.168.75.168</span> promethues + thanos sidecar + thanos store gateway + thanos query<br><span class="hljs-attribute">prom2</span>: <span class="hljs-number">192.168.75.169</span> promethues + thanos sidecar + thanos store gateway + thanos query<br></code></pre></td></tr></table></figure><p>在高可用的情况下，由于数据会有重复，需要在external_labels的标签集区分不同的实例。本文通过增加replica标签做区分 ，在不同的实例填不同的值，如0或1。</p><p>注意：标签区分这一步非常重要，因为Thanos的数据去重功能依赖external_labels来区分不同的实例。</p><p>prom1</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">global:</span><br><span class="hljs-symbol">  scrape_interval:</span>     <span class="hljs-number">30</span>s<br><span class="hljs-symbol">  evaluation_interval:</span> <span class="hljs-number">60</span>s<br><span class="hljs-symbol">  external_labels:</span><br><span class="hljs-symbol">    env:</span> dev<br><span class="hljs-symbol">    replica:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>prom2</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">global:</span><br><span class="hljs-symbol">  scrape_interval:</span>     <span class="hljs-number">15</span>s<br><span class="hljs-symbol">  evaluation_interval:</span> <span class="hljs-number">15</span>s<br><span class="hljs-symbol">  external_labels:</span><br><span class="hljs-symbol">    env:</span> dev<br><span class="hljs-symbol">    replica:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>启动Prometheus</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">prometheus  \<br>   <span class="hljs-attr">--config</span>.file=/usr/local/prometheus/prometheus<span class="hljs-selector-class">.yml</span> \<br>   <span class="hljs-attr">--storage</span><span class="hljs-selector-class">.tsdb</span>.path=/usr/local/prometheus/data \<br>   <span class="hljs-attr">--web</span>.listen-address=<span class="hljs-string">&#x27;0.0.0.0:9090&#x27;</span> \<br>   <span class="hljs-attr">--storage</span><span class="hljs-selector-class">.tsdb</span>.max-block-duration=<span class="hljs-number">2</span>h \<br>   <span class="hljs-attr">--storage</span><span class="hljs-selector-class">.tsdb</span>.min-block-duration=<span class="hljs-number">2</span>h \<br>   <span class="hljs-attr">--storage</span><span class="hljs-selector-class">.tsdb</span>.retention=<span class="hljs-number">2</span>h \<br>   <span class="hljs-attr">--web</span><span class="hljs-selector-class">.enable-lifecycle</span> &amp;<br></code></pre></td></tr></table></figure><p>配置Prometheus.service</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim /etc/systemd/system/prometheus.service<br>[Unit]<br><span class="hljs-attribute">Description</span>=Prometheus<span class="hljs-built_in"> Server</span><br><span class="hljs-built_in"></span><span class="hljs-attribute">Documentation</span>=https://prometheus.io/docs/introduction/overview/<br><span class="hljs-attribute">After</span>=network-online.target<br><br>[Service]<br><span class="hljs-attribute">Restart</span>=on-failure<br><span class="hljs-attribute">ExecStart</span>=/usr/local/prometheus/prometheus --config.<span class="hljs-attribute">file</span>=/usr/local/prometheus/prometheus.yml --storage.tsdb.<span class="hljs-attribute">path</span>=/usr/local/prometheus/data --storage.tsdb.<span class="hljs-attribute">min-block-duration</span>=2h --storage.tsdb.<span class="hljs-attribute">max-block-duration</span>=2h --storage.tsdb.<span class="hljs-attribute">retention</span>=2h --storage.tsdb.wal-compression --web.enable-lifecycle --log.<span class="hljs-attribute">level</span>=info --web.<span class="hljs-attribute">listen-address</span>=0.0.0.0:9090<br><br>[Install]<br><span class="hljs-attribute">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p><code>systemctl daemon-reload &amp;&amp; systemctl enable prometheus &amp;&amp; systemctl start prometheus &amp;&amp; systemctl status prometheus</code></p><p>注释：</p><ul><li><code>--storage.tsdb.min-block-duration</code>和<code>--storage.tsdb.min-block-duration</code>参数必须添加且配置相同的值，用于关闭Prometheus的本地压缩功能，否则在使用compactor在压缩数据时会出现问题，并且会在Sidecar启动时报错；</li><li><code>--storage.tsdb.retention.time</code>配置本地只保留两小时数据，减少空间占用；</li><li><code>--web.enable-lifecycle</code> 用于支持Webhook方式重新加载Prometheus配置。Sidercar会关注Prometheus的配置文件，并在出现变化时通过Webhook方式让Prometheus自动更新配置。</li></ul><p>打开浏览器，访问http:&#x2F;&#x2F;$IP:9090，可以看到Prometheus已正常启动。<br><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/promrtheus%E7%95%8C%E9%9D%A2.png?raw=true"></p><h2 id="4、部署Thanos"><a href="#4、部署Thanos" class="headerlink" title="4、部署Thanos"></a>4、部署Thanos</h2><h3 id="4-1-集群架构"><a href="#4-1-集群架构" class="headerlink" title="4.1 集群架构"></a>4.1 集群架构</h3><p>我们在上面的两个Prometheus的节点服务器中部署Sidercar，用于获取监控数据。同时，配置历史数据写入到对象存储中进行持久化保存。部署一个Store Gateway对接对象存储，而Compactor组件会定时对存储中数据进行压缩索引及降采样操作。</p><p>Querier做为面向用户的组件，对接Sidercar和Store Gateway获取数据并进行展示。（另外还有的Receiver和ruler组件由于使用不是很多，本文不做介绍，有需要可自行查阅。）<br><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/2189604c49014e9aae508311e67ba0ec.jpg?raw=true"></p><h3 id="4-2-下载安装包"><a href="#4-2-下载安装包" class="headerlink" title="4.2 下载安装包"></a>4.2 下载安装包</h3><p>Thanos虽然有多个功能组件，但都是使用同一个二进制文件进行部署，通过不同的启动命令启用不同的功能，非常方便。</p><p>此处我们下载当前的<code>v0.23.1</code>版本，并将解压的二进制文件放到bin目录中。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/thanos-io/</span>thanos<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v0.23.1/</span>thanos-<span class="hljs-number">0.23</span>.<span class="hljs-number">1</span>.linux-amd64.tar.gz<br>tar -xvf thanos-<span class="hljs-number">0.23</span>.<span class="hljs-number">1</span>.linux-amd64.tar.gz <br>cd thanos-<span class="hljs-number">0.23</span>.<span class="hljs-number">1</span>.linux-amd64<br>mv thanos  <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span><br></code></pre></td></tr></table></figure><h3 id="4-3-Sidecar部署"><a href="#4-3-Sidecar部署" class="headerlink" title="4.3 Sidecar部署"></a>4.3 Sidecar部署</h3><p>Sidercar为Thanos的关键组件，通过Sidercar实现了与Prometheus的无缝集成。Sidercar对Prometheus的实例几乎没有任何影响，Prometheus依然做为一个独立的实例运行，你不需要对其配置进行修改。</p><p>Siderca提供了一个数据API，用于我们查询Prometheus中的指标数据，同时默认会将超过两个小时的数据上传到对象存储 ，进行备份保存。</p><p>Sidercar组件必须与Prometheus运行在同一台机器或同一个Kubernetes Pod中，启动命令如下所示：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">thanos sidecar \<br>    <span class="hljs-attr">--tsdb</span><span class="hljs-selector-class">.path</span>              /usr/local/prometheus/data/ \<br>    <span class="hljs-attr">--prometheus</span><span class="hljs-selector-class">.url</span>         http:<span class="hljs-comment">//localhost:9090 \</span><br>    <span class="hljs-attr">--objstore</span><span class="hljs-selector-class">.config-file</span>   bucket_config<span class="hljs-selector-class">.yaml</span> \<br>    <span class="hljs-attr">--http-address</span>              <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">19191</span> \<br>    <span class="hljs-attr">--grpc-address</span>              <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">19091</span> &amp;<br></code></pre></td></tr></table></figure><p>配置thanos-sidecar.service</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim /etc/systemd/system/thanos-sidecar.service<br>[Unit]<br><span class="hljs-attribute">Description</span>=Thanos Sidecar<br><span class="hljs-attribute">After</span>=network-online.target<br><br>[Service]<br><span class="hljs-attribute">Restart</span>=on-failure<br><span class="hljs-comment"># --prometheus.url=http://localhost:9090 --&gt; 指定本节点的 prometheus 地址</span><br><span class="hljs-comment"># --tsdb.path=/usr/local/prometheus/data/ --&gt; 指定本节点的 prometheus 数据目录</span><br><span class="hljs-attribute">ExecStart</span>=/usr/local/thanos/thanos sidecar --prometheus.<span class="hljs-attribute">url</span>=http://localhost:9090 --tsdb.<span class="hljs-attribute">path</span>=/usr/local/prometheus/data/ --objstore.<span class="hljs-attribute">config-file</span>=/root/bucket_config.yaml <span class="hljs-attribute">--grpc-address</span>=0.0.0.0:19090 <span class="hljs-attribute">--http-address</span>=0.0.0.0:19091<br><br>[Install]<br><span class="hljs-attribute">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl daemon-reload &amp;&amp; <span class="hljs-params">system</span>ctl enable thanos-sidecar &amp;&amp; <span class="hljs-params">system</span>ctl start thanos-sidecar &amp;&amp; <span class="hljs-params">system</span>ctl status thanos-sidecar<br></code></pre></td></tr></table></figure><p>注释：</p><ul><li><code>–tsdb.path</code> 用于指定Prometheus 数据存储路径；</li><li><code>–prometheus.url</code> 指定Prometheus访问地址；</li><li><code>–objstore.config-file</code> 设置上传数据的对象存储信息；</li><li><code>–http-address</code> 配置http端口，用于提供Sidercar的metrics信息；</li><li><code>–grpc-address</code> 配置grpc端口，用于与其他Thanos组件通信；</li></ul><p>Thanos支持多种对象存储及本地文件系统，如下列表所示：</p><table><thead><tr><th>Provider</th><th>Maturity</th><th>Aimed For</th><th>Auto-tested on CI</th><th>Maintainers</th></tr></thead><tbody><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#gcs">Google Cloud Storage</a></td><td>Stable</td><td>Production Usage</td><td>yes</td><td>@bwplotka</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#s3">AWS&#x2F;S3</a> (and all S3-compatible storages e.g disk-based <a href="https://min.io/">Minio</a>)</td><td>Stable</td><td>Production Usage</td><td>yes</td><td>@bwplotka</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#azure">Azure Storage Account</a></td><td>Stable</td><td>Production Usage</td><td>no</td><td>@vglafirov</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#openstack-swift">OpenStack Swift</a></td><td>Beta (working PoC)</td><td>Production Usage</td><td>yes</td><td>@FUSAKLA</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#tencent-cos">Tencent COS</a></td><td>Beta</td><td>Production Usage</td><td>no</td><td>@jojohappy,@hanjm</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#aliyun-oss">AliYun OSS</a></td><td>Beta</td><td>Production Usage</td><td>no</td><td>@shaulboozhiao,@wujinhu</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#filesystem">Local Filesystem</a></td><td>Stable</td><td>Testing and Demo only</td><td>yes</td><td>@bwplotka</td></tr><tr><td><a href="https://thanos.io/tip/thanos/storage.md/#oracle-cloud-infrastructure-object-storage">Oracle Cloud Infrastructure Object Storage</a></td><td>Beta</td><td>Production Usage</td><td>yes</td><td>@aarontams,@gaurav-05,@ericrrath</td></tr></tbody></table><p>以阿里云的oss为例，如下为bucket.yml配置格式（<code>阿里云OSS需要自行开通并配置access_key_id和access_key_secret</code>）：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">type:</span> ALIYUNOSS<br><span class="hljs-symbol">config:</span><br><span class="hljs-symbol">  endpoint:</span> <span class="hljs-string">&quot;oss-cn-shenzhen.aliyuncs.com&quot;</span><br><span class="hljs-symbol">  bucket:</span> <span class="hljs-string">&quot;XXX&quot;</span><br><span class="hljs-symbol">  access_key_id:</span> <span class="hljs-string">&quot;XXX&quot;</span><br><span class="hljs-symbol">  access_key_secret:</span> <span class="hljs-string">&quot;XXX&quot;</span><br></code></pre></td></tr></table></figure><p>S3:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">type:</span> S3<br><span class="hljs-symbol">config:</span><br><span class="hljs-symbol">  bucket:</span> <span class="hljs-string">&quot;XXX&quot;</span><br><span class="hljs-symbol">  endpoint:</span> <span class="hljs-string">&quot;com.amazonaws.ap-east-1.s3&quot;</span><br><span class="hljs-symbol">  region:</span> <span class="hljs-string">&quot;ap-east-1&quot;</span><br><span class="hljs-symbol">  access_key:</span> <span class="hljs-string">&quot;XXX&quot;</span><br><span class="hljs-symbol">  secret_key:</span> <span class="hljs-string">&quot;XXX&quot;</span><br></code></pre></td></tr></table></figure><p>Sidecar默认会每隔两个小时备份数据到对象存储，当Sidercar运行超过两个小时后，我们可以在对象存储中看到备份的数据。</p><h3 id="4-4-Store-Gateway部署"><a href="#4-4-Store-Gateway部署" class="headerlink" title="4.4 Store Gateway部署"></a>4.4 Store Gateway部署</h3><p>当Sidercar把监控数据备份到对象存储后，我们只需要在Prometheus中保留短期的数据，如数个小时。这样可以减少Prometheus的压力，也可用于应付大部分的查询 。当需要查询历史数据时，我们可以通过Store Gateway来查询对象存储中保存的数据。</p><p>Store Gateway 主要与对象存储交互，从对象存储获取已经保存的数据。Store Gateway实现与Sidecar一样的数据api，Querier组件可以从Store Gateway 查询历史数据。Store Gateway支持横向扩展，可配置多个Store Gateway拉取多个对象存储数据。</p><p>启动命令：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">thanos store \<br>    <span class="hljs-attr">--data-dir</span>             /usr/local/thanos/data \<br>    <span class="hljs-attr">--objstore</span><span class="hljs-selector-class">.config-file</span> bucket_config<span class="hljs-selector-class">.yaml</span> \<br>    <span class="hljs-attr">--http-address</span>         <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">19194</span> \<br>    <span class="hljs-attr">--grpc-address</span>         <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">19094</span> &amp;<br></code></pre></td></tr></table></figure><p>配置thanos-store-gateway.service</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim /etc/systemd/system/thanos-store-gateway.service<br>[Unit]<br><span class="hljs-attribute">Description</span>=Thanos Store Gateway<br><span class="hljs-attribute">After</span>=network-online.target<br><br>[Service]<br><span class="hljs-attribute">Restart</span>=on-failure<br><span class="hljs-attribute">ExecStart</span>=/usr/local/thanos/thanos store <span class="hljs-attribute">--data-dir</span>=/usr/local/thanos/data --objstore.<span class="hljs-attribute">config-file</span>=/root/bucket_config.yaml <span class="hljs-attribute">--http-address</span>=0.0.0.0:10902 <span class="hljs-attribute">--grpc-address</span>=0.0.0.0:10901<br><br>[Install]<br><span class="hljs-attribute">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p><code>systemctl daemon-reload &amp;&amp; systemctl enable thanos-store-gateway &amp;&amp; systemctl start thanos-store-gateway &amp;&amp; systemctl status thanos-store-gateway</code></p><p>注释 ：</p><ul><li><code>–data-dir</code> 配置缓存目录地址，Store Gateway会在本地磁盘上保留有关所有远程块的少量信息，并使其与存储桶保持同步；</li><li><code>–objstore.config-file</code> 设置对象存储信息，与Sidercar的配置一致；</li><li><code>–http-address</code> 配置http端口，用于提供访问界面和metrics信息；</li><li><code>–grpc-address</code> 配置grpc端口，用于与其他Thanos组件通信。</li></ul><p>程序启动后，打开浏览器访问<a href="http://192.168.75.168:10902/">http://192.168.75.168:10902/</a> , 可以看到对象存储中已存储的块信息（<code>需要等待2小时才会有数据上传</code>）。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/7ce44e317041489e8a8f92a1136bffc0.jpg?raw=true"></p><h3 id="4-5-Querier部署"><a href="#4-5-Querier部署" class="headerlink" title="4.5 Querier部署"></a>4.5 Querier部署</h3><p>前面我们已经配置好Sidercar和Store Gateway组件，接下来我们为Thanos配置一个全局查询界面，即Querier组件。Querier连接Sidercar后，会根据给定的PromQL查询自动检测需要联系哪些Prometheus服务器，当要查询历史数据时，则是通过Store Gateway查询对象存储内容。</p><p>Querier还提供与Prometheus官方一致的HTTP API，可以接入Grafana进行监控展示，并支持PromQL语法。</p><p>启动命令如下所示：</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">thanos</span> <span class="hljs-string">query</span> \<br>    <span class="hljs-built_in">--http-address</span> <span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0:19192 </span>\<br>    <span class="hljs-built_in">--grpc-address</span> <span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0</span>.<span class="hljs-string">0:19092 </span>\<br>    <span class="hljs-built_in">--query.replica-label</span> <span class="hljs-string">replica</span> \<br>    <span class="hljs-built_in">--store</span>        <span class="hljs-string">192</span>.<span class="hljs-string">168</span>.<span class="hljs-string">75</span>.<span class="hljs-string">168:19091 </span>\ <span class="hljs-comment">#prom1实例Sidercar地址</span><br>    <span class="hljs-built_in">--store</span>        <span class="hljs-string">192</span>.<span class="hljs-string">168</span>.<span class="hljs-string">75</span>.<span class="hljs-string">169:19091 </span>\ <span class="hljs-comment">#prom2实例Sidercar地址</span><br>    <span class="hljs-built_in">--store</span>        <span class="hljs-string">192</span>.<span class="hljs-string">168</span>.<span class="hljs-string">75</span>.<span class="hljs-string">168:19094 </span>&amp;   <span class="hljs-comment">#Store Gateway地址</span><br></code></pre></td></tr></table></figure><p>配置thanos-query.service</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim /etc/systemd/system/thanos-query.service<br>[Unit]<br><span class="hljs-attribute">Description</span>=Thanos Query<br><span class="hljs-attribute">After</span>=network-online.target<br><br>[Service]<br><span class="hljs-attribute">Restart</span>=on-failure<br><span class="hljs-comment"># --store=192.168.75.168:19090 --&gt; 请求当前节点 thanos sidecar 数据</span><br><span class="hljs-comment"># --store=192.168.75.169:19090 --&gt; 请求另外一个节点 thanos sidecar 数据</span><br><span class="hljs-comment"># --store=192.168.75.168:10901 --&gt; 请求当前节点 thanos store gateway 数据</span><br><span class="hljs-comment"># --store=192.168.75.169:10901 --&gt; 请求另外一个节点 thanos store gateway 数据</span><br><span class="hljs-comment"># --query.replica-label &quot;replica&quot; --query.replica-label &quot;region&quot; --&gt; 加上后，thanos query 查询同一节点的数据时，会自动去重</span><br><span class="hljs-attribute">ExecStart</span>=/usr/local/thanos/thanos query <span class="hljs-attribute">--http-address</span>=0.0.0.0:19192 --grpc-address 0.0.0.0:19092 <span class="hljs-attribute">--store</span>=192.168.75.168:19090 <span class="hljs-attribute">--store</span>=192.168.75.169:19090 <span class="hljs-attribute">--store</span>=192.168.75.168:10901 <span class="hljs-attribute">--store</span>=192.168.75.169:10901 --query.replica-label <span class="hljs-string">&quot;replica&quot;</span> --query.replica-label <span class="hljs-string">&quot;replica&quot;</span><br><br>[Install]<br><span class="hljs-attribute">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p><code>systemctl daemon-reload &amp;&amp; systemctl enable thanos-query &amp;&amp; systemctl start thanos-query &amp;&amp; systemctl status thanos-query</code></p><p>注释 ：</p><ul><li><code>–query.replica-label</code> 指定重复数据删除的标记label，query在查询数据时，将根据此label评估是否重复数据；</li><li><code>–store</code> 用于指定Sidercar和Store Gateway的连接地址，此示例前两个store配置了prom1和prom2的Sidercar地址，第三个则是连接到store gateway；</li><li><code>–http-address</code> 指定Querier的UI界面访问地址；</li></ul><p>启动完成后，打开浏览器，访问http:&#x2F;&#x2F;$IP:19192 即可查看Querier的UI界面。</p><p><code>“Use Deduplication”</code>项默认已勾选，Querier会根据指定的扩展标签进行数据去重，这保证了在用户层面不会因为高可用模式而出现重复数据的问题。</p><p><code>“Use Partial Response”</code>选项用于允许部分响应的情况，这要求用户在一致性与可用性之间做选择。当某个store出现故障而无法响应时，此时是否还需要返回其他正常store的数据。如果对可用性要求更高的场景，可以勾选此项。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/24dcb75eb7c04369bc0a27955ee44901.jpg?raw=true"></p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/4cb87aca9f5744a6803938be405c6cb9.jpg?raw=true"></p><p>Querier兼容Prometheus的API接口，因此，Grafana可直接添加Querier组件地址做为Prometheus数据源。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/628ae989c60d461d90f9a7369baa7d57.jpg?raw=true"></p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/fccfc37f9e0a466ca69a65ce4d799dd0.jpg?raw=true"></p><p>4.6 Compactor 部署<br>在默认情况下，Prometheus会定期压缩旧数据以提升查询效率，但在前面的操作中，我们关闭了此功能。因此，我们需要使用Compactor组件对存储中的数据进行类似操作。</p><p>Compactor会为以下数据进行降采样操作，降采样有利于对大时间范围的查询提供快速获取结果的能力：</p><ul><li>为大于 40 小时 (2d, 2w) 的块创建 5m 降采样；</li><li>为大于 10 天 (2w) 的块创建 1 小时降采样。</li></ul><p>同时，Compactor也将对索引进行压缩，包括将来自同个Prometheus实例的多个块压缩为一个，这有利于对提升数据的查询效率。Compactor通过扩展标签集来区分不同的Prometheus实例，所以，在Thanos集群中不同实例的Prometheus 扩展标签集必须是唯一的，否则会导致Compactor出现错误。</p><p>启动命令如下所示：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">thanos compact \<br>    <span class="hljs-attr">--data-dir</span>             /var/thanos/compact \<br>    <span class="hljs-attr">--objstore</span><span class="hljs-selector-class">.config-file</span> bucket_config<span class="hljs-selector-class">.yaml</span> \<br>    <span class="hljs-attr">--http-address</span>         <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">19191</span><br></code></pre></td></tr></table></figure><p>注释：</p><ul><li><code>--data-dir</code> 指定用于数据处理的临时工作空间，为保证Compactor正常工作，建议提供<code>100-300G</code>的容量；</li><li><code>--objstore.config-file</code> 指定对象存储的信息，Thanos的其他组件如Sdiercar、Store Gateway只需要提供对象存储的读写权限即可，但Compactor还需要提供删除权限，因为它会对数据进行操作；</li><li><code>--http-address compact</code>的http地址，用于提供metrics指标。</li></ul><p>目前，Thanos还不支持多个Compactor对单个存储对象存储并发进行操作的功能，必须以单实例的方式运行compact。在任务完成后，Compactor的程序会退出，我们可将其做为定时任务的方式来运行。如果需要程序保持运行，可使用<code>--wait和--wait-interval</code> 参数实现。</p><p>由于对象存储本身对于数据是永久保留，如果希望只保留指定时间内的数据，可以通过配置Compactor的<code>--retention.resolution-raw</code> 、<code>--retention.resolution-5m</code> 和 <code>--retention.resolution-1h</code> 三个参数来实现，分别为原始数据的保留时间、5m分钟降采样数据的保留时间和1小时降采样数据保留时间，其中<code>--retention.resolution-raw</code> 不能小于其他两个时间段，否则会影响compact的降采样操作。</p><h2 id="5、其他"><a href="#5、其他" class="headerlink" title="5、其他"></a>5、其他</h2><p>1、prometheus 的配置参数 external_labels 和 thanos query 启动参数 –query.replica-label “replica” –query.replica-label “region” 的作用</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/316190ca92cc4d59b96a918d79c93a7a.jpg?raw=true"></p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/3fe5f6cfebf4430daa61284a84c4ae7e.jpg?raw=true"></p><p>2、thanos 只会保留其中一个节点上传的持久化监控数据（根据配置，要 2 小时后才会上传到阿里云 OSS）</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/05/05/Thanos%E4%BB%8B%E7%BB%8D/213da273bad849eb9289b9f0bbc347f3.jpg?raw=true"></p><p>3、除了实现 prometheus 高可用场景，thanos 也可以用作多个 prometheus 的汇总查询入口，只需部署 thanos sidecar 和 thanos store gateway 到相应的 prometheus 节点，然后 thanos query 通过参数 –store&#x3D;ip:port 连接 thanos sidecar 和 thanos store gateway 即可</p><p><strong>结语：</strong></p><p>当前中文网上对于Thanos产品组件介绍的相关资料较少，并且由于产品还在不断迭代中，原有的文档往往已经不再适用。在研究的过程中笔者也只能依赖于官网的英文资料，并在实际使用中做验证。本文应该算是目前比较系统性介绍产品的一份资料，按照文中的操作方法，可以搭建出满足实际需要的集群架构。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>Prometheus</tag>
      
      <tag>Thanos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>搭建全协议DNS服务器</title>
    <link href="/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="DNS污染现状"><a href="#DNS污染现状" class="headerlink" title="DNS污染现状"></a>DNS污染现状</h2><blockquote><p>从没有一个国家像我们一样拥有如此严重的DNS缓存投毒，而与此对抗的最有力手段则是加密DNS查询。</p></blockquote><p>DNS劫持与污染是GFW与各ISP服务商的常见手段，常用于屏蔽网站与广告引流。DNS服务器负责将域名解析为对应的IP地址，这个过程默认使用UDP的53号端口进行通讯，而这种未经加密的数据包极易被修改伪造，把域名指向不正确的IP地址，从而造成DNS劫持。</p><p>操作系统一般会有一层DNS缓存用于加快解析速度，在查询过一个域名后，得到的数据会被缓存下来，下一次查询时直接将数据返回而无需再次发起DNS请求。但如果第一次查询得到的数据是被劫持过的虚假数据，那系统将在缓存有效期内持续提供错误结果，这个现象称为 <code>DNS缓存投毒</code> 。这种DNS污染行为不仅针对用户终端系统，对于公共DNS服务器（Public DNS，大型公司或组织设立）和本地DNS服务器（Local DNS，运营商提供或局域网自建）同样有效，它们一般都会配置缓存，因此也会被污染。</p><p>处于国内的DNS服务器在对国外网站发起执行DNS迭代查询时，由于域名的权威服务器位于海外，数据包不可避免的要经过防火长城，而部署于其上的审查机制就会生效，一旦匹配到黑名单的解析请求，马上伪装成目标服务器返回虚假的查询结果，由于查询者接受最先得到的解析结果，无论真正的UDP数据包无论有没有返回都会被丢弃，造成错误的DNS解析。这个过程是GFW屏蔽网站的最基本手段，它会波及到绝大多数的境内DNS服务器，进而导致全国性的DNS污染，严重的时候甚至会扩散到周边国家。</p><p>同样的，ISP服务商也可以对DNS数据包进行劫持，这种行为一般用于广告引流，将被劫持的域名指向自己的服务器IP，提供广告或其他内容获利。由于用户的所有流量都流经ISP服务商的网络，即使不使用运营商分配的DNS服务器，返回的数据包仍然可能被劫持，这种行为在大多数用户不察觉的情况下发生，因此常规DNS解析难以保证安全性。</p><p>DNS规范在制定的时候并未考虑过如此严重的劫持行为，直接使用UDP数据包明文通信，即使后面各组织为此做出不少努力，这个缺陷也从来没有被真正弥补过。IETF曾在1997年推出DNSSEC这种签名机制，它被列入了互联网标准化文档中，是最早大规模部署的DNS安全协议，但是时至今日，全世界启用完整DNSSEC的域名仅有24.66%，而在中国仅有1.18%的覆盖率，位列全球倒数第二，足可见形势不容乐观。你可以在APNIC（亚太互联网络信息中心）官网上看到全球的<a href="https://stats.labs.apnic.net/dnssec">DNSSEC覆盖情况</a>与国内的<a href="https://stats.labs.apnic.net/dnssec/CN">DNSSEC分析</a>。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/ziG.png?raw=true" alt="全球DNSSEC覆盖状态"></p><p>另一方面，DNSSEC仅仅使用了信任链签名机制，它能保证查询结果的准确性，这种方案在大多数网络下已经能保证足够的可用性，但在GFW面前却如螳臂当车，因为DNS签名机制虽不能被伪造，但可以被截断，也就是直接丢弃该数据包，或返回一个无签名的虚假数据包。此外，即便启用了DNSSEC，请求时也仅能保证迭代查询的正确性，本机发起的递归查询返回的结果仍可能被劫持，更何况大量普通用户使用运营商的DNS服务器，这种情况下本地DNS服务器就是内鬼，DNS签名机制形同虚设。</p><p>所以，在每况愈下的环境中，为了对抗DNS劫持与污染，各种DNS加密查询协议应运而生，目前主流的有 <code>DNS-over-TLS</code> 、<code>DNS-over-HTTPS</code> 、<code>DNSCrypt</code>，还有萌芽阶段的 <code>DNS-over-QUIC</code> 。</p><h2 id="DNS各协议简介"><a href="#DNS各协议简介" class="headerlink" title="DNS各协议简介"></a>DNS各协议简介</h2><blockquote><p>以下几种DNS查询机制是目前公开的协议，有规范化的文档与实现，后面将搭建支持以下全部协议的DNS服务器</p></blockquote><h3 id="Plain-DNS"><a href="#Plain-DNS" class="headerlink" title="Plain DNS"></a>Plain DNS</h3><p>Plain DNS即常规DNS，它的格式为单个IPv4或IPv6地址，查询时默认使用UDP或TCP的 <code>53</code> 端口通讯，必要时可手动指定其他端口（需要系统或软件支持）。该请求信息未经加密，易被伪造，是目前使用范围最广的查询方式，上文所提及的DNS劫持与污染均基于该机制实现，目前正逐步被其他加密DNS查询所替代。</p><h3 id="DNS-over-TLS"><a href="#DNS-over-TLS" class="headerlink" title="DNS-over-TLS"></a>DNS-over-TLS</h3><p>DNS-over-TLS简称 <code>DoT</code>，是一种基于TLS进行报文加密的DNS请求方式，查询时默认使用TCP的 <code>853</code> 端口进行通讯，在TLS握手以后再执行DNS请求与应答，TLS可以保证通信双方数据的保密性和完整性，这种DNS请求方式几乎不可能被劫持，且由于请求直接从用户终端发起，ISP也无法对其内容进行修改。</p><p>由于TLS证书上有CA的签名，如果系统的根证书信任未被篡改过，那就可以保证通讯服务器不是GFW伪造的，因此GFW只能阻断指定域名或IP的TCP连来拦截DoT，这种行为最多只能让DNS查询超时，但无论如何都不会得到错误的结果。</p><p>相较于常规DNS查询，DoT明显有保密性和完整性的优势，但代价就是更高的时延，理论上至少为常规DNS的四倍。同时，DNS服务器需要接受多次TSL连接，在高并发的环境下对性能也有更高的要求。</p><p>DoT延时较高的问题在实际使用中感知不强，因为整个解析过程最多也就几百毫秒，相比于网页的加载时间并不明显，况且系统中也存在DNS缓存，短时间内重复查询与常规DNS无异。而相比于这些，更应该关心的是能否查到正确的DNS解析结果，这才是DoT的意义所在。</p><p>不过DoT也有其弱点所在，它默认使用853接口，一旦GFW决定大规模封杀它的使用，只需要对853端口的出境流量严格审查或直接切断，即使一部分系统或软件支持切换端口，但也仅仅是治标不治本。这是DoT相较于DoH的最明显缺点，当然两者在不同环境下各有优势，不可一概而论。</p><p>DoT服务的格式为 <code>tls://$域名</code> 或 <code>tls://$IP</code>，IP地址若为IPv6，需要括上 <code>[]</code> 符号。此外，搭建DoT服务时需要有一张针对域名或IP地址的TLS证书，它同时也可以用在HTTPS认证上。</p><h3 id="DNS-over-HTTPS"><a href="#DNS-over-HTTPS" class="headerlink" title="DNS-over-HTTPS"></a>DNS-over-HTTPS</h3><p>DNS-over-HTTPS简称 <code>DoH</code>，是一种基于HTTPS协议进行数据传输和加密的DNS请求方式，查询时默认使用TCP的 <code>443</code> 端口进行通讯。直观讲就是在DNS外面套一层HTTPS，或者说把DNS请求变成HTTPS请求，从而达到加密的效果。</p><p>相比于DoT，DoH使用HTTPS进行连接，由于HTTPS协议也是由TLS加密的，因此DoH和DoT在本质上是相同的，即DoH也可以保证数据的保密性和完整性。不同的是，DoT默认使用853端口，DoH则默认使用HTTPS标准的443端口。</p><p>在逻辑上，DoH的实现更加简单，只需把正常的DNS查询报文先处理为 <code>base64url</code> 编码，接在 <code>dns-query</code> 后的HTTP请求参数中发起GET请求即可，这个过程在RFC8484中有<a href="https://tools.ietf.org/html/rfc8484#section-4.1">详细说明</a>。</p><p>DoH相较于DoT有一些独有优势，一方面由于它默认走443端口，可以与其他网页流量混合在一起，出境时在GFW看来与网页访问没有明显区别。当然，它没有到达某些加密代理工具的反检测高度，在需要的时候GFW只需做一次主动探测，或对于DNS服务器发起重放攻击，就可以立刻识别出目标服务器的性质，但无论如何，DoH的隐蔽性和反检测性都是高于DoT的。另一方面，由于请求包含在HTTP流量中，DoH请求可以透过CDN加速，即使它是动态请求需要实时回源，但在大部分网络环境下CDN的边缘节点会有更好的数据路由，加快请求速度。</p><p>DoH同时也有一些DoT不具备的缺点，譬如它的基于HTTP协议，延迟相较于DoT会稍高一些，不过这一点几乎可以忽略不计。在网络环境差的情况下，DoH性能也会一定程度上低于DoT，总之，两者各有优劣胜负所在。</p><p>DoT服务的格式一般为 <code>https://$域名/dns-query</code> 或 <code>https://$IP/dns-query</code>，IP地址如果为IPv6地址，需要括上 <code>[]</code> 符号。与DoT相同，DoH机制也需要针对域名或IP的TLS证书，这个机制可以保证客户端在查询时不被劫持到错误的服务器上。</p><h3 id="DNS-over-QUIC"><a href="#DNS-over-QUIC" class="headerlink" title="DNS-over-QUIC"></a>DNS-over-QUIC</h3><p>QUIC是 <code>Quick UDP Internet Connection</code> 的缩写，是由谷歌制定的一种传输层协议。它基于UDP协议，融合了TCP、TLS、HTTP&#x2F;2等协议的特性，在UDP的不可靠性上实现了可靠的加密链路，得益于UDP的低延迟与相对效率更高的特性，QUIC相比于传统TCP+TLS有着更低的连接延迟、更高的传输效率、更稳定的传输效果。</p><p>QUIC可以简单理解为在UDP协议上重新实现了HTTP&#x2F;2，即 <code>QUIC = UDP + TLS + HTTP2</code>，但比原来的协议栈有着各方面的优势，因此，在2018的IETF会议上，HTTP-over-QUIC被定义为HTTP&#x2F;3。当然，现阶段QUIC还没有形成标准RFC文档，仍处于测试阶段，但已经有不少浏览器与服务根据草案开始支持该协议。</p><p>基于QUIC的DNS查询称为DNS-over-QUIC，简称 <code>DoQ</code>，默认使用UDP的 <code>784</code> 或 <code>8853</code> 端口（QUIC基于UDP协议）。相比于DoH与DoT，它拥有QUIC协议的优势，重点表现在低延迟上，缓解了前两者一直被诟病的卡顿问题。在QUIC协议中，首次连接需要1-RTT的延迟，此后连接时可以达到0-RTT的连接延迟，远胜于TCP+TLS的3-RTT连接延迟，而DoH与DoT都没有脱离传统TCP协议栈，在延迟上逊于QUIC协议。在一些测试中，DoQ在弱网络中相比DoH或DoT有着明显优势，体验上可以接近传统的UDP查询。</p><p>另一方面，使用特定默认端口的DoQ很容易GFW识别并拦截，与DoT相同，这个问题可以通过修改端口缓解，但它并不受一些系统与客户端的支持。幸运的是，一旦HTTP&#x2F;3能定稿并普及开来，基于该协议的DNS查询就能兼具低延迟与隐蔽性的优势了，但这或许需要很长一段时间。</p><p>当下，QUIC还是一个全新的协议，标准文档也还未出炉，支持的服务很少，而支持DoQ的软件就更少了，当下也仅有AdGuard的系列软件有对它启用实验性的支持。DoQ服务的格式一般为 <code>quic://$域名</code> 或 <code>quic://$IP</code>。</p><h3 id="DNSCrypt"><a href="#DNSCrypt" class="headerlink" title="DNSCrypt"></a>DNSCrypt</h3><p>DNSCrypt在目标上与DoT、DoH、DoQ类似，都是将DNS查询放在加密链路上传输，防止被窃听或劫持，但是它的实现方式略有不同。相比于前三者，它不需要借助于域名工作，也不依赖于被信任的TLS证书，它仅仅提供了一种针对性的协议用于加密客户端与DNS服务器之间的通信。</p><p>你可以将它理解为一个独立的协议，不依赖于既有的HTTP、TLS等协议，有着自己的一套机制用于保证数据的传输安全与身份认证。它的v2版本在2013年发布，<a href="https://dnscrypt.info/">官网</a>介绍称其是“迄今为止部署最多的加密DNS协议”。在该协议中，DNS服务器上会生成一对公私钥，并将公钥派发给客户端用于认证与加密，因此，DNSCrypt客户端必须明确信任所选提供者的公钥，想使用哪个DNSCrypt服务器，就需要预先安装该服务器的公钥，而不是通过常规的受信任证书颁发机构列表签名获取信任。</p><p>DNSCrypt协议是一个自由开放协议，不属于任何个人或组织，官网上也有它详细的<a href="https://dnscrypt.info/protocol">规范文档</a>，不过由于作者没有申请将其列入标准化文档，因此目前并不是一个正式的协议，在大规模的应用中存在一定的局限性。尽管如此，它却是目前使用量最大的加密DNS查询协议，有不少基于它实现的客户端与服务。</p><p>使用DNSCrypt时客户端需要三个必备参数：服务器IP地址、公钥、证书名称，其中IP地址若为IPv6需要括上 <code>[]</code>。由于多个参数在共享时并不方便，一般使用 <code>DNS Stamp</code> 将其封装为 <code>sdns://···</code> 的格式，当然DNS Stamp不仅仅可用于封装DNSCrypt，同样也支持DoT、DoH、DoQ等协议，你可以在<a href="https://blog.dnomd343.top/dns-stamps/">这里</a>看到它的完整介绍。</p><h2 id="公共DNS服务器"><a href="#公共DNS服务器" class="headerlink" title="公共DNS服务器"></a>公共DNS服务器</h2><p>Public DNS，即公共DNS服务器，一般由大型互联网公司推出，节点分布全球各地，延迟较低，用户数量大，具有一定的安全性和抗攻击性。目前有不少公共DNS服务，在不同地区的使用体验不尽相同，这里有一份较为完整的<a href="https://kb.adguard.com/zh/general/dns-providers">全球公共DNS列表</a>，上面列举了绝大多数常用的公共DNS服务及对应地址。</p><h3 id="国内常用公共DNS"><a href="#国内常用公共DNS" class="headerlink" title="国内常用公共DNS"></a>国内常用公共DNS</h3><blockquote><p>国内首选阿里或腾讯DNS，污染较小且稳定性好，且阿里DNS更有完整IPv6支持</p></blockquote><p><strong><a href="https://alidns.com/">阿里DNS</a></strong></p><p><code>$alidns_ip</code> 为阿里DNS的IPv4地址</p><ul><li>IPv4地址：<code>223.5.5.5</code> 或 <code>223.6.6.6</code></li><li>IPv6地址：<code>2400:3200::1</code> 或 <code>2400:3200:baba::1</code></li><li>DoT地址：<code>tls://dns.alidns.com</code> 或 <code>tls://$alidns_ip</code></li><li>DoH地址：<code>https://dns.alidns.com/dns-query</code> 或 <code>https://$alidns_ip/dns-query</code></li></ul><p><strong><a href="https://www.dnspod.cn/Products/Public.DNS">腾讯DNS</a></strong></p><ul><li>IPv4地址：<code>119.29.29.29</code> 或 <code>119.28.28.28</code></li><li>DoT地址：<code>tls://dot.pub</code> 或 <code>tls://dns.pub</code></li><li>DoH地址：<code>https://doh.pub/dns-query</code> 或 <code>https://dns.pub/dns-query</code></li></ul><p><strong><a href="https://dudns.baidu.com/">百度DNS</a></strong></p><ul><li>IPv4地址：<code>180.76.76.76</code></li><li>IPv6地址：<code>2400:da00::6666</code></li></ul><p><strong><a href="http://www.114dns.com/">114 DNS</a></strong></p><ul><li>IPv4地址：<code>114.114.114.114</code> 或 <code>114.114.115.115</code>。</li></ul><h3 id="国外常用公共DNS"><a href="#国外常用公共DNS" class="headerlink" title="国外常用公共DNS"></a>国外常用公共DNS</h3><blockquote><p>在国内使用延迟较高，国外服务器首选Cloudflare DNS或Google DNS。</p></blockquote><p><strong><a href="https://cloudflare-dns.com/">Cloudflare DNS</a></strong></p><p><code>$cfdns_ip</code> 为Cloudflare DNS的IP地址，IPv6地址需要用 <code>[]</code> 括起。</p><ul><li>IPv4地址：<code>1.1.1.1</code> 或 <code>1.0.0.1</code></li><li>IPv6地址：<code>2606:4700:4700::1111</code> 或 <code>2606:4700:4700::1001</code></li><li>DoT地址：<code>tls://$cfdns_ip</code></li><li>DoH地址：<code>https://dns.cloudflare.com/dns-query</code> 或 <code>https://$cfdns_ip/dns-query</code></li></ul><p><strong><a href="https://developers.google.com/speed/public-dns">Google DNS</a></strong></p><p><code>$googledns_ip</code> 为Google DNS的IP地址，IPv6地址需要用 <code>[]</code> 括起，DoH查询的Host仅支持IPv4地址。</p><ul><li>IPv4地址：<code>8.8.8.8</code> 或 <code>8.8.4.4</code></li><li>IPv6地址：<code>2001:4860:4860::8888</code> 或 <code>2001:4860:4860::8844</code></li><li>DoT地址：<code>tls://dns.google</code> 或 <code>tls://$googledns_ip</code></li><li>DoH地址：<code>https://dns.google/dns-query</code> 或 <code>https://$googledns_ipv4/dns-query</code></li></ul><h2 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h2><p>在搭建DNS服务器时，我们需要有一个简单的方式确保服务是正常工作的，这里建议使用<a href="https://github.com/ameshkov/dnslookup">dnslookup</a>进行测试，它是一个专用于多协议DNS调试的命令行工具，基于MIT许可证开源，支持所有已知的DNS协议，包括常规DNS、DoH、DoT、DoQ以及DNSCrypt。它类似于dig工具，但是更纯粹易用，使用时只需指定目标域名和DNS服务器地址，同时也提供了指定DNS服务器的IP地址、输出JSON格式、跳过证书验证等功能。</p><h3 id="获取工具"><a href="#获取工具" class="headerlink" title="获取工具"></a>获取工具</h3><p>你可以直接下载它的<a href="https://github.com/ameshkov/dnslookup/releases">Release</a>到本地使用。Windows系统下直接把 <code>dnslookup.exe</code> 解压到 <code>C:\Windows\System32\</code> 下即可，Linux系统可按如下命令操作：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># v1.4.5是当下的最新版本，实际下载时需要到release页获取最新链接</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; wget <span class="hljs-string">&quot;https://github.com/ameshkov/dnslookup/releases/download/v1.4.5/dnslookup-linux-amd64-v1.4.5.tar.gz&quot;</span></span><br>···<br><span class="hljs-comment"># 解压并安装</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; tar xf dnslookup-linux-amd64-v1.4.5.tar.gz</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; <span class="hljs-built_in">mv</span> linux-amd64/dnslookup /usr/bin/</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; <span class="hljs-built_in">rm</span> -rf dnslookup-linux-amd64-v1.4.5.tar.gz linux-amd64/Copy</span><br></code></pre></td></tr></table></figure><p>安装完毕后使用命令 <code>dnslookup --help</code> 输出使用说明，可用于确认是否安装成功。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">shell&gt; dnslookup <span class="hljs-comment">--help</span><br>dnslookup v1<span class="hljs-number">.4</span><span class="hljs-number">.5</span><br><span class="hljs-keyword">Usage</span>: dnslookup &lt;<span class="hljs-keyword">domain</span>&gt; &lt;<span class="hljs-keyword">server</span>&gt; [&lt;providerName&gt; &lt;serverPk&gt;]<br>&lt;<span class="hljs-keyword">domain</span>&gt;: mandatory, <span class="hljs-keyword">domain</span> <span class="hljs-type">name</span> <span class="hljs-keyword">to</span> lookup<br>&lt;<span class="hljs-keyword">server</span>&gt;: mandatory, <span class="hljs-keyword">server</span> address. Supported: plain, tls:// (DOT), https:// (DOH), sdns:// (DNSCrypt), quic:// (DOQ)<br>&lt;providerName&gt;: optional, DNSCrypt provider <span class="hljs-type">name</span><br>&lt;serverPk&gt;: optional, DNSCrypt <span class="hljs-keyword">server</span> <span class="hljs-built_in">public</span> keyCopy<br></code></pre></td></tr></table></figure><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><blockquote><p>这里使用AdGuardHome提供的DNS服务进行测试，后期可能会被GFW屏蔽</p></blockquote><p><strong>常规DNS</strong></p><p>在国内网络查询谷歌、推特等被封锁的域名会受到污染，这里使用 <code>baidu.com</code> 进行查询。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">baidu.com</span> <span class="hljs-number">176.103</span><span class="hljs-number">.130</span><span class="hljs-number">.130</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">37745</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;baidu.com.</span>     <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">baidu.com.</span>      <span class="hljs-number">33</span>      <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">220.181</span><span class="hljs-number">.38</span><span class="hljs-number">.148</span><br><span class="hljs-string">baidu.com.</span>      <span class="hljs-number">33</span>      <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">39.156</span><span class="hljs-number">.69</span><span class="hljs-number">.79</span><br><span class="hljs-string">Copy</span><br></code></pre></td></tr></table></figure><p><strong>DNS-over-TLS</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">google.com</span> <span class="hljs-string">tls://dns.adguard.com</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">37703</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;google.com.</span>    <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">google.com.</span>     <span class="hljs-number">163</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">216.58</span><span class="hljs-number">.197</span><span class="hljs-number">.14</span><br><span class="hljs-string">Copy</span><br></code></pre></td></tr></table></figure><p><strong>DNS-over-HTTPS</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">youtube.com</span> <span class="hljs-string">https://dns.adguard.com/dns-query</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">60383</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;youtube.com.</span>   <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">youtube.com.</span>    <span class="hljs-number">199</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">172.217</span><span class="hljs-number">.161</span><span class="hljs-number">.206</span><br><span class="hljs-string">Copy</span><br></code></pre></td></tr></table></figure><p><strong>DNS-over-QUIC</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">facebook.com</span> <span class="hljs-string">quic://dns.adguard.com</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">65467</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;facebook.com.</span>  <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">facebook.com.</span>   <span class="hljs-number">296</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">185.60</span><span class="hljs-number">.216</span><span class="hljs-number">.35</span><br><span class="hljs-string">Copy</span><br></code></pre></td></tr></table></figure><p><strong>DNSCrypt</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">twitter.com</span> <span class="hljs-string">sdns://AQIAAAAAAAAAFDE3Ni4xMDMuMTMwLjEzMDo1NDQzINErR_JS3PLCu_iZEIbq95zkSV2LFsigxDIuUso_OQhzIj</span><br><span class="hljs-string">IuZG5zY3J5cHQuZGVmYXVsdC5uczEuYWRndWFyZC5jb20</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">27774</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;twitter.com.</span>   <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">twitter.com.</span>    <span class="hljs-number">168</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">104.244</span><span class="hljs-number">.42</span><span class="hljs-number">.1</span><br><span class="hljs-string">Copy</span><br></code></pre></td></tr></table></figure><h2 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h2><blockquote><p>部署AdGuardHome服务提供多协议的DNS服务，如果想实现无污染DNS，则服务器必须在国外</p></blockquote><p>AdGuard是一个常用的广告拦截器，<a href="https://github.com/AdguardTeam/AdGuardHome">AdGuardHome</a>是其下的一个项目，它部署在路由器或服务器上，可以在DNS解析层面拦截广告。虽然AdGuard是商业化软件，但AdGuardHome却是免费的，它基于GPL3.0协议开源，没有付费增强的商业化机制，且社区与<a href="https://t.me/adguard_en">交流群</a>活跃，项目更新速度快。</p><p>在<a href="https://adguard.com/zh_cn/adguard-home/overview.html">AdGuardHome官网</a>上，大部分介绍均为去广告功能，虽然名义上如此，但它是目前唯一一个能提供全协议的DNS服务工具，我们可以把它当作DNS服务使用，侧重其加密解析功能。它可以自定义拦截与重写列表，对不同的客户端进行管理，对不同的域名与请求来源进行统计，更有完善的图形化界面。所以说，去广告只是一个可选的附加功能，甚至默认的<a href="https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt">广告拦截规则</a>也是开源的，需要的时候也可以编写自己的规则。</p><p>AdGuardHome使用Go语言编写，如果本机有Go编程环境也可以克隆源码自行编译。不过，它的Github仓库中有编译好的二进制资源，安装时直接下载对应版本的<a href="https://github.com/AdguardTeam/AdGuardHome/releases/">Release</a>即可，一般有以下两种安装方式：</p><blockquote><p>注意，AdGuardHome默认占用系统TCP的3000端口，如果该端口上存在其他服务（如Gitea等）会导致启动失败，遇到该情况请先暂时关闭该端口上的服务，安装后AdGuardHome可以修改为在其他端口上运行。</p></blockquote><h3 id="一键安装"><a href="#一键安装" class="headerlink" title="一键安装"></a>一键安装</h3><p>AdGuardHome提供了全自动的脚本安装，只需运行<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/scripts/install.sh">安装脚本</a>，即可一键安装最新稳定版（Latest release）。不过，由于Github在国内经常受到干扰，脚本获取与安装可能出现运行缓慢或异常报错，因此大陆地区的VPS可以尝试手动安装的方式。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 运行安装脚本</span><br>shell&gt; curl -sSL https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/AdguardTeam/</span>AdGuardHome<span class="hljs-regexp">/master/</span>scripts/install.sh | sh<br>···<br>[info] AdGuard Home will be installed to <span class="hljs-regexp">/opt/</span>AdGuardHome<br>[info] Downloading package from https:<span class="hljs-regexp">//</span>static.adguard.com<span class="hljs-regexp">/adguardhome/</span>release/AdGuardHome_linux_amd64.tar.gz -&gt; AdGuardHome_linux_amd64.tar.gz<br>[info] Unpacking package from AdGuardHome_linux_amd64.tar.gz -&gt; /opt<br>···<br>AdGuard Home is successfully installed and will automatically start on boot.<br>···<br>··· [info] AdGuard Home is available on the following addresses:<br>··· [info] Go to http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3000</span><br>··· [info] Go to http:<span class="hljs-regexp">//</span><span class="hljs-number">172.17</span>.<span class="hljs-number">36.87</span>:<span class="hljs-number">3000</span><br>··· [info] Action install has been done successfully on linux-systemd<br>[info] AdGuard Home is now installed and running.<br>···<br><span class="hljs-comment"># 安装完成Copy</span><br></code></pre></td></tr></table></figure><p>运行该命令后，脚本会把AdGuardHome默认安装到 <code>/opt/AdGuardHome</code> 下，如果不习惯也可以将其链接到 <code>/etc</code> 目录</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 创建一个软链接</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; <span class="hljs-built_in">ln</span> -s /opt/AdGuardHome/ /etc/</span><br><span class="hljs-comment"># 进入AdGuardHome文件夹</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; <span class="hljs-built_in">cd</span> /etc/AdGuardHomeCopy</span><br></code></pre></td></tr></table></figure><p>脚本同时会创建一个 <code>systemctl</code> 服务，你可以通过如下命令查看运行情况</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 出现下列语句即服务运行正常</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; systemctl status AdGuardHome</span><br>···<br>Active: active (running) ···<br>···<span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>AdGuardHome默认监听TCP的3000号端口，可以通过以下命令查看它的占用情况</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 查询AdGuardHome在TCP端口的监听情况</span><br><span class="hljs-attribute">shell</span>&gt; netstat -tlnp | grep AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">3000</span>                 :::*                    LISTEN      <span class="hljs-number">22587</span>/AdGuardHome<br><span class="hljs-comment"># 可以确定AdGuardHome在全局监听TCP的3000号端口Copy</span><br></code></pre></td></tr></table></figure><h3 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h3><p>在AdGuardHome项目的<a href="https://github.com/AdguardTeam/AdGuardHome/releases">Release</a>页，下载当前系统对应版本的安装包，解压到指定目录并配置为系统服务即可。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 下载安装包</span><br>shell&gt; wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/AdguardTeam/</span>AdGuardHome<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v0.104.3/</span>AdGuardHome_linux_amd64.tar.gz<br>···<br><span class="hljs-comment"># 解压到 /opt 目录下</span><br>shell&gt; tar xf AdGuardHome_linux_amd64.tar.gz -C <span class="hljs-regexp">/opt/</span><br><span class="hljs-comment"># 删除下载的包</span><br>shell&gt; rm -f AdGuardHome_linux_amd64.tar.gz<br><span class="hljs-comment"># 创建软连接到/etc下</span><br>shell&gt; ln -s <span class="hljs-regexp">/opt/</span>AdGuardHome<span class="hljs-regexp">/ /</span>etc/Copy<br></code></pre></td></tr></table></figure><p>手动配置systemctl服务</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 创建并写入下述配置</span><br>shell&gt; vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>AdGuardHome.serviceCopy<br></code></pre></td></tr></table></figure><p>填入以下配置</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=AdGuard Home: Network-level blocker<br><span class="hljs-attr">ConditionFileIsExecutable</span>=/opt/AdGuardHome/AdGuardHome<br><span class="hljs-attr">After</span>=syslog.target network-<span class="hljs-literal">on</span>line.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">StartLimitInterval</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">StartLimitBurst</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">ExecStart</span>=/opt/AdGuardHome/AdGuardHome <span class="hljs-string">&quot;-s&quot;</span> <span class="hljs-string">&quot;run&quot;</span><br><br><span class="hljs-attr">WorkingDirectory</span>=/root<br><br><span class="hljs-attr">Restart</span>=always<br><span class="hljs-attr">RestartSec</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">EnvironmentFile</span>=-/etc/sysconfig/AdGuardHome<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.targetCopy<br></code></pre></td></tr></table></figure><p>重载systemctl，开启AdGuardHome服务并设置为开机启动</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">shell&gt; systemctl daemon-reload<br>shell&gt; systemctl start AdGuardHome<br>shell&gt; systemctl enable AdGuardHome<br>Created symlink <span class="hljs-keyword">from</span> <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mu</span>lti-user.target.wants<span class="hljs-regexp">/AdGuardHome.service to /</span>etc<span class="hljs-regexp">/systemd/</span>system/AdGuardHome.service.<span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>查看AdGuardHome服务运行状态</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 出现下列语句即服务运行正常</span><br><span class="hljs-keyword">shell</span><span class="language-bash">&gt; systemctl status AdGuardHome</span><br>···<br>Active: active (running) ···<br>···<span class="hljs-keyword">Copy</span><br></code></pre></td></tr></table></figure><p>AdGuardHome管理界面默认监听TCP的3000端口，如果服务器防火墙不拦截该端口，可以直接通过 <code>服务器IP:3000</code> 的方式访问，也可以按下文的方式配置反向代理。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 查询AdGuardHome在TCP端口的监听情况</span><br><span class="hljs-attribute">netstat</span> -tlnp | grep <span class="hljs-number">3000</span><br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">3000</span>                 :::*                    LISTEN      <span class="hljs-number">22587</span>/AdGuardHome<br><span class="hljs-comment"># 可以确定AdGuardHome在全局监听TCP的3000号端口Copy</span><br></code></pre></td></tr></table></figure><h2 id="配置服务"><a href="#配置服务" class="headerlink" title="配置服务"></a>配置服务</h2><blockquote><p>后文使用 <code>dns.dnomd343.top</code> 作为示例域名</p></blockquote><h3 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h3><p>配置 <code>dns.dnomd343.top</code> 解析到当前服务器，通过Nginx实现反向代理本地3000端口。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">shell</span>&gt; <span class="hljs-keyword">cd</span> /etc/nginx/<span class="hljs-keyword">conf</span>.d/<br><span class="hljs-keyword">shell</span>&gt; <span class="hljs-keyword">vim</span> dns.confCopy<br></code></pre></td></tr></table></figure><p>写入以下配置，注意这里需要TLS证书，申请方式可见<a href="https://blog.dnomd343.top/acme.sh-usage/">acme.sh使用说明</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs awk">server &#123;<br>    listen <span class="hljs-number">80</span>;<br>    server_name dns.dnomd343.top;<br>    return <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span><span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br>server &#123;<br>    listen <span class="hljs-number">443</span> ssl http2;<br>    server_name dns.dnomd343.top;<br>    ssl_certificate <span class="hljs-regexp">/etc/</span>ssl<span class="hljs-regexp">/certs/</span>dnomd343.top/fullchain.pem;<br>    ssl_certificate_key <span class="hljs-regexp">/etc/</span>ssl<span class="hljs-regexp">/certs/</span>dnomd343.top/privkey.pem;<br><br>    location / &#123;<br>        proxy_pass http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span>;<br>    &#125;<br>&#125;Copy<br><span class="hljs-comment"># 重启nginx</span><br>shell&gt; nginx -s reloadCopy<br></code></pre></td></tr></table></figure><p>此时访问 <code>https://dns.dnomd343.top</code>，你的访问数据会被代理到AdGuardHome提供的服务端口上</p><p>如果配置正确会显示如下网页</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/0er.png?raw=true" alt="Step-1"></p><p>点击下一步后开始配置端口</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/5b5.png?raw=true" alt="Step-2"></p><p>网页管理界面监听接口按情况分类，如果是反向代理模式可以选 <code>lo - 127.0.0.1</code>，否则可以选所有接口，端口将默认的80改为3000。DNS服务器选择监听所有接口，端口为53不变用于提供常规DNS服务。不过，如果你的服务器上运行有其他DNS软件（BIND等），53端口会可能被占用，你也可以按需要改成其他端口。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/i2s.png?raw=true" alt="Step-3"></p><p>输入用户名和密码后下一步</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/xBe.png?raw=true" alt="Step-4"></p><p>这一步会显示一些提示，上方的监听地址分别为本机回环地址和内网IP</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/91F.png?raw=true" alt="Step-5"></p><p>到这一步就配置完成了，点击进入仪表盘</p><p>注意，此时网页会跳到 <code>http://dns.dnomd343.top:3000/login.html</code> 的登陆页面，如果你的防火墙没有放行3000端口，这里将会出现无法访问的错误，需要手动转到 <code>https://dns.dnomd343.top/login.html</code> 的反向代理页面。</p><p>如果不想访问dns.dnomd343.top时直接跳出AdGuardHome的登录页，可以将其隐藏在 <code>/admin</code> 下，注意这里必须配置 <code>login.html</code> 页面的跳转，否则访问 <code>https://dns.dnomd343.top/admin</code> 将会跳转到 <code>https://dns.dnomd343.top/login.html</code> 导致404错误。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">shell&gt; vim <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d/</span>dns.confCopy<br></code></pre></td></tr></table></figure><p>修改配置文件为以下内容</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> dns.dnomd343.top;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">server_name</span> dns.dnomd343.top;<br>    <span class="hljs-attribute">ssl_certificate</span> /etc/ssl/certs/dnomd343.top/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/ssl/certs/dnomd343.top/privkey.pem;<br><br>    <span class="hljs-section">location</span> /admin/ &#123;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Server <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_pass</span> http://localhost:3000/;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /login.html &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span>/admin/login.html;<br>    &#125;<br>&#125;<span class="hljs-attribute">Copy</span><br><span class="hljs-comment"># 重启Nginx</span><br>shell&gt; nginx -s reloadCopy<br></code></pre></td></tr></table></figure><p>此时访问 <code>https://dns.dnomd343.top</code> 将会是nginx的默认主页，而访问 <code>https://dns.dnomd343.top/admin</code> 将会跳转到AdGuardHome的登录页面。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/EHa.png?raw=true" alt="登录界面"></p><p>输入设置的用户名和密码后进入仪表盘。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/AjM.png?raw=true" alt="仪表盘界面"></p><p>你可以在这里调整AdGuardHome的各项配置以满足需求。</p><h3 id="配置DNS上游"><a href="#配置DNS上游" class="headerlink" title="配置DNS上游"></a>配置DNS上游</h3><p>在设置 - DNS设置中可以设置上游DNS服务器，当AdGuardHome收到合法的DNS请求后，会按配置通过规则以及host等模块拦截或改写一部分查询，剩余的请求就会转发给上游DNS服务器。与下游查询协议类似，AdGuardHome同样也支持多种上游DNS查询协议，即常规DNS、DoH、DoT、DoQ和DNSCrypt等，通过这些协议向大型公共DNS请求数据。</p><p>由于服务器在国外基本不受到DNS污染，可以直接使用常规DNS查询，一般情况下可用直接设置为常用公共DNS的IP地址，如Cloudflare DNS（1.1.1.1）、Google DNS（8.8.8.8）、Quan9 DNS（9.9.9.9）等，你也可以在上文<a href="https://blog.dnomd343.top/dns-server/#%E5%85%AC%E5%85%B1DNS%E6%9C%8D%E5%8A%A1%E5%99%A8">公共DNS服务器</a>的列表中选择其它服务或协议。</p><p>在配置完成后，AdGuardHome就已经能正常运作了，为了测试服务的可用性，可以发起常规DNS查询测试是否配置成功。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 向配置好的服务器发起常规DNS请求</span><br><span class="hljs-string">shell&gt;</span> <span class="hljs-string">dnslookup</span> <span class="hljs-string">baidu.com</span> <span class="hljs-number">47.242</span><span class="hljs-number">.30</span><span class="hljs-number">.65</span><br><span class="hljs-string">dnslookup</span> <span class="hljs-string">v1.4.5</span><br><span class="hljs-attr">dnslookup result:</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">26085</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">0</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;baidu.com.</span>     <span class="hljs-string">IN</span>       <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">baidu.com.</span>      <span class="hljs-number">415</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">39.156</span><span class="hljs-number">.69</span><span class="hljs-number">.79</span><br><span class="hljs-string">baidu.com.</span>      <span class="hljs-number">415</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">220.181</span><span class="hljs-number">.38</span><span class="hljs-number">.148</span><br><span class="hljs-comment"># 正确返回了百度服务器的IP地址Copy</span><br></code></pre></td></tr></table></figure><p>这里不要用谷歌、油管等黑名单网站测试，否则怎么查询都会返回一个错误的IP。</p><h3 id="配置加密DNS"><a href="#配置加密DNS" class="headerlink" title="配置加密DNS"></a>配置加密DNS</h3><p>选择设置 - 加密设置，在此处配置上文提及的几种加密DNS协议</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/Bmy.png?raw=true" alt="加密设置"></p><p>勾选启用加密，开启AdGuardHome的加密DNS协议支持，在这一页可以配置DoH、DoT与DoQ的选项。如果你当前的TCP&#x2F;443端口已经被nginx或其他网页服务器占用，右下角会出现如图443端口不可用的报错，此处直接忽略即可。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/IFI.png?raw=true" alt="443端口错误"></p><p>服务器名称填入用于DoH与DoT的域名，后方的重定向无需勾选，这个功能是将来自80端口的HTTP流量重定向到HTTPS，而我们这部分功能已经交给Nginx处理了。</p><p>此处HTTPS端口不同于之前配置的3000端口，这个端口负责提供DoH查询服务，同时也兼具网页管理的功能，总地来讲，可以认为它与此前的3000功能相同，但是在 <code>/dns-query</code> 下额外加入了DoH支持。这里的端口号我们直接将其设置为3001即可，同样不对外暴露，交给Nginx处理。至于DoT与DoQ的端口，则保持默认的 <code>853</code> 与 <code>784</code> 不变，直接对外提供服务。</p><p>下方需要我们提供TLS证书和私钥，内容对应上方填写的服务器名称，方式建议选择设置路径而不是粘贴内容，这样子以后更新证书的时候就不需要重新填写。此处还要注意证书私钥的权限问题，一般情况下它会被设置为其他用户不可读的状态，遇到这种情况可以手动配置文件属性，或者将AdGuardHome配置为root用户下运行。</p><p>此外，如果你的证书不仅包含域名，还包含服务器IP地址，那将可以以IP地址的形式进行DoH和DoT查询。</p><p>在改完并保存后，网页会自动跳转到 <code>https://dns.dnomd343.top:3001/#encryption</code> ，与上文的情况一样，如果防火墙未放行3001端口将会出现连接超时的错误。不过这里我们并不需要这个页面，而是配置Nginx的反向代理来接管3001端口的DoH查询流量，识别并把它转交给AdGuardHome。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">shell&gt; vim <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d/</span>dns.confCopy<br></code></pre></td></tr></table></figure><p>修改配置文件为以下内容</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> dns.dnomd343.top;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">server_name</span> dns.dnomd343.top;<br>    <span class="hljs-attribute">ssl_certificate</span> /etc/ssl/certs/dnomd343.top/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/ssl/certs/dnomd343.top/privkey.pem;<br><br>    <span class="hljs-section">location</span> /admin/ &#123;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Server <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_pass</span> http://localhost:3000/;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /login.html &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$server_name</span>/admin/login.html;<br>    &#125;<br><br>    <span class="hljs-section">location</span> /dns-query &#123;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Server <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_pass</span> https://127.0.0.1:3001/dns-query;<br>    &#125;<br>&#125;<span class="hljs-attribute">Copy</span><br><span class="hljs-comment"># 重启Nginx</span><br>shell&gt; nginx -s reloadCopy<br></code></pre></td></tr></table></figure><p>这种配置下，Nginx一旦接到 <code>https://dns.dnomd343.top/dns-query</code> 的访问，就会把内容转交给本地3001端口上的AdGuardHome处理。另外，<code>/dns-query</code> 部分的 <code>proxy_set_header</code> 参数必须加上，以达到在HTTP头中添加客户端来源端口的目的，否则AdGuardHome的统计中将无法出现真实的客户端IP。</p><h3 id="配置DNSCrypt"><a href="#配置DNSCrypt" class="headerlink" title="配置DNSCrypt"></a>配置DNSCrypt</h3><p>AdguardHome目前还不支持在前端直接配置DNSCrypt协议，需要你在后台手动改写配置文件，配置文件中将会提供证书名称，私钥公钥等其他信息。</p><p>这份配置需要使用<a href="https://github.com/ameshkov/dnscrypt">dnscrypt</a>工具生成DNSCrypt的密钥对，直接下载最新版<a href="https://github.com/ameshkov/dnscrypt/releases">Release</a>到本地运行。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 获取release并解压</span><br>shell&gt; wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ameshkov/</span>dnscrypt<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v2.0.2/</span>dnscrypt-linux-amd64-v2.<span class="hljs-number">0.2</span>.tar.gz<br>···<br>shell&gt; tar xf dnscrypt-linux-amd64-v2.<span class="hljs-number">0.2</span>.tar.gz<br><span class="hljs-comment"># 直接复制安装</span><br>shell&gt; mv linux-amd64<span class="hljs-regexp">/dnscrypt /u</span>sr<span class="hljs-regexp">/bin/</span><br><span class="hljs-comment"># 删除残余文件</span><br>shell&gt; rm -rf dnscrypt-linux-amd64-v2.<span class="hljs-number">0.2</span>.tar.gz linux-amd64/Copy<br></code></pre></td></tr></table></figure><p>生成一对密钥，使用 <code>--provider-name</code> 指定证书名，<code>--out</code> 指定输出文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">shell&gt; dnscrypt generate --provider-name <span class="hljs-string">&#x27;2.dnscrypt-cert.dnomd343.top&#x27;</span> --out <span class="hljs-regexp">/opt/</span>AdGuardHome/dnscrypt.yaml<br><span class="hljs-number">2021</span><span class="hljs-regexp">/01/</span><span class="hljs-number">26</span> <span class="hljs-number">03</span>:<span class="hljs-number">35</span>:<span class="hljs-number">40</span> [info] Generating configuration <span class="hljs-keyword">for</span> <span class="hljs-number">2</span>.dnscrypt-cert.dnomd343.top<br><span class="hljs-number">2021</span><span class="hljs-regexp">/01/</span><span class="hljs-number">26</span> <span class="hljs-number">03</span>:<span class="hljs-number">35</span>:<span class="hljs-number">40</span> [info] Configuration has been written to <span class="hljs-regexp">/opt/</span>AdGuardHome/dnscrypt.yaml<br><span class="hljs-number">2021</span><span class="hljs-regexp">/01/</span><span class="hljs-number">26</span> <span class="hljs-number">03</span>:<span class="hljs-number">35</span>:<span class="hljs-number">40</span> [info] Go to https:<span class="hljs-regexp">//</span>dnscrypt.info/stamps to generate an SDNS stampCopy<br></code></pre></td></tr></table></figure><p>查看生成的内容</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dts">shell&gt; cat <span class="hljs-keyword">/opt/</span>AdGuardHome/dnscrypt.yaml<br><span class="hljs-symbol">provider_name:</span> <span class="hljs-number">2.</span>dnscrypt-cert.dnomd343.top<br><span class="hljs-symbol">public_key:</span> <span class="hljs-number">358</span>DEA7C201B068DCD8A1DFCF607C951F6FAC2148ACDC602B176A810818B30D1<br><span class="hljs-symbol">private_key:</span> <span class="hljs-number">2360</span>AA8CD96516D0E29948F64A51ECF54E95A9924AD342285FA125C0A4156278358DEA7C201B068DCD8A1DFCF607C951F6FAC2148ACDC602B176A810818B30D1<br><span class="hljs-symbol">resolver_secret:</span> FD0927401827CF442A7CC530E6F401395A3986F637168F3E7100230184C5F26A<br><span class="hljs-symbol">resolver_public:</span> E647313744A35958775E35225BB948C09E35E45BDF939B15D9188CB80F80416F<br><span class="hljs-symbol">es_version:</span> <span class="hljs-number">1</span><br><span class="hljs-symbol">certificate_ttl:</span> <span class="hljs-number">0</span>sCopy<br></code></pre></td></tr></table></figure><p>编辑AdGuardHome的配置文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">shell</span>&gt; <span class="hljs-keyword">vim</span> /<span class="hljs-keyword">opt</span>/AdGuardHome/AdGuardHome.yamlCopy<br></code></pre></td></tr></table></figure><p>将 <code>port_dnscrypt</code> 从0改为5443（也可以是其他自定义端口），<code>dnscrypt_config_file</code> 填入刚刚生成的配置文件路径</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/qbl.png?raw=true" alt="配置文件"></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">tls:</span><br>  ···<br><span class="hljs-symbol">  port_dnscrypt:</span> <span class="hljs-number">5443</span><br><span class="hljs-symbol">  dnscrypt_config_file:</span> <span class="hljs-keyword">/opt/</span>AdGuardHome/dnscrypt.yaml<br>  ···Copy<br></code></pre></td></tr></table></figure><p>重载AdGuardHome</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">shell</span><span class="language-bash">&gt; systemctl restart AdGuardHomeCopy</span><br></code></pre></td></tr></table></figure><p>如果成功支持了DNSCrypt，那系统的TCP与UDP的5443端口将被AdGuardHome占用</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 查看AdGuardHome是否成功占用5443端口</span><br><span class="hljs-attribute">shell</span>&gt; netstat -tlnpu | grep <span class="hljs-number">5443</span><br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">5443</span>                 :::*                    LISTEN      <span class="hljs-number">29538</span>/AdGuardHome<br><span class="hljs-attribute">udp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">5443</span>                 :::*                                <span class="hljs-number">29538</span>/AdGuardHome<br><span class="hljs-comment"># 成功启用了DNSCryptCopy</span><br></code></pre></td></tr></table></figure><p>在使用时，我们需要提供 <code>IP地址及端口号</code> <code>公钥</code> <code>证书名称</code> 这三个数据，从生成的 <code>/opt/AdGuardHome/dnscrypt.yaml</code> 文件中可以拿到这些信息，其中公钥为 <code>public_key</code> 内容，证书名称为 <code>provider_name</code>。</p><p>接着，我们需要把这些信息打包成DNS Stamp格式，你可以在<a href="https://dnscrypt.info/stamps">这里</a>在线生成sdns链接，填入服务器IP和端口、公钥、证书名称即可，复制右端生成的sdns链接。</p><p><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/30/%E6%90%AD%E5%BB%BA%E5%85%A8%E5%8D%8F%E8%AE%AEDNS%E6%9C%8D%E5%8A%A1%E5%99%A8/3eS.png?raw=true" alt="DNS Stamp"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sdns:<span class="hljs-regexp">//</span>AQcAAAAAAAAAETQ3LjI0Mi4zMC42NTo1NDQzIDWN6nwgGwaNzYod_PYHyVH2-sIUis3GArF2qBCBizDRHDIuZG5zY3J5cHQtY2VydC5kbm9tZDM0My50b3ACopy<br></code></pre></td></tr></table></figure><h3 id="DoQ多端口支持"><a href="#DoQ多端口支持" class="headerlink" title="DoQ多端口支持"></a>DoQ多端口支持</h3><blockquote><p><code>AdGuardHome</code> 的DoQ默认监听在UDP的 <code>784</code> 端口，但有部分客户端默认端口为 <code>8853</code> ，为了保障兼容性，需要同时兼容两个端口。</p></blockquote><p>原理上，我们可以直接使用 <code>iptables</code> 内核模块改写UDP流量目标，将访问8853端口的UDP流量重定向到784端口，这个过程并不是用户层流量转发，因此 <code>AdGuardHome</code> 中记录的客户端IP地址不变（如果借助socat等工具来转发，客户端IP地址会变成 <code>127.0.0.1</code>）。使用root权限执行以下命令：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vim"># 添加重定向<br><span class="hljs-keyword">shell</span>&gt; iptables -t nat -A PREROUTING -<span class="hljs-keyword">p</span> udp --dport <span class="hljs-number">8853</span> -<span class="hljs-keyword">j</span> REDIRECT --<span class="hljs-keyword">to</span>-port <span class="hljs-number">784</span><br><br># 查看添加结果<br><span class="hljs-keyword">shell</span>&gt; iptables -t nat -L<br>Chain PREROUTING (policy ACCEPT)<br>target     prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span>               destination<br>REDIRECT   udp  --  anywhere             anywhere             udp <span class="hljs-keyword">dp</span><span class="hljs-variable">t:8853</span> <span class="hljs-keyword">redir</span> ports <span class="hljs-number">784</span><br><br>Chain INPUT (policy ACCEPT)<br>target     prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span>               destination<br>···<br><br># 删除重定向(此处<span class="hljs-number">1</span>表示为第<span class="hljs-number">1</span>行，应视具体情况修改)<br><span class="hljs-keyword">shell</span>&gt; iptables -t nat -D PREROUTING <span class="hljs-number">1</span>Copy<br></code></pre></td></tr></table></figure><blockquote><p>若服务器支持IPv6，需使用ip6tables命令多执行一次，以支持IPv6下的UDP <code>8853</code> 端口查询</p></blockquote><p>为了方便使用，可执行以下脚本自动添加：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">if</span> [ `whoami` = <span class="hljs-string">&quot;root&quot;</span> ]; then<br>  <span class="hljs-attribute">STATUS</span>=$(iptables -t<span class="hljs-built_in"> nat </span>-L | grep 8853)<br>  <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$STATUS</span>&quot;</span> ]; then<br>    iptables -t<span class="hljs-built_in"> nat </span>-A PREROUTING -p udp --dport 8853 -j REDIRECT --to-port 784<br>  fi<br>fiCopy<br></code></pre></td></tr></table></figure><blockquote><p>可将脚本保存到 <code>/etc/profile.d/</code> 目录下实现开机自启。</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 测试多端口是否正常</span><br>shell&gt; dnslookup google.com quic:<span class="hljs-regexp">//</span>dns.dnomd343.top:<span class="hljs-number">784</span><br>···<br>shell&gt; dnslookup google.com quic:<span class="hljs-regexp">//</span>dns.dnomd343.top:<span class="hljs-number">8853</span><br>···<br><span class="hljs-comment"># 两者均输出正确DNS响应即配置成功Copy</span><br></code></pre></td></tr></table></figure><h2 id="测试服务"><a href="#测试服务" class="headerlink" title="测试服务"></a>测试服务</h2><p>到这里已经将全部协议配置好了，我们可以通过AdGuardHome的端口占用情况来回顾各DNS查询协议。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 列出AdGuardHome占用的全部TCP与UDP端口</span><br><span class="hljs-attribute">shell</span>&gt; netstat -tlnpu | grep AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">853</span>                  :::*                    LISTEN      <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">53</span>                   :::*                    LISTEN      <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">3000</span>                 :::*                    LISTEN      <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">3001</span>                 :::*                    LISTEN      <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">5443</span>                 :::*                    LISTEN      <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">udp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">53</span>                   :::*                                <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">udp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">784</span>                  :::*                                <span class="hljs-number">24295</span>/AdGuardHome<br><span class="hljs-attribute">udp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> :::<span class="hljs-number">5443</span>                 :::*                                <span class="hljs-number">24295</span>/AdGuardHomeCopy<br></code></pre></td></tr></table></figure><ul><li><code>TCP/853</code> ：DNS-over-TLS</li><li><code>TCP/53</code> ：常规DNS</li><li><code>TCP/3000</code> ：网页管理界面</li><li><code>TCP/3001</code> ：DNS-over-HTTPS，同时也是网页管理界面</li><li><code>TCP/5443</code> ：DNSCrypt</li><li><code>UDP/53</code> ：常规DNS</li><li><code>UDP/784</code> ：DNS-over-QUIC</li><li><code>UDP/5443</code> ：DNSCrypt</li></ul><p>以上端口中，建议防火墙屏蔽 <code>TCP/3000</code> 和 <code>TCP/3001</code>，借助Nginx反向代理，其他端口均放行。</p><p>最后，我们仍然借助<a href="https://blog.dnomd343.top/dns-server/#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95">dnslookup</a>工具对建成的全协议DNS服务器进行测试。这里目标域名可以任意选择，因为查询过程都是加密链路，基本不受墙的DNS污染影响。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># DoH测试</span><br>shell&gt; dnslookup google.com https:<span class="hljs-regexp">//</span>dns.dnomd343.top/dns-query<br>···<br><br><span class="hljs-comment"># DoT测试</span><br>shell&gt; dnslookup google.com tls:<span class="hljs-regexp">//</span>dns.dnomd343.top<br>···<br><br><span class="hljs-comment"># DoQ测试</span><br>shell&gt; dnslookup google.com quic:<span class="hljs-regexp">//</span>dns.dnomd343.top<br>···<br><br><span class="hljs-comment"># DNSCrypt测试</span><br>shell&gt; dnslookup google.com sdns:<span class="hljs-regexp">//</span>AQcAAAAAAAAAETQ3LjI0Mi4zMC42NTo1NDQzIDWN6nwgGwaNzYod_PYHyVH2-sIUis3GArF2qBCBizDRHDIuZG5zY3J5cHQtY2VydC5kbm9tZDM0My50b3A<br>···<br><br><span class="hljs-comment"># 以上DNS接口已经停用，仅供示例Copy</span><br></code></pre></td></tr></table></figure><h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><h3 id="可用性与普适性"><a href="#可用性与普适性" class="headerlink" title="可用性与普适性"></a>可用性与普适性</h3><p>正常情况下，大公司会在世界各地配置多台服务器来应对不同业务，如果直接使用自建的境外服务器做DNS解析，会把域名解析到国外的服务器上，由于国内直连相对较慢，将会导致网页访问卡顿。对于这种情况，可以配置EDNS来缓解这个问题，将来源IP地址一并加入请求中，从而正确地将域名解析到国内服务器上，不过它并不能完善地解决问题，上游DNS不一定支持扩展协议，也不一定就能返回最佳结果。因此，最佳的解决方案应该是建立分流器，将请求分为国内组与国外组，国内网站走国内公共DNS，国外网站走境外无污染DNS，这样就可以相对稳定地提供服务。前者我们使用阿里、腾讯等国内大型公共DNS服务器的DoH或DoT，免去运营商的劫持，而后者就只能靠我们自己的境外DNS服务器来实现，毕竟大部分国外DoH、DoT服务都被防火长城干扰或阻断。</p><p>基于上面的思路，不少人的第一反应是用国内服务器做分流，这个方法有诸多问题。首先就是国内三大运营商的网络之间通讯较慢，因此大型网站一般都会在各大运营商网络下设置多台服务器，通过配置DNS把不同网络的请求解析到对应服务器上，这将导致国内服务器统一请求的DNS不能兼容多个运营商，无法解析到最适合的服务器，虽然支持EDNS的服务可以在一定程度上修正这个问题，不过同样也不能确保解析结果的普适性。另一个方面则源自国内的管控，根据相关法律，普通人是不能在境内私自搭建DNS服务器的，没有备案的话就会收到服务商的警告与封锁，虽然搭建DoH服务可以绕过云服务商的监测，但是普适性就大大下降了。综合上述问题，使用境内服务器配置DNS分流并不是一个完善的解决方案。</p><p>更常规的做法是在本地路由器或内网设置一个DNS服务器，在其上配置完善的DNS分流机制，即使失去了移动设备外出时的可用性，但也没有上述公网服务器的问题。目前确实有很多基于这方面的实现，结合 <code>DNSmasq</code>、<code>SmartDNS</code>、<code>ChinaDNS</code> 等工具做分流与优选，同时加上去广告、强制重定向等功能，也有封装了完整配置的Docker镜像可以作为容器直接使用。</p><h3 id="有效性与必要性"><a href="#有效性与必要性" class="headerlink" title="有效性与必要性"></a>有效性与必要性</h3><p>回到问题的本质上，我们要对抗的是DNS污染与劫持，即运营商的劫持和GFW的污染。解决前者很轻松，正常情况下不使用运营商分配的DNS就可以避免，而后者则要棘手得多，我们可以从有效性和必要性这两个方面来讨论。</p><p>要知道，GFW在屏蔽域名或IP时有多种手段，针对域名的封锁最基本也最方便的就是DNS污染，以极低的成本就能让普通用户无法正常访问，早期不少屏蔽都是针对DNS的，因而兴起了修改host或是基于加密DNS的抗污染工具，即使到现在，对于部分域名的屏蔽仍是最简单的DNS污染，这也是无污染DNS唯一能解决的封锁方式。而在针对连接方面，封锁IP可以粗暴地从网络层直接切断，我们对此无能为力，但针对域名的连接识别与阻断则稍微复杂。</p><p>在早期，大部分网站基于明文HTTP协议，GFW可以对HTTP请求头的host参数或内容敏感词进行匹配。而随着HTTPS的兴起，HTTP数据嵌套在SSL&#x2F;TLS加密层内，防火长城无法窥探其中内容，但是它可以识别到访问目标IP与连接host，并以此屏蔽黑名单网站。一般情况下，GFW会对TLS连接的SNI进行嗅探，或者读取服务器返回的证书（当然前者成本更低），一旦识别成功就用中间人身份重置TCP连接，从而达到屏蔽作用。在TLS1.3中，新增的ESNI特性通过域前置方式，有效地加密了SNI内容，从而规避掉SNI嗅探，对于这种流量，GFW只有两个选择，不拦截或全部拦截，而显然的，防火长城选择了后者，直接暴力地屏蔽了所有带有ESNI的TLS1.3流量，具体的细节可以关注<a href="https://gfw.report/blog/gfw_esni_blocking/zh/">这篇文章</a>。</p><p>所以，抗污染DNS服务在面对GFW的连接封锁方面是无力的，其上限也只是抵御一部分屏蔽，而上述TCP阻断等屏蔽措施都是在DNS层面无法解决的。不过，大多数情况下有总比没有强，况且还有为数不少的黑名单域名只享受到了DNS污染的待遇，GFW没有足够的资源或精力去阻断这些连接，因此自建DNS服务还是可以在一定程度上优化体验的。而对于科学上网的需求，则交给SS、SSR、Trojan、VMess、VLESS等更专业的协议去完成，同样的，它们可以把DNS请求转发到远端给海外服务器，算是一举两得，在绕过防火长城屏蔽的同时，也无需再考虑DNS污染问题。</p><p>因此，自建DNS的有效性是不可否认的，它确实能抵抗污染与劫持，绕过一部分DNS封锁，但是效果上并不是十全十美，这也就引出了必要性问题，在GFW面前，直接使用代理协议无疑是更为明智的选择，它们绕过了所有封锁的同时还加快了访问速度。不过再说回来，自建DNS也不是一无是处，至少在优化体验的同时能与代理协议互补，总体上还是值得的。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DNS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iptables配置实践</title>
    <link href="/2023/04/30/iptables%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/"/>
    <url>/2023/04/30/iptables%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在大企业中防火墙角色主要交给硬件来支持，效果自然没话说只是需要增加一点点成本，但对于大多数个人或者互联网公司来说选择系统自带的<code>iptables</code>或者第三方云防火墙似乎是更加合适的选择，通过一些合理的优化和灵活的配置，我们也可以很轻松实现硬件防火墙的部分功能，够用就好。</p><blockquote><p>建立防火墙白名单机制很重要</p></blockquote><hr><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="Netfilter-与-iptables-的关系"><a href="#Netfilter-与-iptables-的关系" class="headerlink" title="Netfilter 与 iptables 的关系"></a>Netfilter 与 iptables 的关系</h3><p>Linux 系统在内核中提供了对报文数据包过滤和修改的官方项目名为 Netfilter，它指的是 Linux 内核中的一个框架，它可以用于在不同阶段将某些钩子函数（hook）作用域网络协议栈。Netfilter 本身并不对数据包进行过滤，它只是允许可以过滤数据包或修改数据包的函数挂接到内核网络协议栈中的适当位置。这些函数是可以自定义的。</p><p>iptables 是用户层的工具，它提供命令行接口，能够向 Netfilter 中添加规则策略，从而实现报文过滤，修改等功能。Linux 系统中并不止有 iptables 能够生成防火墙规则，其他的工具如 firewalld 等也能实现类似的功能。</p><h3 id="使用-iptables-进行包过滤"><a href="#使用-iptables-进行包过滤" class="headerlink" title="使用 iptables 进行包过滤"></a>使用 iptables 进行包过滤</h3><p>iptables 策略是由一组有序的规则建立的，它告诉内核应该如何处理某些类别的数据包。每一个 iptables 规则应用于一个表中的一个链。一个 iptables 链就是一个规则集，这些规则按序与包含某种特征的数据包进行比较匹配。</p><h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><p>iptables 默认有 4 个表</p><ol><li>nat 表（地址转换表）</li><li>filter 表（数据过滤表）</li><li>raw 表（状态跟踪表）</li><li>mangle 表（包标记表）</li></ol><h3 id="链"><a href="#链" class="headerlink" title="链"></a>链</h3><p>每个表都有一组内置链，用户还可以添加自定义的链。最重要的内置链是 filter 表中的 INPUT、OUTPUT 和 FORWARD 链。</p><ol><li>INPUT 链（入站规则）</li><li>OUTPUT 链（出站规则）</li><li>FORWARD 链（转发规则）</li><li>PREROUTING 链（路有前规则）</li><li>POSTROUTING 链（路由后规则）</li></ol><p>下图展现了一个数据包是如何通过内核中的 net 和 filter 表的：</p><p><a href="https://i.v2ex.co/4WFXrnn2.png"><img src="https://i.v2ex.co/4WFXrnn2.png" alt="img"></a></p><h3 id="iptables的4表5链"><a href="#iptables的4表5链" class="headerlink" title="iptables的4表5链"></a>iptables的4表5链</h3><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">iptables</span> --&gt;</span>四表五链<br>    添加规则是的考量点：<br>        （<span class="hljs-number">1</span>）要实现那种功能：判断添加在那张表上<br>        （<span class="hljs-number">2</span>）报文流经的路径：判断添加在那个链上<br><br>链--&gt;&gt;练上规则的次序，即为检查的次序，因此隐含一定的法则<br>        （<span class="hljs-number">1</span>）同类规则(访问同一应用)：匹配范围小的放上面<br>        （<span class="hljs-number">2</span>）不同类规则(访问不同应用)：匹配到报文平率较大的放上面<br>        （<span class="hljs-number">3</span>）将可以由条规则描述的多个规则合并为一个<br>        （<span class="hljs-number">4</span>）设置默认策略：<br><br>功能的优先级次序：<span class="hljs-function"><span class="hljs-title">raw</span> --&gt;</span> <span class="hljs-function"><span class="hljs-title">mangle</span> --&gt;</span> <span class="hljs-function"><span class="hljs-title">nat</span> --&gt;</span> filter<br><br>规则：<br>    组成部分：报文的匹配条件，匹配到后处理动作<br>    匹配条件：根据协议报文特征指定匹配条件<br>            基本匹配条件：源IP，目标IP，源端口，目标端口<br>                        扩展匹配条件：IP追踪<br>    处理动作：<br>                        内建处理机制<br>                        自定义处理机制<br>注意：<br><br>报文不会经过自定义链，只能在内置链上通过规则引用后生效<br>        iptables的规则管理工具<br>                添加、修改、删除、显示等功能<br>        规则和链有计数器：<br>                pkgs：有规则或链所匹配到的报文的个数<br>                bytes:由规则或链匹配到的所有报文大小之和<br></code></pre></td></tr></table></figure><h3 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h3><p>每个 iptables 规则都包含一组匹配和一个目标动作，后者定义了复合规则的数据包应该采取什么处理行为。iptables 匹配指定是数据包必须匹配的条件，只有当数据包满足所有的匹配条件时，iptables 才能根据规则的目标所指定的动作来处理该数据包。</p><p>每个匹配都在 iptables 的命令行中指定。下面是一些常用的基本匹配：</p><table><thead><tr><th align="left">参数</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">-P</td><td align="left">设置默认策略</td></tr><tr><td align="left">-F</td><td align="left">清空规则链</td></tr><tr><td align="left">-L</td><td align="left">查看规则链</td></tr><tr><td align="left">-A</td><td align="left">在规则链的末尾加入新规则</td></tr><tr><td align="left">-I num</td><td align="left">在规则链的头部加入新规则</td></tr><tr><td align="left">-D num</td><td align="left">删除某一条规则</td></tr><tr><td align="left">-s</td><td align="left">匹配来源地址IP&#x2F;MASK，加叹号“!”表示除这个IP外</td></tr><tr><td align="left">-d</td><td align="left">匹配目标地址</td></tr><tr><td align="left">-i网卡名称</td><td align="left">匹配从这块网卡流入的数据</td></tr><tr><td align="left">-o网卡名称</td><td align="left">匹配从这块网卡流出的数据</td></tr><tr><td align="left">-p</td><td align="left">匹配协议，如TCP、UDP、ICMP</td></tr><tr><td align="left">–dport num</td><td align="left">匹配目标端口号</td></tr><tr><td align="left">–sport num</td><td align="left">匹配来源端口号</td></tr></tbody></table><h3 id="防火墙的匹配规则"><a href="#防火墙的匹配规则" class="headerlink" title="防火墙的匹配规则"></a>防火墙的匹配规则</h3><ul><li>匹配即可停止</li><li>匹配有先后顺序</li><li>默认规则的优先级最低</li></ul><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><blockquote><p>表名作用：</p></blockquote><p>raw：高级功能，如：网址过滤。<br>mangle：数据包修改（QOS），用于实现服务质量。<br>net：地址转换，用于网关路由器。<br>filter：包过滤，用于防火墙规则。</p><blockquote><p>规则链作用：</p></blockquote><p>INPUT链：处理输入数据包。<br>OUTPUT链：处理输出数据包。<br>PORWARD链：处理转发数据包。<br>PREROUTING链：用于目标地址转换（DNAT）。<br>POSTOUTING链：用于源地址转换（SNAT）。</p><blockquote><p>动作作用：</p></blockquote><p>accept：接收数据包。<br>DROP：丢弃数据包。<br>REJECT ：拒绝数据包<br>REDIRECT：重定向、映射、透明代理。<br>SNAT：源地址转换。<br>DNAT：目标地址转换。<br>MASQUERADE：IP伪装（NAT），用于ADSL。<br>LOG：日志记录。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#规则的观察与清除<br><br>     iptables <span class="hljs-selector-attr">[-t tables]</span> <span class="hljs-selector-attr">[-L]</span> <span class="hljs-selector-attr">[-nv]</span><br><br>选项与参数：<br>-t ：后面接 <span class="hljs-selector-tag">table</span> ，例如 nat 或 <span class="hljs-attribute">filter</span> ，若省略此项目，则使用默认的 filter<br>-L ：列出目前的 <span class="hljs-selector-tag">table</span> 的规则<br>-n ：不进行 IP 与 HOSTNAME 的反查，显示讯息的速度会快很多！<br>-v ：列出更多的信息，包括通过该规则的封包总位数、相关的网络接口等<br><br>     iptables <span class="hljs-selector-attr">[-t tables]</span> <span class="hljs-selector-attr">[-FXZ]</span><br><br>选项与参数：<br>-F ：清除所有的已订定的规则；<br>-X ：杀掉所有使用者 <span class="hljs-string">&quot;自定义&quot;</span> 的 chain (应该说的是 tables ）啰；<br>-Z ：将所有的 chain 的计数与流量统计都归零<br><br><br>#封包的基础比对：IP, 网域及接口装置<br><br>    iptables <span class="hljs-selector-attr">[-AI 链名]</span> <span class="hljs-selector-attr">[-io 网络接口]</span> <span class="hljs-selector-attr">[-p 协议]</span> <span class="hljs-selector-attr">[-s 来源IP/网域]</span> <span class="hljs-selector-attr">[-d 目标IP/网域]</span> -j <span class="hljs-selector-attr">[ACCEPT|DROP|REJECT|LOG]</span><br><br>选项与参数：<br>-AI 链名：针对某的链进行规则的 <span class="hljs-string">&quot;插入&quot;</span> 或 <span class="hljs-string">&quot;累加&quot;</span><br>    -A ：新增加一条规则，该规则增加在原本规则的最后面。例如原本已经有四条规则，<br>         使用 -A 就可以加上第五条规则！<br>    -I ：插入一条规则。如果没有指定此规则的顺序，默认是插入变成第一条规则。<br>         例如原本有四条规则，使用 -I 则该规则变成第一条，而原本四条变成 <span class="hljs-number">2</span>~<span class="hljs-number">5</span> 号<br>    链 ：有 INPUT, OUTPUT, FORWARD 等，此链名称又与 -io 有关，请看底下。<br><br>-io 网络接口：设定封包进出的接口规范<br>    -<span class="hljs-selector-tag">i</span> ：封包所进入的那个网络接口，例如 eth0, lo 等接口。需与 INPUT 链配合；<br>    -o ：封包所传出的那个网络接口，需与 OUTPUT 链配合；<br><br>-<span class="hljs-selector-tag">p</span> 协定：设定此规则适用于哪种封包格式<br>   主要的封包格式有： tcp, udp, icmp 及 <span class="hljs-attribute">all</span> 。<br><br>-s 来源 IP/网域：设定此规则之封包的来源项目，可指定单纯的 IP 或包括网域，例如：<br>   IP  ：<span class="hljs-number">192.168</span>.<span class="hljs-number">0.100</span><br>   网域：<span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>, <span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> 均可。<br>   若规范为『不许』时，则加上 ! 即可，例如：<br>   -s ! <span class="hljs-number">192.168</span>.<span class="hljs-number">100.0</span>/<span class="hljs-number">24</span> 表示不许 <span class="hljs-number">192.168</span>.<span class="hljs-number">100.0</span>/<span class="hljs-number">24</span> 之封包来源；<br><br>-d 目标 IP/网域：同 -s ，只不过这里指的是目标的 IP 或网域。<br><br>-j ：后面接动作，主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT)及记录(LOG)<br><br><span class="hljs-selector-id">#TCP</span>, UDP 的规则比对：针对端口设定<br><br>    iptables <span class="hljs-selector-attr">[-AI 链]</span> <span class="hljs-selector-attr">[-io 网络接口]</span> <span class="hljs-selector-attr">[-p tcp,udp]</span> <span class="hljs-selector-attr">[-s 来源IP/网域]</span> <span class="hljs-selector-attr">[--sport 埠口范围]</span> <span class="hljs-selector-attr">[-d 目标IP/网域]</span> <span class="hljs-selector-attr">[--dport 端口范围]</span> -j <span class="hljs-selector-attr">[ACCEPT|DROP|REJECT]</span><br><br>选项与参数：<br><span class="hljs-attr">--sport</span> 埠口范围：限制来源的端口号码，端口号码可以是连续的，例如 <span class="hljs-number">1024</span>:<span class="hljs-number">65535</span><br><span class="hljs-attr">--dport</span> 埠口范围：限制目标的端口号码。<br><br><span class="hljs-selector-id">#iptables</span> 外挂模块：mac 与 state<br><br>    iptables -A INPUT <span class="hljs-selector-attr">[-m state]</span> <span class="hljs-selector-attr">[--state 状态]</span><br><br>选项与参数：<br>-m ：一些 iptables 的外挂模块，主要常见的有：<br>     state ：状态模块<br>     mac   ：网络卡硬件地址 (hardware address)<br><span class="hljs-attr">--state</span> ：一些封包的状态，主要有：<br>     INVALID    ：无效的封包，例如数据破损的封包状态<br>     ESTABLISHED：已经联机成功的联机状态；<br>     NEW        ：想要新建立联机的封包状态；<br>     RELATED    ：这个最常用！表示这个封包是与我们主机发送出去的封包有关<br><br><br><span class="hljs-selector-id">#ICMP</span> 封包规则的比对：针对是否响应 ping 来设计<br><br>    iptables -A INPUT <span class="hljs-selector-attr">[-p icmp]</span> <span class="hljs-selector-attr">[--icmp-type 类型]</span> -j ACCEPT<br><br>选项与参数：<br><span class="hljs-attr">--icmp-type</span> ：后面必须要接 ICMP 的封包类型，也可以使用代号，<br>              例如 <span class="hljs-number">8</span>  代表 echo request 的意思。<br></code></pre></td></tr></table></figure><blockquote><p>注意事项与规律</p></blockquote><ul><li>可以不指定表，默认为 filter 表</li><li>可以不指定链，默认为对应表的所有链</li><li>除非设置默认策略，否则必须指定匹配条件</li><li>选项 &#x2F; 链名 &#x2F; 目标操作用大写字母，其余都小写</li></ul><h2 id="配置iptables白名单机制"><a href="#配置iptables白名单机制" class="headerlink" title="配置iptables白名单机制"></a>配置iptables白名单机制</h2><blockquote><p>配置iptables白名单是相对简单有效的管理手段</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#清除所有规则(慎用)</span><br><span class="hljs-attribute">iptables</span> -F<br>iptables -X<br>iptables -Z<br><br><span class="hljs-comment">#查看iptable和行号</span><br>iptables -nL --line-number<br><br><span class="hljs-comment">#保存当前防火墙配置</span><br>service iptables save<br><br><span class="hljs-comment">#手动编辑防火墙策略</span><br>vi /etc/sysconfig/iptables<br><br>*filter<br>:INPUT ACCEPT [<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]<br>:FORWARD ACCEPT [<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]<br>:OUTPUT ACCEPT [<span class="hljs-number">0</span>:<span class="hljs-number">0</span>]<br><span class="hljs-comment">#开放本地和Ping</span><br>-A INPUT -i lo -j ACCEPT  <br>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br>-A INPUT -p icmp -j ACCEPT<br><span class="hljs-comment">#配置内网白名单</span><br>-A INPUT -s <span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span> -j ACCEPT<br>-A INPUT -s <span class="hljs-number">172.16.0.0</span>/<span class="hljs-number">12</span> -j ACCEPT<br>-A INPUT -s <span class="hljs-number">192.168.0.0</span>/<span class="hljs-number">16</span> -j ACCEPT<br><span class="hljs-comment">#配置外网白名单</span><br>-A INPUT -s <span class="hljs-number">180.168.36.198</span> -j ACCEPT <br>-A INPUT -s <span class="hljs-number">180.168.34.218</span> -j ACCEPT <br>-A INPUT -s <span class="hljs-number">222.73.202.251</span> -j ACCEPT <br><span class="hljs-comment">#控制端口</span><br>-A INPUT -p tcp --dport <span class="hljs-number">80</span> -j ACCEPT <br>-A INPUT -p tcp --dport <span class="hljs-number">22</span> -j ACCEPT<br><span class="hljs-comment">#拒绝其它</span><br>-A INPUT -j DROP <br>-A FORWARD -j DROP <br><span class="hljs-comment">#开放出口</span><br>-A OUTPUT -j ACCEPT <br>COMMIT<br><br><span class="hljs-comment">#重启生效</span><br>service iptables restart<br><br><span class="hljs-comment">#复查结果</span><br><br>iptables -nL --line-number<br><br>Chain INPUT (policy ACCEPT)<br>num  target     prot opt source               destination         <br><span class="hljs-number">1</span>    ACCEPT     all  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">2</span>    ACCEPT     all  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           state RELATED,ESTABLISHED <br><span class="hljs-number">3</span>    ACCEPT     icmp --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">4</span>    ACCEPT     all  --  <span class="hljs-number">10.0.0.0</span>/<span class="hljs-number">8</span>           <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">5</span>    ACCEPT     all  --  <span class="hljs-number">172.16.0.0</span>/<span class="hljs-number">12</span>        <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">6</span>    ACCEPT     all  --  <span class="hljs-number">192.168.0.0</span>/<span class="hljs-number">16</span>       <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">7</span>    ACCEPT     all  --  <span class="hljs-number">180.168.36.198</span>       <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">8</span>    ACCEPT     all  --  <span class="hljs-number">180.168.34.218</span>       <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">9</span>    ACCEPT     all  --  <span class="hljs-number">222.73.202.251</span>       <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><span class="hljs-number">10</span>   ACCEPT     tcp  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           tcp dpt:<span class="hljs-number">80</span> <br><span class="hljs-number">11</span>   ACCEPT     tcp  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           tcp dpt:<span class="hljs-number">22</span> <br><span class="hljs-number">12</span>   DROP       all  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><br>Chain FORWARD (policy ACCEPT)<br>num  target     prot opt source               destination         <br><span class="hljs-number">1</span>    DROP       all  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>           <br><br>Chain OUTPUT (policy ACCEPT)<br>num  target     prot opt source               destination         <br><span class="hljs-number">1</span>    ACCEPT     all  --  <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>            <span class="hljs-number">0.0.0.0</span>/<span class="hljs-number">0</span>   <br></code></pre></td></tr></table></figure><h2 id="设置crontab脚本"><a href="#设置crontab脚本" class="headerlink" title="设置crontab脚本"></a>设置crontab脚本</h2><blockquote><p>便于运维集中化管理扩展</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/root/</span>start_iptables.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#0 0 * * * /root/start_iptables.sh</span><br><br><span class="hljs-comment">#清除配置</span><br><span class="hljs-regexp">/sbin/i</span>ptables -P INPUT ACCEPT<br><span class="hljs-regexp">/sbin/i</span>ptables -F<br><span class="hljs-regexp">/sbin/i</span>ptables -X<br><span class="hljs-comment">#开放本地和Ping</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -i lo -j ACCEPT  <br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT <br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -p icmp -j ACCEPT<br><span class="hljs-comment">#配置内网白名单</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">8</span> -j ACCEPT<br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">172.16</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">12</span> -j ACCEPT<br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span> -j ACCEPT<br><span class="hljs-comment">#配置外网白名单</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">180.168</span>.<span class="hljs-number">36.198</span> -j ACCEPT <br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">180.168</span>.<span class="hljs-number">34.218</span> -j ACCEPT <br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -s <span class="hljs-number">222.73</span>.<span class="hljs-number">202.251</span> -j ACCEPT <br><span class="hljs-comment">#控制端口</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -p tcp --dport <span class="hljs-number">80</span> -j ACCEPT <br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -p tcp --dport <span class="hljs-number">22</span> -j ACCEPT<br><span class="hljs-comment">#拒绝其它</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A INPUT -j DROP <br><span class="hljs-regexp">/sbin/i</span>ptables -A FORWARD -j DROP <br><span class="hljs-comment">#开放出口</span><br><span class="hljs-regexp">/sbin/i</span>ptables -A OUTPUT -j ACCEPT <br><br><br>chmod <span class="hljs-number">755</span> <span class="hljs-regexp">/root/</span>start_iptables.sh<br>crontab -e<br><span class="hljs-number">0</span> <span class="hljs-number">0</span> * * * <span class="hljs-regexp">/root/</span>start_iptables.sh<br></code></pre></td></tr></table></figure><h2 id="CentOS7配置iptables"><a href="#CentOS7配置iptables" class="headerlink" title="CentOS7配置iptables"></a>CentOS7配置iptables</h2><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-comment"># 配置好yum源以后安装iptables-service</span><br>yum install -y iptables-services<br><span class="hljs-comment"># 停止firewalld</span><br><span class="hljs-params">system</span>ctl stop firewalld<br><span class="hljs-comment"># 禁止firewalld自动启动</span><br><span class="hljs-params">system</span>ctl disable firewalld<br><span class="hljs-comment"># 启动iptables</span><br><span class="hljs-params">system</span>ctl start iptables<br><span class="hljs-comment"># 将iptables设置为开机自动启动，以后即可通过iptables-service控制iptables服务</span><br><span class="hljs-params">system</span>ctl enable iptables<br></code></pre></td></tr></table></figure><h3 id="开启Linux路由转发"><a href="#开启Linux路由转发" class="headerlink" title="开启Linux路由转发"></a>开启Linux路由转发</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#关闭路由转发</span><br>echo <span class="hljs-number">0</span> &gt; <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv4/ip_forward            <br><span class="hljs-comment">#开启路由转发</span><br>echo <span class="hljs-number">1</span> &gt; <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv4/ip_forward            <br><span class="hljs-comment">#注意以上操作仅当前有效，计算机重启后无效，修改/etc/sysctl.conf配置文件，可以实现永久有效规则</span><br>echo <span class="hljs-string">&#x27;net.ipv4.ip_forward=1&#x27;</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br></code></pre></td></tr></table></figure><h2 id="配置NAT-Tunnel"><a href="#配置NAT-Tunnel" class="headerlink" title="配置NAT Tunnel"></a>配置NAT Tunnel</h2><blockquote><p>俗称跳板机</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># 配置iptables<br>vi /etc/sysconfig/iptables<br>*nat<br><span class="hljs-meta">:PREROUTING ACCEPT [6:504]</span><br><span class="hljs-meta">:INPUT ACCEPT [0:0]</span><br><span class="hljs-meta">:OUTPUT ACCEPT [1:52]</span><br><span class="hljs-meta">:POSTROUTING ACCEPT [1:52]</span><br><br>-A POSTROUTING -j MASQUERADE<br>COMMIT<br><br>*filter<br><span class="hljs-meta">:INPUT DROP [1029028:53321694]</span><br><span class="hljs-meta">:FORWARD ACCEPT [0:0]</span><br><span class="hljs-meta">:OUTPUT ACCEPT [44723822:21524638399]</span><br><br>#zabbix<br>-A INPUT -s 10.65.200.90 -p tcp -m tcp --dport 10050 -j ACCEPT<br><br>-A INPUT -p tcp --dport 22 -j ACCEPT<br><br># For keepalived:<br># allow vrrp<br>-A INPUT -p vrrp -j ACCEPT<br>-A INPUT -p igmp -j ACCEPT<br># allow multicast<br>-A INPUT -d 224.0.0.18 -j ACCEPT<br><br># Drop packets from spoofed networks<br>-A INPUT -s 169.254.0.0/16   -j DROP<br>#-A INPUT -s 10.0.0.0/8       -j DROP<br>#-A INPUT -s 127.0.0.0/8      -j DROP<br>-A INPUT -s 224.0.0.0/4      -j DROP<br>-A INPUT -d 224.0.0.0/4      -j DROP<br>-A INPUT -s 240.0.0.0/5      -j DROP<br>-A INPUT -d 240.0.0.0/5      -j DROP<br>-A INPUT -s 0.0.0.0/8        -j DROP<br>-A INPUT -d 0.0.0.0/8        -j DROP<br>-A INPUT -d 239.255.255.0/24 -j DROP<br>-A INPUT -d 255.255.255.255  -j DROP<br><br># Drop Invalid packets<br>-A INPUT   -m state --state INVALID -j DROP<br>#-A FORWARD -m state --state INVALID -j DROP<br>-A OUTPUT  -m state --state INVALID -j DROP<br><br># Drop Bogus TCP packets<br>-A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP<br>-A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP<br><br>-A INPUT -p icmp --icmp-type echo-reply -j ACCEPT<br>-A INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT<br>-A INPUT -p icmp --icmp-type redirect -j ACCEPT<br>-A INPUT -p icmp --icmp-type echo-request -j ACCEPT<br>-A INPUT -p icmp --icmp-type time-exceeded -j ACCEPT<br>-A INPUT -i lo -j ACCEPT<br>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT<br>COMMIT<br><br># 重启生效并检查<br>service iptables restart<br>iptables -nvL<br></code></pre></td></tr></table></figure><h2 id="常用的iptables配置文件"><a href="#常用的iptables配置文件" class="headerlink" title="常用的iptables配置文件"></a>常用的iptables配置文件</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dns"># dnat<br>-<span class="hljs-keyword">A</span> PREROUTING -s <span class="hljs-number">1.1.1.1</span>/<span class="hljs-number">30,2.2.2</span>.<span class="hljs-number">2</span> -p tcp --dport <span class="hljs-number">10000</span> -j DNAT --to-destination <span class="hljs-number">10.71.12.89</span>:<span class="hljs-number">80</span><br># snat<br>-<span class="hljs-keyword">A</span> POSTROUTING -d <span class="hljs-number">1.1.1.1</span> -j SNAT --to-source <span class="hljs-number">2.2.2.2</span><br>-<span class="hljs-keyword">A</span> POSTROUTING -o bond1 -j SNAT --to-source <span class="hljs-number">3.3.3.3</span><br>-<span class="hljs-keyword">A</span> POSTROUTING -j MASQUERADE<br># multiport<br>-<span class="hljs-keyword">A</span> INPUT -s <span class="hljs-number">10.65.200.90</span> -p tcp -m multiport --dports <span class="hljs-number">10050,10051</span> -j ACCEPT<br>-<span class="hljs-keyword">A</span> INPUT -s <span class="hljs-number">10.65.200.90</span> -p tcp -m multiport --dports <span class="hljs-number">10050:10060</span> -j ACCEPT<br></code></pre></td></tr></table></figure><h2 id="Ansible管理iptables"><a href="#Ansible管理iptables" class="headerlink" title="Ansible管理iptables"></a>Ansible管理iptables</h2><blockquote><p>核心先规范好iptables模板格式，然后利用ansible blockinfile中的marker批量修改</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">*filter</span><br><span class="hljs-string">:INPUT</span> <span class="hljs-string">DROP</span> [<span class="hljs-number">0</span><span class="hljs-string">:0</span>]<br><span class="hljs-string">:FORWARD</span> <span class="hljs-string">ACCEPT</span> [<span class="hljs-number">0</span><span class="hljs-string">:0</span>]<br><span class="hljs-string">:OUTPUT</span> <span class="hljs-string">ACCEPT</span> [<span class="hljs-number">0</span><span class="hljs-string">:0</span>]<br><br><span class="hljs-comment"># lvs-tun</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">ipv4</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><br><span class="hljs-comment"># keepalived vrrp</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">vrrp</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">igmp</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">224.0</span><span class="hljs-number">.0</span><span class="hljs-number">.18</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><br><span class="hljs-comment"># http/https</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">80</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">443</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><br><span class="hljs-comment"># BEGIN ANSIBLE MANAGED BLOCK iptables</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-string">xxx</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">22</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-string">xxx</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">22</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-string">xxx</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">22</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-comment"># END ANSIBLE MANAGED BLOCK iptables</span><br><br><span class="hljs-comment"># BEGIN ANSIBLE MANAGED BLOCK jumphost</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">10.10</span><span class="hljs-number">.8</span><span class="hljs-number">.151</span><span class="hljs-string">/32</span>     <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">22</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">10.10</span><span class="hljs-number">.70</span><span class="hljs-number">.149</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">-m</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--dport</span> <span class="hljs-number">38422</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-comment"># END ANSIBLE MANAGED BLOCK jumphost</span><br><br><span class="hljs-comment"># BEGIN ANSIBLE MANAGED BLOCK userdefined</span><br><span class="hljs-comment"># END ANSIBLE MANAGED BLOCK userdefined</span><br><br><span class="hljs-comment"># Drop packets from spoofed networks</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">169.254</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/16</span>   <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">224.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/4</span>      <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">224.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/4</span>      <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">240.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/5</span>      <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">240.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/5</span>      <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-s</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/8</span>        <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/8</span>        <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">239.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><span class="hljs-string">/24</span> <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-d</span> <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.255</span>  <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><br><span class="hljs-comment"># Drop Invalid packets</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span>   <span class="hljs-string">-m</span> <span class="hljs-string">state</span> <span class="hljs-string">--state</span> <span class="hljs-string">INVALID</span> <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-comment">#-A FORWARD -m state --state INVALID -j DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">OUTPUT</span>  <span class="hljs-string">-m</span> <span class="hljs-string">state</span> <span class="hljs-string">--state</span> <span class="hljs-string">INVALID</span> <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><br><span class="hljs-comment"># Drop Bogus TCP packets</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--tcp-flags</span> <span class="hljs-string">SYN,FIN</span> <span class="hljs-string">SYN,FIN</span> <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">tcp</span> <span class="hljs-string">--tcp-flags</span> <span class="hljs-string">SYN,RST</span> <span class="hljs-string">SYN,RST</span> <span class="hljs-string">-j</span> <span class="hljs-string">DROP</span><br><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">icmp</span> <span class="hljs-string">--icmp-type</span> <span class="hljs-string">echo-reply</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">icmp</span> <span class="hljs-string">--icmp-type</span> <span class="hljs-string">destination-unreachable</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">icmp</span> <span class="hljs-string">--icmp-type</span> <span class="hljs-string">redirect</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">icmp</span> <span class="hljs-string">--icmp-type</span> <span class="hljs-string">echo-request</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-p</span> <span class="hljs-string">icmp</span> <span class="hljs-string">--icmp-type</span> <span class="hljs-string">time-exceeded</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-i</span> <span class="hljs-string">lo</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">-A</span> <span class="hljs-string">INPUT</span> <span class="hljs-string">-m</span> <span class="hljs-string">state</span> <span class="hljs-string">--state</span> <span class="hljs-string">RELATED,ESTABLISHED</span> <span class="hljs-string">-j</span> <span class="hljs-string">ACCEPT</span><br><span class="hljs-string">COMMIT</span><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">all</span><br>  <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span><br>  <span class="hljs-attr">gather_facts:</span> <span class="hljs-literal">no</span><br><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backup</span> <span class="hljs-string">iptables</span><br>      <span class="hljs-attr">copy:</span><br>        <span class="hljs-attr">src:</span> <span class="hljs-string">/etc/sysconfig/iptables</span><br>        <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/sysconfig/iptables.bak</span><br>        <span class="hljs-attr">remote_src:</span> <span class="hljs-literal">yes</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">add</span> <span class="hljs-string">iptables</span> <span class="hljs-string">line</span> <span class="hljs-string">for</span> <span class="hljs-string">internal</span> <span class="hljs-string">logic</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">blockinfile:</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/sysconfig/iptables</span><br>        <span class="hljs-attr">insertafter:</span> <span class="hljs-string">&#x27;^:OUTPUT ACCEPT&#x27;</span><br>        <span class="hljs-attr">marker:</span> <span class="hljs-string">&quot;# &#123;mark&#125; iptables whitelist only for internal logic service&quot;</span><br>        <span class="hljs-attr">block:</span> <span class="hljs-string">|</span><br><span class="hljs-string">          -A INPUT -s 10.0.0.0/8 -j ACCEPT</span><br><span class="hljs-string"></span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">reload</span> <span class="hljs-string">service</span><br>      <span class="hljs-attr">service:</span> <span class="hljs-string">name=iptables</span> <span class="hljs-string">state=reloaded</span><br>      <span class="hljs-attr">tags:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">reload</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iptables</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Prometheus存储原理及数据备份还原</title>
    <link href="/2023/04/28/Prometheus%E5%AD%98%E5%82%A8%E5%8E%9F%E7%90%86%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/"/>
    <url>/2023/04/28/Prometheus%E5%AD%98%E5%82%A8%E5%8E%9F%E7%90%86%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/</url>
    
    <content type="html"><![CDATA[<p>prometheus将采集到的样本以时间序列的方式保存在内存（TSDB 时序数据库）中，并定时保存到硬盘中。与zabbix不同，zabbix会保存所有的数据，而prometheus本地存储会保存15天，超过15天以上的数据将会被删除，若要永久存储数据，有两种方式：</p><p>方式一：修改prometheus的配置参数“storage.tsdb.retention.time&#x3D;10000d”；</p><p>方式二：将数据引入存储到Influcdb中。为保证数据安全性，本文主要介绍的是promethues本地存储备份数据的方法。</p><hr><h2 id="一、存储原理"><a href="#一、存储原理" class="headerlink" title="一、存储原理"></a>一、存储原理</h2><p>　　prometheus 提供了本地存储（TSDB）时序型数据库的存储方式，在2.0版本之后，压缩数据的能力得到了大大的提升，单节点情况下可以满足大部分用户的需求，但本地存储阻碍了prometheus集群化的实现，因此在集群中应当采用 其他时序性数据来替代，比如influxdb。<br>　　prometheus 分为三个部分，分别是：<strong>抓取数据</strong>、<strong>存储数据</strong>和<strong>查询数据</strong>。</p><p>　　prometheus按照block块的方式来存储数据，每2小时为一个时间单位，首先会存储到内存中，当到达2小时后，会自动写入磁盘中。block的目录结构如下：</p><table><thead><tr><th align="left">文件</th><th>释义</th></tr></thead><tbody><tr><td align="left">chunks</td><td>是个目录、保存timeseries数据</td></tr><tr><td align="left">meta.json</td><td>配置文件，包含起止时间、包含哪些block</td></tr><tr><td align="left">index</td><td>通过metric名和labels查找时序数据在chunk文件中的位置</td></tr><tr><td align="left">tombstones</td><td>删除操作会首先记录到这个文件</td></tr></tbody></table><p>　　为防止程序异常而导致数据丢失，采用了WAL机制，即2小时内记录的数据存储在内存中的同时，还会记录一份日志，存储在block下的wal目录中。当程序再次启动时，会将wal目录中的数据写入对应的block中，从而达到恢复数据的效果。</p><p> 　当删除数据时，删除条目会记录在tombstones 中，而不是立刻删除。</p><p>   prometheus采用的存储方式称为“<strong>时间分片</strong>”，每个block都是一个独立的数据库。优势是可以提高查询效率，查哪个时间段的数据，只需要打开对应的block即可，无需打开多余数据。</p><p>　　<strong>目录结构：</strong></p><p><img src="data:image/png;base64,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"></p><p>　　prometheus的存储层使用了全文检索中的“<strong>倒排索引</strong>”概念，将每个时间序列视为一个小文档。而metric和label对应的是文档中的单词。</p><h2 id="二、数据备份"><a href="#二、数据备份" class="headerlink" title="二、数据备份"></a>二、数据备份</h2><p><strong>1、完全备份</strong></p><p>　　备份prometheus的data目录可以达到完全备份的目的，但效率较低。</p><p><strong>2、快照备份</strong></p><p>　　prometheus提供了一个功能，是通过API的方式，快速备份数据。</p><p>　　实现方式：</p><p>　　首先，修改prometheus的启动参数，新增以下两个参数：</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">-<span class="hljs-params">-storage.tsdb.path</span>=<span class="hljs-string">``</span>/usr/<span class="hljs-built_in">local</span>/share/prometheus/<span class="hljs-built_in">data</span><span class="hljs-string">` `</span>\<span class="hljs-string">``</span>-<span class="hljs-params">-web.</span><span class="hljs-string">``</span>enable<span class="hljs-string">``</span><span class="hljs-params">-admin</span><span class="hljs-params">-api</span>    <br></code></pre></td></tr></table></figure><p>docker启动Prometheus命令：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker run -d --restart unless-stopped -p <span class="hljs-number">9090</span>:<span class="hljs-number">9090</span> \<br>-v <span class="hljs-regexp">/data/</span>prometheus<span class="hljs-regexp">/conf/</span>prometheus.yml:<span class="hljs-regexp">/etc/</span>prometheus/prometheus.yml \<br>-v <span class="hljs-regexp">/data/</span>prometheus<span class="hljs-regexp">/data:/</span>prometheus \<br>prom/prometheus \<br>--config.<span class="hljs-keyword">file</span>=<span class="hljs-regexp">/etc/</span>prometheus/prometheus.yml \<br>--storage.tsdb.path=/prometheus \<br>--web.enable-admin-api \<br>--web.enable-lifecycle<br></code></pre></td></tr></table></figure><p>Docker-compose.yml:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">services:</span><br><span class="hljs-symbol">  prometheus:</span><br><span class="hljs-symbol">    image:</span> prom/prometheus<br><span class="hljs-symbol">    container_name:</span> prometheus<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;9090:9090&quot;</span><br><span class="hljs-symbol">    volumes:</span><br>      - <span class="hljs-keyword">/data/</span>prometheus<span class="hljs-keyword">/conf/</span>prometheus.yml:<span class="hljs-keyword">/etc/</span>prometheus/prometheus.yml<br>      - <span class="hljs-keyword">/data/</span>prometheus/data:/prometheus<br><span class="hljs-symbol">    command:</span><br>      - <span class="hljs-string">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span><br>      - <span class="hljs-string">&quot;--storage.tsdb.path=/prometheus&quot;</span><br>      - <span class="hljs-string">&quot;--web.enable-admin-api&quot;</span><br>      - <span class="hljs-string">&quot;--web.enable-lifecycle&quot;</span><br><span class="hljs-symbol">    restart:</span> unless-stopped<br></code></pre></td></tr></table></figure><p>　　重启prometheus</p><p>　　调用API</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -XPOST http:<span class="hljs-regexp">//</span>prometheusIP:端口<span class="hljs-regexp">/api/</span>v1<span class="hljs-regexp">/admin/</span>tsdb/snapshot<br>返回结果：  <br>&#123;<span class="hljs-string">&quot;status&quot;</span>:<span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-string">&quot;data&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;20191220T012427Z-21e0e532e8ca3423&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p>　　此时，数据将快速的备份到 data&#x2F;snapshots下。</p><p> 　<strong>【注意】</strong>上述API还有一个参数</p><p><code>skip_head=&lt;bool&gt; </code>  默认是<code>false</code>作用：是否跳过存留在内存中还未写入磁盘中的数据，仍在block块中的数据</p><p>完整的调用方式为：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 不跳过内存中的数据，即同时备份内存中的数据</span><br>curl -XPOST http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9090</span><span class="hljs-regexp">/api/</span>v2<span class="hljs-regexp">/admin/</span>tsdb/snapshot?skip_head=false<br><span class="hljs-comment"># 跳过内存中的数据</span><br>curl -XPOST http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9090</span><span class="hljs-regexp">/api/</span>v2<span class="hljs-regexp">/admin/</span>tsdb/snapshot?skip_head=true<br></code></pre></td></tr></table></figure><h2 id="三、数据还原"><a href="#三、数据还原" class="headerlink" title="三、数据还原"></a>三、数据还原</h2><p>　　利用api方式制作成snapshot后，还原时将snapshot中的文件覆盖到data目录下，重启prometheus即可！</p><p>　　<strong>添加定时备份任务（</strong>每周日3点备份）</p><p><code>crontable -e</code>  #注意时区</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span><span class="hljs-number">3</span> * * <span class="hljs-number">7</span> sudo /<span class="hljs-keyword">usr</span>/bin/curl -XPOST -I http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9090</span>/api/v1/admin/tsdb/snapshot &gt;&gt; /home/bill/prometheusbackup.<span class="hljs-keyword">log</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>Prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker常用命令</title>
    <link href="/2023/04/27/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/04/27/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="Docker-命令"><a href="#Docker-命令" class="headerlink" title="Docker 命令"></a>Docker 命令</h2><h3 id="查看命令"><a href="#查看命令" class="headerlink" title="查看命令"></a>查看命令</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker ps</td><td align="center">查看正在运行的容器</td></tr><tr><td align="left">docker ps -a</td><td align="center">查看所有已经创建的容器</td></tr><tr><td align="left">docker images</td><td align="center">列出镜像列表</td></tr><tr><td align="left">docker container ls</td><td align="center">效果同ps命令(加-a效果同)</td></tr></tbody></table><h4 id="docker-ps-详细参数"><a href="#docker-ps-详细参数" class="headerlink" title="docker ps 详细参数"></a>docker ps 详细参数</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-a :显示所有的容器，包括未运行的。</span><br><br><span class="hljs-deletion">-f :根据条件过滤显示的内容。</span><br><br><span class="hljs-deletion">--format :指定返回值的模板文件。</span><br><br><span class="hljs-deletion">-l :显示最近创建的容器。</span><br><br><span class="hljs-deletion">-n :列出最近创建的n个容器。</span><br><br><span class="hljs-deletion">--no-trunc :不截断输出。</span><br><br><span class="hljs-deletion">-q :静默模式，只显示容器编号。</span><br><br><span class="hljs-deletion">-s :显示总的文件大小。</span><br></code></pre></td></tr></table></figure><h4 id="docker-images-详细参数"><a href="#docker-images-详细参数" class="headerlink" title="docker images 详细参数"></a>docker images 详细参数</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-a :列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；</span><br><br><span class="hljs-deletion">--digests :显示镜像的摘要信息；</span><br><br><span class="hljs-deletion">-f :显示满足条件的镜像；</span><br><br><span class="hljs-deletion">--format :指定返回值的模板文件；</span><br><br><span class="hljs-deletion">--no-trunc :显示完整的镜像信息；</span><br><br><span class="hljs-deletion">-q :只显示镜像ID。</span><br></code></pre></td></tr></table></figure><h3 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker rm</td><td align="center">删除容器</td></tr><tr><td align="left">docker rmi</td><td align="center">删除镜像</td></tr></tbody></table><h4 id="docker-rm-详细参数"><a href="#docker-rm-详细参数" class="headerlink" title="docker rm 详细参数"></a>docker rm 详细参数</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-f :强制删除一个运行中的容器</span><br><br><span class="hljs-deletion">-l :移除容器间的网络连接，而非容器本身</span><br><br><span class="hljs-deletion">-v :-v 删除与容器关联的卷</span><br></code></pre></td></tr></table></figure><h4 id="docker-rmi-详细参数"><a href="#docker-rmi-详细参数" class="headerlink" title="docker rmi 详细参数"></a>docker rmi 详细参数</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-f :强制删除；</span><br><br><span class="hljs-deletion">--no-prune :不移除该镜像的过程镜像，默认移除；</span><br></code></pre></td></tr></table></figure><h3 id="宿-主操作"><a href="#宿-主操作" class="headerlink" title="宿-主操作"></a>宿-主操作</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker cp</td><td align="center">容器与主机之间的数据拷贝</td></tr></tbody></table><h4 id="docker-cp-实例"><a href="#docker-cp-实例" class="headerlink" title="docker cp 实例"></a>docker cp 实例</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker cp  nginx:<span class="hljs-regexp">/www /</span>tmp<span class="hljs-regexp">/    #将nginx容器的/</span>www 拷贝到本地/tmp下<br></code></pre></td></tr></table></figure><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker start</td><td align="center">启动容器</td></tr><tr><td align="left">docker stop</td><td align="center">停止容器</td></tr><tr><td align="left">docker restart</td><td align="center">重启容器</td></tr><tr><td align="left">docker exec</td><td align="center">在运行的容器中执行命令</td></tr><tr><td align="left">docker run</td><td align="center">创建一个新的容器并运行一个命令</td></tr></tbody></table><h4 id="docker-exec-详细参数"><a href="#docker-exec-详细参数" class="headerlink" title="docker exec 详细参数"></a>docker exec 详细参数</h4><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-literal">-</span>d :分离模式: 在后台运行<br><br><span class="hljs-literal">-</span>i :即使没有附加也保持STDIN 打开<br><br><span class="hljs-literal">-</span>t :分配一个伪终端<br><br><span class="hljs-comment">#实例</span><br>docker exec -it nginx /bin/bash<br></code></pre></td></tr></table></figure><h4 id="docker-run-详细参数"><a href="#docker-run-详细参数" class="headerlink" title="docker run 详细参数"></a>docker run 详细参数</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs stylus">-<span class="hljs-selector-tag">i</span>, <span class="hljs-attr">--interactive</span>=false   打开STDIN，用于控制台交互<br>-t, <span class="hljs-attr">--tty</span>=false            分配tty设备，该可以支持终端登录，默认为false<br>-d, <span class="hljs-attr">--detach</span>=false         指定容器运行于前台还是后台，默认为false<br>-u, <span class="hljs-attr">--user</span>=<span class="hljs-string">&quot;&quot;</span>              指定容器的用户<br>-<span class="hljs-selector-tag">a</span>, <span class="hljs-attr">--attach</span>=<span class="hljs-selector-attr">[]</span>            登录容器（必须是以docker run -d启动的容器）<br>-w, <span class="hljs-attr">--workdir</span>=<span class="hljs-string">&quot;&quot;</span>           指定容器的工作目录<br>-c, <span class="hljs-attr">--cpu-shares</span>=<span class="hljs-number">0</span>        设置容器CPU权重，在CPU共享场景使用<br>-e, <span class="hljs-attr">--env</span>=<span class="hljs-selector-attr">[]</span>               指定环境变量，容器中可以使用该环境变量<br>-m, <span class="hljs-attr">--memory</span>=<span class="hljs-string">&quot;&quot;</span>            指定容器的内存上限<br>-P, <span class="hljs-attr">--publish-all</span>=false    指定容器暴露的端口<br>-<span class="hljs-selector-tag">p</span>, <span class="hljs-attr">--publish</span>=<span class="hljs-selector-attr">[]</span>           指定容器暴露的端口<br>-h, <span class="hljs-attr">--hostname</span>=<span class="hljs-string">&quot;&quot;</span>          指定容器的主机名<br>-v, <span class="hljs-attr">--volume</span>=<span class="hljs-selector-attr">[]</span>            给容器挂载存储卷，挂载到容器的某个目录    顺序：主机：容器<br><span class="hljs-attr">--volumes-from</span>=<span class="hljs-selector-attr">[]</span>          给容器挂载其他容器上的卷，挂载到容器的某个目录<br><span class="hljs-attr">--cap-add</span>=<span class="hljs-selector-attr">[]</span>               添加权限，权限清单详见：http:<span class="hljs-comment">//linux.die.net/man/7/capabilities</span><br><span class="hljs-attr">--cap-drop</span>=<span class="hljs-selector-attr">[]</span>              删除权限，权限清单详见：http:<span class="hljs-comment">//linux.die.net/man/7/capabilities</span><br><span class="hljs-attr">--cidfile</span>=<span class="hljs-string">&quot;&quot;</span>               运行容器后，在指定文件中写入容器PID值，一种典型的监控系统用法<br><span class="hljs-attr">--cpuset</span>=<span class="hljs-string">&quot;&quot;</span>                设置容器可以使用哪些CPU，此参数可以用来容器独占CPU<br><span class="hljs-attr">--device</span>=<span class="hljs-selector-attr">[]</span>                添加主机设备给容器，相当于设备直通<br><span class="hljs-attr">--dns</span>=<span class="hljs-selector-attr">[]</span>                   指定容器的dns服务器<br><span class="hljs-attr">--dns-search</span>=<span class="hljs-selector-attr">[]</span>            指定容器的dns搜索域名，写入到容器的/etc/resolv.conf文件<br><span class="hljs-attr">--entrypoint</span>=<span class="hljs-string">&quot;&quot;</span>            覆盖image的入口点<br><span class="hljs-attr">--env-file</span>=<span class="hljs-selector-attr">[]</span>              指定环境变量文件，文件格式为每行一个环境变量<br><span class="hljs-attr">--expose</span>=<span class="hljs-selector-attr">[]</span>                指定容器暴露的端口，即修改镜像的暴露端口<br><span class="hljs-attr">--link</span>=<span class="hljs-selector-attr">[]</span>                  指定容器间的关联，使用其他容器的IP、env等信息<br><span class="hljs-attr">--lxc-conf</span>=<span class="hljs-selector-attr">[]</span>              指定容器的配置文件，只有在指定<span class="hljs-attr">--exec-driver</span>=lxc时使用<br><span class="hljs-attr">--name</span>=<span class="hljs-string">&quot;&quot;</span>                  指定容器名字，后续可以通过名字进行容器管理，links特性需要使用名字<br><span class="hljs-attr">--net</span>=<span class="hljs-string">&quot;bridge&quot;</span>             容器网络设置:<br>                            bridge 使用docker daemon指定的网桥<br>                            host    <span class="hljs-comment">//容器使用主机的网络</span><br>                            container:NAME_or_ID  &gt;<span class="hljs-comment">//使用其他容器的网路，共享IP和PORT等网络资源</span><br>                            <span class="hljs-attribute">none</span> 容器使用自己的网络（类似--net=bridge），但是不进行配置<br><span class="hljs-attr">--privileged</span>=false         指定容器是否为特权容器，特权容器拥有所有的capabilities<br><span class="hljs-attr">--restart</span>=<span class="hljs-string">&quot;no&quot;</span>             指定容器停止后的重启策略:<br>                            no：容器退出时不重启<br>                            on-failure：容器故障退出（返回值非零）时重启<br>                            always：容器退出时总是重启<br><span class="hljs-attr">--rm</span>=false                 指定容器停止后自动删除容器(不支持以docker run -d启动的容器)<br><span class="hljs-attr">--sig-proxy</span>=true           设置由代理接受并处理信号，但是SIGCHLD、SIGSTOP和SIGKILL不能被代理<br></code></pre></td></tr></table></figure><h3 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker pull</td><td align="center">拉取镜像</td></tr><tr><td align="left">docker search</td><td align="center">从Docker Hub查找镜像</td></tr></tbody></table><h3 id="docker环境信息"><a href="#docker环境信息" class="headerlink" title="docker环境信息"></a>docker环境信息</h3><table><thead><tr><th align="left">命令</th><th align="center">解释</th></tr></thead><tbody><tr><td align="left">docker info</td><td align="center">查看docker系统信息</td></tr><tr><td align="left">docker version</td><td align="center">显示 Docker 版本信息</td></tr></tbody></table><h3 id="通过PID查找Docker容器"><a href="#通过PID查找Docker容器" class="headerlink" title="通过PID查找Docker容器"></a>通过PID查找Docker容器</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">docker ps -<span class="hljs-string">q | xargs docker inspect --format &#x27;&#123;&#123;.State.Pid&#125;&#125;, &#123;&#123;.Name&#125;&#125;&#x27; |</span> <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;PID&quot;</span><br></code></pre></td></tr></table></figure><h3 id="设置容器自动重启"><a href="#设置容器自动重启" class="headerlink" title="设置容器自动重启"></a>设置容器自动重启</h3><h4 id="创建容器时设置"><a href="#创建容器时设置" class="headerlink" title="创建容器时设置"></a>创建容器时设置</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -d --restart=always --name 设置容器名 使用的镜像<br>（上面命令  --name后面两个参数根据实际情况自行修改）<br> <br><span class="hljs-comment"># Docker 容器的重启策略如下：</span><br> --restart具体参数值详细信息：<br>       no　　　　　　　 <span class="hljs-regexp">//</span> 默认策略,容器退出时不重启容器；<br>       on-failure　　  <span class="hljs-regexp">//</span> 在容器非正常退出时（退出状态非<span class="hljs-number">0</span>）才重新启动容器；<br>       on-failure:<span class="hljs-number">3</span>    <span class="hljs-regexp">//</span> 在容器非正常退出时重启容器，最多重启<span class="hljs-number">3</span>次；<br>       always　　　　  <span class="hljs-regexp">//</span> 无论退出状态是如何，都重启容器；<br>       unless-stopped  <span class="hljs-regexp">//</span> 在容器退出时总是重启容器，但是不考虑在 Docker 守护进程启动时就已经停止了的容器。<br></code></pre></td></tr></table></figure><h4 id="使用update修改已创建容器"><a href="#使用update修改已创建容器" class="headerlink" title="使用update修改已创建容器"></a>使用update修改已创建容器</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">docker</span> <span class="hljs-variable">update</span> --<span class="hljs-variable">restart</span>=<span class="hljs-variable">always</span> 容器<span class="hljs-function"><span class="hljs-title">ID</span>(或者容器名)</span><br>（容器<span class="hljs-variable">ID</span>或者容器名根据实际情况修改）<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>命令</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>阿里云自动更换EIP脚本</title>
    <link href="/2023/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%8D%A2EIP%E8%84%9A%E6%9C%AC/"/>
    <url>/2023/04/26/%E9%98%BF%E9%87%8C%E4%BA%91%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%8D%A2EIP%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p>阿里云自动更换EIP脚本</p><p>需要安装阿里云SDK： pip install aliyun-python-sdk-ecs 使用方式：python change_eip.py</p><p>centos7先安装pip和模块：</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">wget</span> <span class="hljs-string">https</span>://<span class="hljs-string">bootstrap</span>.<span class="hljs-string">pypa</span>.<span class="hljs-string">io</span>/<span class="hljs-string">pip</span>/<span class="hljs-string">2</span>.<span class="hljs-string">7</span>/<span class="hljs-built_in">get-pip.py</span><br><span class="hljs-string">python</span> <span class="hljs-built_in">get-pip.py</span><br><span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-string">aliyun-python-sdk-ecs</span> <br><span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-string">aliyun-python-sdk-core</span><br><span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-string">requests</span><br><span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-built_in">--ignore-installed</span> <span class="hljs-string">requests</span><br></code></pre></td></tr></table></figure><p>config.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><br><span class="hljs-keyword">import</span> os<br><br>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))<br><span class="hljs-comment">#账号的key和secret</span><br>access_id=<span class="hljs-string">&#x27;xxxxxx&#x27;</span><br>access_key_secret=<span class="hljs-string">&#x27;xxxxxxxxx&#x27;</span><br><span class="hljs-comment">#ECS_ID 服务器ID</span><br>ecs_vpc_id=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment">#带宽大小，200 就是 200M带宽</span><br>eip_bandwidth=<span class="hljs-number">200</span><br><span class="hljs-comment">#区域：cn-hongkong(香港),ap-southeast-1(新加坡)</span><br>ecs_regionid=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment">#流量计费方式：PayByTraffic(按流量收费),PayByBandwidth(按带宽收费)</span><br>ecs_chargetype=<span class="hljs-string">&#x27;PayByTraffic&#x27;</span><br></code></pre></td></tr></table></figure><p>eip.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> access_id,access_key_secret,ecs_regionid,ecs_chargetype<br><span class="hljs-keyword">from</span> aliyunsdkcore <span class="hljs-keyword">import</span> client<br><span class="hljs-keyword">from</span> aliyunsdkecs.request.v20140526 <span class="hljs-keyword">import</span> AllocateEipAddressRequest,ReleaseEipAddressRequest,AssociateEipAddressRequest,UnassociateEipAddressRequest,DescribeEipAddressesRequest<br><br>clt = client.AcsClient(access_id,access_key_secret,ecs_regionid)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_eip_address</span>(<span class="hljs-params">regionid=ecs_regionid,chargetype=ecs_chargetype,bandwidth=<span class="hljs-number">200</span>,fmt=<span class="hljs-string">&#x27;json&#x27;</span></span>):<br>    request=AllocateEipAddressRequest.AllocateEipAddressRequest()<br>    request.set_accept_format(fmt)<br>    request.set_Bandwidth(bandwidth)<br>    request.add_query_param(<span class="hljs-string">&#x27;RegionId&#x27;</span>,regionid)<br>    request.add_query_param(<span class="hljs-string">&#x27;InternetChargeType&#x27;</span>,chargetype)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        result=clt.do_action(request)<br>        r_dict=json.loads(result)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Create EIP Address Failed.&quot;</span>)<br>        sys.exit()<br>    <br>    <span class="hljs-keyword">if</span> r_dict.has_key(<span class="hljs-string">&#x27;EipAddress&#x27;</span>):<br>        res=&#123;&#125;<br>        res[<span class="hljs-string">&#x27;ip&#x27;</span>]=r_dict[<span class="hljs-string">&#x27;EipAddress&#x27;</span>]<br>        res[<span class="hljs-string">&#x27;id&#x27;</span>]=r_dict[<span class="hljs-string">&#x27;AllocationId&#x27;</span>]<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(r_dict[<span class="hljs-string">&#x27;Message&#x27;</span>])<br>        sys.exit()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_eip_address</span>(<span class="hljs-params">eipid,fmt=<span class="hljs-string">&#x27;json&#x27;</span></span>):<br>    request=ReleaseEipAddressRequest.ReleaseEipAddressRequest()<br>    request.set_accept_format(fmt)<br>    request.set_AllocationId(eipid)<br>    <span class="hljs-keyword">try</span>:<br>        result=clt.do_action(request)<br>        r_dict=json.loads(result)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Delete EIP Address Failed.&quot;</span>)<br>        sys.exit()<br>    <br>    <span class="hljs-keyword">if</span> r_dict.has_key(<span class="hljs-string">&#x27;Code&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(r_dict[<span class="hljs-string">&#x27;Message&#x27;</span>])<br>        sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> r_dict<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">associate_eip_address</span>(<span class="hljs-params">allocationid,instanceid,instancetype=<span class="hljs-string">&#x27;EcsInstance&#x27;</span>,fmt=<span class="hljs-string">&#x27;json&#x27;</span></span>):<br>    request=AssociateEipAddressRequest.AssociateEipAddressRequest()<br>    request.set_accept_format(fmt)<br>    request.set_AllocationId(allocationid)<br>    request.add_query_param(<span class="hljs-string">&#x27;InstanceType&#x27;</span>,instancetype)<br>    request.set_InstanceId(instanceid)<br>    <span class="hljs-keyword">try</span>:<br>        result=clt.do_action(request)<br>        r_dict=json.loads(result)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Associate EIP Address Failed.&quot;</span>)<br>        sys.exit()<br>        <br>    <span class="hljs-keyword">if</span> r_dict.has_key(<span class="hljs-string">&#x27;Code&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(r_dict[<span class="hljs-string">&#x27;Message&#x27;</span>])<br>        sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> r_dict<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unassociate_eip_address</span>(<span class="hljs-params">allocationid,instanceid,instancetype=<span class="hljs-string">&#x27;EcsInstance&#x27;</span>,fmt=<span class="hljs-string">&#x27;json&#x27;</span></span>):<br>    request=UnassociateEipAddressRequest.UnassociateEipAddressRequest()<br>    request.set_accept_format(fmt)<br>    request.set_AllocationId(allocationid)<br>    request.add_query_param(<span class="hljs-string">&#x27;InstanceType&#x27;</span>,instancetype)<br>    request.set_InstanceId(instanceid)<br>    <span class="hljs-keyword">try</span>:<br>        result=clt.do_action(request)<br>        r_dict=json.loads(result)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Unassociate EIP Address Failed.&quot;</span>)<br>        sys.exit()<br>        <br>    <span class="hljs-keyword">if</span> r_dict.has_key(<span class="hljs-string">&#x27;Code&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(r_dict[<span class="hljs-string">&#x27;Message&#x27;</span>])<br>        sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> r_dict<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_unassociate_eip_address</span>():<br>    request=DescribeEipAddressesRequest.DescribeEipAddressesRequest()<br>    request.set_accept_format(<span class="hljs-string">&#x27;json&#x27;</span>)<br>    request.set_Status(<span class="hljs-string">&#x27;Available&#x27;</span>)<br>    request.set_PageSize(<span class="hljs-number">50</span>)<br>    <span class="hljs-keyword">try</span>:<br>        result =json.loads(clt.do_action(request))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Get Eip address list error.&quot;</span>)<br>        sys.exit()<br>    eip_list=[]<br>    <span class="hljs-keyword">if</span> result:<br>        eip_list=result[<span class="hljs-string">&#x27;EipAddresses&#x27;</span>][<span class="hljs-string">&#x27;EipAddress&#x27;</span>]<br>        <br>    <span class="hljs-keyword">for</span> eip <span class="hljs-keyword">in</span> eip_list:<br>        <span class="hljs-comment">#print eip[&#x27;IpAddress&#x27;],eip[&#x27;AllocationId&#x27;]</span><br>        result=delete_eip_address(eip[<span class="hljs-string">&#x27;AllocationId&#x27;</span>])<br>        <span class="hljs-keyword">if</span> result:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;EIP %s is deleted.&quot;</span>) % eip[<span class="hljs-string">&#x27;IpAddress&#x27;</span>]<br>        <br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    delete_unassociate_eip_address()<br></code></pre></td></tr></table></figure><p>instance.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> access_id,access_key_secret,ecs_vpc_id,ecs_regionid<br><span class="hljs-keyword">from</span> aliyunsdkcore <span class="hljs-keyword">import</span> client<br><span class="hljs-keyword">from</span> aliyunsdkecs.request.v20140526 <span class="hljs-keyword">import</span> DescribeInstancesRequest<br><br>clt = client.AcsClient(access_id,access_key_secret,ecs_regionid)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">instance_info</span>(<span class="hljs-params">instanceid,fmt=<span class="hljs-string">&#x27;json&#x27;</span></span>):<br>    request=DescribeInstancesRequest.DescribeInstancesRequest()<br>    request.set_accept_format(fmt)<br>    request.set_InstanceIds([instanceid])<br><br>    <span class="hljs-keyword">try</span>:<br>        result=clt.do_action(request)<br>        r_dict=json.loads(result)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Get Instance Info Failed.&quot;</span>)<br>        sys.exit()<br><br>    <span class="hljs-keyword">if</span> r_dict.has_key(<span class="hljs-string">&#x27;TotalCount&#x27;</span>) <span class="hljs-keyword">and</span> r_dict[<span class="hljs-string">&#x27;TotalCount&#x27;</span>] != <span class="hljs-number">0</span>:<br>        instance=r_dict[<span class="hljs-string">&#x27;Instances&#x27;</span>][<span class="hljs-string">&#x27;Instance&#x27;</span>][<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">return</span> instance<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Instance id %s is not exist.&quot;</span>) % instanceid<br>        sys.exit()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-built_in">print</span> instance_info(ecs_vpc_id)[<span class="hljs-string">&#x27;EipAddress&#x27;</span>]<br></code></pre></td></tr></table></figure><p>change_eip.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding:utf-8</span><br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> ecs_vpc_id,eip_bandwidth<br><span class="hljs-keyword">from</span> eip <span class="hljs-keyword">import</span> create_eip_address,delete_eip_address,associate_eip_address,unassociate_eip_address<br><span class="hljs-keyword">from</span> instance <span class="hljs-keyword">import</span> instance_info<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment">#获取当前vpc下ecs主机的eip</span><br>    instance=instance_info(ecs_vpc_id)<br>    eip_id=instance[<span class="hljs-string">&#x27;EipAddress&#x27;</span>][<span class="hljs-string">&#x27;AllocationId&#x27;</span>]<br>    eip_ip=instance[<span class="hljs-string">&#x27;EipAddress&#x27;</span>][<span class="hljs-string">&#x27;IpAddress&#x27;</span>]<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> instance:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Get instance info error.&quot;</span>)<br>        sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> eip_id:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Instance %s has not associate eip address.&quot;</span>) % ecs_vpc_id<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Instance: %s ,Eip id: %s .&quot;</span>) % (ecs_vpc_id,eip_id)<br>    <br>            <span class="hljs-comment">#解绑eip</span><br>            result_unassociate=unassociate_eip_address(eip_id, ecs_vpc_id)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result_unassociate:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Unassociate eip address from %s error.&quot;</span>) % ecs_vpc_id<br>                sys.exit()<br>            <br>            <span class="hljs-comment">#判断真正解绑后开始删除旧的eip</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                eip_id_tmp=instance_info(ecs_vpc_id)[<span class="hljs-string">&#x27;EipAddress&#x27;</span>][<span class="hljs-string">&#x27;AllocationId&#x27;</span>]<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> eip_id_tmp:<br>                    <span class="hljs-comment">#删除老的eip</span><br>                    result_release=delete_eip_address(eip_id)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result_release:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Release eip %s error.&quot;</span>) % eip_id<br>                        sys.exit()<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">continue</span><br>                time.sleep(<span class="hljs-number">1</span>)<br>    <br>    <span class="hljs-comment">#申请新eip</span><br>    result_allocate=create_eip_address(bandwidth=eip_bandwidth)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result_allocate:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Allocate new eip address error.&quot;</span>)<br>        sys.exit()<br>    <br>    <span class="hljs-comment">#暂停10秒等待新的EIP申请成功后，在绑定</span><br>    time.sleep(<span class="hljs-number">10</span>)<br>    <br>    <span class="hljs-comment">#绑定eip</span><br>    result_associate=associate_eip_address(result_allocate[<span class="hljs-string">&#x27;id&#x27;</span>], instanceid=ecs_vpc_id)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result_associate:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Associate eip %s to instance %s error.&quot;</span>) % (result_allocate,ecs_vpc_id)<br>        sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Associate eip %s to instance %s successfully.&quot;</span>) % (result_allocate[<span class="hljs-string">&#x27;ip&#x27;</span>],ecs_vpc_id)<br>        ip_dict=&#123;<br>            <span class="hljs-string">&#x27;oip&#x27;</span>:eip_ip,<br>            <span class="hljs-string">&#x27;nip&#x27;</span>:result_allocate[<span class="hljs-string">&#x27;ip&#x27;</span>]<br>        &#125;<br>        <span class="hljs-keyword">return</span> ip_dict<br>    <br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-built_in">print</span> main()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CLOUD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Aliyun</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWS如何检查VPN隧道的当前状态？</title>
    <link href="/2023/04/26/AWS%E5%A6%82%E4%BD%95%E6%A3%80%E6%9F%A5VPN%E9%9A%A7%E9%81%93%E7%9A%84%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%EF%BC%9F/"/>
    <url>/2023/04/26/AWS%E5%A6%82%E4%BD%95%E6%A3%80%E6%9F%A5VPN%E9%9A%A7%E9%81%93%E7%9A%84%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<p>验证您使用的是<a href="https://docs.aws.amazon.com/vpn/latest/s2svpn/VPNRoutingTypes.html">静态还是动态站点到站点 VPN 路由</a>。不支持边界网关协议 （BGP） 的 VPN 设备必须使用静态路由。支持 BGP 的 VPN 设备可以使用动态路由。</p><h1 id="使用亚马逊-VPC-控制台检查当前状态"><a href="#使用亚马逊-VPC-控制台检查当前状态" class="headerlink" title="使用亚马逊 VPC 控制台检查当前状态"></a>使用亚马逊 VPC 控制台检查当前状态</h1><h2 id="如果您使用静态-VPN，请按照以下步骤操作："><a href="#如果您使用静态-VPN，请按照以下步骤操作：" class="headerlink" title="如果您使用静态 VPN，请按照以下步骤操作："></a>如果您使用静态 VPN，请按照以下步骤操作：</h2><ol><li>登录<a href="https://console.aws.amazon.com/vpc/">亚马逊 VPC 控制台</a>。</li><li>在导航窗格中的“站点<strong>到站点</strong> VPN 连接”下，选择“站点<strong>到站点 VPN 连接</strong>”。</li><li>选择您的 VPN 连接。</li><li>选择<strong>隧道详细信息</strong>视图。</li><li>查看 VPN <strong>隧道的状态。</strong></li><li>如果隧道状态为 <strong>UP，</strong>则选择<strong>静态路由</strong>视图。请务必在本地防火墙后面指定任何专用网络。</li><li>如果隧道状态为 <strong>DOWN，</strong>请验证本地<a href="https://docs.aws.amazon.com/vpc/latest/adminguide/Introduction.html#FirewallRules">防火墙</a>是否已正确配置。</li><li>请务必在 VPC 路由表中<a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#EnableDisableRouteProp">启用路由传播</a>。</li></ol><h2 id="如果您将动态-VPN-与-BGP-配合使用，请按照以下步骤操作："><a href="#如果您将动态-VPN-与-BGP-配合使用，请按照以下步骤操作：" class="headerlink" title="如果您将动态 VPN 与 BGP 配合使用，请按照以下步骤操作："></a>如果您将动态 VPN 与 BGP 配合使用，请按照以下步骤操作：</h2><ol><li>登录<a href="https://console.aws.amazon.com/vpc/">亚马逊 VPC 控制台</a>。</li><li>在导航窗格中的“站点<strong>到站点</strong> VPN 连接”下，选择“站点<strong>到站点 VPN 连接</strong>”。</li><li>选择您的 VPN 连接。</li><li>选择<strong>隧道详细信息</strong>视图。</li><li>查看 VPN <strong>隧道的状态。</strong></li><li>如果隧道状态为 <strong>UP，</strong>则验证<strong>详细信息</strong>列是否列出了一个或多个 BGP 路由。</li><li>如果隧道状态为“<strong>关闭</strong>”，但“详细信息”列为<strong>“****IPSEC 已打开”</strong>，请确保在防火墙上正确<a href="https://docs.aws.amazon.com/vpc/latest/adminguide/GenericConfig.html">配置 BGP</a>。互联网协议安全 （IPSec） 的第 2 阶段已建立，但尚未建立 BGP。</li><li>请务必在 VPC 路由表中<a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html#EnableDisableRouteProp">启用路由传播</a>。</li></ol><h2 id="如果继续遇到问题，请按照以下步骤操作："><a href="#如果继续遇到问题，请按照以下步骤操作：" class="headerlink" title="如果继续遇到问题，请按照以下步骤操作："></a>如果继续遇到问题，请按照以下步骤操作：</h2><ul><li>验证 VPC 中 Amazon Elastic Compute Cloud （Amazon EC2） 实例的安全组是否允许适当的访问。有关更多信息，请参阅 <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">VPC 的安全组</a>。</li><li>验证本地防火墙是否允许其访问控制列表 （ACL） 和防火墙策略中的相同服务。</li></ul><p>有关更多信息，请参阅 <a href="https://docs.aws.amazon.com/vpc/latest/adminguide/Troubleshooting.html">排查客户网关设备问题。</a></p><h1 id="使用-Amazon-CloudWatch-监控您的-VPN-隧道"><a href="#使用-Amazon-CloudWatch-监控您的-VPN-隧道" class="headerlink" title="使用 Amazon CloudWatch 监控您的 VPN 隧道"></a>使用 Amazon CloudWatch 监控您的 VPN 隧道</h1><p>您还可以使用 CloudWatch 检查 VPN 隧道的状态，并在隧道状态更改时收到通知。CloudWatch 可用于访问一段时间内的指标数据，以帮助评估隧道的稳定性。有关更多信息，请参阅 <a href="https://docs.aws.amazon.com/vpn/latest/s2svpn/monitoring-cloudwatch-vpn.html">使用 Amazon CloudWatch 监控 VPN 隧道</a>。</p><h1 id="连接各cloud-VPN隧道注意事项（连接后无流量传播的问题）"><a href="#连接各cloud-VPN隧道注意事项（连接后无流量传播的问题）" class="headerlink" title="连接各cloud VPN隧道注意事项（连接后无流量传播的问题）"></a>连接各cloud VPN隧道注意事项（连接后无流量传播的问题）</h1><h2 id="Azure："><a href="#Azure：" class="headerlink" title="Azure："></a>Azure：</h2><p>AWS的站点到站点的VPN连接的“VPN连接选项”中本地IPv4和远程IPv4地址为相反的含义；本地IPv4指的是客户端IPv4网段，远程IPv4网络为本地IPv4网段</p><h2 id="阿里云："><a href="#阿里云：" class="headerlink" title="阿里云："></a>阿里云：</h2><p>AWS一定要选择静态路由 (阿里不支持动态BGP，会导致tunnel 状态是Down, IPSEC 是UP)</p><h2 id="AWS："><a href="#AWS：" class="headerlink" title="AWS："></a>AWS：</h2><p>在配置路由时一定要在路由表中将“路由传播”选项改为“是”，否则流量将无法传输</p>]]></content>
    
    
    <categories>
      
      <category>CLOUD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AWS</tag>
      
      <tag>VPN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWS_Site-to-Site_VPN_日志</title>
    <link href="/2023/04/25/AWS-Site-to-Site-VPN-%E6%97%A5%E5%BF%97/"/>
    <url>/2023/04/25/AWS-Site-to-Site-VPN-%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<p>AWS Site-to-Site VPN 日志可让您更深入地了解 Site-to-Site VPN 部署。使用此功能，您可以访问 Site-to-Site VPN 连接日志，这些日志提供有关 IP 安全性（IPsec）隧道建立、互联网密钥交换（IKE）协商和失效对端检测（DPD）协议消息的详细信息。</p><p>可将 Site-to-Site VPN 日志发布到 Amazon CloudWatch Logs。此功能为客户提供了一种一致的方式来访问和分析其所有 Site-to-Site VPN 连接的详细日志。</p><h6 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h6><ul><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#log-benefits">Site-to-Site VPN 日志的优势</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#cwl-policy-size">Amazon CloudWatch Logs 资源策略大小限制</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/log-contents.html">Site-to-Site VPN 日志的内容</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#publish-cw-logs">发布到 CloudWatch Logs 的 IAM 要求</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#status-logs">查看 Site-to-Site VPN 日志配置</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#enable-logs">启用 Site-to-Site VPN 日志</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/monitoring-logs.html#disable-logs">禁用 Site-to-Site VPN 日志</a></li></ul><h2 id="Site-to-Site-VPN-日志的优势"><a href="#Site-to-Site-VPN-日志的优势" class="headerlink" title="Site-to-Site VPN 日志的优势"></a>Site-to-Site VPN 日志的优势</h2><ul><li><strong>简化 VPN 故障排除</strong>：Site-to-Site VPN 日志可帮助您查明 AWS 与客户网关设备之间的配置不匹配情况，并解决初始 VPN 连接问题。VPN 连接可能由于设置配置错误（例如超时调整不当）而随时间推移发生间歇性抖动，底层传输网络中可能存在问题（例如互联网天气），或者路由更改或路径故障可能导致通过 VPN 的连接中断。此功能可让您准确地诊断间歇性连接故障的原因，并微调低级别隧道配置以实现可靠运行。</li><li><strong>集中式 AWS Site-to-Site VPN 可见性</strong>：Site-to-Site VPN 日志可以为用于连接 Site-to-Site VPN 的所有不同方式提供隧道活动日志：虚拟网关、中转网关和 CloudHub（使用互联网和 AWS Direct Connect 这两者作为传输途径）。此功能为客户提供了一种一致的方式来访问和分析其所有 Site-to-Site VPN 连接的详细日志。</li><li><strong>安全性与合规性</strong>：Site-to-Site VPN 日志可以发送到 Amazon CloudWatch Logs，以便对一段时间内的 VPN 连接状态和活动进行回顾性分析。这可以帮助您满足合规性和法规要求。</li></ul><h2 id="Amazon-CloudWatch-Logs-资源策略大小限制"><a href="#Amazon-CloudWatch-Logs-资源策略大小限制" class="headerlink" title="Amazon CloudWatch Logs 资源策略大小限制"></a>Amazon CloudWatch Logs 资源策略大小限制</h2><p>CloudWatch Logs 资源策略限制为 5120 个字符。当 CloudWatch Logs 检测到策略接近此大小限制时，它会自动启用以 <code>/aws/vendedlogs/</code> 开头的日志组。启用日志记录时，Site-to-Site VPN 必须使用您指定的日志组更新 CloudWatch Logs 资源策略。为避免达到 CloudWatch Logs 资源策略大小限制，请在日志组名称前加上 <code>/aws/vendedlogs/</code> 前缀。</p><h2 id="发布到-CloudWatch-Logs-的-IAM-要求"><a href="#发布到-CloudWatch-Logs-的-IAM-要求" class="headerlink" title="发布到 CloudWatch Logs 的 IAM 要求"></a>发布到 CloudWatch Logs 的 IAM 要求</h2><p>VPN 隧道日志可直接发布到 CloudWatch Logs。要使其正常工作，附加到 IAM 角色的 IAM policy 必须至少包括下面所示的权限。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>  <span class="hljs-string">&quot;Statement&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;Action&quot;</span>: [<br>        <span class="hljs-string">&quot;logs:CreateLogDelivery&quot;</span>,<br>        <span class="hljs-string">&quot;logs:GetLogDelivery&quot;</span>,<br>        <span class="hljs-string">&quot;logs:UpdateLogDelivery&quot;</span>,<br>        <span class="hljs-string">&quot;logs:DeleteLogDelivery&quot;</span>,<br>        <span class="hljs-string">&quot;logs:ListLogDeliveries&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;Resource&quot;</span>: [<br>        <span class="hljs-string">&quot;*&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>      <span class="hljs-string">&quot;Sid&quot;</span>: <span class="hljs-string">&quot;S2SVPNLogging&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;Sid&quot;</span>: <span class="hljs-string">&quot;S2SVPNLoggingCWL&quot;</span>,<br>      <span class="hljs-string">&quot;Action&quot;</span>: [<br>        <span class="hljs-string">&quot;logs:PutResourcePolicy&quot;</span>,<br>        <span class="hljs-string">&quot;logs:DescribeResourcePolicies&quot;</span>,<br>        <span class="hljs-string">&quot;logs:DescribeLogGroups&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;Resource&quot;</span>: [<br>        <span class="hljs-string">&quot;*&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span><br>    &#125;<br>  ]<br>&#125;  <br></code></pre></td></tr></table></figure><h2 id="查看-Site-to-Site-VPN-日志配置"><a href="#查看-Site-to-Site-VPN-日志配置" class="headerlink" title="查看 Site-to-Site VPN 日志配置"></a>查看 Site-to-Site VPN 日志配置</h2><h6 id="查看当前隧道日志记录设置"><a href="#查看当前隧道日志记录设置" class="headerlink" title="查看当前隧道日志记录设置"></a>查看当前隧道日志记录设置</h6><ol><li>通过以下网址打开 Amazon VPC 控制台：<a href="https://console.aws.amazon.com/vpc/%E3%80%82">https://console.aws.amazon.com/vpc/。</a></li><li>在导航窗格中，选择 <strong>Site-to-Site VPN Connections</strong>（Site-to-Site VPN 连接）。</li><li>从 <strong>VPN connections</strong>（VPN 连接）列表中选择要查看的 VPN 连接。</li><li>选择 <strong>Tunnel details</strong>（隧道详细信息）选项卡。</li><li>展开 <strong>Tunnel 1 options</strong>（隧道 1 选项）和 <strong>Tunnel 2 options</strong>（隧道 2 选项）部分，以查看所有隧道配置详细信息。</li><li>您可以在 <strong>Tunnel VPN log</strong>（隧道 VPN 日志）下查看日志记录功能的当前状态，并在 <strong>CloudWatch log group</strong>（CloudWatch 日志组）下查看当前配置的 CloudWatch 日志组（如果有）。</li></ol><h6 id="使用-AWS-命令行或-API-查看有关-Site-to-Site-VPN-连接的当前隧道日志记录设置"><a href="#使用-AWS-命令行或-API-查看有关-Site-to-Site-VPN-连接的当前隧道日志记录设置" class="headerlink" title="使用 AWS 命令行或 API 查看有关 Site-to-Site VPN 连接的当前隧道日志记录设置"></a>使用 AWS 命令行或 API 查看有关 Site-to-Site VPN 连接的当前隧道日志记录设置</h6><ul><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-DescribeVpnConnections.html">DescribeVpnConnections</a>（Amazon EC2 查询 API）</li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-vpn-connections.html">describe-vpn-connections</a> (AWS CLI)</li></ul><h2 id="启用-Site-to-Site-VPN-日志"><a href="#启用-Site-to-Site-VPN-日志" class="headerlink" title="启用 Site-to-Site VPN 日志"></a>启用 Site-to-Site VPN 日志</h2><h6 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h6><p>当您为现有 VPN 连接隧道启用 Site-to-Site VPN 日志时，通过该隧道的连接可能会中断几分钟。但是，每个 VPN 连接都提供两条隧道以实现高可用性，因此，您可以一次对一条隧道启用日志记录，同时保持通过此隧道的连接不被修改。有关更多信息，请参阅 <a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/endpoint-replacements.html">站点到站点 VPN 隧道终端节点替换</a>。</p><h6 id="创建新的-Site-to-Site-VPN-连接时启用-VPN-日志记录"><a href="#创建新的-Site-to-Site-VPN-连接时启用-VPN-日志记录" class="headerlink" title="创建新的 Site-to-Site VPN 连接时启用 VPN 日志记录"></a>创建新的 Site-to-Site VPN 连接时启用 VPN 日志记录</h6><p>按照<a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/SetUpVPNConnections.html#vpn-create-vpn-connection">创建 Site-to-Site VPN 连接</a>过程操作。在步骤 9 <strong>Tunnel Options</strong>（隧道选项）期间，您可以指定要用于这两条隧道的所有选项，包括 <strong>VPN logging</strong>（VPN 日志记录）选项。有关这些选项的详细信息，请参阅 <a href="https://docs.aws.amazon.com/zh_cn/vpn/latest/s2svpn/VPNTunnels.html">站点到站点 VPN 连接的隧道选项</a>。</p><h6 id="使用-AWS-命令行或-API-对新的-Site-to-Site-VPN-连接启用隧道日志记录"><a href="#使用-AWS-命令行或-API-对新的-Site-to-Site-VPN-连接启用隧道日志记录" class="headerlink" title="使用 AWS 命令行或 API 对新的 Site-to-Site VPN 连接启用隧道日志记录"></a>使用 AWS 命令行或 API 对新的 Site-to-Site VPN 连接启用隧道日志记录</h6><ul><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-CreateVpnConnection.html">CreateVpnConnection</a>（Amazon EC2 查询 API）</li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/create-vpn-connection.html">create-vpn-connection</a> (AWS CLI)</li></ul><h6 id="对现有-Site-to-Site-VPN-连接启用隧道日志记录"><a href="#对现有-Site-to-Site-VPN-连接启用隧道日志记录" class="headerlink" title="对现有 Site-to-Site VPN 连接启用隧道日志记录"></a>对现有 Site-to-Site VPN 连接启用隧道日志记录</h6><ol><li>通过以下网址打开 Amazon VPC 控制台：<a href="https://console.aws.amazon.com/vpc/%E3%80%82">https://console.aws.amazon.com/vpc/。</a></li><li>在导航窗格中，选择 <strong>Site-to-Site VPN Connections</strong>（Site-to-Site VPN 连接）。</li><li>从 <strong>VPN connections</strong>（VPN 连接）列表中选择要修改的 VPN 连接。</li><li>依次选择 <strong>Actions</strong>（操作）、<strong>Modify VPN tunnel options</strong>（修改 VPN 隧道选项）。</li><li>通过从 <strong>VPN tunnel outside IP address</strong>（VPN 隧道外部 IP 地址）列表中选择适当的 IP 地址，选择要修改的隧道。</li><li>在 <strong>Tunnel activity log</strong>（隧道活动日志）下，选择 <strong>Enable</strong>（启用）。</li><li>在 <strong>Amazon CloudWatch log group</strong>（Amazon CloudWatch 日志组）下，选择要将日志发送到的 Amazon CloudWatch 日志组。</li><li>（可选）在 <strong>Output format</strong>（输出格式）下，选择日志输出的所需格式：<strong>json</strong> 或 <strong>text</strong>（文本）。</li><li>选择 <strong>Save changes</strong>（保存更改）。</li><li>（可选）如果需要，对其它隧道重复步骤 4 到 9。</li></ol><h6 id="使用-AWS-命令行或-API-对现有-Site-to-Site-VPN-连接启用隧道日志记录"><a href="#使用-AWS-命令行或-API-对现有-Site-to-Site-VPN-连接启用隧道日志记录" class="headerlink" title="使用 AWS 命令行或 API 对现有 Site-to-Site VPN 连接启用隧道日志记录"></a>使用 AWS 命令行或 API 对现有 Site-to-Site VPN 连接启用隧道日志记录</h6><ul><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-ModifyVpnTunnelOptions.html">ModifyVpnTunnelOptions</a>（Amazon EC2 查询 API）</li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/modify-vpn-tunnel-options.html">modify-vpn-tunnel-options</a> (AWS CLI)</li></ul><h2 id="禁用-Site-to-Site-VPN-日志"><a href="#禁用-Site-to-Site-VPN-日志" class="headerlink" title="禁用 Site-to-Site VPN 日志"></a>禁用 Site-to-Site VPN 日志</h2><h6 id="对-Site-to-Site-VPN-连接禁用隧道日志记录"><a href="#对-Site-to-Site-VPN-连接禁用隧道日志记录" class="headerlink" title="对 Site-to-Site VPN 连接禁用隧道日志记录"></a>对 Site-to-Site VPN 连接禁用隧道日志记录</h6><ol><li>通过以下网址打开 Amazon VPC 控制台：<a href="https://console.aws.amazon.com/vpc/%E3%80%82">https://console.aws.amazon.com/vpc/。</a></li><li>在导航窗格中，选择 <strong>Site-to-Site VPN Connections</strong>（Site-to-Site VPN 连接）。</li><li>从 <strong>VPN connections</strong>（VPN 连接）列表中选择要修改的 VPN 连接。</li><li>依次选择 <strong>Actions</strong>（操作）、<strong>Modify VPN tunnel options</strong>（修改 VPN 隧道选项）。</li><li>通过从 <strong>VPN tunnel outside IP address</strong>（VPN 隧道外部 IP 地址）列表中选择适当的 IP 地址，选择要修改的隧道。</li><li>在 <strong>Tunnel activity log</strong>（隧道活动日志）下，清除 <strong>Enable</strong>（启用）。</li><li>选择 <strong>Save changes</strong>（保存更改）。</li><li>（可选）如果需要，对其它隧道重复步骤 4 到 7。</li></ol><h6 id="使用-AWS-命令行或-API-对-Site-to-Site-VPN-连接禁用隧道日志记录"><a href="#使用-AWS-命令行或-API-对-Site-to-Site-VPN-连接禁用隧道日志记录" class="headerlink" title="使用 AWS 命令行或 API 对 Site-to-Site VPN 连接禁用隧道日志记录"></a>使用 AWS 命令行或 API 对 Site-to-Site VPN 连接禁用隧道日志记录</h6><ul><li><a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-ModifyVpnTunnelOptions.html">ModifyVpnTunnelOptions</a>（Amazon EC2 查询 API）</li><li><a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/modify-vpn-tunnel-options.html">modify-vpn-tunnel-options</a> (AWS CLI)</li></ul>]]></content>
    
    
    <categories>
      
      <category>CLOUD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AWS</tag>
      
      <tag>VPN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用Python连接AWSS3存储桶</title>
    <link href="/2023/04/24/%E4%BD%BF%E7%94%A8Python%E8%BF%9E%E6%8E%A5AWSS3%E5%AD%98%E5%82%A8%E6%A1%B6/"/>
    <url>/2023/04/24/%E4%BD%BF%E7%94%A8Python%E8%BF%9E%E6%8E%A5AWSS3%E5%AD%98%E5%82%A8%E6%A1%B6/</url>
    
    <content type="html"><![CDATA[<p>AWS配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">访问<span class="hljs-variable constant_">S3</span>需要aws_access_key_id和aws_secret_access_key。<br>func1.在boto3提供的<span class="hljs-variable constant_">API</span>中，可以指定这两个值。<br>func2.但是把安全相关的这些信息放到代码中并不是一个好的选择。<br>所以，也可通过awscli配置，将其存放到~<span class="hljs-regexp">/.aws/</span>credentials。<br>boto3的<span class="hljs-variable constant_">API</span>在访问<span class="hljs-variable constant_">S3</span>时，会自动从该文件中读取相关信息。<br>awscli可以通过pip install awscli进行安装。<br>复制代码<br></code></pre></td></tr></table></figure><p>代码示例如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> boto3<br><span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger<br> <br> <br><span class="hljs-variable constant_">BUCKET_NAME</span> = <span class="hljs-string">&quot;your-bucket-name&quot;</span>  # 存储桶名称<br> <br># aws_access_key_id和aws_secret_access_key<br><span class="hljs-variable constant_">CN_S3_AKI</span> = <span class="hljs-string">&#x27;your_aws_access_key_id&#x27;</span><br><span class="hljs-variable constant_">CN_S3_SAK</span> = <span class="hljs-string">&#x27;your_aws_secret_access_key&#x27;</span><br> <br><span class="hljs-variable constant_">CN_REGION_NAME</span> = <span class="hljs-string">&#x27;your-cn-region-name&#x27;</span>  # 区域<br> <br># s3 实例<br>s3 = boto3.<span class="hljs-title function_">client</span>(<span class="hljs-string">&#x27;s3&#x27;</span>, region_name=<span class="hljs-variable constant_">CN_REGION_NAME</span>,<br>                  aws_access_key_id=<span class="hljs-variable constant_">CN_S3_AKI</span>, aws_secret_access_key=<span class="hljs-variable constant_">CN_S3_SAK</span><br>                  )<br> <br> <br>def <span class="hljs-title function_">upload_files</span>(path_local, path_s3):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    上传（重复上传会覆盖同名文件）</span><br><span class="hljs-string">    :param path_local: 本地路径</span><br><span class="hljs-string">    :param path_s3: s3路径</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Start upload files.&#x27;</span>)<br> <br>    <span class="hljs-keyword">if</span> not <span class="hljs-title function_">upload_single_file</span>(path_local, path_s3):<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Upload files failed.&#x27;</span>)<br> <br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Upload files successful.&#x27;</span>)<br> <br> <br>def <span class="hljs-title function_">upload_single_file</span>(src_local_path, dest_s3_path):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    上传单个文件</span><br><span class="hljs-string">    :param src_local_path:</span><br><span class="hljs-string">    :param dest_s3_path:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-title function_">open</span>(src_local_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-attr">f</span>:<br>            s3.<span class="hljs-title function_">upload_fileobj</span>(f, <span class="hljs-variable constant_">BUCKET_NAME</span>, dest_s3_path)<br>    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Upload data failed. | src: &#123;src_local_path&#125; | dest: &#123;dest_s3_path&#125; | Exception: &#123;e&#125;&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">False</span><br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Uploading file successful. | src: &#123;src_local_path&#125; | dest: &#123;dest_s3_path&#125;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">True</span><br> <br> <br>def <span class="hljs-title function_">download_zip</span>(path_s3, path_local):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    下载</span><br><span class="hljs-string">    :param path_s3:</span><br><span class="hljs-string">    :param path_local:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    retry = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> retry &lt; <span class="hljs-number">3</span>:  # 下载异常尝试<span class="hljs-number">3</span>次<br>        logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Start downloading files. | path_s3: &#123;path_s3&#125; | path_local: &#123;path_local&#125;&#x27;</span>)<br>        <span class="hljs-attr">try</span>:<br>            s3.<span class="hljs-title function_">download_file</span>(<span class="hljs-variable constant_">BUCKET_NAME</span>, path_s3, path_local)<br>            file_size = os.<span class="hljs-property">path</span>.<span class="hljs-title function_">getsize</span>(path_local)<br>            logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Downloading completed. | size: &#123;round(file_size / 1048576, 2)&#125; MB&#x27;</span>)<br>            <span class="hljs-keyword">break</span>  # 下载完成后退出重试<br>        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:<br>            logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Download zip failed. | Exception: &#123;e&#125;&#x27;</span>)<br>            retry += <span class="hljs-number">1</span><br> <br>    <span class="hljs-keyword">if</span> retry &gt;= <span class="hljs-number">3</span>:<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Download zip failed after max retry.&#x27;</span>)<br> <br> <br>def <span class="hljs-title function_">delete_s3_zip</span>(path_s3, file_name=<span class="hljs-string">&#x27;&#x27;</span>):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    删除</span><br><span class="hljs-string">    :param path_s3:</span><br><span class="hljs-string">    :param file_name:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">try</span>:<br>        # copy<br>        # copy_source = &#123;<span class="hljs-string">&#x27;Bucket&#x27;</span>: <span class="hljs-variable constant_">BUCKET_NAME</span>, <span class="hljs-string">&#x27;Key&#x27;</span>: path_s3&#125;<br>        # s3.<span class="hljs-title function_">copy_object</span>(<span class="hljs-title class_">CopySource</span>=copy_source, <span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>, <span class="hljs-title class_">Key</span>=<span class="hljs-string">&#x27;is-zips-cache/&#x27;</span> + file_name)<br>        s3.<span class="hljs-title function_">delete_object</span>(<span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>, <span class="hljs-title class_">Key</span>=path_s3)<br>    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Delete s3 file failed. | Exception: &#123;e&#125;&#x27;</span>)<br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Delete s3 file Successful. | path_s3 = &#123;path_s3&#125;&#x27;</span>)<br> <br> <br>def <span class="hljs-title function_">batch_delete_s3</span>(delete_key_list):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    批量删除</span><br><span class="hljs-string">    :param delete_key_list: [</span><br><span class="hljs-string">                &#123;&#x27;Key&#x27;: &quot;</span>test-<span class="hljs-number">01</span>/虎式<span class="hljs-number">03</span>的副本.<span class="hljs-property">jpeg</span><span class="hljs-string">&quot;&#125;,</span><br><span class="hljs-string">                &#123;&#x27;Key&#x27;: &quot;</span>test-<span class="hljs-number">01</span>/tank001.<span class="hljs-property">png</span><span class="hljs-string">&quot;&#125;,</span><br><span class="hljs-string">            ]</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">try</span>:<br>        res = s3.<span class="hljs-title function_">delete_objects</span>(<br>            <span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>,<br>            <span class="hljs-title class_">Delete</span>=&#123;<span class="hljs-string">&#x27;Objects&#x27;</span>: delete_key_list&#125;<br>        )<br>    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&quot;Batch delete file failed. | Excepthon: &#123;e&#125;&quot;</span>)<br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;Batch delete file success. &quot;</span>)<br> <br> <br> <br>def <span class="hljs-title function_">get_files_list</span>(<span class="hljs-title class_">Prefix</span>=<span class="hljs-title class_">None</span>):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    查询</span><br><span class="hljs-string">    :param start_after:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Start getting files from s3.&#x27;</span>)<br>    <span class="hljs-attr">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-title class_">Prefix</span> is not <span class="hljs-title class_">None</span>:<br>            all_obj = s3.<span class="hljs-title function_">list_objects_v2</span>(<span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>, <span class="hljs-title class_">Prefix</span>=<span class="hljs-title class_">Prefix</span>)<br>            <br>            # 获取某个对象的head信息<br>            # obj = s3.<span class="hljs-title function_">head_object</span>(<span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>, <span class="hljs-title class_">Key</span>=<span class="hljs-title class_">Prefix</span>)<br>            # logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;obj = &#123;obj&#125;&quot;</span>)<br>        <span class="hljs-attr">else</span>:<br>            all_obj = s3.<span class="hljs-title function_">list_objects_v2</span>(<span class="hljs-title class_">Bucket</span>=<span class="hljs-variable constant_">BUCKET_NAME</span>)<br> <br>    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:<br>        logger.<span class="hljs-title function_">error</span>(f<span class="hljs-string">&#x27;Get files list failed. | Exception: &#123;e&#125;&#x27;</span>)<br>        <span class="hljs-keyword">return</span><br> <br>    contents = all_obj.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Contents&#x27;</span>)<br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;--- contents = &#123;contents&#125;&quot;</span>)<br>    <span class="hljs-keyword">if</span> not <span class="hljs-attr">contents</span>:<br>        <span class="hljs-keyword">return</span><br> <br>    file_name_list = []<br>    <span class="hljs-keyword">for</span> zip_obj <span class="hljs-keyword">in</span> <span class="hljs-attr">contents</span>:<br>        # logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;zip_obj = &#123;zip_obj&#125;&quot;</span>)<br>        file_size = <span class="hljs-title function_">round</span>(zip_obj[<span class="hljs-string">&#x27;Size&#x27;</span>] / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>, <span class="hljs-number">3</span>)  # 大小<br>        # logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;file_path = &#123;zip_obj[&#x27;Key&#x27;]&#125;&quot;</span>)<br>        # logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;LastModified = &#123;zip_obj[&#x27;LastModified&#x27;]&#125;&quot;</span>)<br>        # logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;file_size = &#123;file_size&#125; Mb&quot;</span>)<br>        # zip_name = zip_obj[<span class="hljs-string">&#x27;Key&#x27;</span>][<span class="hljs-title function_">len</span>(start_after):]<br>        zip_name = zip_obj[<span class="hljs-string">&#x27;Key&#x27;</span>]<br> <br>        file_name_list.<span class="hljs-title function_">append</span>(zip_name)<br> <br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&#x27;Get file list successful.&#x27;</span>)<br> <br>    <span class="hljs-keyword">return</span> file_name_list<br> <br> <br># <span class="hljs-variable constant_">TODO</span> 检测是否存在 check_exists，可用get_files_list时遍历路径下是否存在要检测的文件名称来判断<br># def <span class="hljs-title function_">check_exists</span>(bucket_name, path_name):<br>#     s3 = boto3.<span class="hljs-title function_">resource</span>(<span class="hljs-string">&#x27;s3&#x27;</span>)<br>#     bucket = s3.<span class="hljs-title class_">Bucket</span>(bucket_name)<br>#     counter = <span class="hljs-number">0</span><br>#     <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> bucket.<span class="hljs-property">objects</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Prefix</span>=path_name):<br>#         counter = counter + <span class="hljs-number">1</span><br>#         <span class="hljs-keyword">if</span> counter &gt; <span class="hljs-number">0</span>:<br>#             <span class="hljs-keyword">return</span> <span class="hljs-title class_">True</span><br>#     <span class="hljs-keyword">return</span> <span class="hljs-title class_">False</span><br> <br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pass<br>    # <span class="hljs-variable constant_">TODO</span> test 查询 / 上传 / 下载 /删除<br>    # 查询<br>    # file_name_list = <span class="hljs-title function_">get_files_list</span>(<span class="hljs-title class_">Prefix</span>=<span class="hljs-string">&#x27;test-01/tank001.png&#x27;</span>)<br>    file_name_list = <span class="hljs-title function_">get_files_list</span>()<br>    logger.<span class="hljs-title function_">info</span>(f<span class="hljs-string">&quot;file_name_list = &#123;file_name_list&#125;&quot;</span>)<br> <br>    # 上传<br>    # path_local = <span class="hljs-string">&#x27;/Users/Desktop/test/local_file_path/虎式02的副本.jpeg&#x27;</span><br>    # path_s3 = <span class="hljs-string">&#x27;test-02/虎式02的副本.jpeg&#x27;</span>  # s3路径不存在则自动创建<br>    # <span class="hljs-title function_">upload_files</span>(path_local, path_s3)<br> <br>    # 下载<br>    # path_s3 = <span class="hljs-string">&#x27;test-01/虎式02的副本.jpeg&#x27;</span><br>    # path_local = <span class="hljs-string">&#x27;/Users/Desktop/test/download_from_s3/虎式02的副本.jpeg&#x27;</span><br>    # <span class="hljs-title function_">download_zip</span>(path_s3, path_local)<br> <br>    # 删除<br>    # path_s3 = <span class="hljs-string">&#x27;test-01/虎式02的副本.jpeg&#x27;</span><br>    # <span class="hljs-title function_">delete_s3_zip</span>(path_s3)<br> <br>    # 批量删除 - 桶内多个文件<br>    # delete_key_list = [<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/虎式02.jpeg&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/虎式03.jpeg&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/tank001.png&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/face.png&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/114.png&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/xiaox.JPG&quot;</span>&#125;,<br>    #     &#123;<span class="hljs-string">&#x27;Key&#x27;</span>: <span class="hljs-string">&quot;test-01/face.jpg&quot;</span>&#125;,<br>    # ]<br>    # <span class="hljs-title function_">batch_delete_s3</span>(delete_key_list)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CLOUD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AWS</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ocserv安装(账号+密码+OTP认证方式)</title>
    <link href="/2023/04/24/Ocserv%E5%AE%89%E8%A3%85(%E8%B4%A6%E5%8F%B7+%E5%AF%86%E7%A0%81+OTP%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F)/"/>
    <url>/2023/04/24/Ocserv%E5%AE%89%E8%A3%85(%E8%B4%A6%E5%8F%B7+%E5%AF%86%E7%A0%81+OTP%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F)/</url>
    
    <content type="html"><![CDATA[<h3 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h3><p>ocserv 是目前比较常用的vpn软件。这里完整记录下从零开始搭建过程。</p><table><thead><tr><th align="left">名称</th><th align="left">值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">操作系统</td><td align="left">Centos 7</td><td align="left">所用到的基础image</td></tr></tbody></table><h3 id="源码安装ocserv"><a href="#源码安装ocserv" class="headerlink" title="源码安装ocserv"></a>源码安装ocserv</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#依赖的安装</span><br>yum install epel-release<br>yum install -y pam-devel lz4-devel libseccomp-devel readline-devel mysql<span class="hljs-regexp">/libnl3-devel krb5-devel radcli-devel libcurl-devel cjose-devel mysql/</span>jansson-devel protobuf-c-devel libtalloc-devel http-parser-devel mysql<span class="hljs-regexp">/protobuf-c gperf nuttcp lcov uid_wrapper pam_wrapper nss_wrapper mysql/</span>socket_wrapper gssntlmssp haproxy iputils freeradius gawk mysql/gnutls-utils iproute yajl tcpdump gnutls-devel libev-devel<br><br><span class="hljs-comment">#下载安装认证模块</span><br>wget https:<span class="hljs-regexp">//</span>download-ib01.fedoraproject.org<span class="hljs-regexp">/pub/</span>epel<span class="hljs-regexp">/7/</span>x86_64<span class="hljs-regexp">/Packages/</span>l/liboath-devel-<span class="hljs-number">2.6</span>.<span class="hljs-number">2</span>-<span class="hljs-number">1</span>.el7.x86_64.rpm<br>rpm -ivh liboath-devel-<span class="hljs-number">2.6</span>.<span class="hljs-number">2</span>-<span class="hljs-number">1</span>.el7.x86_64.rpm <br>wget https:<span class="hljs-regexp">//</span>download-ib01.fedoraproject.org<span class="hljs-regexp">/pub/</span>epel<span class="hljs-regexp">/7/</span>SRPMS<span class="hljs-regexp">/Packages/</span>o/oath-toolkit-<span class="hljs-number">2.6</span>.<span class="hljs-number">2</span>-<span class="hljs-number">1</span>.el7.src.rpm<br>rpm -ivh oath-toolkit-<span class="hljs-number">2.6</span>.<span class="hljs-number">2</span>-<span class="hljs-number">1</span>.el7.src.rpm<br><br><span class="hljs-comment">#下载源代码</span><br>git clone https:<span class="hljs-regexp">//gi</span>tlab.com<span class="hljs-regexp">/openconnect/</span>ocserv.git<br><br><span class="hljs-comment">#编译安装及配置OTP模块</span><br>cd ocserv/<br>autoreconf -fvi<br>.<span class="hljs-regexp">/configure --prefix=/u</span>sr<span class="hljs-regexp">/local/</span>ocserv --with-local-talloc --with-local-http-parser --with-local-protobuf-c --with-openssl --with-pam --with-geoip --with-otp<br>make &amp;&amp; make install<br><br><span class="hljs-comment">#内核参数调优</span><br>echo <span class="hljs-string">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br>echo <span class="hljs-string">&quot;net.core.default_qdisc = fq&quot;</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br>echo <span class="hljs-string">&quot;net.ipv4.tcp_congestion_control = bbr&quot;</span> &gt;&gt; <span class="hljs-regexp">/etc/</span>sysctl.conf<br>sysctl -p<br></code></pre></td></tr></table></figure><h3 id="配置账号（账号-密码-OTP认证方式）"><a href="#配置账号（账号-密码-OTP认证方式）" class="headerlink" title="配置账号（账号+密码+OTP认证方式）"></a>配置账号（账号+密码+OTP认证方式）</h3><p>上述步骤执行完基本的ocserv 已经安装好， 其实如果不编译 直接执行 apt 安装也行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建账户</span><br>ocpasswd -c /etc/ocserv/ocpasswd user<br><span class="hljs-comment">#生成一个16字节的随机字符串作为用户的密钥</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;HOTP/T30 user - <span class="hljs-subst">$(head -c 16 /dev/urandom |xxd -c 256 -ps)</span>&quot;</span> &gt;&gt;/etc/ocserv/ocserv.otp<br><span class="hljs-comment">#查看key</span><br><span class="hljs-built_in">cat</span> ocserv.otp<br><span class="hljs-comment">#生成totp</span><br>oathtool --totp -v xxx<br><span class="hljs-comment">#通过上面的Base32 secret生成otp二维码</span><br>qrencode -t ANSIUTF8 <span class="hljs-string">&quot;otpauth://totp/user@ocserv?secret=xxx&quot;</span><br></code></pre></td></tr></table></figure><h3 id="配置服务"><a href="#配置服务" class="headerlink" title="配置服务"></a>配置服务</h3><ol><li><p>修改配置文件</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 下载个网上现成的，具体优化参考官方的 sample 也行，这里就不优化了</span><br>wget -N <span class="hljs-comment">--no-check-certificate -P &quot;/etc/ocserv&quot; &quot;https://files.zorz.cc/ocserv.conf&quot;</span><br><br><br>auth = <span class="hljs-string">&quot;plain[passwd=/etc/ocserv/ocpasswd]&quot;</span><br><span class="hljs-comment"># listen-host = [IP|HOSTNAME]</span><br>tcp-port = <span class="hljs-number">443</span><br><span class="hljs-comment">#udp-port = 443  #最好注释掉（0）</span><br><span class="hljs-built_in">run</span>-<span class="hljs-keyword">as</span>-user = nobody<br><span class="hljs-built_in">run</span>-<span class="hljs-keyword">as</span>-group = daemon<br>socket-<span class="hljs-built_in">file</span> = /var/<span class="hljs-built_in">run</span>/ocserv-socket<br>server-cert = /etc/letsencrypt/live/xxx.com/fullchain.pem （<span class="hljs-number">1</span>）<br>server-key = /etc/letsencrypt/live/xxx.com/privkey.pem   （<span class="hljs-number">2</span>） <span class="hljs-comment">#刚才写的</span><br>ca-cert = /etc/ocserv/ssl/ca-cert.pem<br>isolate-workers = <span class="hljs-literal">true</span><br>banner = <span class="hljs-string">&quot;Hello&quot;</span><br>max-clients = <span class="hljs-number">16</span><br>max-same-clients = <span class="hljs-number">2</span><br>server-stats-reset-<span class="hljs-built_in">time</span> = <span class="hljs-number">604800</span><br>keepalive = <span class="hljs-number">32400</span><br>dpd = <span class="hljs-number">30</span><br>mobile-dpd = <span class="hljs-number">90</span><br>switch-<span class="hljs-keyword">to</span>-tcp-<span class="hljs-keyword">timeout</span> = <span class="hljs-number">25</span><br><span class="hljs-keyword">try</span>-mtu-discovery = <span class="hljs-literal">true</span><br>tls-priorities = <span class="hljs-string">&quot;NORMAL:%SERVER_PRECEDENCE:%COMPAT:-VERS-SSL3.0&quot;</span><br>auth-<span class="hljs-keyword">timeout</span> = <span class="hljs-number">240</span><br>min-reauth-<span class="hljs-built_in">time</span> = <span class="hljs-number">300</span><br>max-ban-score = <span class="hljs-number">80</span><br>ban-reset-<span class="hljs-built_in">time</span> = <span class="hljs-number">1200</span><br>cookie-<span class="hljs-keyword">timeout</span> = <span class="hljs-number">300</span><br>deny-roaming = <span class="hljs-literal">false</span><br>rekey-<span class="hljs-built_in">time</span> = <span class="hljs-number">172800</span><br>rekey-method = ssl<br>use-occtl = <span class="hljs-literal">true</span><br>pid-<span class="hljs-built_in">file</span> = /var/<span class="hljs-built_in">run</span>/ocserv.pid<br>device = vpns<br>predictable-ips = <span class="hljs-literal">true</span><br>default-domain = xxx.com <span class="hljs-comment">#(3)</span><br><br>ipv4-network = <span class="hljs-number">192.168</span><span class="hljs-number">.169</span><span class="hljs-number">.0</span> <span class="hljs-comment">#(4)</span><br>ipv4-netmask = <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br><span class="hljs-comment"># An alternative way of specifying the network:</span><br><span class="hljs-comment">#ipv4-network = 192.168.1.0/24</span><br><span class="hljs-comment"># The IPv6 subnet that leases will be given from.</span><br><span class="hljs-comment">#ipv6-network = fda9:4efe:7e3b:03ea::/48</span><br><span class="hljs-comment"># Specify the size of the network to provide to clients. It is</span><br><span class="hljs-comment"># generally recommended to provide clients with a /64 network in</span><br><span class="hljs-comment"># IPv6, but any subnet may be specified. To provide clients only</span><br><span class="hljs-comment"># with a single IP use the prefix 128.</span><br><span class="hljs-comment">#ipv6-subnet-prefix = 128</span><br><span class="hljs-comment">#ipv6-subnet-prefix = 64</span><br>tunnel-all-dns = <span class="hljs-literal">true</span><br>dns = <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><br>dns = <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span><br>ping-leases = <span class="hljs-literal">false</span><br><span class="hljs-comment"># route = 10.10.10.0/255.255.255.0</span><br><span class="hljs-comment"># route = 192.168.0.0/255.255.0.0</span><br><span class="hljs-comment"># route = fef4:db8:1000:1001::/64</span><br><span class="hljs-comment"># route = default</span><br><span class="hljs-comment"># no-route = 192.168.5.0/255.255.255.0</span><br>cisco-client-compat = <span class="hljs-literal">true</span><br>dtls-legacy = <span class="hljs-literal">true</span><br><br><br><br><span class="hljs-comment"># 需要改的我已经标注好了</span><br></code></pre></td></tr></table></figure></li><li><p>启动</p></li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/ocserv/</span>sbin<span class="hljs-regexp">/ocserv --foreground --pid-file /</span>run<span class="hljs-regexp">/ocserv.pid --config /u</span>sr<span class="hljs-regexp">/local/</span>ocserv/ocserv.conf<br></code></pre></td></tr></table></figure><ol><li>查看日志</li></ol><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">journalctl </span>-xe -u ocserv.service<br></code></pre></td></tr></table></figure><h3 id="yum安装ocserv"><a href="#yum安装ocserv" class="headerlink" title="yum安装ocserv"></a>yum安装ocserv</h3><p>为了教程更简便，这里我直接用EPEL源安装Ocserv，可以省去麻烦的编译过程。首先安装EPEL源：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">yum -y install epel-release<br></code></pre></td></tr></table></figure><p>然后就可以直接YUM安装Ocserv了：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> ocserv<br></code></pre></td></tr></table></figure><p>新建一个目录，用来存放SSL证书相关文件，然后进入到这个目录内：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> ssl<br><span class="hljs-built_in">cd</span> ssl<br></code></pre></td></tr></table></figure><p>新建一个证书模板：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs abnf">vi ca.tmpl<br><br>写入：<br><br><span class="hljs-attribute">cn</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;LALA&quot;</span><br> organization <span class="hljs-operator">=</span> <span class="hljs-string">&quot;LALA.IM&quot;</span><br><br><span class="hljs-attribute">serial</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br> expiration_days <span class="hljs-operator">=</span> <span class="hljs-number">9999</span><br> ca<br> signing_key<br> cert_signing_key<br> crl_signing_key<br> <br>注：LALA和LALA.IM可以根据自己的需要更改，都是自签证书，随便写也没关系。<br></code></pre></td></tr></table></figure><p>然后生成私钥和CA证书：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">certtool --<span class="hljs-keyword">generate</span>-privkey --outfile ca-key<span class="hljs-variable">.pem</span><br>certtool --<span class="hljs-keyword">generate</span>-self-<span class="hljs-keyword">signed</span> --load-privkey ca-key<span class="hljs-variable">.pem</span> --template ca<span class="hljs-variable">.tmpl</span> --outfile ca-cert<span class="hljs-variable">.pem</span><br></code></pre></td></tr></table></figure><p>接着来生成服务器证书，还是老样子新建一个证书模板：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs abnf">vi server.tmpl<br><br>写入：<br><br><span class="hljs-attribute">cn</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;你的服务器IP&quot;</span><br> organization <span class="hljs-operator">=</span> <span class="hljs-string">&quot;LALA.IM&quot;</span><br> expiration_days <span class="hljs-operator">=</span> <span class="hljs-number">9999</span><br> signing_key<br> encryption_key<br> tls_www_server<br><br>注：cn后面的值改成你的服务器公网IP。<br></code></pre></td></tr></table></figure><p>然后生成私钥和证书：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">certtool <span class="hljs-attr">--generate-privkey</span> <span class="hljs-attr">--outfile</span> server-key<span class="hljs-selector-class">.pem</span><br>certtool <span class="hljs-attr">--generate-certificate</span> <span class="hljs-attr">--load-privkey</span> server-key<span class="hljs-selector-class">.pem</span> <span class="hljs-attr">--load-ca-certificate</span> ca-cert<span class="hljs-selector-class">.pem</span> <span class="hljs-attr">--load-ca-privkey</span> ca-key<span class="hljs-selector-class">.pem</span> <span class="hljs-attr">--template</span> server<span class="hljs-selector-class">.tmpl</span> <span class="hljs-attr">--outfile</span> server-cert.pem<br></code></pre></td></tr></table></figure><p>然后我们把证书文件用移动到Ocserv默认的目录下：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">cp server-cert.pem <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span><span class="hljs-keyword">public</span>/<br>cp server-key.pem <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span><span class="hljs-keyword">private</span>/<br>cp ca-cert.pem <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span>cacerts/<br></code></pre></td></tr></table></figure><p>现在编辑ocserv的配置文件（需要改动的地方很多，如果vi不好用就自己用SFTP把这个文件下载到本地用专业的编辑器编辑）：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vi <span class="hljs-regexp">/etc/</span>ocserv/ocserv.conf<br></code></pre></td></tr></table></figure><p>让我们一起来看看需要改哪些地方：</p><ol><li>auth也就是验证方式要改为：</li></ol><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">auth</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;plain[passwd=/etc/ocserv/ocpasswd,otp=/etc/ocserv/ocserv.otp]&quot;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>默认的监听端口为443，如果你的服务器上跑着HTTPS的WEB站点，那么443端口肯定是被占用了的，所以如果有需求的话，可以更改下面的值：</li></ol><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elm">\# <span class="hljs-type">TCP</span> and <span class="hljs-type">UDP</span> <span class="hljs-keyword">port</span> number<br> tcp-<span class="hljs-keyword">port</span> = 443<br> udp-<span class="hljs-keyword">port</span> = 443<br></code></pre></td></tr></table></figure><p>如图所示：</p><p><img src="data:image/png;base64,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" alt="# When the server has a dynamic DNS address (that may change),  # should set that to true to ask the client to resolve again  # reconnects.  *listen-host-is-dyndns -  - true  # TCP and UDP  tcp-;nzrt = 443  udp-port = 443  rt number "></p><ol start="3"><li>Anyconnect有一个设置连接欢迎信息的功能，也就是你在连接的时候会弹出一个提示框，提示框的内容就可以自行设置，如有需要可以更改下面的值：</li></ol><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\#</span> A banner <span class="hljs-keyword">to</span> be displayed <span class="hljs-literal">on</span> clients<br> banner = <span class="hljs-string">&quot;Welcome LALA.IM&quot;</span><br></code></pre></td></tr></table></figure><p>如图所示：</p><p><img src="data:image/png;base64,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" alt="# A banner to be displayed on  clients  banner -  &quot;Welcome L ALA. 1M&quot;&#39; "></p><ol start="4"><li><p>Anyconnect可以限制最大允许连接的设备数量，如有需要可以更改下面这两个值：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">max-clients</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span><br><span class="hljs-attribute">max-same-clients</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li></ol><p>如图所示：</p><p><img src="data:image/png;base64,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" alt="Unset  134  136  138  # L Imit the number of  *max-clients -  1ß24  max-clients =  # Limit the number of  clients.  identical  or  set  to  zero for  unlimited .  clients  to zero  (i.e.,  users connecting  # multiple times). IJ  n set  or set  max- same- clients  for unlimited. "></p><ol start="5"><li>更改服务器证书以及私钥的路径为我们刚才移动的路径：</li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">server-cert = <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span><span class="hljs-keyword">public</span>/server-cert.pem<br>server-key = <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span><span class="hljs-keyword">private</span>/server-key.pem<br></code></pre></td></tr></table></figure><p>如图所示：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkQAAAB6CAYAAABeD0yuAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAkSgAwAEAAAAAQAAAHoAAAAAx3svHwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAN5FJREFUeAHtfT9vFbvW/sqr2xO+wDkgER2lCPdSvQoF51ImQigVJemSNilOGf3en1KeImlJRShTbRBKShQKIr0NN6RAKJGAfAHCJ9jvWvZ4xvbYyzOe2Ts7m7VR2DNje/15vMbbY3v8zAzxA/IRBKYBgYtdeDi3CQuHQ3ixNA0OiQ+CwJQgMEn35iTZMiXVOy1u/FfakZ/w6c0+7O/vw/tLL/fle3Wd0ujvzaefbgY7/c0n8FLdvK3OLmD34TocUZmjdXi4e5EujflmZma8v4egix7B+kwhLy1pynJMku9Ur6aOQvXRt60pfVNW1dfuTt/118ah69Tdxs4+8lJcm7atD3ltZVw31tetvy1ekn9SEPgHbwh1ho4B/lyBB8cDuHIyX8L7dwCPV1fhN3Udz/dP4fL+I3X+89MbGHy7AyuYfssp1+/JxZezZgKXXsBw+ALz0s0ygBU8lkGEZtCNL9c92PgwhI2ijlrrvbcBH4YbLYp11NdCk2QVBH5pBFrfmyNEa5JsGaGbIro9AokRoltw/+lTuB/s0dyC2dtf4T9mVOjyG3y9PVt0fn7C92+z8Pjp/d47Qxe7D3GUZw42T/ZgGUd85jZP4GRzDtbVcFF7AOwSX5RsPULhyqNOlBm5mHF0Ha3jk9gRTtWY9Ie7UI1XxcvZep1jGvFaxz+Sh7J21117jopzM9pV2knDwM4olx79KNMdJfUT23d3xK1vH0iePfrjn9dtoyva72XYw39U78r/0jlupEfL37Xq1vUvrE9fzfCdCqq6qOLF1ReXGY2lZN1myOTcLtKcWCuxpsT2+vj6441x7MC6r0whO9YhWrdOPVDsNPw45Wa8Eej2vut4sGPevzczZDZ0hbLpNtMeMYroS8YZo9TBzMaauzfpvs5vP524KIKCjzPGlqTvEcw0wFX7j/Hp3u8MZpI0cQgkOkScvdRZWoV/XQ30tBmOBq2aDtDP7/ANZuHqvZ5KC06ncaKZtHsbH2B4vgOLiztwjsufDtcWYee8jzUje7D5eQtHkYZK/tm26djQTUQjSnhd/R0CLNuN2wlsbgO8KtIPFzbhb9U5S5WLO4l9PdgaHsLaySYczJ/D+c4inH3R3aylF8aOwk5jy70n8GxxDwamY3jxFg4WDhuupbF8R70Lm8+LqcTR+BD3PJ6i/UZM8N+hqYtyoZAe6RkSZkERMf+CmYuLub5juecH8AxjUsfLED5s3GsoMxJLqm7PoAgB/IXDuoUd+EsNcabsjMjkXMc0+mFZhsPSh2GJdZ4+vv54Y6Ixr4pZdYvtAhy8LR5I8Adszq6HWGz4uqej/oxX1BmaO3iGbeUH0GHI1F92G8Jhnbo3Y/HJ2InOxeKTjzPGlux7jIsXUwvyfWMQwEa7wedqePr65fD4u51VX3tZXPx+/HL48vXp8IqyXJ0OX7+0838fHr98PTxVibaMzOPzneHiGv4sDs+HO4uLQ+wQtfgcDvFHdUilq49/zTonXQC08Nz6q3QersFQmVIJ00eJcn728vxwbQhKYGUDdoiGi8ZJSndssXwpy2LXYK2ysZQdPKj06GTCtPBpJD74+vxzsiJ0jbuuLQ+X82VZ/pliIX25vqNMqi+qo7LOjJ6EzGgsFTKNPCceOsqsYsmKI4VHJH466AvXjwGH+Y7GvF+31rl1L2jJVhqjipJufv3pGFd1u7iDraT1SdQfNhxF+9OiDbHKaE0hrEPXSEdO+0myIvGpDAjrqlAIp9v3lX2MAcH+BkTjpVIoRzcEgfwRIhoF+nEXHj/SK4h+e4TrjOAjnJqF17cfwD91Et6Xv8Gduz/gqvOqanpqwKkIfJPoZG+5mDrDJ4w5e8QG1fX9KUajsE6LJ2bztJVQlFsuKhafxJbP1IiYtsV76l1agbW9AU5oHMHg7Bk8MQMTUXmxhEWYnyvSevchpnOc1y3/OLWZvqtRTIyVV/Dcm9pDZdkyt2BBjX5cwNuDBdgqR526yMTR1jKm/TV1C/BHLH4yfeCgjqclYj5eMDtlOuoPR853cLz05DOc+0hw9ddbG+IrzTjn7AQmPjNUUZF7G3n3GBsvmbZIsetBIL9DpOy9sjo5P+Hqx22YpfVGt36HOzhp9r3sAF3Ct69FWic/iyFPfKzAp2VszLFDoG4avzHvpMQtfO8PWMCpKz0N5iaxZ7nlWKFu4tG6PVdPaUuwsobTZusDnHPbgNjvmSvFOzv6G9dnFY3NyHyopn/qPnj21E6rsrWkJhds/7j8PfheTu+efdHTOJ1kYt0uHMDbI5oKXaleCOgkMwaAjqPt0NubnfV1q7/G8TI3D4vq4YB8pAcp/16J+V5dv7n1V/jwBF8koRl+e81esv4y2pAesK5QL45YO5n4LAXlxFm3e6wWL8aW4g3nau2bSZDvSUMg0SEyr9wP4OMPgK/vaE3Qe1CDQLfuw58PAD4OzDqhd/jKmVmAjeuL/sQuUTCtOwT0ZtkCPb5efIGG75h1ULoEL3BtwtlytUiWFjtXC6djonPLxeTRdWoIaERM27I9v1NbM7P0F9qKa5BWWr1CZy1UXgZco2M6mKPxAU2M+ICjAWrBNP14FTY5WC+BXXambGFS5WL+ceVyfTcyi3ihdSyvTOc0V6aOiaWVBdhcxn2WnMrtJjMWbUsvaC3ZnB7hojopse6iL1Z/MSvoejrmg6XxTaJXO2fFAvw5+LzljaYGC9HF6ai/0j16u1Z1isxi9HT9tW5DWKwNnrF7urTUO+DtjMcniYnFWdqW9veYkRm63wuXqMOIh2YdaHFVviYQgRma2ptAu8SkTARoEeVznKypFvJmCpqaYtRgyTYLU1Od4sjIEZA2pG+IqQ1ST5oNX3LpW7/Ia4pAYoSoqRjJd90I6FdrcRsCfFNOOkPXXRuiXxC4eQhIG9J/nWlMl+EMl3iUL2r2r0Yk9oSAjBD1BKSIEQQEAUFAEBAEBIGbi4CMEN3cuhPLBQFBQBAQBAQBQaAnBKRD1BOQIkYQEAQEAUFAEBAEbi4C0iG6uXUnlgsCgsCvjkBBmVG+BDhteOT6l1tu2vATf1oh0KBDZF69b8F2b7Pc7xev5V832716nTZ3A0d6SyC3bKv6SGTOtYP2YbG5jBJqRpqc6wNnVLFhp3plP1VPo9DP2TYNaW0wa5O3KTYxmbHrTeXetHzT6G8Xn+z73t4aYhT12sXOUdgjMkeBwD94oZls9789gtXVR5Vo6iAh2Svt2dj3pzHbfd+KRd4EIaA37NxQnV7clFI+gsCvgsC0M7dz/tEmq8jXOPwQ2HSNK/erxIb42RqBxAhRLtu9bQd2qv5zBQ8qHg87sfWxfo0xn+0+zOru9/6rc549OWU+ySk27MJve1hbyw2nkVQn3S6IabYPXlLKIJWuMbRHjCJ2JhmgGXXFkLVipUfffQboqA9eucq/qk60Vv+8qS3tdiyO1kPUTqq7OIM3l+ZvClj5jr55+io8NQ7NGN/tGGxTrhlmyXvF88HxL1J9SZlYLhpL3iaLTfTpOliHGJ7Z9Yd2RmOJs9PBzK4He3TEHxVtU7e6DariKVIRxeUcH2KY8XXL+aeNoYfhxZJjyNidLhfzwblutde8naSX8I635cYy+b4BCNDGjOlPiNxVl1Kkrkjkakhea7K+H8fTapkbXiCyvYK0sB2JKRK0lkysNkGgT/aXOm9iJxEs+oSZ9rklQ5EHVmlEeFjZaeVTpJtWmoWDnat+TLZoMkRFROgQPnJ2apLIEjLSV57UtVRXKn3VNXNE2MZ8sOsE8ytcDIljkzrx85BOT2aIyNWY5n3z9WDswkKOnZqwErllSlJNm8BSyQymperB0ufYSf5ZeDr+er47dnrlKK20yyvXAjONdxXLlameTMeWKlf4iMrGZFq+Oz5weIa16KseLg6eXN3y+uKxxJXzMAvWQwgbzwcHF09mjZg1jk2eDxxmpCtkv21DPd2QqeLPq0V07d8f9XJKW7RttXXisYpPO+bC8jBj83beUyGnk4dAYoSI69HptUXv4DFOj63i/+9gv7ZOiEaHvsLdOyXLKyewXdrCH8jVdQH4kNDiswaH5e5YczC/eAKfa8yHLcRxWS+Qc+rEoozAnUr3kGjki+H8KPht1AgKkdWWspCYdQ+JGf8KDAOrPJYPiu8nQN5YyrIPNOXH3MEzOP9gqCQwnbUTp6K21mBvcKQEHf2NNBRRu2xd9+DJM03PEX7yjPhwNIC9tS0oeUtx2HsLqUo61ZEv0zaTPWbqwZcZsHPN4pJbejF0NmULpiXqoTGeYMV10s6G9cDi1DAxaUtDObVsER9YPGtCvAuWTBvPIlf7+mNiibPTx8yzkj+1fGjVTsSkZvrAYRZTlbhuyFSxY1RwWhLpdhPCbcYH0hltkxmDuPpjiknSZCKQ3yFKsd2Tv5en8BFs1vuuIBTDob2x3TdkPc81O8rWjEOsHGv9CJickWZ9rOzXptEKMr7n4jn2cv0zarMuROOFmLg1M30zPEcc16wTE5TI4NnOyoZ4svqYWGLLtbM0ndvlhlOMEuVDYqr0pPiQspNLj/mQapMZmWOtP8YOSeqMQH6HSKmOsN2rtGJ06F/3e1xM3SPbfY31vBq9CTNqV+mNUGfZml0Jrj5qsPYgyDTuFmt/Ni72a8uyKAO0lac8VKzZ21CSrOP6iW0cLauWCVR14GJWSqgfZDNxM/WQtLNuRvJKw3hJ4mnHda6d2ZgZL6t6Mlcg15ZSQEBmmRY4aIhnoKR7ycbTTXHPWH1MLHHlOteDa6I6o3vqbAfOkcISJyzwzxA5B/I6lzJ9cGTETlrWbUxM8jrjg1c23L4E7OTqz8gUtnuDxOR/87N4eu3QS1ojVP4dD78Xha5OX1vXXw6PTQKl09qh16fDK15BVirNIaulLM7ceEoUzQHbc872/DBNGS+W89GLOzu1NQt2enh9T0C/moe2dJZrNIp59cKeuj7P1nLdjj+P7Z8HbFCXaJ7bmmOndQOouxTL2KmL4/qS4BqOmD7PfrB019YMeD4UtpF9OKo13MGW23zsOnAx8/VhWQtru9zaoafPCA9+e3JLwDAzY6e9ZsgXy6XpdQuhePHscHDx09y4jtvp4+Ce52Pm3kvOvcJg5uPkn9v2VDJdm2vrUVJx7StR5zyeefVHgj25diwxdtp+u7HryaP7pYx5Hhe1Fqhoe0L3WRCWEDYNfWAxQ7m2j27dWveC45+2kMot2g1EyMZaOQ83ywcbF7d9qfRpvNAuq1z8vtXlzD1oFylS5GvCEBAuM4xw+fAI0Ftpz+GVkMbyMF1TKr3hMoCVxk/612TmjVE75XjSaMX2vLOOkN6i2p4/l/v7xsSoGDoqBDpOmY3KLJE7CQjo1/NnYO7zljSWk1AhYoMg0BWBpRVYO9mEOes18WU4lPu7K65SfioQkBGiqahGcUIQEAQEAUFAEBAEuiAgI0Rd0JOygoAgIAgIAoKAIDAVCEiHaCqqUZwQBAQBQUAQEAQEgS4ISIeoC3qTWLbY6r8ZTYHlQG45S8S1H94UH26KnddeoWKAIDBBCEz7fTvt/jUIpQYdIr0j9T6y1r+/9CR6rPZvPv2sMnBpVa7MI9qgseDvwbcmwrshe6LtXUjLBYWGz4veLPH5gLzyE3PaxVab5we5d1r3mtqA0MVOTk9bH+z8k1zHnJ1cGofVqOqA0xlLy/UhJi90Pdff3HK2DX3IsOV1OZ4kW3w/+rCNiyUuzbdl0s9tX0bdXo8TC9uvyWqTEx0i6gwdA/y5Ag9u+4Bdwvt3AI+RtoOoO1ZXH8Psx1PQfSYuzZfT7bwx2/3Si2IjskNAXiQ4VJuSNdnuvZt9Yy+tWJ5dqojSBsMObTZls3eo5cqVAibgoLUPxWaeQ6r3CfkEsebs5NImxKekGdPgQ9JJyTAWBLhY4tI6Ghe8bzvK5IpzbR1XLjdtbP6NsI5yfS/KJTpEuWz3t2D29lf4jxkxuvwGX2/P9rJjdVe2ew6vflmztSaHQdkZkaEnpTBDsrBDx2spl+E6LjFeD3GG+bg0ik9/xLK6dj1PRnZcu7YxvsddRMonHFk92oWHJn4f7iKroPnkyfSxtm8V5x5CnXaaW85mgyd7GFuK6QHFJah4Bo398e+qHqs8/jUba8fOqC1k4zrsYtxoW2Zq8VNpqx852LgKIWaLU8bBM2GLg5luu6p46hdr8jRuZx2Hxlc8Hwxkfj2SvOoad992wYy3OtzWKcOqe8+pP8KMuzdj+jr4FxOp4j0vrlP17qSbClR2MDEYtdNLaLZRZB7b/ffjYodrZwvrZhrZXLSza7Era3O2eyPR38WVrhe7l5qtRC35XdiM1c6nRqZRr755hmRVrtx1ljZFtnaVru307AgufHF3K3Z2gi13qHV3ga7t8luIjfvg6VW77dp6QzhTGd53T2p52sUHLSRkD2eLt7t3aUnigHZjVnVe6SPb3TCo0urSctPqkmpxrWLH1Dvne0hWdS0en01khvyja8Yu1KNiyTqvVBdpJs68cs69wdnClbOVecds3ZJMawfjxm0IV87T753G780WMp37litHaVadlFiQUSPA2vNVx4Spd5NINvnXuDTPBzvOSn8qmc3uW8ofq3dPX6nD2Bj+5ts6T6btA4qL35thXe7VyvfqOudflat+5JVz2h6TO6TPpBXfTnwW/rmNqcmIbAx2LDSQ7ami08QIkdd7ck712qIw2z2X5gjJP8liu+fURdihs9mMGWblBjKDjNqc+UyaIQbFG+3GskPn+8AAw9bDPeAZ5iNyiX+Kki6+IPPIGQyOAM4/g8XHFik3sstWXNvM7azvaWOC8Zkr02d1x6H7rbUT+Hxe2GGv/yNiZ2OeX85cp2/OFq6cLcM/TtathbXiuPoMygXOFqUjUs7X75wz7UtKZgzPVDlHv3XC+ZeLNYln7bT0Nz30bbHjLFm3nJKc+ovLY9s6zodCZPDejKtrkBL3j0bRzMjmTG0drlXObntSGqP1zsQ8F4MpfVZ6foeIY7vn0izl7Q+Lob3e2O4bWpDNZhxjVka92TIb2txbtpgPODy5fAZIJWStzWqodJJ8Z2wxDVMzhnnL97MvcPT2M8xvPQP4cgRfzqy0az+0yHIZ37PN7F3mhMVZbt32jgvVUOze5GovF08iRj2Bzblimn8Z4NBeg9i7f7l2cr4n0nLrNio2gVm03M1JMG0kDq40IAq22p6oi6l6Z2K+hxjM7xAphzi2ey4tikYioViMheOCSOqHFYALZRUITRmbE+JDyU3YjEPlgGFWzpZpFAVYl01Sr9+MD56eXtmhPdkjO21YD+qmP9/BAZ8v1lqZiFXFyMAA5uHJ0hOY/zyAz1k/XBH5XS7bzO0NfW+lLlemYnXfhl2zEAnXeWzvhRtPJ85UuQGuVqAPPSxZa4g4W7hynMO5dcvZwulj05rfm5wYB08uI9XJ2Q4g13LxAGS1uZx/uVh7tjS20yvnnHJxllu3jgLvhMPMy9r4lPOhsZBryGi3PS3Uu/XOxDwXgy30UXAzn3y2+6vT18OXL4s1RPjd5zKicm6X5hettTaMI1ZSaG7Rv+adq3lMnCc2628a6yQ5Vjl77pORSfPAdlbLeHXozDGXGT1dpNezk8rdCHZo32HrvL0PCVyi9eCXs9ZPWPbUD2k9RbWmwJ3T92XadZSbVreguuLLtOfYMVfU90pC6IiNz6hM3xbbd9RC6yvKe8XFWmFYpPks5Pa94LLB8/6x5UJOq2upurXxJX+tcxYXK5+zDipqSJHgYeq0BXGZcTw9mz1b7HK6rqx6ivpHYbZY1m2tjhgXbX1uvXt+O20dl4bKonGWqluM1zI+7djtgBnjOyWF2zrOB73GpgyDhPwqmcOM96+S4R/5Mv14jOGpfTBYu/VOOjy5trNMDPrWxc6FywyRl48gIAgIAoIAgwCt69ieh/MPG3CvyEZv+2zPnwsxbAy2XxoznPqaGcDK0BpJjOE0Qdc7TplNkCdiiiAgCAgCgsBoEFhagbWTTZgzWy3g9zIcSmeIQ1sw49CZyDQZIZrIahGjBAFBQBAQBAQBQWCcCMgI0TjRFl2CgCAgCAgCgoAgMJEISIdoIqtFjBIEBAFBQBAQBASBcSIgHaJRo11sFe/sMN5EZ265JrIlT0sE6JVuQwTcsqhkFwQEgfEjMIr2cxQyx4+MaGQQaNAhymS7//kJ3uzvw776ewOG1oyxpUUS/UC1ZLtvIb1dVlpNn8vYW2w0aRYqtu41tbG0i51t9ExaXhvjvHo6Wp+Dg2evYMO8XqNcjOEZuz5puIzCnlH43ldndBS2cRiOWl/3uOas12m5PuSWS1s0vhyj9oGrPy5tfAj8ipoSHaIObPeDK/jX6iqs0t/KHfh2/Al+jgDhxmz3I9DdSCTHIMyxGXPlGimWTBqBjszK+OqsvE0jsTR5CHSM68lzqF+LRtF+9iqTqz8urV+YRJqLQKJDlMl2T+z2d+/Ab0bXrd8Bu0TwvYcekeZOmYPNkz1YxpGVuc0TONmccxmwjd7Adw5TboxBWMui3XG1LYrTpRzlSffyw2zG6XIxH5zriI0xhbeTQKKnoWJLfqtcAD7nUgwXnSkmUz95xdm9w+Uq5unKBPtazPcqd97R0WAP1laWnMJpPJGxw+L4MfWghYT906zt9giWjgO3rGNGecL5nldHpejogaPTM7K174UWTqYxRN//9vRlBE8qUExxtGG0p2KOHc79kIjdbH0cQznjHxkb+zi2VG0BZY/7h4lOOWvnb6WHsYUtpwoH/kvgybRL8bhOtJ+OnS4ucd8TMtEzB1PrfnCuO7EUgKPJJWV/op1Qeex7pIlgyaMQiO3Y6F5vyXZ/dTp8/fJ4+N0I+X6Mu1a/Hp5emQsdv2lHymIX5jZs92rnU3tny9IMjq252DnT2vWZ5FRi/J08S6HFQT3d3rkVK6HYAdXa9VWVrJejy3EfCnXmS+3a6e8Oap+XGbNZgpUtQVw4PIudRg2AVl2yrNklU3SFC+FoxBhv1HfNd7palXPysidcmVgaXcc6NYY19U8xhltxReWMDNZGL9HzPa+OPJneaTwGc33n4ppiSd8b6r6x4o2NF1Xf9j0Vqy/POf/UwZPzj9Ly9HWro5Bfni3KB9s2y8maf3Y+W3bqno6Vs3TVDkm+da84dcbpS7XJpMi23SjmcPHSouXrbWj8fjB6i28Ha5MWspNLI1wS7QRX30a0fAcRSFB3mDKhDlFB61Fwcnw/RpqO16dD0+dxqDuOT4enr3vuEKkfi6qxNJbGv/2At3KqADIdE/Nd3eAU8PHfJi6gSUc8Pbo1uzItVI7xQamy6Q/ID/vmDcnDQgnflSmR/6K4sDJ9O6xzrhylUSXg9xr+QNKh0xl2tuT3fVfguFQKEZ/cy5ZtbgKexdL869Y55x/JLzt9nm813d4Fxve8OvLkO6fkT3VvOEk1TJr6zsnUPwDqwcHpDKFmDk8LS22jZYtrdP0siqcvwzrvoK9bHVk2GE9qtlA8WW1YzL9aOUv2SLC25CvbrR97Th/mdfwxfjvfvmxVqHpQKfKWcjjfS7kBmSrmY/dDobN86G3bLoX0uX44bWBppxzkIpCYMmOG0RKM9rfuP9Xrh2gN0aNZuPoxC7O3GHmNkoqhy2y2+9Ey5TZyoXOmmA84/DxJ7PO5zMNcuSgbdQffO9dHSwGcf7Sz7R6RlR7B4OwZPHEWccf0dPCdsyWmTl2PxSBbCJBbzyIHJZLQD9ZCdU7mIuzs4FjCyWc491WwMv3MTc474NlEfNs8k+Rf77aEwLBIfceiL2RD22ux2B1RLGW1E219+jXz53eIFF5NGO1pYfY7uHrwz2pNUTbWxWIz7Na3Z7sfJVOusM87VZrLPMyVa8FG7TIkO5a1PJmD+cU9GGg69UDZlvXO+aek6xgdrA8AtirOqIDi6KXGvidtialg7qNYEbrO6msg88kLGB4Crhu01k9wMsfNst6TPgdCzj8no3fSghHdiRfOB84WrpxnGntqM6Jz+lghTCKHS7YPDWK3MMnBmjEznZRoJ4p1Ug93L9KiJIeLAD+0lMt275brk+me7C3XjtCwqj+MzjpEQ5BmSgy/7Xkwf4jWklsOq0Zkq7UNRm4p09NF6ZZM48dNZp9ncYni6Q8De+fRcsXUSYEv6bbxVOdFHbgMyel6iFSrvkxD6V69mfzxememKqP+FVJVul3eaIt/x31PTC2kbImq9DB1Yt62vWndkqKYTG9avJjuKVUyPtj10x/Lety/LvpKf3zMo/55ePntS4ETtvY4de5O6XDxwvoQtUW3yVoXTc159e77VJ77PtjYYiZGH/kQxsyX6bYTalq6aCd8XOK+J2RGY1fffwaX5u1SSp/BxsPLxzUMUJlLDuoICJeZ2z+UM0GghgC9KTIuVm96i+o5vBLSzFotyIXpQwCnlG4gI/ok1APfTtDSEto77VzakZaV1XHKrKU2yS4I3EAEll6cw7OD5zDKEWj9OjluI/F5SxqxGxgjYrIgMA4Eku0E7ps2MyOdody6kBGiXOSknCAgCAgCgoAgIAhMDQIyQjQ1VSmOCAKCgCAgCAgCgkAuAtIhykVOygkCgoAgIAgIAoLA1CAgHaKpqcqOjhSvalq7zncU+AsUF8zaV7Jg1h6ziSlBi6CtbQ8mxi4xRBDoB4EGHSKG7Z5jtOfSOttOq+iLGxMXkY18v4WiEdecSMj5VfYabI6bggusTCMn/fSCX4bkPdzFVPPR+VRRWhTnyNA8OfoSNUgV5xjZ42U1Aif428akbeMqDfIEV2wH07iY4NKaqLTL2/duk7KTnMf2q+191NQv/35bghe0F5TTdjWVJfkEgclHINEhSrDdRxntL+H94CPMPrbY7gfv4XIEeIye7R4bhbkDeHZOO+sWfy8M2afNSrwGyCYBwzKNGiwkoV04rMo5O/PmglHoIV3nO3C23BOJX69MzpxvNmZcvhuQNjbMbgAWTU0MYsbFBJfWQClt9mffg+X92aDsRGfpiEuub0sv4HBhE/6OblaaK1jKCQLXj0CiQ8Sw3XOM9pR2+wH8s6C7//n9G/yAr/Cthx6Rfu0wj+0+i3n44guc5dQTNcSAVAWjbIDvPYFniyfwucZnEDDYG+WqRtUST5peORqV0mX102OMtT4L64DZ5pKWR+zbe7hbcWA0zrOz0cgZjS6u4x/Jw6feXdxvyB51i/vAYcbjYvwJfns+VHVEuUlu4Td+2/5Fmb+VPHv0QNtdlc2QGTRcX6R707WZyNPNNQ4zRmjHJHpgWpyfq0vxsK4woRFZjn0+zmzO1VHdgOoKry9eR5WEwBHrXxVHdrwrKU45n+1e61laWYO9bXuEO6BfLgkCNxCBRIeI8ejWLNz++q0a9bk8hY8/dP6fV1cAs7NA1GWX7/dh8O0OPLjLyGqRdG/jgxoZwR2qFS8SktvBDo7eNOl3LL2wRnnU6Ir9YxExAp9oX+0AbM7pH81qmiuSv7isRq4W/gCiozJ7R8zMWKM5J5swV/7AUQePlxdMvXgLBydrsGIGrIKZ6CL+GD13R7k+bBiiLO5JExtje3QMt4fF3b2tfXL2YBP3zVEjZ4gnHLwtpwGzsI7aD6DlHcIa/lMjcc5onGdni5Gzkz1kyUBOiDWsj4P5c8DdauHsi67luA8cZuREHJe4i1wdUWdiACtmhFJxWNixewKb2wCvivTyCV51mC16EYoX7KT/peIlU2bcAWTnWEC6Meqd0494Zd/CHxRrKcwYwRlJ5p6bwxvrZHNOdXSr+y8VLxE8yTPsNC+DNepbNjwpPDknYvpyZfL+xePaK0f3Rchs4tIK8cqF8so1QeAGIdChQ3Qf/nxwBe/292Gf/r7NwoPblee3ZwE5zPbhP7MrsPr0PuBpvx/V2bgAfABs/lGbVhVPR0QQ27Ck6oThj835swPdibEfJxkZ5slUlz8H/K2tPg5xoZdW5QocWSMkqrPyApL9IfwxevJMd+r8J/iAghaXsHNifhAU95BFvpmJdQvlVdajAeytbVVEodiJ3VprOHK2tlLgt4b0YaaTWIjO9oHBpbLaO2LqSHV8rXqfoSd3q6ODktYs7jP6wdPVomUevNUdvIu3BwDPnqhOOmTL9My2T4kPis5xVBUWzxQH3PlngNAAjV1sFMflPYs3neY9pIehgky2QbyE8UTS3T18ANM9StfsBni6BdyzoL5cmSn/YnHtl3NN9M7c+PMS5VQQuJEI5HeI0N0Yo/0tHB368REJXf+1Ck/v0zjRT6BBo+4femLCDk0W2z0+/eSywReG60YWn5r2tpO7FqunZWvEJN93v9NnjZCYBr6BcPMD8QqJIWiY3F+4HRZBJIL49EqjY1RmGaoOULhAcbU71qz4sSSO3we2jpwOtPXjnsDi3sYWLKg4vIC3Bwtupy9TJqvy7Ascvf0M81vYA/9y1O6BhRU8KYkxZnO0bxR49i6zr7hmcJiUqhI7BIGWCHTqEFW6PEb73+7AXbgNs9QXog9Np0G1pkhfzPm/GHbHqZv2bPeuvmzm4aZritSw8iY8b8v34LAuo83qKbHJtJjrX+xM/ejilNIi/nAlp/9wPcH2mZ6a1AvKm4xG1TVnY10XhVcCT6Yci3VQRvuL/frA66/VUSfmb+zULhzA2yOcLlswo2Gov5PMiP3FKOEA5uHJ0hOY/zyAzzCBP5zZ8cIwm48Mz4wFzC38c+LaaXvo4TO8hohGAM8W56G2MqsYeWo4gB4JIrksCFwjAnW+V/uKy1r/8uXL4cuXx8PvKoubVmO0vzodvlb57TK27PxjYiVWRL7EhhxhIg9J51ieQ/nVNYc12meOLhjYS/ZkTHcYhn3W4oJ1uma3llMWdXTaTNUkL8ZwHPUAEyJ2aAdRJvll/VmY2pjpPMYe3xb33C7XnOWZ80Gn2YzUDtZRzBiZVEaBXtlO8rGzrZFBRm2DS3MfKllas38es4fyVfp8Ju485u9CV4FNGV/GhCw2cVM49F3cD4UiFQNlLPn+oa+d00I2uNfs+nRSmHghu2tYlYU9P+yMDJ5l8cABqy8q07ODYqfEE5Uk/AvHdTPW+qi9sTgL+CyXBIFJREC4zLBlkE8EAXri256H8w8bet0JZqNFpeNifo9YJZcFAUHguhAItAnXZYroFQT6RkA6RH0jOlXycL2BWsBrOYVvmVV7LVnX5VAQEASmHAFqD+htx7yp8ykHR9ybAgSkQzQFlSguCAKCgCAgCAgCgkA3BHpaVN3NCCktCAgCgoAgIAgIAoLAdSIgHaLrRF90CwKCgCAgCAgCgsBEICAdoomoBjFCEBAEBAFBQBAQBK4TgX+kldMeQwNFy3EXyVofFfxkqhwx2iOJ6w91chserDwFtQ+jToyXSyuVHIKAICAICAKCgCAgCIwNgcQIUS7bPVdubL6JIkFAEBAEBAFBQBAQBBohkOgQZbLdI63r/af2aFEjWySTICAICAKCgCAgCAgC14JAokPE2MSw3TOlJEkQEAQEAUFAEBAEBIGJQ6DBGqKIzbeI7f4NDJDpXn3uPkC2+14YXCMK5bIgIAgIAoKAICAICAKjQSC/Q4T2KLb7+8awS3i/Pwt3DKGruSzfgoAgIAgIAoKAICAITDgC+VNmjmMe272TJieCgCAgCAgCgoAgIAhMNgIJ6o7qlfvKjbvwePUR/AZumvtKvpumy5pylSTn6L//G+B//9e5JCeCgCAgCAgCU47Av/8N8O7dlDsp7t0EBBIdojG6MDMzRmWiShAQBAQBQWBiEBgOJ8YUMeTXRaDTGqKRwCY3xkhgFaGCgCAgCEwcAvIgPHFV8isb1NMaol8ZQvFdEBAEBAFBQBAQBG46AtIhuuk1KPYLAoKAICAICAKCQGcEpEPUGUIRIAgIAoKAICAICAI3HQHpEN30GhT7uyNwsQsPcS3D+lF3USIhgYBgnQBIkgUBQeC6EGjQIaJX6PdhH3ekfn/pmUls93id0vb338Cnn1a6nfbmE76kL5/RI3AE6zPrcB2/6xe7D+Hh7kVDF7vb2VzfBew+fAiNTYt40FxfRMAEXO7HB67uCOsZmMHO5cyI4rAfHyagMkZuAldPI1cuCgSBG4lA4i0z6gwdA/y5Ag+OB+ASc+DO1IMr+NfqKu5JhB/qAB1/gt+f3kdqVyx3XKVdvt+H40+/w9P7so31jYySpNFH8PfmAmwN7yVz9pOhZ333NuDDcIMxrWd9jKbRJY3Dh3uw8WEIG9glX58ZhF1JYh0upq+OwwdOv6QJAoLANCOQGCFiWOsvv8HXu3d0Z4gQuvU73IFv8F0NBVE52rxRf27N3oYfVz2OERXD7vpJdMYbmaDG2DylutMgR+s4UnCkp0dU2Ye7oMY0lDx7ZEU/6VZTKBkyC9+5r6P1ys6ZShkWaa9Py1qGPfy3bPx3ZHKWdEu72N2Gs52/YMkRE/ahiZ1xXLSCuj7StQ67OEoVjonKMBphmJkxI0bNRjTq+lCeF4M+1FEfvHLuqFoYM7I+P3a173UfOMx0WjXS6J8DfGmAtdZs/k9jHcWsEFH3ARPGjmdGHRkImO+47+31aVk5bYGu5/h9FLHlaB0eruMftTvYpu4W7Zp/TzDuS5IgMBEIJDpEjI0t2O5/Xv2Au3dM94iR2SgJG9bnB/DsfAhD3LOI/j5smJEJanQHsFJcHw4PAZbtjs4JbG4DvCrSDxc24W9q9e89gWeLZ/DFzPhcvIUD2IG/1C98psyEL9RoLcNh6cPwhelO5OlbekFYHMIa/js0/pcyGWO8HxSno8gUq5Iu4O0BwLMnpg4oJe5Dys44LkZjSB+l7cHm560Cz0NY2HxemyajztDcwTM4H34AHTJ6REPjZuT73yF9+MMwZ8Xg+Q6cLZtOFnVemLoda+waX0I+UFoaMyPB/c4px2Mdx8xoDvmAcTZWPONxra2MtC/Ghch33Pc8fal7LGJGcTlWt7wtJ3uAI8TY/pxswsH8OZzvLMJZ2aDyGiVVEJgYBLBD0eBzNTx9/XJ4/N3NenX6evjy5Uv9d3yKeV4PT68CeV6fDr3LbiY6A/wto78GH7zZaFvT4eLOuZv7fGe4iNcprfpbHJpsh2swXMPeQuhDMo08+3jYUWZlx9qwUn04XIPKLseeDvrwhx3l2nocyaM5OVwbgg9qwoe4nQwuxvqQvprf50Nsj4u61seqHhZ3hl7EFFIZ3EL6Ateq2OJ9GGvsZmPm42Gf28ekwMa6VMjEoV+eytC1yP1QigzEGaaNFc9EXFcxYIyuvo2duj2w71HG9w764vdYZVP9yK8bq245W8r7oSrvtKF1RdUVavPpTz6CwAQgkD9ChHe2YrvHNUSr9PdoFq5+zMKstUzo56c3MPh2B1bUuiIs0NPn3sYHuoPgFTzXUyT22OziDo4AVKNHw3I0gFd+b2MLFg7e4tgGPYniephy1AnLZcvUdpKtw+ELb0ppAf6wB1Vs8zL12SIaH3caIcKnxu0z2NFDaa7KbB8YXGjkKabP1Y5nizA/Zy4uws7OGsDJZzg3lxp9t9FnC4z7MPbYzcbM9id1bGOdyhtLj2OmRhwj9T52PDPj2tg50W1BsGqsus30PShWLgoCE4hApw5R5Q8tvn4HVw/+Wa4bGlVnqNKJM13UMcLpisWzL9js4+feH7CAQ7ZqGszO2Oh4CVYWDuDtEU6XLaxUnZdOMmOKUdfaHmyHXn3qrM+a+oupt6+rRa52BxKPP2xArK9mFwU1tfgMnNkyytDIh5CdDC4kN6aP0uzP0d+weeL9wD55AWoGtc3bTzF9c/OwuLddTclhp3J7z/xwJHwo7BxL7JKumA82XnRcw6yqn6N1Wo8S+dTKRfKxlxOYNfBhLHg2imvW0UAi43tnfVUd1hTjuh+aHrefJet5rPuosy016XJBEJg8BPhRKj1VVk6Lqemx46GeOXPT3Om078NjM5VWfptyEY2Nh05pWDY8JaYk+0O71jQJN6StytLQL8r2Z4Bq02ZtZEbc1UPalh+20g4+OEPztsyoHfkJLJ6MD6QxbqdXv5YPcX1eGWfakIb9rekYp479clgfTeu2kEPxgqNR5bSsRtOTW/rgXffLMZjFfS/qz/GruIZf8XK+LfY0jls/izs71hQYV85Ps/Hk0sheL73ErI0PXj2MAM+paQuC8eLVgXMfYRXF8CRZqr6ovI4jmTKjmJbPTUNg8tjuaUZZPpOPAE21PccF6k1Hk7p6xOqjt19oMb0/LdlBKauvg9xxFmV9GAFmo/CN9WEUCn9lmdcQEzhKpT7S7v/KgTcxvv9jYiwRQ24WAjTV9mGMJk+7vlFAOW7MxIdRICAyBQFBYEwIyAjRmIAWNYKAICAICAIeAjJC5AEip9eJQE+Lqq/TBdEtCAgCgoAgIAgIAoJANwSkQ9QNPyktCAgCgoAgIAgIAlOAgHSIpqASxYUGCNDi3NRrxg3E/FJZBLNfqrrFWUHgV0fgv2Zm/n8Cgxy2+6rM/v4+7O+/gU89UpklDL4BybQNfkX1cAMMVia2YxqnN1Zs2pT2XjbX1w+ezfW192VcJSbbh3HGxLgQ76qnn9jtaoWUFwQEAQD1lhl1iobD/xfAgzo2xxls90Tuugr3jcTL97B/egn3H/XFZ2YEy/f4EBg303jP+tQGlMJo3ypekpi1ktZD5p5jogeLRIQgIAhMDwLllFl4pCiX7d4F6OfVFdy2OT3c5PZnxVB+mNmcnkIrFnl7J9Z8xvAMmS28oqf6ioGdCkb0Kb/tURd6ukzsNtvCDi5rkGk8YieRVc7M8GzbOk9RT3YlFUbU9enRhTgTd2W9i6fGSMeKjV2Vn47q+tRFzeBdxJNvZtSHscen9qXuA49Z9H4gug+MqyBmiRh0MLGmKNMxEYl57Zr6v+5fvY4eOru/x2VGfU/4F7030ZSoTMuH1KEbu5Q74kPSzpgmPiai+oTRPgaoXJ8iBMoOEfkU7hRFvE2y3V/CezVdtq/4zP68b5GcRUQ2u4yN9RQwXBtfqQF0Gdjpx4g2GTR0GocAy8UP+b0n8GxxDwZHRWmiNFg4hCSpvfcDrX7oHu5quhNjCPsdYRqP2Jli26Yfx2U4VHx0uJMpDGsOhPSRgTEm7sr4Op48y7ouGdKHPxxTz2gfY2dnMFMxaFFCKFqNHTB0drrui9hFWp2zInb5mGBivqzaUB1JW9C6LVB4xu4jvh6E0b4MRjmYXgT+B7eGrv7CW23ns90red+Phy9TjPeNqTsqWgHDTl/a7G8t79EqxGkMtEwjz9l2vqNMjBvaehv/bGoEhoE9oQ+5GEp2+cM1j6qgBKLnA0tnKTllZ42B3pSk7f0Tdof01eRZTNwF47rC2aLeMBr1d0Ur4F7Hs5C+wLUqfngfDC2JiadSXwKzSn5ZojywY9I+LjME7NV0GPW4M6wYnD4tN4yZrd8+VmXIjjLm/bgPy6tRQnj3bSnXGF46LW2BpsygEE7cUyVmfh1Y9xEXn2V8VeVrdV/qaHGAdY0B06KAZBUERoeAM0IUXkeEzVvkk2K7L4v9dgfu/vgG33taWG2Yo2822z3DwM6xSi+twNreAAfSj2BwFiBWLUG3DjqNEOFTY4RpHHm/4LwcyaJRgQ+w0YgV1iNetUzlmM2dbOrEEKrSCYNnvaB1hfHPylU/jPsw9vgcC6N9hcC9jS1YOHiLWmnUZgG2ykrHUbXlM9g5r0Y3kXew2YeNpXgdjR1r1s64q8ZObMrxPvEpZpjY5fTltAVBE637iNMXLCsXBYHpQaDsELXtDLkQ1NnunfTLb/D19h34va9Zs0K4amRuJNt94UCIgT3JKq3ZsQfrA8Bfomas9GpxrPmRKr6bcpDFmMaTdpKP1tRK4TIAw+5NeWL6yvLFQYhlPYSnX84/j+n7JRjtfTCanmMdLhzA2yOasl3BGg1/jtZpHZn/CcREKpZidWSJlrYg0BYIo70VIXIoCDRC4H+Y8SeX0V6z3hvWejeNZbtPTZeRBY2HTmnI1kxD0bc3VOwP+1pTKMkpgmK4vzYy30VmEF2OgR0LMPqUOJVuT4UElfRykcUsYScNqWMI6j8HVK8OrbS4Pq9MbQrSigOnHv1yaE/TmHCmfyz5CllPbumDd30M8ZmHWRsWeRcz7b6eGivdLqKNbDF1vrizU7Kfm2CMxgQTS8398+ooS2bpiPLD94+7N+N2Gu9D3yNsC5z7wOj249NrR2KYkSwFBpXXZWTKzGAq39OCgHCZNeo0TlYmWjj8HF7Bh3KqYkT20VSbMNqPCNyexLJ1RG8U0QJ9f4qmJ93jEMP6Nw4DJltH+7ZgwmIC30RUH3oklo8gcM0ICNv9NVdAG/XqDarNE1yfjW9ovWi0WKeN+HrecbOlT7u+OsLdr4wbs+4Wt5Mw7f61Q6PMPfa2oNQsB4LA9CIgI0TTW7fimSAgCAgCk42AjBBNdv38YtaVi6p/Mb/FXUFAEBAEBAFBQBAQBEoEpENUQiEHgoAgIAgIAoKAIPCrIiAdol+15sVvQUAQEAQEAUFAECgRaLComvYYGsDHHwB3H6+Cw8/68xO8GXwETMLPbXiw8hRchg5T9i48Xn0EQu1a4i4HgoAgIAgIAoKAIDBBCCQ6RLls99rDn5+O4ePsXdyluoXHZpFdiyKSVRAQBAQBQUAQEAQEgS4IJKbMOrDd4+jR8cdZePzoTjP7/v3vZvkklyAgCAgCgsD0ICBt//TU5Q33JDFCxHhn2O5xDk1NhV2eqmm1B6oIjiwdf4RZnGL7DS7hGyOmTHr3rjyUA0FAEBAEBAFBQBAQBMaJQIcO0X3488EbGOzva3vvPoAHt6/UsZ4qewyrsmhonHUpugQBQUAQEAQEAUEgE4H8DhEqVGz3943mS3i/Pwt3bv2E799w0dCPd7D/1aQBfMWT2qLsKlmOBAFBQBAQBAQBQUAQuDYEOnWIKqtp8fU7uHqwglNkt+C3p6tQ9pNwyuz9/je4I2+ZVXDJkSAgCAgCgoAgIAhMFAKJDpF5bb6w+d0+4DhP8Qq9m0ajP09limyiKleMEQQEAUFAEBAEBIFmCEwOl1kzeyWXICAICAKCgCAgCAgCvSPwf2hnEG0546ljAAAAAElFTkSuQmCC" alt="186  188  19E  There may be multiple server- cert and server-key directives,  but each key should correspond to the preceding certificate.  The certificate files will be reloaded when changed allowing for in-place  certificate renewal (they are checked and  a SIGHIJP signal t  o mal n server WI  force  reloaded periodically  reload).  server- cert  server- key  / etc/ /ocserv/ public/ server- cert . pem  / etc/ /ocserv/ pri vat e/ server- key. pem "></p><ol start="6"><li>更改CA证书的路径为我们刚才移动的路径：</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ca-cert = <span class="hljs-regexp">/etc/</span>pki<span class="hljs-regexp">/ocserv/</span>cacerts/ca-cert.pem<br></code></pre></td></tr></table></figure><p>如图所示：</p><p><img src="data:image/png;base64,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" alt="226  228  # The Certificate Authority that will be used to verify  # client certificates (public keys) if certificate authentication  # is set.  etc/ /ocserv/cacerts/ca- cert . pem  ca-cert = / "></p><ol start="7"><li><p>取消如下几个参数的注释（去掉#号就是去掉注释）：</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">ipv4-network<br>ipv4-netmask<br></code></pre></td></tr></table></figure></li></ol><p>如图所示：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkIAAACbCAYAAACOCfTOAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAkKgAwAEAAAAAQAAAJsAAAAAdft2eAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAQABJREFUeAHtfT1PHMn2/uGvmxt/gV1bAlkE+K6jKxz4LiHIsogc2hlOTbAhEeEGOIXIdkg0a1kQ+mcHRroJaxMgBNLafAHjTzD/c+qlu6q66nT1ywwzcMbC010v5+Wp6p7TVdX1zAzxA/IRBAQBQUAQEAQEAUHgBiLw/26gz+KyICAICAKCgCAgCAgCCgEJhKQjCAKCgCAgCAgCgsCNRUACoRvb9OK4IHBNEDh/BQ9nZuDFwTXxJ3TjuvsX+ivngsCYEcgMhH7C13dv4M2bT3DhGvjzK7x7Q+n49+4r/MzNc8u1Oj6HVw9fgLrvHbyAh6/O66VguRm8Wfp/D0FXPYAXM0ZevaQrLEF+Wx/6tteVjTp6/VXh8OXyrhDqTqpTPqXSc5S1qeu2ad/9JcfmqyzD+c7lcTa3aQNO3jTmudj1fZ/oA4/APrrnV+5lQZlKfsyOVNun0mMyctNc+27adZuLUb/lsgKhn18/wtHsXbjr6cbg6OMl/Pb8OTzHv+XZI/j41YZCXJ4npPPJ+elxnoyVHaB14cPhPqzjv311/BlezuVVn4xSc/Dys/WhZ4sO/oSNxX2DEerYWelZgYgbPwIj7C/jdyatce4lfMbr2e+ynO9cXlrNleVE/bsiayb+PuG2rbnP+x0DYKp8uKJ2vmFq6wMhHPX5eDQLy4/uBNDcgvtPHsEvJvXW7G34cWkDIS4vENPw9PzVQxzVmYeNw11YxWh/fuMQDjfmexkWP1Wy9YiL/5BAUb9OpxElPy/lgH5SeOXI9EauzHC3HaHyZHJ5KXV16TUyKaBcWpivk+LlH7woMang4ulbhV23JpN38AJH6Q70VIfC5uErKMf7mHbwZM74o4RcHo4rJtuWrec6VB5rTMhf3T+VD17jAqT6WQrPHJmlBU2O0r6nbFHSWVzSMoGtF7ebrnfvusFiZdrVPDm77efbxvged0+nBrhQn9FyGf9UHXe0QJctu1rKFkp/Acn7EmcnYZ+4T7DXbeBfYSON5r/AP7q34nX+ytxPivwaW9pmp3xIycu5/tw+4dufaoeUtpz0tMxJuW5zvJioMvT6fPpzOfzy1+vhx+9U4vvw4+uP+H/88/2jLVfN5/KqpTNSzraHS0vbwzMsur++NNymg+zP/hBHhIY4IuR8KA2GsG5SHflD1LK95JaP1XdEFYeBTNS4DtZW9xgrkL6sPCs81wa3vNXt6zvbXqLtE4I/p6wVUfetfLA4Bf4p33PyqD3RFtO2pJLOdbNw7UB5KZvr8qxdSpvTN7h6dWCk2ofSU/0skOnhGdoWlK09jdnD4RkI9GzhcOFkcvUCfe7p/rq5LksfqM/aS1UXLfPcqt3yqpKwN/rt513TnO8xWTaNZDp9t/DX5tN3zL8AT2qj4rrhbAl88Oq5Ov3juvtE+roN/FN9yfhLvqp7sbZpCW/kpIe+u3+qmNX5wOusytPlte39/nZYS2I6uba19cz3VV63gSmTfsqOCOkpsWV4ZId9EiHcz6/v4MPlA/h3pByXlxCXl7x4D+ZwrCB3ZqxeKA6j2iHUuXuweHgCZ1Tp/D3smdEn9XQ/Q0/7x3BaDlMwoh2ZMA8LS4dwQkIPBrC7vllOy+HQ9+Z6Rh6jic1i9M29/Kymw/AmgfHHmZkay5wydNddzW/AoTUi1GfT6ZvLM+XWN19i2+rPyo6Z8mDbYQ4ePwXYmLdP0qay+mLyWst05Tc9dvqE289ITArPpipyyrO+c7aMGc/5BVgif85PAZaOYYALA89OABoOXuYgklnGaT/3mq7DM1N6fjHdDnvv9Y3o/P0ewNPH+rqptcXxIeyDCQNy7hPR6za83t17HelaXwM9Cb8OmyNep5DjQ8L9muQEnrXtUCM2ll0nM3kPGfN1G7N9gtOYQOgnfP/2A+CfD3ox9JsP8A/++4ALoz9dlB5RoDP4dgfWntyHW2WyOuLygqKZp2aomH50d1fNFNkh/gC6Q8SZopoUW9oGfEYp188MMwOFio6lK7yBV4zpmIDDs6vHgA9vBhdaezXiD9MO9ib3Fp7pBfHO+DSXh9Ffsm3Zer27Okl48rawuIwCz+NTOHh/AgubGO2eHvT48NNHIzrXNON7WtMKrOFDEAXx6kFrFcoHsnQllTP3chMW997j4+A5vN9b9AOJVrbUKJTs5giMoh2SMifsum2O1pXVYAIhWuejF0LTYujnz5fhLv5bxmM7QsQFOlxee2/NQjgch9WjF/jjqzrFjnmqaC85WVM9MW3An11fzaUFeoeLcI+GOugpd3fLvLGG5ziHvrVrbqhcXtLImoxRyAxUHrxw1gEpfQP9Vh/epF89zMwLZHqnme2gfqTPtnHw4BQ1+59KXg8yfQ3uWe6ooVunPPbwLJK7ySzE0EGm71Q0bguKoNFEF+tMmZV6pCT1UTJPYAAL8HjlMSycDOAEzHWUqjOudPeazvS9Yhpd+8duMN7kXoZB1OIevD/AUetFO7KCGtraUjGuh4Su9x4zwuE81/RgVFsRDa+/UbRDA5lXet22hfiq6uXP3YVrhOj89fC192fXEHF5+RpTJWmuV60RyJzf9uXE5l3DtOBczbU662iKuXhfsn9GMpw64bokNT9u8501AiQkmRfKxPpZtnAytdVt5ubVugDj49L2Nvpbrrdx5+PX9308ubxyTZC2y/s/2Q4hLi6eXB5KbyXTsyp64vpYrB+orPXwceHwJCVxmVH1JjH0PegvSd/12iy8J6m1Y37bhjJdrJWRuN7N9mtXX029pBu0JgLlmEVBCqOiz4cyOX25eUlDMCPUV/Z3VYvBk5VK6+JczIo1Q6E+1wcj0dwr/DVTmJe0hWS6dofnnKW6D8bW8LDXbep+RunK8NIG6uOe/JR/STNNf3HxDMCp6EjK8jPi119puy4dnCfbwZftn5GMoE8UfR5LMjLT95BQ5qivW9+jST+bIQOvKgi73npxmHJmAGvDJk941xsR8U4QEAQCBGjEY2sBzj6X6+LozZ+thTP4POI1M4ElcioI3FgEmKmxG4uJOC4ICAKCwHgQWFmD9cMNmKdXyM3fKuxLEDQe9EWLIKAQkBEh6QiCgCAgCAgCgoAgcGMRkBGhG9v04rggIAgIAoKAICAISCAkfUAQEAQEAUFAEBAEbiwCEghdZdObrecn49VQBgixkwFnQrKmpY0mBC5lRlvM2tbjfB+FTE6f5I0PgWlp22mxcwQtlxkINWWft+UNM/2bd1DwsfbiBO1NYzZRxLcufL6fXhSIkJEhYDbFLBaHIrdYuOFPlm56K2/EG2lm2XFdC6XwTaVPGg5uPxtXPxkzNuaHa2am7TU0aW02zfa4/Q0Xvk/k0+2Y+yfbnClbUumssM6Z/8qRULDP40bT5adkmCdmjYtPb5B9/ld4cp/2l9abMd63hS8+wZsvF3Df7sRo03v4zmaf70FX7yIUq/TL3sX2LrB3O5dwR2q9OzcRaM4/ewWPndeHW9vfu52tLRl/xZvsexRtvfnqS0WqO4iWwB0hkbW+xfXXtl7cCp3aRqatQwER7kx9sm/oaDg9kjcaBCyj/WdNGOIpse3kJU7gybTYOQLo6keEWrHP+5b+vLyE27MhAYdfJvesC/s8x8zLsidzDOWc4cUTW/lq7MSxSisb3Sdm/WSjH2jcpxy3jHaaw5ODxc2bQ5KwJcvrhhmsTA9PZ7dqtXu1xTi0M3zCCM49mTGuMtfazONApvtwyPezhPwxt5FuA8J3F1btyJ3rBJrZP9s2tYttwxko1KmdhcsRD3392zbWbdmcSZ3v19QKXj8sjEnXy8Es3rppmWhFHlM8/oC9xV0nd4mIrfZTJzPRDii3Vd81PpSWaf3FeXCt+KP7fduiwYm3LeYFthTNntEOcUZ7rm2r+mj7BN9/bW/l/xZ28v2zmZ1NcKnYjgm8LbpG8/tLXb+OWeKk8Ts+dmGfd3aX/uvL8JJX1CyXdtY0O202Z583qtTunOUOq/6OtXpnXb0haQO2X88L2snT2b2z2EXVLRTsQqqySJ9Tz/EVtxTFvNJmvdOtPTc7h9pdVL16rs7wmNNny8bstHnmO8AzyHVOfX1qt1Zrs1NKHXoyAzwruzRTjZidYZp77tsSqm93HtipfCjbM93POG2BndG2df1KyPLwTJQpklPyKB13vbVt5tlCdtr+SIJSMgol5qCmXnHthPICW5S+EmstPKzj6o7nqTay/rnFi+N4vXx/C0HOQUwmpTlYR/3TItjryNGibUzJ5NuhXd8N/XLPg37t2TkKW9B72sU72rZkl9N3vOs2aAenz3u7TRe7QTtylE+uz9bJQF/Rx21+6juox9lZ6S8xO1w9sfwG+hxcXKnx45guKknpTht5Mrk+wdWLW+CmsiNC3djnf4FHiqMMecp+u4TBu6/w0wnAOh+2YZ83vDVq4zKXLd0YE2VPrmP77exIKGC8rNJITKSY26Ms1qFp4XkNnmHx8rwkmZw/2YThjjOcnJIZsliXwjocMYzMbaWGduLT+iaSap6clQKj/azMjhxdRRtFzCiSembbrrvGVnbgbGELNxxUjKQBr6Bji8sGX9ja9OAABsj7t/2H0yebioiU1yNZdsTLjmhFClaSavwz18v8xmI2WStSvjtl52FhyfTPunZA21J9t51/zPXXwZYKhEUC07a1162DmeL7OgG6pBVvHpIzYEBk+C+JhLotKXdhaPqgiZ19XA9N9Dm4pB3IyYljDbV9IlEvQyUTCHVnny/0/3IH7v74Bt87R0JmCK8V+zwOnbVlS0+y/RYeRg6mh1WaZbGOeKaTOuAJtEYIbxhE2Lm76gwHd5GZNJTNsDeyGGs9W3HMmeNvo5YOtrpWUFdtvUVYX1+C49O6lfUOG3xLF2AEpK62n+FTKP5QdqHdCfzDILFXmbXtEAe1rX+2XvT6a2lL3EKbOiGEvRjOr+ED0gau7VIP5irG7zf41h4H/cXCMK3fI+kTAEwg1I193sP54hv8c/sO/Np5mVB/7PMpZl7PbjppwPbr1cV53OlhlU6wWHsO8SfZeLpizNqGw733FaZ4KubJ5BjtXZnR45I12pPplFU3ZJdJ3eaZJ+5yXtxmJL67sm0nxALdOGNM48ny1YyU79WSNqXEzaaw322vlbp62AbzJ2uws/MWnu7Nl+uHQmNcNvgwL/ucfqB2Yavdq4yopSFm2XZhwYh/ar1FdueMKHNl1rVDpHpeUolJqg9Wrr+R2MK07ciu2wRCbX8fmtjptm1hRtkWRRJ30EQfJyea19CWkfQJY5g7T8Yfd2Cf73mNEM3Lqmleb/6Qt55y1fywmcf1GbV1XnTqmCqqeVict7RzwC4TMOUnPq4+XdfOHZv5TCuPvkOZKdblpC3hnGt4njDSJkf18Xa6/oV4WrHV73BdgNZhsedkuvPxPqM9b6dbz7czrGfbx7Ha4O0xYjvZ0UODpd/muiT5Z32N1uUSx9ZG2ggXt3JdBWHGrANK9k/OMcxL1VM+h/rAMJSH7VctV1yz3jUW1guvvyC/aLAg3ZPJYcb5zskM81z/SCZdS856Ck5NkVcjM9UOWL9t33X7UaPrbwS2FGtQ7L23aFvlYHmPd9cLqXUrLvaEoXtO3XfJ9MkCaBKo17tYXUF/ce91sXuFK8k7Tt5fQn2+jSTDbQv/mnZ+3wI7seFb4+LZHZykbXHtDrBO9omgXKXNAuXBqXCNYQ8cyYdGEoRVeiTQjlcovY1A49byavJ4cc/RRm0zgLVOU005eq6qzCj8G4XMq8JnivWO5PdB2rZtj2CmxtqKlHoKAWGVnvqOoBeArsLx9hm467mn3jFxQBAQBK4WAfl9uFr8A+0yIhQAIqeCgCAgCAgCgoAgcHMQkBGhm9PW4qkgIAgIAoKAICAIBAhIIBQAIqeCgCAgCAgCgoAgcHMQkEDo5rS1eCoITDYChjqgy9vgk+3glFgn7TAlDZUwU9ovAUw6OTMQsmzyn+DClYU8ZO/eGIb56M7RiXqujFbHtLGi2Z0VV99n8bMoPbSqPrarayq9lXFXWGmcflAblBxQo3e6hg9n9AZkahhFGzTxfRT6M11Xxa5afxNb+y47Tt/Hff0RVin/Uuld8W0jt8m10tU+W7+NnbbupH9fBZ7jxyQrECrY5z37Svb550ilsTx7hOzz/tbR8XqekM4nU80+39n7myTAbKY53EeCgJv2uSG+K/Zr2abgynv3VLfDDblWuE7Sa/vdDDzrA6G27PPJelwL1ufpV5rnYeNQM2PPbxzC4Qaz26wRORrGWxRuhiHVNukV9mB6UrD8Qg6jNuumfrpIM2rHZXL+EWbhqJmXFvjgTk3kMk7rdskYIVK63FE5/cRhdWo/2mFWMFpXnlzjmKlmCHwPcUo2VU29JHtyUM/6XX3a1v2g9ClpSdAHiTU+/+PhXRoTyHT7brp/cn2QLPJ04XVRquOeOtP66rxM6+Nq1umj/Gr/5Hz3rjWj2ktL9gnCDK+pg1fw0Op8+Cq6C3vu9efprdiSbgfOP4tmss/bApHvVBvl6IuIy0iKtx9VTNmihAZtZO8TXexk9XGeJGzBixZH6W3fdO+xyjs1G5L8XQlk0u+Z9ZEzRd+3rE73muZrTVpuTSBEoz5HMLv8CH6psfzn5Q+4e8eWyq9XI7aSXWzFbjhHkH1e8VbV7fOyskMcPzSagMRsiu8Hz71Ku7BBBKCUh1QLx1v2hkOdizZto/paBqzaToZ5z/bgKfFmmfzPL+eMzVy9iltBgm8LFBQUaZmcf3P3FuFQsX7qm7z9cV28R7Zi2rzjA/m+6gY0yIezBfDW+Le/uAF/WgHWUwy05veewlkO2eDcY3i65GytTkR6sA2W41L7YfBUtlisA4iyT9OYqRtHsv04BVy7Uz2//cq+VIc1pzOVF8hsMGJGN+JV2C/6bnk9BDIrfcL3z/ZPrg+S9em2rXvqjOtLIWLT0/psidR3Sl+6L3G+T9L1x9uSbgfOP42ij1nZ51MY6/RUG9Xr4+XGc9PtR+VTtnD3iS52pvXFrdep3L0n3X66rt9G9rqt/Abglte46zSUv2Upe3g8U7UmMZ0NhNqyz+fW6wRIG/Z5VmGCuZZlvO3Gnpw2p40taWlAfDGUfX6K5JbHMMBA5uwEYGEe02rZhdOM0wCaNFAFQZ9fIo99zqeGSZ12XLVPv0SumyOSK9O2/TiZ6Onjp6AIE+NPTYn2y8CaVRvLDGXGykTT+mfijqpxE1u3bQJPV3bsuG99bF+KGWDSJun642xhXKjPGncb1VtUKVHXfsn+Une9VzTlJST1cdW72NKyjVLm1OGZqjeB6Uwg1JZ9Pq9eOywoAsVhuFbs8+00qloM4+3Y2ZMZW1gPj0/h4P0JLGziL/jpAZwes6UzM3E0bhufHg5P4CyzBhVLM6njSMTqsWamN6NvvawHYjBj24/xqW09RuQVZI2TiXtEbZtEbUT6mL6UNIUyJuj6G40trPeJzBG1UUKbSk62H29L/9c7r49zoX9biIxWP9Sqh1BiFPJmSxhrkngydSYwiwmE2rLP19drj4MZ+sOhOyTBxCF9nOpSDbGD3Ny5H2daJqdKJuOt6pw4hbCEN7xzkptZL8eEokyWzIh/qt4JDGABHq88hoWTAZyA+RHsyi78eAewGWA1+jZeYXlwkMeknmKqDoSZ09Jvr14WZhScfVZTokX7xZVUUhvVq8U64UNFq5OgZA5wgpM+9KCQu0ZolEzcpR+Opd6h10ZezmhOetGX1Zcivk/S9cfZkgV9xL+sevWF4m3Uo76s9tN2xm3h7hPd7Ezp41BrdO/hBOH6oK3jbVzaYJd4ZP6eNsCTUz8ReQEJK3PahH3eFRPWc/PaHRNrrSINJibakLW9RmT/jLcua2/AXp5kyuWMrGHRrZEZ989nqVasxy5uSXZhDDWTbOkBi7yR4ZI5c15aRuOwvLLNsDXzTNU+Y7jrt18PrUhiFrI1B+2XdICrV9N+DNZpH0J9ad/X90P9SScwI5DrNkbSzlB+eJ5iuNZ9CW96isnab6PADo/9OpQfnqf9S/eldB2NSRv2ay3TbcOS3XuSrj/OFq4dOP/CNgnP03jXtVEcz7S8Sp/2+hLWS94LmvTP6n2iuZ2cvib+ubZw7Re2iX/utoO+Rq1cTiaPJ+fFpOUJ19hEhKNihCAgCAgCgoAgcAUI0FqlrQU4c9Z50osUWwtnGQumr8DeEaiUQGgEoIpIQUAQEAQEAUFgOhDA9UozwZQ6vjVWvkU6HV50sVICoS7oSV1BQBAQBAQBQUAQmGoEmMXSU+2XGC8ICAKCgCAgCAgCgkAtAhII1UIkBQQBQUAQEAQEAUHguiIggdB1bdlJ98ts6V7SLEy6wQ3tu+7+NYRDigsC1x8B2r7C3ZV/Aj2W+1K0UTIDoQSLfJJ93pY3zPTEUP/pImpAu0TqcIZ6AVe8x3f3bSdZ16LFYylqBy6vi84+6qZsS6Xn6OxSN0e+W8ZsmKl2lg7x5/JcGXKcRmAcbZnSkUpPW5uf4/YN3HC1Nrp2y096P+sbN873fMTjJV3ZOe0QlzKtqQcv5mHv6VsoWJaUI6n2S6XneN+lbo78m1fmXzkuFyzyP9zSxCd2Cb8h8zwxjF18eoPs87/Ck/u3TKHb8GDtCRSnbtUej4V9vkcwxylKMSS/DDTqDTNfKtLUQYO8oOgknEb9mwTDrqENB3/CxiK+5fI5d1vVa9TPGjcn53tjYX6Fxu3gV5/qM3wgV7x9fhQ0eS7JfSnaJvUjQkkWedpBuiRjvTV7G35c/owq6TNRsyw3Z58nG1i2XzNkqHmuglcJmTyeHZoi9wQzryczYPrl8hJgat/I7l3c5dnoDJ6MU+zQKVxyZMbMactwHZPVR1qrNqKRxhf4R1gi4/cr3FeD+oaFNIWZ3t3Ztnk42qCf5JIM0ElnwydA97xGpteXgn6tAk5ra+kbmcFjFjc0p7+k+qAifrT91sE5rslPpYehJUWc56a7GFF6eO6W7e/Y6xe2s5B4rx1crNPtV4cn20ZJfR18rZEZb4cafTUyc/H0ZwUI04b9WtnhXq96dMttQs6Tg8EurK/5gXhd+5G81PXg+e1cDzky43a6o3Wun6Z00A4+nnGJ1yqV3+Hxcvjlr9fDj9+pFL9D9PePthyV1fVev3491H9/Db9cUnpPH9od1OyMjOzzw23cG7zxR+0waneQpd0zXTnurptcntkd1NmlmXbo1Bv00g6uVj5Z58oMdmX2jOfyvIKRE1eHm03puKOv3TnYwc8tpY49XCglJbNSs0ygXYmVrrIu7bxq1euCZV5Z0R61zbP1/W+1a2rTNlI7K1P7kS0wREoX3JR2SX370vGsghmViPmgZWW1g6cklOWeczIpL9Wvuf7J9WvPsMiJa5ubzdnJ2+JKcY+93Xypf6s/629oR3hOkmJpVgOXZ8v436qf+Z3cFCBZ1i5MUv3FnlMed22m7Uj3a06ftTkt15bwv9My+XbwpfhnaZlULo0nd4/k+1Ias0Amd4/0nSBLsQ3de71bIJVH6Vy7OzIq95eUTKdO8jBWN/A9Wff6ZrAjQrks8j+/voMPlw/g3zRHpj4B39jyLBwNPkGfq4SgDfs87aBpnxRcZnOOwZvLM96ub5bM6ys7Q1B8dSwzL8cgzOUZha2+GObhFC6t9GAl4r+iujG2+7YyO9Zr3kaocH3NcNitw2Y45N0aM6YdWvuYkMn1XbZ/akOimLW2kSom7MywJaZWcS0hPxL+EBvuQeJK+hys0YjVHEXaAQx2kYT4D39UQGkK2wGnJzaR5PKkYCpO4JJhZrSNavVlCA6LMDJbtwMjk0bwkngCc4/M6EtRzIzMvfeKKRLO3+8BPH2MqaP8MO3e+v7Sxl4GzzbiprAOEwjlschTEDT4dgfWntwHuzqogsMvd+BuJbFNghnea8U+j8Olo2A259xgmHntzeMtPNPBmTMGy+Vx6trljQiXkbBtt/OQrcW0UbreiDBLKxxNTivfR2MKRjIO6eNVBjRd/DNExl1ESF0HgTSe7D2yZV+ae7kJi3vvkbr4HN7vLVYffhzLRns4/vsLi+donZ0I6UwgFIzqPF/GYOYuLOPi6Edm5CcrCEI3f379G/65e0ctqu7mdR/s89oCj+2XY/Dm8jhnMpl5VQd0WesdmVyeUyw4HAULckOZnRmuA5dGdZrZRnXqvb5UV7h1ftkG2fq4vtuT73F3Slvj+UHqyGwp7cjGLDAt/3QF1tZ3YeuVHlHw6ql22IIiC9djbOHoUWVZk1fJPSn9cFOTx531RSSPXSaDp2Ne5R7ZqS+hzsU9eH/wHvYW7Wiwoyx5OA8LS7swOEgVaNh+gZh43+0mM1BRnFbwLHKu+UH+rF+4RojO7Rog+/0RVxLRJ8jTi4zyVdWUpDlpNRXfaB7XzDmbtQQ++7XPmB0yeLtz4GEezTlHlwWQD2pu165dwO9inYqZHza2gLt+wKxJwW4XrHmoAcVku7YWa1Eqc9j+PLGaN0/got1YMrY4c9qsOTTnXJb15+VD3zlccvNYY9Rag8ZtlFjnRGuF6JPGrM4/dy2B3w6cF267+n03lOGfu/XCvpvun9q/JGacoZjn6sztg5wtNeqUPtsublnXjipm2LeKa6yffqbXijhyXQDVmjObZ9cHkbV+e1XPU3jWtBGrz9phvov7kote5DgpU5clvGPtEJFUJrEyCRvH1gLPIN27f6Lo5H23BjOyythTqCot5Y+oXgJHtx/mXg/p+4s2Iy6TMzHEDHEt7A3z3P7Jybw+ecI1ds0DXXFPEBAEBAFBYPQI0BtdN4mxffSIjk+DBELjw1o0CQKCgCAgCFxbBGgN6zOAt1e1YP/aAjtyxyQQGjnEokAQEAQEAUFAEBAEJhUBZrH0pJosdgkCgoAgIAgIAoKAINAPAhII9YOjSBEEBAFBQBAQBASBKURAAqEpbDQxOYGA2Sbe2ZIpUVCSBQFBYKwIyLXZEG7cSyhJ/N1QlBSvRSAzELJs8sHu0En2eaP34hO8IeZ5+nv3FfpjIqNFaYYvBXfgzOdF6btz9S2vrr04fTVcMnWik/mczmSlG5CRwiWV3gWSUbVtyqZx60vZYdNHgSnJdv1EbqqsCDplSyrd+tD2e1Ryc+y5St059nUtw/nH5XXVm1N/BXb2AVaR5zCyM1WOACnTAIGsQKhgn/cEl+zzz3GTxeXZI2SfL0Md2mzxzd+zsIZ5lP+c23nak9vsRNjnLV5ms8nhPhIZ3NCPYlY2FCfXCoJxt+249V1RY1m2dKTpwB1RYKi4ca7Iluuu9tpemyNsuJUd2F/cgD+TGzWOUPcNE10fCOGoz8ejWVh+dCeAhmOfJ3oOrDOC4Kct+3wta2/Avpv1cGgQcRmE/dEpeqqIsyAHYHqnKeZhWyitz5aIfTe3ZVSYsf4F7eDhmcxzn+zrmZWJb07L1U99Tdnga3FB+N028vtS83aItaaXFuDi6yMm+bIPuqMeXjpiEtbzdGSd8Hhy+lJM6jlYJ02rwaUpW3qOLX22O69PY13+RrrnfDsk8aIMD7NV2PUKk9yyLxX9RdVxrzt9Per8mmsT5Xv9ohBKihP6PJuqJ568sF9z/jF5qf6ptTN2ejLtfcfYzOWZIitr67C7JaNC1VbuOYXfG7Il+/zll+Fff30ZfkFGestA/1ef9PPOjtLN2OdpB013Z1/rPaU7u2mqnUmdc1us8m125Cy2IXXl8CzIFVGpBGWLtZnTZwVQGVvepnWxJSaP5Lq+4mk2ZtYm8+35x7Egc3lWZszWwE7aAdZrL9xh1Z6TLcVuq1Zm6jumi8pSekpml3awssO2DfwL2kHtUGv9S7lC6V472IIpH21++B34HvYRt3igz999PNwBuKkdpCiNi7crb7Fzcc71buWGbWDTR9HuKd/DdPecjlO2kK2pD9VzcXBlcn03uDaj15Erq9Sf7p+cvrJ+7ZHXzzj/uDzdH8udmN3+ydkZ4OIZy+W5BeO4uSXkuDsC7IhQe/Z5jNZ+HMHlHTMthjxls0cfwZk56x7OtWGfT2llWZBTlWy6wyAMxDljWKUzWJCthMo3yzyc0FcR4iR0scUR4x12wSzpH8eCzOV5ljU8cfBUPEUnUJCCN5RUFk/IHHs7cAzeaG2yHUpPmh85vrvXAwmq0RdnBW9ugarB9E/FpzQS1nrHd7cvjaLda2FJ2MLVCzFzy7I+6GuzOXM70z9Zfa5hkeNUP+P84/KMimj/ZO3k7llcXujTaHjFQi03+ZwJhDqyz99+AP825KyAdKt37v6Ay3IJUUvMzTBrK/b5liobV3PIFFuxIOMw6+oxIKWVXrdQu+bH0cfZ2soWTmDbPN4/+yP1Fp4BTWG5UzlcXtoaIm88hI15M6S/CrB/lWtBxt4OKQZvvh3SeDbNsf1zXPqa2jem8mNv9xH4xfjQnrk91T/RfkZf2rsr6GeMndw9i8vz/WMw8gvKWUsEmECoA/v8rV/hDnyD70XgcwHf/rkNs7daWllU64N9PhJd98WsTIsvD02n7cSCXDiMD9HhPH2ZB64+J7ly2NmW0WGW8k/dJM62Yen4tPLWBJdX8R3n4beOtwGpUk1guQMrlUJtEyK4cKI6t0NEONt38xi8SWqqHSIa85OY/tlcX0OsWVzyXYiXbGhL53ZP6SvTm+MZ8UxhNsCVOfShh07n3lPrQxvmdqZ/1uqL2B9J8nDh/OPyInKLpEw7uXsWlwfnp3C8tIBjq8HHjHp5S6qCInLaAIH82bUm7PMoldYJOez0fRLQ0xy/WvYQnYvmPfLWB7hrJ1gW5JRMmr/FufjiL1g7oOannfzM9Sdp5mFOX5iHel19LW0hz/vFzMy3G8x4VvBwvYKDZWUtg5vn++7iqdvKyg3n38PzVLvr9DguoYzgvFU7kIy0f5Yx2/fN2h7Udfq8iwvfDj6eVnL1O9AVrFVL63PXXFSlUkoc63jZIrXmmiaZjdnSk7YE7azWKDn3g1btrj1J+e6mV9vP0R3aUgBUPXBlru8HPtX5YPB2uhgqCPtE2JeCfLdynb6q+SqF62ecf1weyXRN81Qn7Qx8Y+9Z9p7kScZLO6E3irVfV87yERCusQZBoxSdQgToyWlrAc4+v4Q5Yz69VSIs0aNoS5yWmBnA2rDPUbdR2CkyBYEpQCBy75oCq6fSxH9NtNX/+Q/A//430SaKcZOPAA3ZwcxGYShNja3QYHOZVORdq4Pffwf48OFauSTOCAI3AwFa64TrGYflA9zN8PtqvJzsESFcLCsfQUAQ6IAAro2SjyAgCAgCgkAagckeEbJ2y83cIiHfgkAeAvIQkYeTlBIEBIEbjwDz1tiNx0YAEAQEAUFAEBAEBIFrjsD0BkJme3J5ffCa91BxTxAQBAQBQUAQGCECmYFQQ/Z5l3V+JOzzo0LE8uK4vDmj0kVv2IxDD9lPfj2EV2OlMbZYRjisPI6dwC43rxHzMqOPIHB3m3Xluuk4neRxm1G95KdGX6qe699M4HuqjqQLAoKAICAIjAyBrECoMfv8L48047xlnl++CzA7C533U3RhGAGb8fmrZ7CxiExdrh45boEABQnPAN6ewfZSWB0DwPkT2LQbHJ49hb1nllQQ6z0r84h5+VlW9MbpIx7Jh/oVequzeJXevplhN1vch8WNP82GcqHd7jmvzy3pH5PvG7C4b/SR7/PjCoZ9S+RMEBAEBAFBQCNQHwi1Yp934cXRpL8v4UHJt+FmtjimHyHLgBz+iOhRliibuHoSd8trOcXUGuY/21hE+oW1BjYx+pQUyre2liMjHKs0/WiHoxJemjeiUMokdTxDcumWCgxGOhpBO4B/hpd2455SNRo5gN31tXJ357nHgOEAvFejVVSv3INmfmEJDk9ymL8YfTga9n4P27UIflxjiBtuF7ZssEW2xXZxdauoY05fpXCZoORvwx9ma+vz93twiPzeg5JCvCwrR4KAICAICAJjQaAmEMIg5uMRzC4/QrYw/vPz8gfcvRMpdfEFjmZ/g/u9DQfRjxA9Ue8nRm52YeNks+DpWtx4pqeE6Ad3qdySHogsD+yPEgZFz+hJvfwR5r11cx19SAkBe+8NJQQFWrS5XDnaAKs6EFvZsfYjMaLNN/xXc/cWzY+/DrLsb+TiPYoqMG1+D55aHjLUd7zqTq8gp9YWDsQYmTSi8qcVYEymIGh+7ylSTiQCFde1IOhS3F/utJJbNvfY28oeKykahnjls5NDWF/rSIih2nkBTnETRWW/N/2l+9LmybzOG6zBMBowxe1rmnp+egygyIIpaJ1R7bAtw49NYZTygoAgIAj0igAbCHVin1dm0mjQP/EAqVc3XGEO67LHfp1mSNZTYvuQ4uLUIyj2h9QdVSK9jj7FO2PYy1lWYtfe4JgCBUpCjhkk2lKjBWcnAAtENqNGUzbLkRacHtxEQlF30CTKkKxUaOJRFQTl/tib6UfcqNwElvidW1fpjPyHMt9uH8OqHSkbLESmz/R01ipyhNnRk4ik/KTDDThZsz7Q9JcJjtXaqRlYhX3l3z4ezXQN9GqswgEnNaJJO1sTlvdqyku2ICAICAKCwGgRYAKhjuzzZDeNBoHLQj9aZ+LSLfs1QJwhmaZODgF28UdQ/TgT0eCu+qG202aKFK8IBhqMGjGsxHFbTSoSjR68P4GFzacApwdAAwndP0uwTcMPhyZQyxE4ihEh1OvhuXMPTixRrbGpGLXqGnRZH7EdyoBKs9Gr4FEFq2Ugu7KDa5pwu+lwFM2K6fqtRvs2VuFkcwif1bzheU9t29UyqS8ICAKCwM1FgAmEOrDPKzzNaNBv9/tdJN2krSrs1zGGZDvVVo4Y0HJpmrJKjRBlmZDFSuxM1VmhZlRpAAvweOUxLJwM4AQMo72aVtoq3/7CQGVrtwz0rIjk9+MdwBlFDPLCUa1EjVGMCHmqaPpwFY63/yjWDNUGQeYtLxukeuJiJ94aJCpwAAMPM7cNzjAoC/Bsqs/aEKu3soY9y5FP/bOYnrUV5VsQEAQEAUFgnAgwgVCdGRfw5egHwI8jGNhX5N98ggtbbWSjQXYBcjly409n6NEcNbqjuFr8EZyVtUXYWMX1QF3Xnlg/k98rsKPW8NgpNfz2pl1W4A9cUrQxb/KLX3a9gHf35B6ShM7h1AmNTy0QMxYNpcDnfbTf1lHrhTLW+rg2rthgyF9o7RbpfqwXos/MzMOGGmwjH23wZfMobd4ZHSGtB/AnVcCprHk7dVbU46yyMmP6MNB9S29nGZxnqFMYzNQ0ndMGbh6nzkypxf3jKlKfcGxRpgiXEIeY5AkCgoAgMGoEpoNrDEdn8j4UJAn7dR5WUupaI4CBpPpkXzvXGg1xThAQBASBJAIdRoSSMiVDEBAEBAFBQBAQBASBqUDgmo0ITQXmYqQgMHoEZERo9BiLBkFAELgWCMiI0LVoRnFCEBAEBAFBQBAQBNogIIFQG9SkjiAgCAgCgoAgIAhcCwSmNxAye9wUL1tdi+YQJwQBQUAQEAQEAUFgnAhkBkK4J9C7N/DGfT2erEQesnf21fl3X+Gna3nAQP/uq5frlpygY/satn3Ve5Sm+RQao9R0Jezz7maM3rYBFmP7Ojt+F9Esl1eD0E3SN1KeuBqcJVsQEAQEgWuGQFYg1Jh9HncT+vQBYNmyzz9fhtmjL+UeQ32AaDb767TpYWCHsM8HgLQ+xYCGZZHHXa4tXxrt2O01IpeXMui66yOOOWGtT7W+pAsCgoAg0AWB+kCoFfv8LZi9/Q/8bUeBLr7BP7dne9ph2h01CEdu9CjLNLPPIxsnPHyBf7ShII6kvDJkoXbQRDPXl6MpNl11AndUBOuHLPa2o2juNJes1eb09U27dZcbWeazyLfVf831CWt9244h9QQBQUAQqEWgJhBqyz6v6Tl+uxzgdBpOqX27A8+f9EW1YSkxrif7PLXY4S7AJnJhrOMOy3tIznm2vQTHp+eqMTVzvaEDUTtX22CQRkUcZnocadF8Vn4fKCgsxsg+X2WR1wSwmtstDMi4PN+X1Nl10yes9amWlnRBQBAQBLojwAZC7dnn9ZqiD7AMz3F6bBk+wJtwDVF32xMSShJNmEb2efJqfc1wb63DpiLndFw1HFYqiMDpEiSkMJ85eIwcrUS/ER8Juhr2eQq8fBZ5G8iaYE5RhthgjsuzfvLf11WfsNbz7S65goAgIAi0RYAJhDqwz//8Dt9+3IXlR78ou355tIYc9Efw5aKtmV3qlSSXU8M+n3QXp/5Wj531Nf6omGV1fwvPkMfLXYRMAsfPPl+MPnEs8oqINOEwlxepcl31CWt9pLElSRAQBASBnhBgAqGu7POXcFm8KPYTLn/chtlbPVmdK2Ya2edzfcNyBy+IeLb6UQERTpstHZ8iPajzGSP7fFZQgqadv9qC3WIEzLE1lRdjdVdlH8L83lM444KulEyjNmrLJOgT1nrTQvIlCAgCgkD/CDCBUJ0yhn3+1n347wOAowG9ck9/9ArZE7jfSyBEC6JpsfB1ZZ/ncF+BtfVyDc3WwjasF8UtLmYhNTHTv40wm4+FfZ5jkfftnD/ZdN4a4/IKRyMH112fsNZHGl2SBAFBQBDoBYFrxjVGP6TCPt9LzxAh040APiyoj7DPT3c7ivWCgCAwcgQ6jAiN3DZRIAgIAoKAICAICAKCwEgRuGYjQiPFSoQLAtODgIwITU9biaWCgCBwpQj860q15yq3N/Xc8lJOEBAEBAFBQBAQBASBDAQme2rs998zXJAigoAgEEVArp8oLJIoCAgCgoCLwGRPjbmWyrEgIAgIAoKAICAICAI9I5A5NUY7RQ/giDZJfP4I9DaJaAmxzw+O4AcZdfsBrLk0Gm4e3IYHa329Pt8zAiJOEBAEBAFBQBAQBG4sAlmBUME+ryIeixXxkF3Cb0ihQYHRxac38PHrr/BEbRaE7PODMk8FTB+/wq9uoGTFyLcgIAgIAoKAICAICAJXhED9GqE27PPENn/3TjlydOtXuAPf4Hux0/QVeStqBQFBQBAQBAQBQUAQcBCoCYRass/fmoXb/3yDC6vo4gtOq9kT+RYEBAFBQBAQBAQBQWAyEGCnxiz7/PNiUVDc6J9f38GHS1wjZMspio13MEB6DfW5+wAe3L6MV5ZUQUAQEAQEAUFAEBAErggB5q0xu0C6atnd5edgiOVx+Q8GPN/u+AulK1VwzdCbb3DHXWhdKSMJgoAgIAgIAoKAICAIjBcBJhAKDakGM3lBkA6ovt1ZMwupQ7lyLggIAoKAICAICAKCwNUgwE6N8SYZ9nl8eX7w5sgUta/X+6NJNIL0xE6b8UIlVxAQBAQBQUAQEAQEgbEh0GBEaGw2iSJBQBAQBAQBQUAQEATGgkDNW2NjsUGUCAKCgCAgCAgCgoAgcCUISCB0JbCLUkFAEBAEBAFBQBCYBAQkEJqEVhAbBAFBQBAQBAQBQeBKEJBA6EpgF6WCgCAgCAgCgoAgMAkISCA0Ca0w6Tacv4KHMzPw4mDSDb3B9o2ijUYh8wY3kbguCAgCk4lAZiBEr8O/gTdvPpW0GWDTKJ3+3sFXl0uM2OdVeiSvMxbn8OrhC1C/ywcv4OGr82yJ568ewszMQ2hQJVu2X5BsnEFd9Gds9QocwItouldoTCeTZMuYXM5W47YjtuVURoPT4EOqD6bSsxuw54LjtIfabRz3qp4hEnGCwJQhkLWPUJx9/hbcf/Ic7luHLz7Bmy8XcF9tOU3s80cwa/cPoqBo8AlmR7Cz9PnpsbUg4/sc3u8twv4+wNb7c3j5ci6jTtsic/Dy8xBeYrj2YmbQVshk1Jt7CZ+HLyfDlnFbcfAnbCzuw/Dzyrg1N9PHtVFbHziZzayT0oKAICAITCwC9SNCGMR8PJqF5Ud3WCd+Xl7C7dlbugyxz99+AP82myj+/P4Nt138B75dsCKyMvWIzjxsHO7CKo62zG8cwuHGfN60zfl72Ftcg5X5BYC991COI+mnvFdqtEiP4uSOMh28sKM++jtnwEDXWYVd/Ec+qFEjryLZU8p1sw5e4BPigZ6qUvUevjJ+8D6k7ORtcUcSglEtNW3ipumypa1pH1INTW0b4u6mpXyAWltSGjHdTP/okbvq9B8F2ksL84yASFYgs/SJbyNQQXO83UmL538BNNNGxrSoDyxmnMwaHwLfCdfS/whWhV/c9QBw6lybhetKXPN+pnF+AenrPS6Tu1bcfmq99NICXFwf0te0laS/SV5lNFvJlVEjHyk5EwQaIjBkP5fDL3+9Hn78ToW+Dz++/oj/ux9Kez18TX9/fRlemqzLL38NX+tKw+8fdd4X/DZJroB2x2fbw6Wl7eEZ1t5fXxpu00HG52x7abi+TwXPhttLbr394TrAEHQmZpfyM8SWRagerA+ViiKVZIdplJlKJ9vc8n65/XW00/iupOC5NruBDxU7fR2F6cVBLD/A0MOM96EQGx7sr5s2KPWVbRYU9nwgfRYHLEd5ti2Dav4p6XH6gZKpz0kvXkrBn1PWF+ScBbg4ObrNnX6m+oCVyWOm2p31qcTMquR9yMGsKrPig9fuAZ5Fe1qLuO+YLipP6Q5mnj4es7S2LjITdha+lvll36U0285oldPPlIfJa7rsS6otneu+8C2QVaTLgSAgCGQjwI4IWfZ5S7BajbF+gUfPn8Nz+vvtEgbvvuLKIf25PQtqXdHfs2vw/Ml9wNN+P4v3YA7HQvJnxmhaDEA/3M/B46c0KFSOCQGsw/6Omf6YuweLhydwlmMxrlGyowkz8xtwmFOHK0OjVma0S8ulJ+VjOHVMXd98ib7rz8rOEKzZrA9924kWuBieE7hPH2u7MnyIQoAjdUuUcX4KsHQMA1wEdnZi2wzTkz7gNOTmOuxSBSr25x48/SNjKutgALvrm1DMkOJU0Ob6IZxgw8+9/Ax4FQH+AGHceaaOh8PPZVmlKfafxmVjPjUS4vQzmIeFJa0PWMwOYLC7BNs5Pjkm8T60xEzJd3xocq04tjU7TOhjMavT0LNMru8y/cxamb6mD4H60vzeUzj7XF73th52VJy2zumXRQ05EAQEgQABJhD6Cd+//QD454NZDP0BJ7f+gQ+4APpTbIrrlztw98c3+I6R0K3ZWfhx9AEuf0OOsfs0XfYTcOash48ZsqeAY3cVAxCaIqMbhTtFk1Cjbpr6pkIBhppS86bHEvXYZBxCXz0GHJEyP5T7GE718FnaBhzkMjLpu+uNbjR2zr3chEWFoV57tVlEFIhBWx+OT+Hg/QksbGKkenrgBLo1PqyswfruACeXMGg4fgqPbaTYQ3M0FWEDkLfwTAfJ7jxIRdiSCc7rMFuEe3371DtmK7CGgST9cKsgfhXKh4uK3z0ltO1nnPq2MpN9l1NWl4cB8DbeVXIfzOrESb4gIAhUEGACIb0YWo32qFGfZbiL/5bxODpCpNYF3YFfKe6hoAhug10yBBdf4AjKNUMVK7IT9AJknA8zT+kYeKib1g7UPf+rEYviyZ6CC6zb883l4AWN3jT5+CM9qqZ6wt6AP/XgRhNh2WXjdkZsqZWIP3yLe/D+wKy9suXb+mBGFwawAI9XHsPCyQBOIB4AVH2gH+FdGLwYADgjZtak6Dc9xe9ulW8Q4nqLLRx5abokKCobE1VAdLaNg1unzno0pzQtYj40/rGYad+2en/VsQVmjvmVQ8Lv2A3i669LX0bDPshi5kvOPsuSGbGT67td+9njHcDbFa4njDzwyRqh7KaVgoJACgEmEEpVsen4Zljxejy+Iv/3LKzhFJheLo1TZmt34NvAvFr/AWC5yLP123/T4s9FejzGKZS8d8ZoxOJQ1ynUmh+BTgEHySifgLcWtp0RIbvg0lkEWixsJiNW4I9tKJ+ei1GDFdjBH8/j1XLR7IxXr3CgwQFnJ2dLnQ/oxdoibKxuwOKaG4q29YGminAJ+QlNe87BPbWcfAEnkLSNaaw1FCsI6DFGop4pOiv+P00r7KP9dgRjHqfUznoYfcMRRzUiQt8k8607peEskKcRk6ENFnjMVnb2YRFfCijkFv2lvo3iznOYtZRJU4uLGzDv+p+9VUXqemCtH8m1wl9/KTuZvttHP1uxwVB1QT+HkOQJAoJAPQKTyT7/n/8A/O9/9dZLCUFAEKhH4PffAT7g00jkQ28iPYO38Nmd1oyUy0qiNVxbC95aFnrTamvhrB/5WUZIIUFAEBAEmiEwmYEQPlHKRxAQBHpEANecuR8KgGidHL4pCcNytb1bpMUxjSQF08O9ym9hklQRBAQBQaAGgckOhIKbd40vki0ICAIhAvahQq6lEBk5FwQEAUFAIdBhjZAgKAgIAoKAICAICAKCwHQjIIHQdLefWC8ICAKCgCAgCAgCHRCY3kBIvTYqb1B0aHupKggIAoKAICAI3HgEMgMhyzTfgH3eYaePbsA4kdBbjqXIfh2920sLS8ehhwwnv8bNR2SxjASrJojVr4IHdrl5jbYNYPQRBO6u1K5cNx3X09TxYpEo/anRZ4uF365/zKvlHk8VyXDrufYX8q094+pThWI5EAQEAUFgqhHICoQK9nnP1WDDxeVZOEL2ef2hwOkjwH/X4MFtr1J/J2preZdeorvo81fPkGkcmcG6i7rhEuhH+RnA2zNAhorggwHg/Als2p2zz57C3jNLHIv1npV5+7gnzbOsTQQ5fRRDIFklvdZtdRZUBWiL2svH7uJNe/X8iXtT1314fena5DvuubRv9JHv0V3RD+DPjUXcF9JuJV2Pi/TdNOqSIwgIAoIAh0B9INSGfR63Vbz/5Akodg1Oe6s8+hGyG9aFT796lCXKKq2eqN3yWk6xLx3mP8Mfn/2dtQZWMfqUFMq3tpYjIxPJYt3A6/qitAN4YmNCxbu0Vu4EPvcYMBwATftG9ewGgwDzC0vILJDD+Mbow9Gw93vYrkXw41qvN8Erdmwm25bsBo5uufCY0xeWdc6V/G2wlGG02/khbhppKNKKguevtuB4+48SI9xcksWlVd8t1MmBICAICAI3GoGaQAhHdj4ewezyI/glClO5u/Tg2x3472gin0Az/SgYiowgR5/uwsbJZsH9tbjxTFMo0A8uEnkW5KXEPQb2R4meuOlJvfwRjoqOJjr6cEdoZHI1dAoUaA1gzY5CqD3ydSBGRKmK4oOIXm2+2ctl7t6i+fHXQZYdnVA7aeNYxQu1+7EdUaAdqN2pJdzlegsHYoxMGlEJqTrU/jFE4JjDX+ZOx9iALjotEwUmnqjoBogTzHwUzYQ98b/PTg5hPXubaL9ucabaeQFOcWM/uytzOf2l+9LmidmxebAGw2jAVEjrdEA7ouP25oqYloJhItIkGin/o8mBnzJkaT4uXfqur1nOBAFBQBC4iQiwgVAX9vmrA9NhlXbZvfHnJ8WWrqcV9h0Wd996NbViA4HKuh5Hn+EbUmMYbZmxr4rF2ndZn5npR2JhL/66Bgoo8+32MfImmcBksBCZPtPTWavIW2VHT2LmZacdbsDJmvWBpr9McKzWTs3AKuCmgujjPh51pzPhrcIBJzWiSbstU9B1LyxOgeHiZpLlnvqii0td3w3Fy7kgIAgIAoKAjwATCLVnn/dVXPVZSaIZZ0vXPGSg2Ozpx7nkBrPTZpZNXAcDDUaNpp3FehQjQtgdPDx37sGJJR41XaUYteoadNmuh+1QBlSad03NuKlgtQxkV3ZwTRNUR9GsmK7farRvYxVONoeGcuIcaJCo/ODoztYxbJfGlll4VMWlvu96AuREEBAEBAFBoIIAEwgFi6GfL8Nd/JfFPl9Rc0UJLru3MgF/BCts6XaqrRwxoOXSNGXViXlg2lisY000ihEhTw9NH65662GqP/ZeheLtLxukBrnVU28NEmUfwMBjmHemS+EMg7IycFbCzFtl2fqsBbF6K2vYsxz51D+L6VmsqKbxnkJsViyOy4j6rvVBvgUBQUAQuAkI4ChH5uf78OPrj8PvRWk6f2Vg0aQAAANhSURBVD18bf/++jK8LPIuh1/+cvJUGbduUTB+ADhTQX/Rz/4Ql1UQcVL5t7Q9xDeC8BPmrWNK8NlfV/XWKxm2HMmI1LPZ3ndYNjg/2x7iS1MRO7WQs+2lMq8w6GyIb1oNkQNKFdpfx+PCP0wy9mv/l4bb2vGibCFGqzD/k0ynbC0GXuUWJ8YH1/cCUz/PtzdsP8IuaIuo7b5MjY1TL2gHV6fXBmivm6ccb6OPKkbrYbpni2OjqhLRT7Iq/TqCS1HOl4kAMteSqiT/CQKCgCBwoxG4ZlxjtMCYFig3mL66CdGu+Dj5CNA0JO040Nd0oPUY12KpD4VD8hEEBAFBQBCoIPCvSookCAKCwPgRoGnIz+NXKxoFAUFAELjpCFyzEaGb3pzivyAQICAjQgEgcioICAKCgI8As1jaLyhngoAgIAgIAoKAICAIXDcEJBC6bi0q/ggCgoAgIAgIAoJANgISCGVDJQUFAUFAEBAEBAFB4LohkLlYmkhUB3D0g/YRsnQbNs1CchserDn8YshR9m5wBD8o+/YDWHtyHxnI5CMICAKCgCAgCAgCgsDkIJC1WPrn13cwuJyFu/8A3CkCocCJi0/wBvnGnj8iVjIKkr7A7BMdNF18egN/z67Bk1wuMlngGYArp4JASwTkWmoJnFQTBASBm4JA/dRYa/Z5O3IEcGv2Nvy4/HlTMBU/BQFBQBAQBAQBQWBKEKiZGrPs88+Rff4CvlWcIvb5D4ADRWb6Kz759fPyB9y9E+evr4iUBEFAEBAEBAFBQBAQBMaEABsIWfb558kY5hd49Pw5PCJjaWrs3dfKWiCaVvtwiWuEkjLG5KmoEQQEAUFAEBAEBAFBIECAWSMULoYua95dxuCnEtjQ6NDfMOssmFZri3DdUOOF0rKuoQRbjgSBLgjItdQFPakrCAgCNwABJhAKvadA5xu/WPrv2SLoaR0EkVp78w5NkHNBQBBoh4BwjbXDTWoJAoLAtUeAnRrjvXfWB1FB7xX5C/hyRC/O/4DBmyMjxn313iSlvn7/HeD//i+VK+mCgCDQBAG6nuQjCAgCgoAgEEWgwYhQtL4kCgKCgCAgCAgCgoAgMLUI1L8+P7WuieGCgCAgCAgCgoAgIAjwCEggxOMjuYKAICAICAKCgCBwjRH4/4TW/76gjs+/AAAAAElFTkSuQmCC" alt="422  423  424  425  426  427  428  429  ASE  431  192.168.1.a/24  432  The pool of addresses that leases will be given fnm. If the leases  are given via Radius, or via the explicit-ip? per-user config option then  these network values should contain a network w  ith at least a single  address that will  remain under the full contnl of ocserv (that is  to  i pv4  i pv4  i pv4  be able to assi n  the local part of the tun device address).  - network  - netmask  - network  192.168.1 a  255.255.255.a  Ying the network "></p><ol start="8"><li><p>去掉如下参数的注释以及设置DNS服务器地址：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">tunnel-all-dns</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">dns</span> = <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span><br><span class="hljs-attr">dns</span> = <span class="hljs-number">8.8</span>.<span class="hljs-number">4.4</span><br></code></pre></td></tr></table></figure></li></ol><p>如图所示：</p><p><img src="data:image/png;base64,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" alt="# Whether to tunnel all DNS queries via the VPN.  nute is set.  # when a default  This  is the default  tunnel-all-dns  true  # The advertized DNS server.  # multiple servers.  use multiple lines for  dns  dns  8.8.8.8  8.8.4.4  451 "></p><p>确定你已经修改好上面的内容，然后保存即可。</p><p>现在来创建一个VPN用户：</p><p><code>ocpasswd -c /etc/ocserv/ocpasswd lala</code></p><p>盲输两遍密码即可。如果不想让这个用户继续使用了，可以执行下面的命令删除指定的用户：</p><p><code>ocpasswd -c /etc/ocserv/ocpasswd -d lala</code></p><p>现在我们开启机器的IPV4转发功能：</p><p><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p><p>然后启动CentOS7的Firewalld防火墙：</p><p><code>systemctl start firewalld.service</code></p><p>放行Anyconnect的端口（我这里之前设置的是默认的443端口，如果你修改了端口，那么这里也要对应）：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">firewall-cmd --permanent <span class="hljs-attribute">--zone</span>=public <span class="hljs-attribute">--add-port</span>=443/tcp<br>firewall-cmd --permanent <span class="hljs-attribute">--zone</span>=public <span class="hljs-attribute">--add-port</span>=443/udp<br></code></pre></td></tr></table></figure><p>设置转发：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">firewall-cmd <span class="hljs-attr">--permanent</span> <span class="hljs-attr">--add-masquerade</span><br>firewall-cmd <span class="hljs-attr">--permanent</span> <span class="hljs-attr">--direct</span> <span class="hljs-attr">--passthrough</span> ipv4 -t nat -<span class="hljs-selector-tag">A</span> POSTROUTING -o eth0 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>注：eth0是你的公网网卡名字，每个机器的名字可能都不一样，自己用ifconfig命令查一下就行了。</p><p>重加载，让新的配置生效：</p><p><code>firewall-cmd --reload</code></p><p>现在就可以尝试运行一下Ocserv了：</p><p><code>ocserv -f -d 1</code></p><p>如果一切正常，回显的内容大致如下图所示：</p><p><img src="data:image/png;base64,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" alt="ocsem,• -f -d I  note: setting &#39; plain&#39; as primary authentication method  note: setting &#39;file&#39; as supplemental config option  listening (TCP) on ø.ø.ø.ø:443...  listening (TCP) on C:  listening (UDP) on ø.ø.ø.ø:443...  listening (UDP) on C:  ocser•u&#39;C1593): main: initialized ocsem,• ø.12.I  ocser•u&#39;C1594): sec-mod: reading supplemental config from files  ocsetwC1594): sec-mod: sec-mod initialized (socket: /var/lib/ocsetw/ocset&quot;.&#39;. sock. ba2befa6) "></p><p>确定正常后按键盘组合键Ctrl+C退出运行，现在我们就可以直接用systemctl来管理Ocserv的进程。</p><p>设置Ocserv开机启动：</p><p><code>systemctl enable ocserv</code></p><p>启动Ocserv：</p><p><code>systemctl start ocserv</code> </p><p>配置日志</p><p><code>ExecStart=/bin/sh -c &#39;/usr/sbin/ocserv --pid-file /var/run/ocserv.pid --config /etc/ocserv/ocserv.conf -f -d 5 &gt;&gt; /var/log/agent.log 2&gt;&amp;1&#39;</code></p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ocserv</tag>
      
      <tag>VPN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何使用java探针注入器？</title>
    <link href="/2023/04/24/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8java%E6%8E%A2%E9%92%88%E6%B3%A8%E5%85%A5%E5%99%A8%EF%BC%9F/"/>
    <url>/2023/04/24/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8java%E6%8E%A2%E9%92%88%E6%B3%A8%E5%85%A5%E5%99%A8%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<p>本文介绍如何快速入手基于SWCK的java探针注入器。</p><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><h3 id="1-1-SWCK-是什么？"><a href="#1-1-SWCK-是什么？" class="headerlink" title="1.1 SWCK 是什么？"></a>1.1 SWCK 是什么？</h3><p><a href="https://github.com/apache/skywalking-swck">SWCK</a>是部署在 Kubernetes 环境中，为 Skywalking 用户提供服务的平台，用户可以基于该平台使用、升级和维护 SkyWalking 相关组件。</p><p>实际上，SWCK 是基于 <a href="https://book.kubebuilder.io/">kubebuilder</a> 开发的Operator，为用户提供自定义资源（ CR ）以及管理资源的控制器（ Controller ），所有的自定义资源定义（CRD）如下所示：</p><ul><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#javaagent">JavaAgent</a></li><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#oap">OAP</a></li><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#ui">UI</a></li><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#storage">Storage</a></li><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#satellite">Satellite</a></li><li><a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#fetcher">Fetcher</a></li></ul><h3 id="1-2-java-探针注入器是什么？"><a href="#1-2-java-探针注入器是什么？" class="headerlink" title="1.2 java 探针注入器是什么？"></a>1.2 java 探针注入器是什么？</h3><p>对于 java 应用来说，用户需要将 java 探针注入到应用程序中获取元数据并发送到 Skywalking 后端。为了让用户在 Kubernetes 平台上更原生地使用 java 探针，我们提供了 java 探针注入器，该注入器能够将 java 探针通过 sidecar 方式注入到应用程序所在的 pod 中。 java 探针注入器实际上是一个<a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/">Kubernetes Mutation Webhook控制器</a>，如果请求中存在 <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">annotations</a> ，控制器会拦截 pod 事件并将其应用于 pod 上。</p><h2 id="2-主要特点"><a href="#2-主要特点" class="headerlink" title="2. 主要特点"></a>2. 主要特点</h2><ul><li><strong>透明性</strong>。用户应用一般运行在普通容器中而 java 探针则运行在初始化容器中，且两者都属于同一个 pod 。该 pod 中的每个容器都会挂载一个共享内存卷，为 java 探针提供存储路径。在 pod 启动时，初始化容器中的 java 探针会先于应用容器运行，由注入器将其中的探针文件存放在共享内存卷中。在应用容器启动时，注入器通过设置 JVM 参数将探针文件注入到应用程序中。用户可以通过这种方式实现 java 探针的注入，而无需重新构建包含 java 探针的容器镜像。</li><li><strong>可配置性</strong>。注入器提供两种方式配置 java 探针：全局配置和自定义配置。默认的全局配置存放在 <a href="https://kubernetes.io/docs/concepts/configuration/configmap/">configmap</a> 中，用户可以根据需求修改全局配置，比如修改 <code>backend_service</code> 的地址。此外，用户也能通过 annotation 为特定应用设置自定义的一些配置，比如不同服务的 <code>service_name</code> 名称。详情可见 <a href="https://github.com/apache/skywalking-swck/blob/master/docs/java-agent-injector.md">java探针说明书</a>。</li><li><strong>可观察性</strong>。每个 java 探针在被注入时，用户可以查看名为 <code>JavaAgent</code> 的 CRD 资源，用于观测注入后的 java 探针配置。详情可见 <a href="https://github.com/apache/skywalking-swck/blob/master/docs/javaagent.md">JavaAgent说明</a>。</li></ul><h2 id="3-安装SWCK"><a href="#3-安装SWCK" class="headerlink" title="3. 安装SWCK"></a>3. 安装SWCK</h2><p>在接下来的几个步骤中，我们将演示如何从0开始搭建单机版的 Kubernetes 集群，并在该平台部署0.6.1版本的 SWCK。</p><h3 id="3-1-工具准备"><a href="#3-1-工具准备" class="headerlink" title="3.1 工具准备"></a>3.1 工具准备</h3><p>首先，你需要安装一些必要的工具，如下所示：</p><ol><li><a href="http://kind.sigs.k8s.io/">kind</a>，用于创建单机版 Kubernetes集群。</li><li><a href="https://kubernetes.io/docs/tasks/tools/">kubectl</a>，用于和Kubernetes 集群交互。</li></ol><h3 id="3-2-搭建单机版-Kubernetes集群"><a href="#3-2-搭建单机版-Kubernetes集群" class="headerlink" title="3.2 搭建单机版 Kubernetes集群"></a>3.2 搭建单机版 Kubernetes集群</h3><p>在安装完 <a href="http://kind.sigs.k8s.io/">kind</a> 工具后，可通过如下命令创建一个单机集群。</p><blockquote><p>注意！如果你的终端配置了代理，在运行以下命令之前最好先关闭代理，防止一些意外错误的发生。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kind create cluster --image=kindest/node:v1.19.1<br></code></pre></td></tr></table></figure><p>在集群创建完毕后，可获得如下的pod信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get pod -A                          <br>NAMESPACE            NAME                                         READY   STATUS    RESTARTS   AGE<br>kube-system          coredns-f9fd979d6-57xpc                      1/1     Running   0          7m16s<br>kube-system          coredns-f9fd979d6-8zj8h                      1/1     Running   0          7m16s<br>kube-system          etcd-kind-control-plane                      1/1     Running   0          7m23s<br>kube-system          kindnet-gc9gt                                1/1     Running   0          7m16s<br>kube-system          kube-apiserver-kind-control-plane            1/1     Running   0          7m23s<br>kube-system          kube-controller-manager-kind-control-plane   1/1     Running   0          7m23s<br>kube-system          kube-proxy-6zbtb                             1/1     Running   0          7m16s<br>kube-system          kube-scheduler-kind-control-plane            1/1     Running   0          7m23s<br>local-path-storage   local-path-provisioner-78776bfc44-jwwcs      1/1     Running   0          7m16s<br></code></pre></td></tr></table></figure><h3 id="3-3-安装证书管理器-cert-manger"><a href="#3-3-安装证书管理器-cert-manger" class="headerlink" title="3.3 安装证书管理器(cert-manger)"></a>3.3 安装证书管理器(cert-manger)</h3><p>SWCK 的证书都是由证书管理器分发和验证，需要先通过如下命令安装<a href="https://cert-manager.io/docs/">证书管理器cert-manger</a>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.3.1/cert-manager.yaml<br></code></pre></td></tr></table></figure><p>验证 cert-manger 是否安装成功。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get pod -n cert-manager<br>NAME                                       READY   STATUS    RESTARTS   AGE<br>cert-manager-7dd5854bb4-slcmd              1/1     Running   0          73s<br>cert-manager-cainjector-64c949654c-tfmt2   1/1     Running   0          73s<br>cert-manager-webhook-6bdffc7c9d-h8cfv      1/1     Running   0          73s<br></code></pre></td></tr></table></figure><h3 id="3-4-安装SWCK"><a href="#3-4-安装SWCK" class="headerlink" title="3.4 安装SWCK"></a>3.4 安装SWCK</h3><p>java 探针注入器是 SWCK 中的一个组件，首先需要按照如下步骤安装 SWCK：</p><ol><li>输入如下命令获取 SWCK 的 yaml 文件并部署在 Kubernetes 集群中。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ curl -Ls https://archive.apache.org/dist/skywalking/swck/0.6.1/skywalking-swck-0.6.1-bin.tgz | tar -zxf - -O ./config/operator-bundle.yaml | kubectl apply -f -<br></code></pre></td></tr></table></figure><ol><li>检查 SWCK 是否正常运行。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get pod -n skywalking-swck-system<br>NAME                                                  READY   STATUS    RESTARTS   AGE<br>skywalking-swck-controller-manager-7f64f996fc-qh8s9   2/2     Running   0          94s<br></code></pre></td></tr></table></figure><h3 id="3-5-安装-Skywalking-组件-—-OAPServer-和-UI"><a href="#3-5-安装-Skywalking-组件-—-OAPServer-和-UI" class="headerlink" title="3.5 安装 Skywalking 组件 — OAPServer 和 UI"></a>3.5 安装 Skywalking 组件 — OAPServer 和 UI</h3><ol><li>在 <code>default</code> 命名空间中部署 OAPServer 组件和 UI 组件。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl apply -f https://raw.githubusercontent.com/apache/skywalking-swck/master/operator/config/samples/default.yaml<br></code></pre></td></tr></table></figure><ol><li>查看 OAPServer 组件部署情况。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get oapserver<br>NAME      INSTANCES   RUNNING   ADDRESS<br>default   1           1         default-oap.default<br></code></pre></td></tr></table></figure><ol><li>查看 UI 组件部署情况。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get ui<br>NAME      INSTANCES   RUNNING   INTERNALADDRESS      EXTERNALIPS   PORTS<br>default   1           1         default-ui.default                 [80]<br></code></pre></td></tr></table></figure><h2 id="4-部署demo应用"><a href="#4-部署demo应用" class="headerlink" title="4. 部署demo应用"></a>4. 部署demo应用</h2><p>在第3个步骤中，我们已经安装好 SWCK 以及相关的 Skywalking 组件，接下来按照全局配置以及自定义配置两种方式，通过两个 java 应用实例，分别演示如何使用 SWCK 中的 java 探针注入器。</p><h3 id="4-1-设置全局配置"><a href="#4-1-设置全局配置" class="headerlink" title="4.1 设置全局配置"></a>4.1 设置全局配置</h3><p>当 SWCK 安装完成后，默认的全局配置就会以 configmap 的形式存储在系统命令空间中，可通过如下命令查看。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$  kubectl get configmap skywalking-swck-java-agent-configmap -n skywalking-swck-system -oyaml<br>apiVersion: v1<br>data:<br>  agent.config: |-<br>    <span class="hljs-comment"># The service name in UI</span><br>    agent.service_name=<span class="hljs-variable">$&#123;SW_AGENT_NAME:Your_ApplicationName&#125;</span><br><br>    <span class="hljs-comment"># Backend service addresses.</span><br>    collector.backend_service=<span class="hljs-variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800&#125;</span><br><br>    <span class="hljs-comment"># Please refer to https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties to get more details.</span><br></code></pre></td></tr></table></figure><p>在 <code>kind</code> 创建的 Kubernetes 集群中， SkyWalking 后端地址和 configmap 中指定的地址可能不同，我们需要使用真正的 OAPServer 组件的地址 <code>default-oap.default</code> 来代替默认的 <code>127.0.0.1</code> ，可通过修改 configmap 实现。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl edit configmap skywalking-swck-java-agent-configmap -n skywalking-swck-system<br>configmap/skywalking-swck-java-agent-configmap edited<br><br>$ kubectl get configmap skywalking-swck-java-agent-configmap -n skywalking-swck-system -oyaml<br>apiVersion: v1<br>data:<br>  agent.config: |-<br>    <span class="hljs-comment"># The service name in UI</span><br>    agent.service_name=<span class="hljs-variable">$&#123;SW_AGENT_NAME:Your_ApplicationName&#125;</span><br><br>    <span class="hljs-comment"># Backend service addresses.</span><br>    collector.backend_service=<span class="hljs-variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:default-oap.default:11800&#125;</span><br><br>    <span class="hljs-comment"># Please refer to https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/configurations/#table-of-agent-configuration-properties to get more details.</span><br></code></pre></td></tr></table></figure><h3 id="4-2-设置自定义配置"><a href="#4-2-设置自定义配置" class="headerlink" title="4.2 设置自定义配置"></a>4.2 设置自定义配置</h3><p>在实际使用场景中，我们需要使用 Skywalking 组件监控不同的 java 应用，因此不同应用的探针配置可能有所不同，比如应用的名称、应用需要使用的插件等。为了支持自定义配置，注入器提供 annotation 来覆盖默认的全局配置。接下来我们将分别以基于 <code>spring boot</code> 以及 <code>spring cloud gateway</code> 开发的两个简单java应用为例进行详细说明，你可以使用这两个应用的<a href="https://github.com/dashanji/swck-spring-cloud-k8s-demo">源代码</a>构建镜像。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># build the springboot and springcloudgateway image </span><br>$ git <span class="hljs-built_in">clone</span> https://github.com/dashanji/swck-spring-cloud-k8s-demo <br>$ <span class="hljs-built_in">cd</span> swck-spring-cloud-k8s-demo &amp;&amp; make<br><br><span class="hljs-comment"># check the image</span><br>$ docker images<br>REPOSITORY     TAG       IMAGE ID       CREATED          SIZE<br>gateway        v0.0.1    51d16251c1d5   48 minutes ago   723MB<br>app            v0.0.1    62f4dbcde2ed   48 minutes ago   561MB<br><br><span class="hljs-comment"># load the image into the cluster</span><br>$ kind load docker-image app:v0.0.1 &amp;&amp; kind load docker-image gateway:v0.0.1<br></code></pre></td></tr></table></figure><h3 id="4-3-部署-spring-boot-应用"><a href="#4-3-部署-spring-boot-应用" class="headerlink" title="4.3 部署 spring boot 应用"></a>4.3 部署 spring boot 应用</h3><ol><li>创建 <code>springboot-system</code> 命名空间。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl create namespace springboot-system<br></code></pre></td></tr></table></figure><ol><li>给 <code>springboot-system</code> 命名空间打上标签使能 java 探针注入器。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl label namespace springboot-system swck-injection=enabled<br></code></pre></td></tr></table></figure><ol><li>接下来为 spring boot 应用对应的部署文件 <code>springboot.yaml</code> ，其中使用了 annotation 覆盖默认的探针配置，比如 <code>service_name</code> ，将其覆盖为 <code>backend-service</code> 。</li></ol><blockquote><p>需要注意的是，在使用 annotation 覆盖探针配置之前，需要增加 <code>strategy.skywalking.apache.org/agent.Overlay: &quot;true&quot;</code> 来使覆盖生效。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">demo-springboot</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">springboot-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">demo-springboot</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">swck-java-agent-injected:</span> <span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-comment"># enable the java agent injector</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">demo-springboot</span><br>      <span class="hljs-attr">annotations:</span><br>        <span class="hljs-attr">strategy.skywalking.apache.org/agent.Overlay:</span> <span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-comment"># enable the agent overlay</span><br>        <span class="hljs-attr">agent.skywalking.apache.org/agent.service_name:</span> <span class="hljs-string">&quot;backend-service&quot;</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">springboot</span><br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">app:v0.0.1</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;java&quot;</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/app.jar&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">demo</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">springboot-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-number">8085</span><span class="hljs-string">-tcp</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8085</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8085</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">demo-springboot</span><br></code></pre></td></tr></table></figure><ol><li>在 <code>springboot-system</code> 命名空间中部署 <code>spring boot</code> 应用。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl apply -f springboot.yaml<br></code></pre></td></tr></table></figure><ol><li>查看部署情况。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get pod -n springboot-system<br>NAME                               READY   STATUS    RESTARTS   AGE<br>demo-springboot-7c89f79885-dvk8m   1/1     Running   0          11s<br></code></pre></td></tr></table></figure><ol><li>通过 <code>JavaAgent</code> 查看最终注入的 java 探针配置。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get javaagent -n springboot-system<br>NAME                            PODSELECTOR           SERVICENAME       BACKENDSERVICE<br>app-demo-springboot-javaagent   app=demo-springboot   backend-service   default-oap.default:11800<br></code></pre></td></tr></table></figure><h3 id="4-4-部署-spring-cloud-gateway-应用"><a href="#4-4-部署-spring-cloud-gateway-应用" class="headerlink" title="4.4 部署 spring cloud gateway 应用"></a>4.4 部署 spring cloud gateway 应用</h3><ol><li>创建 <code>gateway-system</code> 命名空间。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl create namespace gateway-system<br></code></pre></td></tr></table></figure><ol><li>给 <code>gateway-system</code> 命名空间打上标签使能 java 探针注入器。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl label namespace gateway-system swck-injection=enabled<br></code></pre></td></tr></table></figure><ol><li>接下来为 spring cloud gateway 应用对应的部署文件 <code>springgateway.yaml</code> ，其中使用了 annotation 覆盖默认的探针配置，比如 <code>service_name</code> ，将其覆盖为 <code>gateway-service</code> 。此外，在使用 <code>spring cloud gateway</code> 时，我们需要在探针配置中添加 <code>spring cloud gateway</code> 插件。</li></ol><blockquote><p>需要注意的是，在使用 annotation 覆盖探针配置之前，需要增加 <code>strategy.skywalking.apache.org/agent.Overlay: &quot;true&quot;</code> 来使覆盖生效。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">demo-gateway</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">demo-gateway</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">gateway-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">demo-gateway</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">swck-java-agent-injected:</span> <span class="hljs-string">&quot;true&quot;</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">demo-gateway</span><br>      <span class="hljs-attr">annotations:</span><br>        <span class="hljs-attr">strategy.skywalking.apache.org/agent.Overlay:</span> <span class="hljs-string">&quot;true&quot;</span><br>        <span class="hljs-attr">agent.skywalking.apache.org/agent.service_name:</span> <span class="hljs-string">&quot;gateway-service&quot;</span>     <br>        <span class="hljs-attr">optional.skywalking.apache.org:</span> <span class="hljs-string">&quot;cloud-gateway-3.x&quot;</span> <span class="hljs-comment"># add spring cloud gateway plugin</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">gateway:v0.0.1</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;java&quot;</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/gateway.jar&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">service-gateway</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">gateway-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-number">9999</span><span class="hljs-string">-tcp</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9999</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">demo-gateway</span><br></code></pre></td></tr></table></figure><ol><li>在 <code>gateway-system</code> 命名空间中部署 <code>spring cloud gateway</code> 应用。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl apply -f springgateway.yaml<br></code></pre></td></tr></table></figure><ol><li>查看部署情况。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get pod -n gateway-system<br>NAME                           READY   STATUS    RESTARTS   AGE<br>demo-gateway-758899c99-6872s   1/1     Running   0          15s<br></code></pre></td></tr></table></figure><ol><li>通过 <code>JavaAgent</code> 获取最终注入的java探针配置。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get javaagent -n gateway-system<br>NAME                         PODSELECTOR        SERVICENAME       BACKENDSERVICE<br>app-demo-gateway-javaagent   app=demo-gateway   gateway-service   default-oap.default:11800<br></code></pre></td></tr></table></figure><h2 id="5-验证注入器"><a href="#5-验证注入器" class="headerlink" title="5. 验证注入器"></a>5. 验证注入器</h2><ol><li>当完成上述步骤后，我们可以查看被注入pod的详细状态，比如被注入的<code>agent</code>容器。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># get all injected pod</span><br>$ kubectl get pod -A -lswck-java-agent-injected=<span class="hljs-literal">true</span><br>NAMESPACE           NAME                               READY   STATUS    RESTARTS   AGE<br>gateway-system      demo-gateway-5bb77f6d85-lt4z7      1/1     Running   0          69s<br>springboot-system   demo-springboot-7c89f79885-lkb5j   1/1     Running   0          75s<br><br><span class="hljs-comment"># view detailed state of the injected pod [demo-springboot]</span><br>$ kubectl describe pod -l app=demo-springboot -n springboot-system<br>...<br>Events:<br>  Type   Reason   Age                From                           Message<br>  ----   ------  ----                ----                           -------<br>  ...<br>  Normal Created  91s  kubelet,kind-control-plane Created  container inject-skywalking-agent<br>  Normal Started  91s  kubelet,kind-control-plane Started  container inject-skywalking-agent<br>  ...<br>  Normal Created  90s  kubelet,kind-control-plane Created  container springboot<br>  Normal Started  90s  kubelet,kind-control-plane Started  container springboot<br><br><span class="hljs-comment"># view detailed state of the injected pod [demo-gateway] </span><br>$ kubectl describe pod -l app=demo-gateway -n gateway-system<br>...<br>Events:<br>  Type   Reason   Age            From                         Message<br>  ----   ------  ----            ----                         -------<br>  ...<br>  Normal Created 2m20s kubelet,kind-control-plane Created container inject-skywalking-agent<br>  Normal Started 2m20s kubelet,kind-control-plane Started container inject-skywalking-agent<br>  ...<br>  Normal Created 2m20s kubelet,kind-control-plane Created container gateway<br>  Normal Started 2m20s kubelet,kind-control-plane Started container gateway<br></code></pre></td></tr></table></figure><ol><li>现在我们可以将服务绑定在某个端口上并通过 web 浏览器查看采样数据。首先，我们需要通过以下命令获取<code>gateway</code>服务和<code>ui</code>服务的信息。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl get service service-gateway -n gateway-system<br>NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE<br>service-gateway   ClusterIP   10.99.181.145   &lt;none&gt;        9999/TCP   9m19s<br><br>$ kubectl get service default-ui<br>NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE<br>default-ui   ClusterIP   10.111.39.250   &lt;none&gt;        80/TCP    82m<br></code></pre></td></tr></table></figure><ol><li>接下来分别启动2个终端将<code>service-gateway</code> 以及 <code>default-ui</code> 绑定到本地端口上，如下所示：</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ kubectl port-forward service/service-gateway -n gateway-system 9999:9999<br>Forwarding from 127.0.0.1:9999 -&gt; 9999<br>Forwarding from [::1]:9999 -&gt; 9999<br>$ kubectl port-forward service/default-ui 8090:80                     <br>Forwarding from 127.0.0.1:8090 -&gt; 8080<br>Forwarding from [::1]:8090 -&gt; 8080<br></code></pre></td></tr></table></figure><ol><li>使用以下命令通过<code>spring cloud gateway</code> 网关服务暴露的端口来访问 <code>spring boot</code> 应用服务。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..10&#125;; <span class="hljs-keyword">do</span> curl http://127.0.0.1:9999/gateway/hello &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-keyword">done</span><br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br>Hello World!<br></code></pre></td></tr></table></figure><ol><li>我们可以在 web 浏览器中输入 <code>http://127.0.0.1:8090</code> 来访问探针采集到的数据。</li></ol><p><img src="https://skywalking.apache.org/zh/2022-04-19-how-to-use-the-java-agent-injector/dashboard.png" alt="img"></p><ol><li>所有服务的拓扑图如下所示。</li></ol><p><img src="https://skywalking.apache.org/zh/2022-04-19-how-to-use-the-java-agent-injector/topology.png" alt="img"></p><ol><li>查看 <code>gateway-service</code> 网关服务的 trace 信息。</li></ol><p><img src="https://lh3.googleusercontent.com/KAJruPRGjzjmX3S0xOu_3CoWetbcTwMQZIcCLtpkOKy1Z3CQFnz_hO6o4pheLiWwNGAr-xfM71NtsgxWo1nHfkGoYRfUF6fY6yHsYI4aAfEJ0y09Gm_tysQir1tn0SNxuVciCjl4" alt="img"></p><ol><li>查看 <code>backend-service</code> 应用服务的 trace 信息。</li></ol><p><img src="https://lh5.googleusercontent.com/zani4DhZmsrKN0N2GLgcjyFg6NBteduWwTNuwXvh7OOONjBhBwnCEuOLNpWa3iaZiPIeG36p-vlk2Fex2lvXJxv4YgBYmvl480U7_FBbtXjduJhsMdTBdvaBN_C2HRpZbdwWzerJ" alt="img"></p><h2 id="6-结束语"><a href="#6-结束语" class="headerlink" title="6. 结束语"></a>6. 结束语</h2><p>如果你的应用部署在 Kubernetes 平台中，且需要 Skywalking 提供监控服务， SWCK 能够帮助你部署、升级和维护 Kubernetes 集群中的 Skywalking 组件。除了本篇博客外，你还可以查看 <a href="https://github.com/apache/skywalking-swck/blob/master/docs/operator.md#operator-usage-guide">SWCK文档</a> 以及 <a href="https://github.com/apache/skywalking-swck/blob/master/docs/java-agent-injector.md">java探针注入器文档</a> 获取更多的信息。如果你觉得这个项目好用，请给 <a href="https://github.com/apache/skywalking-swck">SWCK</a> 一个star! 如果你有任何疑问，欢迎在<a href="https://github.com/apache/skywalking/issues">Issues</a>或者<a href="https://github.com/apache/skywalking/discussions">Discussions</a>中提出。</p><ul><li><a href="https://skywalking.apache.org/zh/2022-04-18-meeting/">← Previous</a></li><li>Next →</li></ul>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>SkyWalking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SkyWalking极简入门</title>
    <link href="/2023/04/24/SkyWalking%E6%9E%81%E7%AE%80%E5%85%A5%E9%97%A8/"/>
    <url>/2023/04/24/SkyWalking%E6%9E%81%E7%AE%80%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="SkyWalking-极简入门"><a href="#SkyWalking-极简入门" class="headerlink" title="SkyWalking 极简入门"></a>SkyWalking 极简入门</h1><p>从 0 开始入门 SkyWalking，搭建 SkyWalking 服务，并接入 Java 项目中实现分布式链路追踪。</p><h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h2 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h2><p>SkyWalking 是什么？</p><blockquote><p>FROM <a href="http://skywalking.apache.org/">http://skywalking.apache.org/</a></p><p>分布式系统的应用程序性能监视工具，专为微服务、云原生架构和基于容器（Docker、K8s、Mesos）架构而设计。</p><p>提供分布式追踪、服务网格遥测分析、度量聚合和可视化一体化解决方案。</p></blockquote><h2 id="1-2-功能列表"><a href="#1-2-功能列表" class="headerlink" title="1.2 功能列表"></a>1.2 功能列表</h2><p>SkyWalking 有哪些功能？</p><blockquote><p>FROM <a href="http://skywalking.apache.org/">http://skywalking.apache.org/</a></p><ul><li>多种监控手段。可以通过语言探针和 service mesh 获得监控是数据。</li><li>多个语言自动探针。包括 Java，.NET Core 和 Node.JS。</li><li>轻量高效。无需大数据平台，和大量的服务器资源。</li><li>模块化。UI、存储、集群管理都有多种机制可选。</li><li>支持告警。</li><li>优秀的可视化解决方案。</li></ul></blockquote><h2 id="1-3-整体架构"><a href="#1-3-整体架构" class="headerlink" title="1.3 整体架构"></a>1.3 整体架构</h2><p>SkyWalking 整体架构如何？</p><blockquote><p>FROM <a href="http://skywalking.apache.org/">http://skywalking.apache.org/</a></p><p><img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl533fk5xj31pc0s8h04.jpg" alt="架构图"></p></blockquote><p>整个架构，分成上、下、左、右四部分：</p><blockquote><p>考虑到让描述更简单，我们舍弃掉 Metric 指标相关，而着重在 Tracing 链路相关功能。</p></blockquote><ul><li>上部分 <strong>Agent</strong> ：负责从应用中，收集链路信息，发送给 SkyWalking OAP 服务器。目前支持 SkyWalking、Zikpin、Jaeger 等提供的 Tracing 数据信息。而我们目前采用的是，SkyWalking Agent 收集 SkyWalking Tracing 数据，传递给服务器。</li><li>下部分 <strong>SkyWalking OAP</strong> ：负责接收 Agent 发送的 Tracing 数据信息，然后进行分析(Analysis Core) ，存储到外部存储器( Storage )，最终提供查询( Query )功能。</li><li>右部分 <strong>Storage</strong> ：Tracing 数据存储。目前支持 ES、MySQL、Sharding Sphere、TiDB、H2 多种存储器。而我们目前采用的是 ES ，主要考虑是 SkyWalking 开发团队自己的生产环境采用 ES 为主。</li><li>左部分 <strong>SkyWalking UI</strong> ：负责提供控台，查看链路等等。</li></ul><h2 id="1-4-官方文档"><a href="#1-4-官方文档" class="headerlink" title="1.4 官方文档"></a>1.4 官方文档</h2><p>在 <a href="https://github.com/apache/skywalking/tree/master/docs">https://github.com/apache/skywalking/tree/master/docs</a> 地址下，提供了 SkyWalking 的<strong>英文</strong>文档。</p><p>考虑到大多数胖友的英语水平和艿艿不相伯仲，再加上胖友一开始对 SkyWalking 比较陌生，所以比较推荐先阅读 <a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking">https://github.com/SkyAPM/document-cn-translation-of-skywalking</a> 地址，提供了 SkyWalking 的<strong>中文</strong>文档。</p><p>考虑到胖友使用 SkyWalking 的目的，是实现<strong>分布式链路追踪</strong>的功能，所以最好去了解下相关的知识。这里推荐阅读两篇文章：</p><ul><li><a href="https://github.com/opentracing-contrib/opentracing-specification-zh">《OpenTracing 官方标准 —— 中文版》</a></li><li>Google 论文 <a href="http://www.iocoder.cn/Fight/Dapper-translation/?self">《Dapper，大规模分布式系统的跟踪系统》</a></li></ul><h1 id="2-搭建-SkyWalking-单机环境"><a href="#2-搭建-SkyWalking-单机环境" class="headerlink" title="2. 搭建 SkyWalking 单机环境"></a>2. 搭建 SkyWalking 单机环境</h1><p>考虑到让胖友更快的入门，我们来搭建一个 SkyWalking <strong>单机</strong>环境，步骤如下：</p><p><img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl533oq0xj30ww0pomzt.jpg" alt="SkyWalking 单机环境"></p><ul><li>第一步，搭建一个 Elasticsearch 服务。</li><li>第二步，下载 SkyWalking 软件包。</li><li>第三步，搭建一个 SkyWalking OAP 服务。</li><li>第四步，启动一个 Spring Boot 应用，并配置 SkyWalking Agent。</li><li>第五步，搭建一个 SkyWalking UI 服务。</li></ul><p>仅仅五步，按照艿艿标题党的性格，应该给本文取个《10 分钟快速搭建 SkyWalking 服务》标题才对，哈哈哈。</p><h2 id="2-1-Elasticsearch-搭建"><a href="#2-1-Elasticsearch-搭建" class="headerlink" title="2.1 Elasticsearch 搭建"></a>2.1 Elasticsearch 搭建</h2><blockquote><p>FROM <a href="https://www.elastic.co/cn/products/elasticsearch">https://www.elastic.co/cn/products/elasticsearch</a></p><p>Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎，能够解决不断涌现出的各种用例。 作为 Elastic Stack 的核心，它集中存储您的数据，帮助您发现意料之中以及意料之外的情况。</p></blockquote><p>参考<a href="http://www.iocoder.cn/Elasticsearch/install/?self">《Elasticsearch 极简入门》</a>的<a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「1. 单机部署」</a>小节，搭建一个 Elasticsearch 单机服务。</p><p>不过要<strong>注意</strong>，本文使用的是 Elasticsearch <code>7.5.1</code> 版本。因为 SkyWalking <a href="https://github.com/apache/skywalking/releases/tag/v6.6.0"><code>6.6.0</code></a> 版本，增加了对 Elasticsearch 7.X 版本的支持。当然，如果胖友使用 Elasticsearch 6.X 版本也是可以的。</p><h2 id="2-2-下载-SkyWalking-软件包"><a href="#2-2-下载-SkyWalking-软件包" class="headerlink" title="2.2 下载 SkyWalking 软件包"></a>2.2 下载 SkyWalking 软件包</h2><p>对于 SkyWalking 的软件包，有两种方式获取：</p><ul><li>手动编译</li><li>官方包</li></ul><p>一般情况下，我们建议使用<strong>官方包</strong>。手动编译，更多是尝鲜或者等着急修复的 BUG 的版本。</p><h3 id="2-2-1-官方包"><a href="#2-2-1-官方包" class="headerlink" title="2.2.1 官方包"></a>2.2.1 官方包</h3><p>在 <a href="http://skywalking.apache.org/downloads/">http://skywalking.apache.org/downloads/</a> 下，我们下载<strong>操作系统</strong>对应的发布版。</p><p>这里，我们选择 <a href="https://www.apache.org/dyn/closer.cgi/skywalking/6.6.0/apache-skywalking-apm-es7-6.6.0.tar.gz">Binary Distribution for ElasticSearch 7 (Linux)</a> 版本，因为艿艿是 Mac 环境，再加上想使用 Elasticsearch 7.X 版本作为存储。如果胖友想用 Elasticsearch 6.X 版本作为存储，记得下载 <a href="https://www.apache.org/dyn/closer.cgi/skywalking/6.6.0/apache-skywalking-apm-6.6.0.tar.gz">Binary Distribution (Linux)</a> 版本。</p><p><strong>① 下载</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建目录</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /Users/yunai/skywalking</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /Users/yunai/skywalking</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">下载</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget http://mirror.bit.edu.cn/apache/skywalking/6.6.0/apache-skywalking-apm-es7-6.6.0.tar.gz</span><br></code></pre></td></tr></table></figure><p><strong>② 解压</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">解压</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf apache-skywalking-apm-es7-6.6.0.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span>  apache-skywalking-apm-bin-es7</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span> -<span class="hljs-built_in">ls</span></span><br> 4 drwxr-xr-x 8 root root  4096 Sep  9 15:09 agent # SkyWalking Agent<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 bin # 执行脚本<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 config # SkyWalking OAP Server 配置文件<br>32 -rwxr-xr-x 1 root root 28903 Sep  9 14:32 LICENSE<br> 4 drwxr-xr-x 3 root root  4096 Sep  9 15:44 licenses<br>32 -rwxr-xr-x 1 root root 31850 Sep  9 14:32 NOTICE<br>16 drwxr-xr-x 2 root root 16384 Sep  9 15:22 oap-libs # SkyWalking OAP Server<br> 4 -rw-r--r-- 1 root root  1978 Sep  9 14:32 README.txt<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 webapp # SkyWalking UI<br></code></pre></td></tr></table></figure><h3 id="2-2-2-手动编译"><a href="#2-2-2-手动编译" class="headerlink" title="2.2.2 手动编译"></a>2.2.2 手动编译</h3><blockquote><p>友情提示：如果胖友没有编译 SkyWalking 源码的诉求，可以跳过本小节。</p></blockquote><p>参考 <a href="https://github.com/apache/skywalking/blob/v6.3.0/docs/en/guides/How-to-build.md">How to build project</a> 文章。</p><p>需要前置安装如下：</p><ul><li>GIT</li><li>JDK 8+</li><li>Maven</li></ul><p><strong>① 克隆代码</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/apache/skywalking.git</span><br></code></pre></td></tr></table></figure><ul><li>因为网络问题，可能克隆会有点久。</li></ul><p><strong>② 初始化子模块</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> skywalking</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git submodule init</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git submodule update</span><br></code></pre></td></tr></table></figure><p><strong>③ 编译</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./mvnw clean package -DskipTests</span><br></code></pre></td></tr></table></figure><ul><li>编译过程，如果机子比较差，花费时间会比较久。</li></ul><p><strong>④ 查看编译结果</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> apm-dist <span class="hljs-comment"># 编译结果目录</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> target</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf apache-skywalking-apm-bin.tar.gz <span class="hljs-comment"># 解压 Linux 包</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> apache-skywalking-apm-bin</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ls</span> -<span class="hljs-built_in">ls</span></span><br> 4 drwxr-xr-x 8 root root  4096 Sep  9 15:09 agent # SkyWalking Agent<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 bin # 执行脚本<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 config # SkyWalking OAP Server 配置文件<br>32 -rwxr-xr-x 1 root root 28903 Sep  9 14:32 LICENSE<br> 4 drwxr-xr-x 3 root root  4096 Sep  9 15:44 licenses<br>32 -rwxr-xr-x 1 root root 31850 Sep  9 14:32 NOTICE<br>16 drwxr-xr-x 2 root root 16384 Sep  9 15:22 oap-libs # SkyWalking OAP Server<br> 4 -rw-r--r-- 1 root root  1978 Sep  9 14:32 README.txt<br> 4 drwxr-xr-x 2 root root  4096 Sep  9 15:44 webapp # SkyWalking UI<br></code></pre></td></tr></table></figure><h2 id="2-3-SkyWalking-OAP-搭建"><a href="#2-3-SkyWalking-OAP-搭建" class="headerlink" title="2.3 SkyWalking OAP 搭建"></a>2.3 SkyWalking OAP 搭建</h2><p><strong>① 修改 OAP 配置文件</strong></p><blockquote><p>友情提示：如果配置文件，适合 SkyWalking 6.X 版本。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs YAML"><span class="hljs-string">$</span> <span class="hljs-string">vi</span> <span class="hljs-string">config/application.yml</span><br><br><span class="hljs-attr">storage:</span><br>  <span class="hljs-attr">elasticsearch7:</span><br>    <span class="hljs-attr">nameSpace:</span> <span class="hljs-string">$&#123;SW_NAMESPACE:&quot;elasticsearch&quot;&#125;</span><br>    <span class="hljs-attr">clusterNodes:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_CLUSTER_NODES:localhost:9200&#125;</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_HTTP_PROTOCOL:&quot;http&quot;&#125;</span><br><span class="hljs-comment">#    trustStorePath: $&#123;SW_SW_STORAGE_ES_SSL_JKS_PATH:&quot;../es_keystore.jks&quot;&#125;</span><br><span class="hljs-comment">#    trustStorePass: $&#123;SW_SW_STORAGE_ES_SSL_JKS_PASS:&quot;&quot;&#125;</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">$&#123;SW_ES_USER:&quot;&quot;&#125;</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">$&#123;SW_ES_PASSWORD:&quot;&quot;&#125;</span><br>    <span class="hljs-attr">indexShardsNumber:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_INDEX_SHARDS_NUMBER:2&#125;</span><br>    <span class="hljs-attr">indexReplicasNumber:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_INDEX_REPLICAS_NUMBER:0&#125;</span><br>    <span class="hljs-comment"># Those data TTL settings will override the same settings in core module.</span><br>    <span class="hljs-attr">recordDataTTL:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_RECORD_DATA_TTL:7&#125;</span> <span class="hljs-comment"># Unit is day</span><br>    <span class="hljs-attr">otherMetricsDataTTL:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_OTHER_METRIC_DATA_TTL:45&#125;</span> <span class="hljs-comment"># Unit is day</span><br>    <span class="hljs-attr">monthMetricsDataTTL:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_MONTH_METRIC_DATA_TTL:18&#125;</span> <span class="hljs-comment"># Unit is month</span><br>    <span class="hljs-comment"># Batch process setting, refer to https://www.elastic.co/guide/en/elasticsearch/client/java-api/5.5/java-docs-bulk-processor.html</span><br>    <span class="hljs-attr">bulkActions:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_BULK_ACTIONS:1000&#125;</span> <span class="hljs-comment"># Execute the bulk every 1000 requests</span><br>    <span class="hljs-attr">flushInterval:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_FLUSH_INTERVAL:10&#125;</span> <span class="hljs-comment"># flush the bulk every 10 seconds whatever the number of requests</span><br>    <span class="hljs-attr">concurrentRequests:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_CONCURRENT_REQUESTS:2&#125;</span> <span class="hljs-comment"># the number of concurrent requests</span><br>    <span class="hljs-attr">resultWindowMaxSize:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_QUERY_MAX_WINDOW_SIZE:10000&#125;</span><br>    <span class="hljs-attr">metadataQueryMaxSize:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_QUERY_MAX_SIZE:5000&#125;</span><br>    <span class="hljs-attr">segmentQueryMaxSize:</span> <span class="hljs-string">$&#123;SW_STORAGE_ES_QUERY_SEGMENT_SIZE:200&#125;</span><br><span class="hljs-comment">#  h2:</span><br><span class="hljs-comment">#    driver: $&#123;SW_STORAGE_H2_DRIVER:org.h2.jdbcx.JdbcDataSource&#125;</span><br><span class="hljs-comment">#    url: $&#123;SW_STORAGE_H2_URL:jdbc:h2:mem:skywalking-oap-db&#125;</span><br><span class="hljs-comment">#    user: $&#123;SW_STORAGE_H2_USER:sa&#125;</span><br><span class="hljs-comment">#    metadataQueryMaxSize: $&#123;SW_STORAGE_H2_QUERY_MAX_SIZE:5000&#125;</span><br></code></pre></td></tr></table></figure><ul><li><pre><code class="hljs">storage.elasticsearch7<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   <br><br>  配置项，设置使用 Elasticsearch <span class="hljs-number">7</span>.X 版本作为存储器。<br><br>  - 这里，我们打开注释，并记得通过 `nameSpace` 设置 Elasticsearch 集群名。<br><br>- ```<br>  storage.elasticsearch<br></code></pre></td></tr></table></figure> 配置项，设置使用 Elasticsearch 6.X 版本作为存储器。- 这里，我们无需做任何改动。- 如果胖友使用 Elasticsearch 6.X 版本作为存储器，记得设置这个配置项，而不是 `storage.elasticsearch7` 配置项。</code></pre></li><li><pre><code class="hljs">storage.h2<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br>   <br><br>  配置项，设置使用 H2 作为存储器。<br><br><span class="hljs-bullet">  -</span> 这里，我们需要手动注释掉，因为 H2 是默认配置的存储器。<br><br><span class="hljs-quote">&gt; 友情提示：如果配置文件，适合 SkyWalking 7.X 版本。</span><br><br>![<span class="hljs-string">配置文件</span>](<span class="hljs-link">https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl534r2llj30pc0rs1kx.jpg</span>)<br><br><span class="hljs-bullet">-</span> 重点修改 <span class="hljs-code">`storage`</span> 配置项，通过 <span class="hljs-code">`storage.selector`</span> 配置项来设置具体使用的存储器。<br><span class="hljs-bullet">-</span> <span class="hljs-code">`storage.elasticsearch`</span> 配置项，设置使用 Elasticsearch 6.X 版本作为存储器。胖友可以主要修改 <span class="hljs-code">`nameSpace`</span>、<span class="hljs-code">`clusterNodes`</span> 两个配置项即可，设置使用的 Elasticsearch 的集群和命名空间。<br><span class="hljs-bullet">-</span> <span class="hljs-code">`storage.elasticsearch7`</span> 配置项，设置使用 Elasticsearch 7.X 版本作为存储器。<br><span class="hljs-bullet">-</span> 还有 MySQL、H2、InfluxDB 等等存储器的配置可以选择，胖友自己根据需要去选择哈~<br><br><span class="hljs-strong">**② 启动 SkyWalking OAP 服务**</span><br><br><span class="hljs-code">```Bash</span><br><span class="hljs-code">$ bin/oapService.sh</span><br><span class="hljs-code"></span><br><span class="hljs-code">SkyWalking OAP started successfully!</span><br></code></pre></td></tr></table></figure></code></pre></li></ul><p>是否<strong>真正</strong>启动成功，胖友打开 <code>logs/skywalking-oap-server.log</code> 日志文件，查看是否有错误日志。首次启动时，因为 SkyWalking OAP 会创建 Elasticsearch 的索引，所以会“疯狂”的打印日志。最终，我们看到如下日志，基本可以代表 SkyWalking OAP 服务启动成功：</p><blockquote><p>友情提示：因为首次启动会创建 Elasticsearch 索引，所以可能会比较慢。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">18</span>:<span class="hljs-number">22</span>:<span class="hljs-number">53</span>,<span class="hljs-number">635</span> - org.eclipse.jetty.server.Server - <span class="hljs-number">444</span> [main] INFO  [] - Started @35249ms<br></code></pre></td></tr></table></figure><h2 id="2-4-SkyWalking-UI-搭建"><a href="#2-4-SkyWalking-UI-搭建" class="headerlink" title="2.4 SkyWalking UI 搭建"></a>2.4 SkyWalking UI 搭建</h2><p><strong>① 启动 SkyWalking UI 服务</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/webappService.sh<br><br>SkyWalking Web Application started successfully!<br></code></pre></td></tr></table></figure><p>是否<strong>真正</strong>启动成功，胖友打开 <code>logs/logs/webapp.log</code> 日志文件，查看是否有错误日志。最终，我们看到如下日志，基本可以代表 SkyWalking UI 服务启动成功：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">18</span>:<span class="hljs-number">27</span>:<span class="hljs-number">02.824</span>  INFO <span class="hljs-number">48250</span> --- [main] o.a.s.apm.webapp.ApplicationStartUp      : Started ApplicationStartUp in <span class="hljs-number">7.774</span> seconds (JVM running <span class="hljs-keyword">for</span> <span class="hljs-number">8.316</span>)<br></code></pre></td></tr></table></figure><p>如果想要修改 SkyWalking UI 服务的参数，可以编辑 <code>webapp/webapp.yml</code> 配置文件。例如说：</p><ul><li><code>server.port</code> ：SkyWalking UI 服务端口。</li><li><code>collector.ribbon.listOfServers</code> ：SkyWalking OAP 服务地址数组。因为 SkyWalking UI 界面的数据，是通过请求 SkyWalking OAP 服务来获得的。</li></ul><p><strong>② 访问 UI 界面：</strong></p><p>浏览器打开 <code>http://127.0.0.1:8080</code> 。界面如下图：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl534a7rnj31f60u0gtw.jpg" alt="SkyWalking UI"></p><h2 id="2-5-SkyWalking-Agent"><a href="#2-5-SkyWalking-Agent" class="headerlink" title="2.5 SkyWalking Agent"></a>2.5 SkyWalking Agent</h2><p>大多数情况下，我们在启动项目的 Shell 脚本上，通过 <code>-javaagent</code> 参数进行配置 SkyWalking Agent 。我们在 <a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「2.3.1 Shell」</a> 小节来看。</p><p>考虑到偶尔我们需要在 IDE 中，也希望使用 SkyWalking Agent ，所以我们在 <a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「2.3.2 IDEA」</a> 小节来看。</p><h3 id="2-3-1-Shell"><a href="#2-3-1-Shell" class="headerlink" title="2.3.1 Shell"></a>2.3.1 Shell</h3><p><strong>① Agent 软件包</strong></p><p>我们需要将 <code>apache-skywalking-apm-bin/agent</code> 目录，拷贝到 Java 应用所在的服务器上。这样，Java 应用才可以配置使用该 SkyWalking Agent。我们来看看 Agent 目录下有哪些：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash">$ <span class="hljs-built_in">ls</span> -<span class="hljs-built_in">ls</span><br><br>total 35176<br>    0 drwxr-xr-x@  7 yunai  staff       224 Dec 24 14:20 activations<br>    0 drwxr-xr-x@  4 yunai  staff       128 Dec 24 14:21 bootstrap-plugins<br>    0 drwxr-xr-x@  3 yunai  staff        96 Dec 24 14:12 config <span class="hljs-comment"># SkyWalking Agent 配置</span><br>    0 drwxr-xr-x@  3 yunai  staff        96 Jan  2 19:29 logs <span class="hljs-comment"># SkyWalking Agent 日志</span><br>    0 drwxr-xr-x@ 13 yunai  staff       416 Dec 24 14:22 optional-plugins <span class="hljs-comment"># 可选插件</span><br>    0 drwxr-xr-x@ 68 yunai  staff      2176 Dec 24 14:20 plugins <span class="hljs-comment"># 插件</span><br>35176 -rw-r--r--@  1 yunai  staff  18006420 Dec 24 14:12 skywalking-agent.jar <span class="hljs-comment"># SkyWalking Agent</span><br></code></pre></td></tr></table></figure><ul><li>关于 SkyWalking Agent 提供的插件列表，可以看看<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/service-agent/java-agent/Supported-list.md">《SkyWalking 文档 —— 插件支持列表》</a>。</li></ul><p>因为艿艿是在本机测试，所以无需拷贝，SkyWalking Agent 目录是 <code>/Users/yunai/skywalking/apache-skywalking-apm-bin-es7/agent/</code>。</p><p>考虑到方便胖友，艿艿这里提供了一个最简的 Spring Boot 应用 <a href="http://static.iocoder.cn/lab-39-demo-2.2.2.RELEASE.jar">lab-39-demo-2.2.2.RELEASE.jar</a>。对应 Github 仓库是 <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-39/lab-39-demo">lab-39-demo</a>。</p><p><strong>② 配置 Java 启动脚本</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># SkyWalking Agent 配置</span><br><span class="hljs-built_in">export</span> SW_AGENT_NAME=demo-application <span class="hljs-comment"># 配置 Agent 名字。一般来说，我们直接使用 Spring Boot 项目的 `spring.application.name` 。</span><br><span class="hljs-built_in">export</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 <span class="hljs-comment"># 配置 Collector 地址。</span><br><span class="hljs-built_in">export</span> SW_AGENT_SPAN_LIMIT=2000 <span class="hljs-comment"># 配置链路的最大 Span 数量。一般情况下，不需要配置，默认为 300 。主要考虑，有些新上 SkyWalking Agent 的项目，代码可能比较糟糕。</span><br><span class="hljs-built_in">export</span> JAVA_AGENT=-javaagent:/Users/yunai/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar <span class="hljs-comment"># SkyWalking Agent jar 地址。</span><br><br><span class="hljs-comment"># Jar 启动</span><br>java -jar <span class="hljs-variable">$JAVA_AGENT</span> -jar lab-39-demo-2.2.2.RELEASE.jar<br></code></pre></td></tr></table></figure><ul><li>通过环境变量，进行配置。</li><li>更多的变量，可以在 <a href="https://github.com/apache/skywalking/blob/master/apm-sniffer/config/agent.config"><code>/work/programs/skywalking/apache-skywalking-apm-bin/agent/config/agent.config</code></a> 查看。要注意，可能有些变量是被注释掉的，例如说 <code>SW_AGENT_SPAN_LIMIT</code> 对应的 <code>agent.span_limit_per_segment</code> 。</li></ul><p><strong>③ 执行脚本：</strong></p><p>直接执行上述的 Shell 脚本，启动 Java 项目。在启动日志中，我们可以看到 SkyWalking Agent 被加载的日志。日志示例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">DEBUG <span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">19</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29</span>:<span class="hljs-number">400</span> main AgentPackagePath : The beacon <span class="hljs-keyword">class</span> <span class="hljs-title class_">location</span> is jar:file:/Users/yunai/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar!/org/apache/skywalking/apm/agent/core/boot/AgentPackagePath.class.<br>INFO <span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">19</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29</span>:<span class="hljs-number">402</span> main SnifferConfigInitializer : Config file found in /Users/yunai/skywalking/apache-skywalking-apm-bin-es7/agent/config/agent.config.<br></code></pre></td></tr></table></figure><p>同时，也可以在 <code>/Users/yunai/skywalking/apache-skywalking-apm-bin-es7/agent/agent/logs/skywalking-api.log</code> 查看对应的 SkyWalking Agent 日志。日志示例如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">DEBUG <span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span> <span class="hljs-number">19</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span>:<span class="hljs-number">539</span> SkywalkingAgent-<span class="hljs-number">5</span>-ServiceAndEndpointRegisterClient-<span class="hljs-number">0</span> ServiceAndEndpointRegisterClient : ServiceAndEndpointRegisterClient running, status:CONNECTED.<br></code></pre></td></tr></table></figure><ul><li>这里，我们看到 <code>status:CONNECTED</code> ，表示 SkyWalking Agent 连接 SkyWalking OAP 服务成功。</li></ul><p><strong>④ 简单测试</strong></p><p>完事，可以去 SkyWalking UI 查看是否链路收集成功。</p><p>1、首先，使用浏览器，访问下 <a href="http://127.0.0.1:8079/demo/echo">http://127.0.0.1:8079/demo/echo</a> 地址，请求下 Spring Boot 应用提供的 API。因为，我们要追踪下该链路。</p><p>2、然后，继续使用浏览器，打开 <a href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a> 地址，进入 SkyWalking UI 界面。如下图所示：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/2017-01-01_02.png" alt="SkyWalking UI 界面 —— 仪表盘"></p><p>这里，我们会看到 SkyWalking 中非常重要的三个概念：</p><ul><li><p><strong>服务(Service)</strong> ：表示对请求提供相同行为的一系列或一组工作负载。在使用 Agent 或 SDK 的时候，你可以定义服务的名字。如果不定义的话，SkyWalking 将会使用你在平台（例如说 Istio）上定义的名字。</p><blockquote><p>这里，我们可以看到 Spring Boot 应用的<strong>服务</strong>为 <code>&quot;demo-application&quot;</code>，就是我们在环境变量 <code>SW_AGENT_NAME</code> 中所定义的。</p></blockquote></li><li><p><strong>服务实例(Service Instance)</strong> ：上述的一组工作负载中的每一个工作负载称为一个实例。就像 Kubernetes 中的 pods 一样, 服务实例未必就是操作系统上的一个进程。但当你在使用 Agent 的时候, 一个服务实例实际就是操作系统上的一个真实进程。</p><blockquote><p>这里，我们可以看到 Spring Boot 应用的<strong>服务</strong>为 <code>&#123;agent_name&#125;-pid:&#123;pid&#125;@&#123;hostname&#125;</code>，由 Agent 自动生成。关于它，我们在<a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「5.1 hostname」</a>小节中，有进一步的讲解，胖友可以瞅瞅。</p></blockquote></li><li><p><strong>端点(Endpoint)</strong> ：对于特定服务所接收的请求路径, 如 HTTP 的 URI 路径和 gRPC 服务的类名 + 方法签名。</p><blockquote><p>这里，我们可以看到 Spring Boot 应用的一个<strong>端点</strong>，为 API 接口 <code>/demo/echo</code>。</p></blockquote></li></ul><p>3、之后，点击「拓扑图」菜单，进入查看拓扑图的界面。如下图所示：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/2017-01-01_03.png" alt="SkyWalking UI 界面 —— 拓扑图"></p><p>4、再之后，点击「追踪」菜单，进入查看链路数据的界面。如下图所示：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl535q88ej31ds0u0k0p.jpg" alt="SkyWalking UI 界面 —— 追踪"></p><h3 id="2-3-2-IDEA"><a href="#2-3-2-IDEA" class="headerlink" title="2.3.2 IDEA"></a>2.3.2 IDEA</h3><p>我们统一使用 IDEA 作为开发 IDE ，所以忽略 Eclipse 的配置方式。</p><p>具体参考下图，比较简单：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/0081Kckwly1gkl5354kg7j30rs0egwkv.jpg" alt="IDEA 界面"></p><h1 id="3-搭建-SkyWalking-集群环境"><a href="#3-搭建-SkyWalking-集群环境" class="headerlink" title="3. 搭建 SkyWalking 集群环境"></a>3. 搭建 SkyWalking 集群环境</h1><p>在生产环境下，我们一般推荐搭建 SkyWalking 集群环境。😈 当然，如果公司比较抠门，也可以在生产环境下使用 SkyWalking 单机环境，毕竟 SkyWalking 挂了之后，不影响业务的正常运行。</p><p>搭建一个 SkyWalking <strong>集群</strong>环境，步骤如下：</p><ul><li>第一步，搭建一个 Elasticsearch 服务的<strong>集群</strong>。</li><li>第二步，搭建一个注册中心的<strong>集群</strong>。目前 SkyWalking 支持 Zookeeper、Kubernetes、Consul、Nacos 作为注册中心。</li><li>第三步，搭建一个 SkyWalking OAP 服务的<strong>集群</strong>，同时参考<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/backend/backend-cluster.md">《SkyWalking 文档 —— 集群管理》</a>，将 SkyWalking OAP 服务注册到注册中心上。</li><li>第四步，启动一个 Spring Boot 应用，并配置 SkyWalking Agent。另外，在设置 SkyWaling Agent 的 <code>SW_AGENT_COLLECTOR_BACKEND_SERVICES</code> 地址时，需要设置多个 SkyWalking OAP 服务的地址数组。</li><li>第五步，搭建一个 SkyWalking UI 服务的<strong>集群</strong>，同时使用 Nginx 进行负载均衡。另外，在设置 SkyWalking UI 的 <code>collector.ribbon.listOfServers</code> 地址时，也需要设置多个 SkyWalking OAP 服务的地址数组。</li></ul><p>😈 具体的搭建过程，并不复杂，胖友自己去尝试下。</p><h1 id="4-告警"><a href="#4-告警" class="headerlink" title="4. 告警"></a>4. 告警</h1><p>在 SkyWaling 中，已经提供了告警功能，具体可见<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/backend/backend-alarm.md">《SkyWalking 文档 —— 告警》</a>。</p><p>默认情况下，SkyWalking 已经<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/backend/backend-alarm.md#%E9%BB%98%E8%AE%A4%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99">内置告警规则</a>。同时，我们可以参考<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/backend/backend-alarm.md#%E8%A7%84%E5%88%99">告警规则</a>，进行自定义。</p><p>在满足 SkyWalking 告警规则的触发规则时，我们在 SkyWaling UI 的告警界面，可以看到告警内容。如下图所示：<img src="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/2017-01-01_06.png" alt="SkyWaling UI 界面 —— 告警"></p><p>同时，我们自定义 <a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking/blob/master/docs/zh/master/setup/backend/backend-alarm.md#webhook">Webhook</a> ，对接 SkyWalking 的告警请求。而具体的邮箱、钉钉等告警方式，需要自己进行开发。至于自定义 WebHook 如何实现，可以参考：</p><ul><li>Java 语言：<ul><li><a href="http://www.iocoder.cn/Fight/Distributed-tracking-system-based-on-SkyWalking-abnormal-alert/?self">《基于 SkyWalking 的分布式跟踪系统 - 异常告警》</a></li></ul></li><li>Go 语言：<ul><li><a href="https://github.com/yanmaipian/dingding-notify-for-skywalking">dingding-notify-for-skywalking</a></li><li><a href="https://github.com/weiqiang333/infra-skywalking-webhook">infra-skywalking-webhook</a></li></ul></li></ul><h1 id="5-注意事项"><a href="#5-注意事项" class="headerlink" title="5. 注意事项"></a>5. 注意事项</h1><h2 id="5-1-hostname-配置"><a href="#5-1-hostname-配置" class="headerlink" title="5.1 hostname 配置"></a>5.1 hostname 配置</h2><p>在 SkyWalking 中，每个被监控的实例的名字，会包含 hostname 。格式为：<code>&#123;agent_name&#125;-pid:&#123;pid&#125;@&#123;hostname&#125;</code> ，例如说：<code>&quot;scrm-scheduler-pid:27629@iZbp1e2xlyvr7fh67qi59oZ&quot;</code> 。</p><p>因为有些服务器未正确设置 <code>hostname</code> ，所以我们一定要去修改，不然都不知道是哪个服务器上的实例（😈 鬼知道 <code>&quot;iZbp1e2xlyvr7fh67qi59oZ&quot;</code> 一串是哪个服务器啊）。</p><p>修改方式如下：</p><p><strong>1、修改 <code>/etc/hosts</code> 的 <code>hostname</code></strong> ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">127.0.0.1 localhost<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br>10.80.62.151 pre-app-01 <span class="hljs-comment"># 就是这个，其中 10.80.62.151 是本机内网 IP ，pre-app-01 是 hostname 。</span><br></code></pre></td></tr></table></figure><p><strong>2、修改本机 <code>hostname</code></strong> ：</p><p>参考 <a href="https://yq.aliyun.com/articles/427296">《CentOS7 修改主机名（hostname）》</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">$ hostname pre-app-01 <span class="hljs-comment"># 其中 pre-app-01 就是你希望的 hostname 。</span><br><br>$ hostnamectl set-hostname pre-app-01 <span class="hljs-comment"># 其中 pre-app-01 就是你希望的 hostname 。</span><br></code></pre></td></tr></table></figure><h1 id="6-Spring-Boot-使用示例"><a href="#6-Spring-Boot-使用示例" class="headerlink" title="6. Spring Boot 使用示例"></a>6. Spring Boot 使用示例</h1><p>在 <a href="http://www.iocoder.cn/Spring-Boot/SkyWalking/?self">《芋道 Spring Boot 链路追踪 SkyWalking 入门》</a> 中，我们来详细学习如何在 Spring Boot 中，整合并使用 SkyWalking 收集链路数据。😈 相比<a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「2.5 SkyWaling Agent」</a>来说，我们会提供更加丰富的示例哟。</p><h1 id="7-Spring-Cloud-使用示例"><a href="#7-Spring-Cloud-使用示例" class="headerlink" title="7. Spring Cloud 使用示例"></a>7. Spring Cloud 使用示例</h1><p>在 <a href="http://www.iocoder.cn/Spring-Cloud/SkyWalking/?self">《芋道 Spring Cloud 链路追踪 SkyWalking 入门》</a> 中，我们来详细学习如何在 Spring Cloud 中，整合并使用 SkyWalking 收集链路数据。😈 相比<a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#">「2.5 SkyWaling Agent」</a>来说，我们会提供更加丰富的示例哟。</p><h1 id="666-彩蛋"><a href="#666-彩蛋" class="headerlink" title="666. 彩蛋 "></a>666. 彩蛋<a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/#666-%E5%BD%A9%E8%9B%8B"> </a></h1><p>本文仅仅是简单的 SkyWalking 入门文章，如果胖友想要更好的使用 SkyWalking，推荐通读下<a href="https://github.com/SkyAPM/document-cn-translation-of-skywalking">《SkyWalking 文档》</a>。</p><p>想要进一步深入的胖友，也可以阅读如下资料：</p><ul><li><a href="http://www.iocoder.cn/categories/SkyWalking/?self">《SkyWalking 源码解析》</a></li><li><a href="http://www.iocoder.cn/Fight/APM-Apache-Skywalking-and-Pinpoint/?self">《APM 巅峰对决：Apache Skywalking P.K. Pinpoint》</a></li><li><a href="http://skywalking.apache.org/zh/blog/">《SkyWalking 官方 —— 博客合集》</a></li></ul><p>😈 最后弱弱的问一句，上完 SkyWaling 之后，有没发现自己系统各种地方慢慢慢！嘻嘻。</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>SkyWalking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PromQL内置函数</title>
    <link href="/2023/04/24/PromQL%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/"/>
    <url>/2023/04/24/PromQL%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<p>Prometheus 提供了其它大量的内置函数，可以对时序数据进行丰富的处理。某些函数有默认的参数，例如：<code>year(v=vector(time()) instant-vector)</code>。其中参数 <code>v</code> 是一个瞬时向量，如果不提供该参数，将使用默认值 <code>vector(time())</code>。instant-vector 表示参数类型。</p><h2 id="abs"><a href="#abs" class="headerlink" title="abs()"></a>abs()</h2><p><code>abs(v instant-vector)</code> 返回输入向量的所有样本的绝对值。</p><h2 id="absent"><a href="#absent" class="headerlink" title="absent()"></a>absent()</h2><p><code>absent(v instant-vector)</code>，如果传递给它的向量参数具有样本数据，则返回空向量；如果传递的向量参数没有样本数据，则返回不带度量指标名称且带有标签的时间序列，且样本值为1。</p><p>当监控度量指标时，如果获取到的样本数据是空的， 使用 absent 方法对告警是非常有用的。例如：</p><p># 这里提供的向量有样本数据</p><p>absent(http_requests_total{method&#x3D;”get”}) &#x3D;&gt; no data</p><p>absent(sum(http_requests_total{method&#x3D;”get”})) &#x3D;&gt; no data</p><p># 由于不存在度量指标 nonexistent，所以 返回不带度量指标名称且带有标签的时间序列，且样本值为1</p><p>absent(nonexistent{job&#x3D;”myjob”}) &#x3D;&gt; {job&#x3D;”myjob”} 1</p><p># 正则匹配的 instance 不作为返回 labels 中的一部分</p><p>absent(nonexistent{job&#x3D;”myjob”,instance&#x3D;~”.*”}) &#x3D;&gt; {job&#x3D;”myjob”} 1</p><p># sum 函数返回的时间序列不带有标签，且没有样本数据</p><p>absent(sum(nonexistent{job&#x3D;”myjob”})) &#x3D;&gt; {} 1</p><h2 id="ceil"><a href="#ceil" class="headerlink" title="ceil()"></a>ceil()</h2><p><code>ceil(v instant-vector)</code> 将 v 中所有元素的样本值向上四舍五入到最接近的整数。例如：</p><p>node_load5{instance&#x3D;”192.168.1.75:9100”} # 结果为 2.79</p><p>ceil(node_load5{instance&#x3D;”192.168.1.75:9100”}) # 结果为 3</p><h2 id="changes"><a href="#changes" class="headerlink" title="changes()"></a>changes()</h2><p><code>changes(v range-vector)</code> 输入一个区间向量， 返回这个区间向量内每个样本数据值变化的次数（瞬时向量）。例如：</p><p># 如果样本数据值没有发生变化，则返回结果为 1</p><p>changes(node_load5{instance&#x3D;”192.168.1.75:9100”}[1m]) # 结果为 1</p><h2 id="clamp-max"><a href="#clamp-max" class="headerlink" title="clamp_max()"></a>clamp_max()</h2><p><code>clamp_max(v instant-vector, max scalar)</code> 函数，输入一个瞬时向量和最大值，样本数据值若大于 max，则改为 max，否则不变。例如：</p><p>node_load5{instance&#x3D;”192.168.1.75:9100”} # 结果为 2.79</p><p>clamp_max(node_load5{instance&#x3D;”192.168.1.75:9100”}, 2) # 结果为 2</p><h2 id="clamp-min"><a href="#clamp-min" class="headerlink" title="clamp_min()"></a>clamp_min()</h2><p><code>clamp_min(v instant-vector, min scalar)</code> 函数，输入一个瞬时向量和最小值，样本数据值若小于 min，则改为 min，否则不变。例如：</p><p>node_load5{instance&#x3D;”192.168.1.75:9100”} # 结果为 2.79</p><p>clamp_min(node_load5{instance&#x3D;”192.168.1.75:9100”}, 3) # 结果为 3</p><h2 id="day-of-month"><a href="#day-of-month" class="headerlink" title="day_of_month()"></a>day_of_month()</h2><p><code>day_of_month(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在月的第几天。返回值范围：1~31。</p><h2 id="day-of-week"><a href="#day-of-week" class="headerlink" title="day_of_week()"></a>day_of_week()</h2><p><code>day_of_week(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在周的第几天。返回值范围：0~6，0 表示星期天。</p><h2 id="days-in-month"><a href="#days-in-month" class="headerlink" title="days_in_month()"></a>days_in_month()</h2><p><code>days_in_month(v=vector(time()) instant-vector)</code> 函数，返回当月一共有多少天。返回值范围：28~31。</p><h2 id="delta"><a href="#delta" class="headerlink" title="delta()"></a>delta()</h2><p><code>delta(v range-vector)</code> 的参数是一个区间向量，返回一个瞬时向量。它计算一个区间向量 v 的第一个元素和最后一个元素之间的差值。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p><p>例如，下面的例子返回过去两小时的 CPU 温度差：</p><p>delta(cpu_temp_celsius{host&#x3D;”zeus”}[2h])</p><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="deriv"><a href="#deriv" class="headerlink" title="deriv()"></a>deriv()</h2><p><code>deriv(v range-vector)</code> 的参数是一个区间向量,返回一个瞬时向量。它使用<a href="http://en.wikipedia.org/wiki/Simple_linear_regression">简单的线性回归</a>计算区间向量 v 中各个时间序列的导数。</p><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp()"></a>exp()</h2><p><code>exp(v instant-vector)</code> 函数，输入一个瞬时向量，返回各个样本值的 <code>e</code> 的指数值，即 e 的 N 次方。当 N 的值足够大时会返回 <code>+Inf</code>。特殊情况为：</p><ul><li><code>Exp(+Inf) = +Inf</code></li><li><code>Exp(NaN) = NaN</code></li></ul><h2 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h2><p><code>floor(v instant-vector)</code> 函数与 ceil() 函数相反，将 v 中所有元素的样本值向下四舍五入到最接近的整数。</p><h2 id="histogram-quantile"><a href="#histogram-quantile" class="headerlink" title="histogram_quantile()"></a>histogram_quantile()</h2><p><code>histogram_quantile(φ float, b instant-vector)</code> 从 bucket 类型的向量 <code>b</code> 中计算 φ (0 ≤ φ ≤ 1) 分位数（百分位数的一般形式）的样本的最大值。（有关 φ 分位数的详细说明以及直方图指标类型的使用，请参阅<a href="https://prometheus.io/docs/practices/histograms">直方图和摘要</a>）。向量 <code>b</code> 中的样本是每个 bucket 的采样点数量。每个样本的 labels 中必须要有 <code>le</code> 这个 label 来表示每个 bucket 的上边界，没有 <code>le</code> 标签的样本会被忽略。直方图指标类型自动提供带有 <code>_bucket</code> 后缀和相应标签的时间序列。</p><p>可以使用 <code>rate()</code> 函数来指定分位数计算的时间窗口。</p><p>例如，一个直方图指标名称为 <code>employee_age_bucket_bucket</code>，要计算过去 10 分钟内 第 90 个百分位数，请使用以下表达式：</p><p>histogram_quantile(0.9, rate(employee_age_bucket_bucket[10m]))</p><p>返回：</p><p>{instance&#x3D;”10.0.86.71:8080”,job&#x3D;”prometheus”} 35.714285714285715</p><p>这表示最近 10 分钟之内 90% 的样本的最大值为 35.714285714285715。</p><p>这个计算结果是每组标签组合成一个时间序列。我们可能不会对所有这些维度（如 <code>job</code>、<code>instance</code> 和 <code>method</code>）感兴趣，并希望将其中的一些维度进行聚合，则可以使用 sum() 函数。例如，以下表达式根据 <code>job</code> 标签来对第 90 个百分位数进行聚合：</p><p># histogram_quantile() 函数必须包含 le 标签</p><p>histogram_quantile(0.9, sum(rate(employee_age_bucket_bucket[10m])) by (job, le))</p><p>如果要聚合所有的标签，则使用如下表达式：</p><p>histogram_quantile(0.9,sum(rate(employee_age_bucket_bucket[10m])) by (le))</p><blockquote><p><strong>[info] 注意</strong></p><p><code>histogram_quantile</code> 这个函数是根据假定每个区间内的样本分布是线性分布来计算结果值的(也就是说它的结果未必准确)，最高的 bucket 必须是 le&#x3D;”+Inf” (否则就返回 NaN)。</p><p>如果分位数位于最高的 bucket（+Inf） 中，则返回第二个最高的 bucket 的上边界。如果该 bucket 的上边界大于 0，则假设最低的 bucket 的的下边界为 0，这种情况下在该 bucket 内使用常规的线性插值。</p><p>如果分位数位于最低的 bucket 中，则返回最低 bucket 的上边界。</p></blockquote><p>如果 b 含有少于 2 个 buckets，那么会返回 <code>NaN</code>，如果 φ &lt; 0 会返回 <code>-Inf</code>，如果 φ &gt; 1 会返回 <code>+Inf</code>。</p><h2 id="holt-winters"><a href="#holt-winters" class="headerlink" title="holt_winters()"></a>holt_winters()</h2><p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code> 函数基于区间向量 v，生成时间序列数据平滑值。平滑因子 <code>sf</code> 越低, 对旧数据的重视程度越高。趋势因子 <code>tf</code> 越高，对数据的趋势的考虑就越多。其中，<code>0&lt; sf, tf &lt;=1</code>。</p><p>holt_winters 仅适用于 Gauge 类型的时间序列。</p><h2 id="hour"><a href="#hour" class="headerlink" title="hour()"></a>hour()</h2><p><code>hour(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前第几个小时，时间范围：0~23。</p><h2 id="idelta"><a href="#idelta" class="headerlink" title="idelta()"></a>idelta()</h2><p>idelta(v range-vector) 的参数是一个区间向量, 返回一个瞬时向量。它计算最新的 2 个样本值之间的差值。</p><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="increase"><a href="#increase" class="headerlink" title="increase()"></a>increase()</h2><p><code>increase(v range-vector)</code> 函数获取区间向量中的第一个和最后一个样本并返回其增长量, 它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内 HTTP 请求数的增长数：</p><p>？increase(http_requests_total{job&#x3D;”apiserver”}[5m])</p><p><code>increase</code> 的返回值类型只能是计数器类型，主要作用是增加图表和数据的可读性。使用 <code>rate</code> 函数记录规则的使用率，以便持续跟踪数据样本值的变化。</p><h2 id="irate"><a href="#irate" class="headerlink" title="irate()"></a>irate()</h2><p><code>irate(v range-vector)</code> 函数用于计算区间向量的增长率，但是其反应出的是瞬时增长率。irate 函数是通过区间向量中最后两个两本数据来计算区间向量的增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。这种方式可以避免在时间窗口范围内的“长尾问题”，并且体现出更好的灵敏度，通过irate函数绘制的图标能够更好的反应样本数据的瞬时变化状态。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内最后两个样本数据的 HTTP 请求数的增长率：</p><p>irate(http_requests_total{job&#x3D;”api-server”}[5m])</p><p>irate 只能用于绘制快速变化的计数器，在长期趋势分析或者告警中更推荐使用 rate 函数。因为使用 irate 函数时，速率的简短变化会重置 <code>FOR</code> 语句，形成的图形有很多波峰，难以阅读。</p><blockquote><p><strong>[info] 注意</strong></p><p>当将 <code>irate()</code> 函数与<a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators">聚合运算符</a>（例如 <code>sum()</code>）或随时间聚合的函数（任何以 <code>_over_time</code> 结尾的函数）一起使用时，必须先执行 irate 函数，然后再进行聚合操作，否则当采样目标重新启动时 irate() 无法检测到计数器是否被重置。</p></blockquote><h2 id="label-join"><a href="#label-join" class="headerlink" title="label_join()"></a>label_join()</h2><p><code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code> 函数可以将时间序列 v 中多个标签 <code>src_label</code> 的值，通过 <code>separator</code> 作为连接符写入到一个新的标签 <code>dst_label</code> 中。可以有多个 src_label 标签。</p><p>例如，以下表达式返回的时间序列多了一个 <code>foo</code> 标签，标签值为 <code>etcd,etcd-k8s</code>：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xquery">This <span class="hljs-literal">is</span> a code block<br>  up&#123;endpoint=<span class="hljs-string">&quot;api&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;192.168.123.248:2379&quot;</span>,job=<span class="hljs-string">&quot;etcd&quot;</span>,<span class="hljs-type">namespace</span>=<span class="hljs-string">&quot;monitoring&quot;</span>,service=<span class="hljs-string">&quot;etcd-k8s&quot;</span>&#125; =&gt; up&#123;endpoint=<span class="hljs-string">&quot;api&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;192.168.123.248:2379&quot;</span>,job=<span class="hljs-string">&quot;etcd&quot;</span>,<span class="hljs-type">namespace</span>=<span class="hljs-string">&quot;monitoring&quot;</span>,service=<span class="hljs-string">&quot;etcd-k8s&quot;</span>&#125; <span class="hljs-number">1</span><br>  <span class="hljs-number">1</span>label_join(up&#123;endpoint=<span class="hljs-string">&quot;api&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;192.168.123.248:2379&quot;</span>,job=<span class="hljs-string">&quot;etcd&quot;</span>,<span class="hljs-type">namespace</span>=<span class="hljs-string">&quot;monitoring&quot;</span>,service=<span class="hljs-string">&quot;etcd-k8s&quot;</span>&#125;, <span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;job&quot;</span>, <span class="hljs-string">&quot;service&quot;</span>) =&gt; up&#123;endpoint=<span class="hljs-string">&quot;api&quot;</span>,foo=<span class="hljs-string">&quot;etcd,etcd-k8s&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;192.168.123.248:2379&quot;</span>,job=<span class="hljs-string">&quot;etcd&quot;</span>,<span class="hljs-type">namespace</span>=<span class="hljs-string">&quot;monitoring&quot;</span>,service=<span class="hljs-string">&quot;etcd-k8s&quot;</span>&#125;  <span class="hljs-number">1</span><br>    <br></code></pre></td></tr></table></figure><h2 id="label-replace"><a href="#label-replace" class="headerlink" title="label_replace()"></a>label_replace()</h2><p>为了能够让客户端的图标更具有可读性，可以通过 <code>label_replace</code> 函数为时间序列添加额外的标签。label_replace 的具体参数如下：</p><p>label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)</p><p>该函数会依次对 v 中的每一条时间序列进行处理，通过 <code>regex</code> 匹配 src_label 的值，并将匹配部分 <code>relacement</code> 写入到 dst_label 标签中。如下所示：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">This is <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">code</span> block<br>  <span class="hljs-built_in">label_replace</span>(up, <span class="hljs-string">&quot;host&quot;</span>, <span class="hljs-string">&quot;$1&quot;</span>, <span class="hljs-string">&quot;instance&quot;</span>,  <span class="hljs-string">&quot;(.*):.*&quot;</span>)<br>    <br></code></pre></td></tr></table></figure><p>函数处理后，时间序列将包含一个 <code>host</code> 标签，host 标签的值为 Exporter 实例的 IP 地址：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">This is a <span class="hljs-keyword">code</span> block<br>  up&#123;host=<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;localhost:8080&quot;</span>,job=<span class="hljs-string">&quot;cadvisor&quot;</span>&#125;   <span class="hljs-number">1</span><br>  up&#123;host=<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;localhost:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>&#125;   <span class="hljs-number">1</span><br>  up&#123;host=<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;localhost:9100&quot;</span>,job=<span class="hljs-string">&quot;node&quot;</span>&#125;   <span class="hljs-number">1</span><br>    <br></code></pre></td></tr></table></figure><h2 id="ln"><a href="#ln" class="headerlink" title="ln()"></a>ln()</h2><p><code>ln(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的自然对数。特殊情况：</p><ul><li><code>ln(+Inf) = +Inf</code></li><li><code>ln(0) = -Inf</code></li><li><code>ln(x &lt; 0) = NaN</code></li><li><code>ln(NaN) = NaN</code></li></ul><h2 id="log2"><a href="#log2" class="headerlink" title="log2()"></a>log2()</h2><p><code>log2(v instant-vector)</code> 函数计算瞬时向量 v 中所有样本数据的二进制对数。特殊情况同上。</p><h2 id="log10"><a href="#log10" class="headerlink" title="log10()"></a>log10()</h2><p><code>log10(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的十进制对数。特殊情况同上。</p><h2 id="minute"><a href="#minute" class="headerlink" title="minute()"></a>minute()</h2><p><code>minute(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前小时的第多少分钟。结果范围：0~59。</p><h2 id="month"><a href="#month" class="headerlink" title="month()"></a>month()</h2><p><code>month(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前属于第几个月，结果范围：0~12。</p><h2 id="predict-linear"><a href="#predict-linear" class="headerlink" title="predict_linear()"></a>predict_linear()</h2><p><code>predict_linear(v range-vector, t scalar)</code> 函数可以预测时间序列 v 在 t 秒后的值。它基于简单线性回归的方式，对时间窗口内的样本数据进行统计，从而可以对时间序列的变化趋势做出预测。该函数的返回结果<strong>不带有度量指标</strong>，只有标签列表。</p><p>例如，基于 2 小时的样本数据，来预测主机可用磁盘空间的是否在 4 个小时候被占满，可以使用如下表达式：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">predict_linear</span>(node_filesystem_free&#123;job=<span class="hljs-string">&quot;node&quot;</span>&#125;[<span class="hljs-number">2</span>h], <span class="hljs-number">4</span> * <span class="hljs-number">3600</span>) &lt; <span class="hljs-number">0</span><br>  <br></code></pre></td></tr></table></figure><p>基于10 小时的样本数据，预测windows主机未来24小时内存是否会被占满：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">predict_linear</span>(windows_os_physical_memory_free_bytes[<span class="hljs-number">10</span>h], <span class="hljs-number">24</span>*<span class="hljs-number">3600</span>) &lt;= <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>通过下面的例子来观察返回值：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">predict<span class="hljs-constructor">_linear(<span class="hljs-params">http_requests_total</span>&#123;<span class="hljs-params">code</span>=<span class="hljs-string">&quot;200&quot;</span>,<span class="hljs-params">instance</span>=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,<span class="hljs-params">job</span>=<span class="hljs-string">&quot;prometheus&quot;</span>,<span class="hljs-params">method</span>=<span class="hljs-string">&quot;get&quot;</span>&#125;[5m], 5)</span><br><br><br>结果<br>&#123;code=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;query_range&quot;</span>,instance=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,<span class="hljs-keyword">method</span>=<span class="hljs-string">&quot;get&quot;</span>&#125;  <span class="hljs-number">1</span><br>&#123;code=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;prometheus&quot;</span>,instance=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,<span class="hljs-keyword">method</span>=<span class="hljs-string">&quot;get&quot;</span>&#125;   <span class="hljs-number">4283.449995397104</span><br>code=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;static&quot;</span>,instance=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,<span class="hljs-keyword">method</span>=<span class="hljs-string">&quot;get&quot;</span>&#125;   <span class="hljs-number">22.99999999999999</span><span class="hljs-operator"></span><br><span class="hljs-operator">...</span><br><span class="hljs-operator"></span><br></code></pre></td></tr></table></figure><p>这个函数一般只用在 Gauge 类型的时间序列上。</p><h2 id="rate"><a href="#rate" class="headerlink" title="rate()"></a>rate()</h2><p><code>rate(v range-vector)</code> 函数可以直接计算区间向量 v 在时间窗口内平均增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。该函数的返回结果<strong>不带有度量指标</strong>，只有标签列表。</p><p>例如，以下表达式返回区间向量中每个时间序列过去 5 分钟内 HTTP 请求数的每秒增长率：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">rate(http_requests_total[<span class="hljs-number">5</span>m])<br>结果：  <br>&#123;<span class="hljs-keyword">code</span>=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;label_values&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,method=<span class="hljs-string">&quot;get&quot;</span>&#125; <span class="hljs-number">0</span><br>&#123;<span class="hljs-keyword">code</span>=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;query_range&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,method=<span class="hljs-string">&quot;get&quot;</span>&#125;  <span class="hljs-number">0</span><br>&#123;<span class="hljs-keyword">code</span>=<span class="hljs-string">&quot;200&quot;</span>,handler=<span class="hljs-string">&quot;prometheus&quot;</span>,<span class="hljs-keyword">instance</span>=<span class="hljs-string">&quot;120.77.65.193:9090&quot;</span>,job=<span class="hljs-string">&quot;prometheus&quot;</span>,method=<span class="hljs-string">&quot;get&quot;</span>&#125;   <span class="hljs-number">0.2</span><br>...<br><br></code></pre></td></tr></table></figure><p>rate() 函数返回值类型只能用计数器，在长期趋势分析或者告警中推荐使用这个函数。</p><blockquote><p><strong>[info] 注意</strong></p><p>当将 <code>rate()</code> 函数与<a href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators">聚合运算符</a>（例如 <code>sum()</code>）或随时间聚合的函数（任何以 <code>_over_time</code> 结尾的函数）一起使用时，必须先执行 rate 函数，然后再进行聚合操作，否则当采样目标重新启动时 rate() 无法检测到计数器是否被重置。</p></blockquote><h2 id="resets"><a href="#resets" class="headerlink" title="resets()"></a>resets()</h2><p><code>resets(v range-vector)</code> 的参数是一个区间向量。对于每个时间序列，它都返回一个计数器重置的次数。两个连续样本之间的值的减少被认为是一次计数器重置。</p><p>这个函数一般只用在计数器类型的时间序列上。</p><h2 id="round"><a href="#round" class="headerlink" title="round()"></a>round()</h2><p><code>round(v instant-vector, to_nearest=1 scalar)</code> 函数与 <code>ceil</code> 和 <code>floor</code> 函数类似，返回向量中所有样本值的最接近的整数。<code>to_nearest</code> 参数是可选的,默认为 1,表示样本返回的是最接近 1 的整数倍的值。你也可以将该参数指定为任意值（也可以是小数），表示样本返回的是最接近它的整数倍的值。</p><h2 id="scalar"><a href="#scalar" class="headerlink" title="scalar()"></a>scalar()</h2><p><code>scalar(v instant-vector)</code> 函数的参数是一个单元素的瞬时向量,它返回其唯一的时间序列的值作为一个标量。如果度量指标的样本数量大于 1 或者等于 0, 则返回 <code>NaN</code>。</p><h2 id="sort"><a href="#sort" class="headerlink" title="sort()"></a>sort()</h2><p><code>sort(v instant-vector)</code> 函数对向量按元素的值进行升序排序，返回结果：key: value &#x3D; 度量指标：样本值[升序排列]。</p><h2 id="sort-desc"><a href="#sort-desc" class="headerlink" title="sort_desc()"></a>sort_desc()</h2><p><code>sort(v instant-vector)</code> 函数对向量按元素的值进行降序排序，返回结果：key: value &#x3D; 度量指标：样本值[降序排列]。</p><h2 id="sqrt"><a href="#sqrt" class="headerlink" title="sqrt()"></a>sqrt()</h2><p><code>sqrt(v instant-vector)</code> 函数计算向量 v 中所有元素的平方根。</p><h2 id="time"><a href="#time" class="headerlink" title="time()"></a>time()</h2><p><code>time()</code> 函数返回从 1970-01-01 到现在的秒数。注意：它不是直接返回当前时间，而是时间戳</p><h2 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp()"></a>timestamp()</h2><p><code>timestamp(v instant-vector)</code> 函数返回向量 v 中的每个样本的时间戳（从 1970-01-01 到现在的秒数）。</p><p>该函数从 Prometheus 2.0 版本开始引入。</p><h2 id="vector"><a href="#vector" class="headerlink" title="vector()"></a>vector()</h2><p><code>vector(s scalar)</code> 函数将标量 s 作为没有标签的向量返回，即返回结果为：key: value&#x3D; {}, s。</p><h2 id="year"><a href="#year" class="headerlink" title="year()"></a>year()</h2><p><code>year(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前年份。</p><h2 id="lt-aggregation-gt-over-time"><a href="#lt-aggregation-gt-over-time" class="headerlink" title="&lt;aggregation&gt;_over_time()"></a><code>&lt;aggregation&gt;_over_time()</code></h2><p>下面的函数列表允许传入一个区间向量，它们会聚合每个时间序列的范围，并返回一个瞬时向量：</p><ul><li><code>avg_over_time(range-vector)</code> : 区间向量内每个度量指标的平均值。</li><li><code>min_over_time(range-vector)</code> : 区间向量内每个度量指标的最小值。</li><li><code>max_over_time(range-vector)</code> : 区间向量内每个度量指标的最大值。</li><li><code>sum_over_time(range-vector)</code> : 区间向量内每个度量指标的求和。</li><li><code>count_over_time(range-vector)</code> : 区间向量内每个度量指标的样本数据个数。</li><li><code>quantile_over_time(scalar, range-vector)</code> : 区间向量内每个度量指标的样本数据值分位数，φ-quantile (0 ≤ φ ≤ 1)。</li><li><code>stddev_over_time(range-vector)</code> : 区间向量内每个度量指标的总体标准差。</li><li><code>stdvar_over_time(range-vector)</code> : 区间向量内每个度量指标的总体标准方差。</li></ul><blockquote><p><strong>[info] 注意</strong></p><p>即使区间向量内的值分布不均匀，它们在聚合时的权重也是相同的。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>Prometheus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zabbix5.0版本Docker-compose.yml</title>
    <link href="/2023/04/23/Zabbix5-0%E7%89%88%E6%9C%ACDocker-compose-yml/"/>
    <url>/2023/04/23/Zabbix5-0%E7%89%88%E6%9C%ACDocker-compose-yml/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>鉴于网络中各个文章讲述的docker方式安装一套zabbix—server端都模糊不清及国内网络连接docker服务器拉取镜像一直无法成功的拉取完整镜像，遂分享自己经过测试和使用无异常的docker-compose文件，旨在让大家可以快速高效的部署一套即开即用的zabbix服务端。</p><h1 id="docker-compose配置分享"><a href="#docker-compose配置分享" class="headerlink" title="docker-compose配置分享"></a>docker-compose配置分享</h1><p>以下为<code>docker-compose.yml</code>文件，请根据自己的情况更改mysql密码及zabbix管理密码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">zabbix-db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zabbix-db</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_USER=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_PASSWORD=zabbix123</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=Zabbix123</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;$&#123;PWD&#125;/mysql:/var/lib/mysql&quot;</span><br><br>  <span class="hljs-attr">zabbix-server-mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">zabbix/zabbix-server-mysql:ubuntu-5.0-latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zabbix-server-mysql</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_SERVER_HOST=mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_USER=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_PASSWORD=zabbix123</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=Zabbix123</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;$&#123;PWD&#125;/zabbix/alertscripts:/usr/lib/zabbix/alertscripts&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;10051:10051&quot;</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zabbix-db:mysql</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zabbix-db</span><br><br>  <span class="hljs-attr">zabbix-web-nginx-mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">zabbix/zabbix-web-nginx-mysql:ubuntu-5.0-latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zabbix-web-nginx-mysql</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_SERVER_HOST=mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_USER=zabbix</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_PASSWORD=zabbix123</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=Zabbix123</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">PHP_TZ=Asia/Shanghai</span><br><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8082:8080&quot;</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zabbix-db:mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zabbix-server-mysql:zabbix-server</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zabbix-server-mysql</span><br><br><span class="hljs-attr">networks:</span> <br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-attr">external:</span> <br>      <span class="hljs-attr">name:</span> <span class="hljs-string">zabbix</span><br></code></pre></td></tr></table></figure><p><span style="color: #519D9E; ">注：个人建议在启动前先docker pull下载对应docker镜像，因为在国内网络环境下有些惊喜无法正常下载</span><br>如遇无法下载或无法完整下载的镜像时，可以访问<a href="https://www.zabbix.com/container_images">Zabbix Docker images</a>Zabbix官网镜像地址跳转至docker镜像库中，在tags中选择自己需要的版本并在本地使用docker pull xxx 进行测试是否可以正常下载镜像</p><p>分享一个yaml格式检查网站：<a href="https://www.yamllint.com/">YAMLlint - The YAML Validator</a></p><h1 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h1><h2 id="Mysql字符集导致zabbix无法插入中文"><a href="#Mysql字符集导致zabbix无法插入中文" class="headerlink" title="Mysql字符集导致zabbix无法插入中文"></a>Mysql字符集导致zabbix无法插入中文</h2><h3 id="1-查看当前数据库支持的字符集"><a href="#1-查看当前数据库支持的字符集" class="headerlink" title="1. 查看当前数据库支持的字符集"></a>1. 查看当前数据库支持的字符集</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> ;  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+  </span><br><br><span class="hljs-operator">|</span> Charset  <span class="hljs-operator">|</span> Description                     <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-keyword">collation</span>   <span class="hljs-operator">|</span> Maxlen <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+  </span><br><br><span class="hljs-operator">|</span> big5     <span class="hljs-operator">|</span> Big5 Traditional Chinese        <span class="hljs-operator">|</span> big5_chinese_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> dec8     <span class="hljs-operator">|</span> <span class="hljs-type">DEC</span> West European               <span class="hljs-operator">|</span> dec8_swedish_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp850    <span class="hljs-operator">|</span> DOS West European               <span class="hljs-operator">|</span> cp850_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> hp8      <span class="hljs-operator">|</span> HP West European                <span class="hljs-operator">|</span> hp8_english_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> koi8r    <span class="hljs-operator">|</span> KOI8<span class="hljs-operator">-</span>R Relcom Russian           <span class="hljs-operator">|</span> koi8r_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> latin1   <span class="hljs-operator">|</span> cp1252 West European            <span class="hljs-operator">|</span> latin1_swedish_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> latin2   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-2</span> Central European     <span class="hljs-operator">|</span> latin2_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> swe7     <span class="hljs-operator">|</span> <span class="hljs-number">7</span>bit Swedish                    <span class="hljs-operator">|</span> swe7_swedish_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> ascii    <span class="hljs-operator">|</span> US ASCII                        <span class="hljs-operator">|</span> ascii_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> ujis     <span class="hljs-operator">|</span> EUC<span class="hljs-operator">-</span>JP Japanese                 <span class="hljs-operator">|</span> ujis_japanese_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> sjis     <span class="hljs-operator">|</span> Shift<span class="hljs-operator">-</span>JIS Japanese              <span class="hljs-operator">|</span> sjis_japanese_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> hebrew   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-8</span> Hebrew               <span class="hljs-operator">|</span> hebrew_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> tis620   <span class="hljs-operator">|</span> TIS620 Thai                     <span class="hljs-operator">|</span> tis620_thai_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> euckr    <span class="hljs-operator">|</span> EUC<span class="hljs-operator">-</span>KR Korean                   <span class="hljs-operator">|</span> euckr_korean_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> koi8u    <span class="hljs-operator">|</span> KOI8<span class="hljs-operator">-</span>U Ukrainian                <span class="hljs-operator">|</span> koi8u_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> gb2312   <span class="hljs-operator">|</span> GB2312 Simplified Chinese       <span class="hljs-operator">|</span> gb2312_chinese_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> greek    <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-7</span> Greek                <span class="hljs-operator">|</span> greek_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp1250   <span class="hljs-operator">|</span> Windows Central European        <span class="hljs-operator">|</span> cp1250_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> gbk      <span class="hljs-operator">|</span> GBK Simplified Chinese          <span class="hljs-operator">|</span> gbk_chinese_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> latin5   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-9</span> Turkish              <span class="hljs-operator">|</span> latin5_turkish_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> armscii8 <span class="hljs-operator">|</span> ARMSCII<span class="hljs-number">-8</span> Armenian              <span class="hljs-operator">|</span> armscii8_general_ci <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> utf8     <span class="hljs-operator">|</span> UTF<span class="hljs-number">-8</span> Unicode                   <span class="hljs-operator">|</span> utf8_general_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> ucs2     <span class="hljs-operator">|</span> UCS<span class="hljs-number">-2</span> Unicode                   <span class="hljs-operator">|</span> ucs2_general_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp866    <span class="hljs-operator">|</span> DOS Russian                     <span class="hljs-operator">|</span> cp866_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> keybcs2  <span class="hljs-operator">|</span> DOS Kamenicky Czech<span class="hljs-operator">-</span>Slovak      <span class="hljs-operator">|</span> keybcs2_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> macce    <span class="hljs-operator">|</span> Mac Central European            <span class="hljs-operator">|</span> macce_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> macroman <span class="hljs-operator">|</span> Mac West European               <span class="hljs-operator">|</span> macroman_general_ci <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp852    <span class="hljs-operator">|</span> DOS Central European            <span class="hljs-operator">|</span> cp852_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> latin7   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-13</span> Baltic              <span class="hljs-operator">|</span> latin7_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> utf8mb4  <span class="hljs-operator">|</span> UTF<span class="hljs-number">-8</span> Unicode                   <span class="hljs-operator">|</span> utf8mb4_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp1251   <span class="hljs-operator">|</span> Windows Cyrillic                <span class="hljs-operator">|</span> cp1251_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> utf16    <span class="hljs-operator">|</span> UTF<span class="hljs-number">-16</span> Unicode                  <span class="hljs-operator">|</span> utf16_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> utf16le  <span class="hljs-operator">|</span> UTF<span class="hljs-number">-16</span>LE Unicode                <span class="hljs-operator">|</span> utf16le_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp1256   <span class="hljs-operator">|</span> Windows Arabic                  <span class="hljs-operator">|</span> cp1256_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp1257   <span class="hljs-operator">|</span> Windows Baltic                  <span class="hljs-operator">|</span> cp1257_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> utf32    <span class="hljs-operator">|</span> UTF<span class="hljs-number">-32</span> Unicode                  <span class="hljs-operator">|</span> utf32_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> <span class="hljs-type">binary</span>   <span class="hljs-operator">|</span> <span class="hljs-type">Binary</span> pseudo charset           <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>              <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> geostd8  <span class="hljs-operator">|</span> GEOSTD8 Georgian                <span class="hljs-operator">|</span> geostd8_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> cp932    <span class="hljs-operator">|</span> SJIS <span class="hljs-keyword">for</span> Windows Japanese       <span class="hljs-operator">|</span> cp932_japanese_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> eucjpms  <span class="hljs-operator">|</span> UJIS <span class="hljs-keyword">for</span> Windows Japanese       <span class="hljs-operator">|</span> eucjpms_japanese_ci <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> gb18030  <span class="hljs-operator">|</span> China <span class="hljs-type">National</span> Standard GB18030 <span class="hljs-operator">|</span> gb18030_chinese_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+  </span><br><br><span class="hljs-number">41</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p>在支持列表中我们可以看到眼熟的ascii，gbk，utf8，utf8mb4等，以及下面会出现的latin1。</p><p><strong>着重强调</strong>：utf8和utf8mb4，在列表可以看到Maxlen最大长度一栏，utf8最大长度为3字节，所以utf8有个别名叫utf8mb3，两者是一个意思。而utf8mb4最大长度4字节，可以理解为utf8mb4是utf8的扩展，毕竟多一个字节可以多存很多数据，比如特殊的字符或者emoji表情就需要utf8mb4字符集。在实际生产环境中也都是使用utf8mb4字符集。</p><h4 id="1-1-查看当前数据库使用的字符集"><a href="#1-1-查看当前数据库使用的字符集" class="headerlink" title="1.1 查看当前数据库使用的字符集"></a>1.1 查看当前数据库使用的字符集</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%character%&#x27;</span> ;  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+  </span><br><br><span class="hljs-operator">|</span> Variable_name            <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                      <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+  </span><br><br><span class="hljs-operator">|</span> character_set_client     <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_connection <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_database   <span class="hljs-operator">|</span> latin1                     <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_filesystem <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>                     <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_results    <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_server     <span class="hljs-operator">|</span> latin1                     <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_set_system     <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">|</span> character_sets_dir       <span class="hljs-operator">|</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>charsets<span class="hljs-operator">/</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+  </span><br><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><p><strong>参数解释</strong>：</p><p>官方文档：</p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html">https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html</a></p><table><thead><tr><th>Rate tiers</th><th>Pricing</th></tr></thead><tbody><tr><td>character_set_client</td><td>客户端请求数据的字符集</td></tr><tr><td>character_set_connection</td><td>从客户端接收到数据，然后传输的字符集</td></tr><tr><td>character_set_database</td><td>默认数据库的字符集，无论默认数据库如何改变，都是这个字符集；如果没有默认数据库，那就使用 character_set_server指定的字符集，这个变量建议由系统自己管理，不要人为定义</td></tr><tr><td>character_set_filesystem</td><td>把os上文件名转化成此字符集，即把character_set_client转换character_set_filesystem，默认binary是不做任何转换的</td></tr><tr><td>character_set_results</td><td>结果集的字符集</td></tr><tr><td>character_set_server</td><td>数据库服务器的默认字符集</td></tr><tr><td>character_set_system</td><td>这个值总是utf8，不需要设置，是为存储系统元数据的字符集</td></tr></tbody></table><p>通过以上可以看到数据库服务器默认的字符集是latin1，此数据集是ASCII的扩展，但是最大长度还是1字节，无法存储汉字，特殊符号等；需要将默认的latin1修改为常用的utf8mb4字符集。</p><p><strong>注意</strong>：mysql在5.5.3版本之后才支持utf8mb4.</p><h4 id="1-2-查看当前某个数据库使用的字符集"><a href="#1-2-查看当前某个数据库使用的字符集" class="headerlink" title="1.2 查看当前某个数据库使用的字符集"></a>1.2 查看当前某个数据库使用的字符集</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> database test ;  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------------------------------------------------------------+  </span><br><br><span class="hljs-operator">|</span> Database <span class="hljs-operator">|</span> <span class="hljs-keyword">Create</span> Database                                                  <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------------------------------------------------------------+  </span><br><br><span class="hljs-operator">|</span> test     <span class="hljs-operator">|</span> <span class="hljs-keyword">CREATE</span> DATABASE `test` <span class="hljs-comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span> <span class="hljs-operator">|</span>  <br><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------------------------------------------------------------+  </span><br><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h3 id="2-字符集转换"><a href="#2-字符集转换" class="headerlink" title="2. 字符集转换"></a>2. 字符集转换</h3><h4 id="1-更改数据库默认字符集"><a href="#1-更改数据库默认字符集" class="headerlink" title="1. 更改数据库默认字符集"></a>1. 更改数据库默认字符集</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# cp <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf.bak    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>备份mysql配置文件my.cnf  <br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>[mysqld]<br><span class="hljs-type">character</span><span class="hljs-operator">-</span><span class="hljs-keyword">set</span><span class="hljs-operator">-</span>server<span class="hljs-operator">=</span>utf8         <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新增配置项<br>datadir<span class="hljs-operator">=</span><span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>mysql<br>socket<span class="hljs-operator">=</span><span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.sock<br>symbolic<span class="hljs-operator">-</span>links<span class="hljs-operator">=</span><span class="hljs-number">0</span><br>log<span class="hljs-operator">-</span>error<span class="hljs-operator">=</span><span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>log<span class="hljs-operator">/</span>mysqld.log<br>pid<span class="hljs-operator">-</span>file<span class="hljs-operator">=</span><span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>run<span class="hljs-operator">/</span>mysqld<span class="hljs-operator">/</span>mysqld.pid  <br><br>[client]                <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新增配置项<br><span class="hljs-keyword">default</span><span class="hljs-operator">-</span><span class="hljs-type">character</span><span class="hljs-operator">-</span><span class="hljs-keyword">set</span><span class="hljs-operator">=</span>utf8     <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新增配置项  <br><br>[mysql]                     <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新增配置项<br><span class="hljs-keyword">default</span><span class="hljs-operator">-</span><span class="hljs-type">character</span><span class="hljs-operator">-</span><span class="hljs-keyword">set</span><span class="hljs-operator">=</span>utf8     <span class="hljs-operator">/</span><span class="hljs-operator">/</span>新增配置项  <br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# service mysqld restart        <span class="hljs-operator">/</span><span class="hljs-operator">/</span>重启mysql服务<br>停止 mysqld：                                              [确定]<br>正在启动 mysqld：                                          [确定]  <br><br>[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p123qqq...A<br>...<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%char%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> Variable_name                        <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> character_set_client                 <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_connection             <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_database               <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_filesystem             <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>                     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_results                <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_server                 <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_system                 <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_sets_dir                   <span class="hljs-operator">|</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>charsets<span class="hljs-operator">/</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> validate_password_special_char_count <span class="hljs-operator">|</span> <span class="hljs-number">1</span>                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------+----------------------------+</span><br><span class="hljs-number">9</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br></code></pre></td></tr></table></figure><h4 id="2-导出数据（数据库已安装并配置了zabbix情况下）"><a href="#2-导出数据（数据库已安装并配置了zabbix情况下）" class="headerlink" title="2. 导出数据（数据库已安装并配置了zabbix情况下）"></a>2. 导出数据（数据库已安装并配置了zabbix情况下）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysqldump -uroot -p  库名 &gt; zabbix.sql<br></code></pre></td></tr></table></figure><h4 id="3-替换数据，查看sql文件中的内容，寻找默认的字符集并改为utf8"><a href="#3-替换数据，查看sql文件中的内容，寻找默认的字符集并改为utf8" class="headerlink" title="3. 替换数据，查看sql文件中的内容，寻找默认的字符集并改为utf8"></a>3. 替换数据，查看sql文件中的内容，寻找默认的字符集并改为utf8</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;s/latin1/utf8/g&#x27;</span> zabbix.sql<br></code></pre></td></tr></table></figure><h4 id="4-导入更换字符集和原有数据"><a href="#4-导入更换字符集和原有数据" class="headerlink" title="4. 导入更换字符集和原有数据"></a>4. 导入更换字符集和原有数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Source zabbix.sql<br></code></pre></td></tr></table></figure><h4 id="5-监控项字符集变更为utf8"><a href="#5-监控项字符集变更为utf8" class="headerlink" title="5. 监控项字符集变更为utf8"></a>5. 监控项字符集变更为utf8</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> items <span class="hljs-keyword">CONVERT</span> <span class="hljs-keyword">TO</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>监控</tag>
      
      <tag>Zabbix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafka集群实战与原理分析线上问题优化</title>
    <link href="/2023/04/21/Kafka%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E4%BC%98%E5%8C%96/"/>
    <url>/2023/04/21/Kafka%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="Kafka-集群实战与原理分析线上问题优化"><a href="#Kafka-集群实战与原理分析线上问题优化" class="headerlink" title="Kafka 集群实战与原理分析线上问题优化"></a>Kafka 集群实战与原理分析线上问题优化</h1><h2 id="一、为什么使用消息队列"><a href="#一、为什么使用消息队列" class="headerlink" title="一、为什么使用消息队列?"></a>一、为什么使用消息队列?</h2><h3 id="1-1-Kafka知识点思维导图"><a href="#1-1-Kafka知识点思维导图" class="headerlink" title="1.1 Kafka知识点思维导图"></a>1.1 Kafka知识点思维导图</h3><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-LinuxKafka%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98.jpg" alt="Kafka集群实战"></p><p>以电商为业务背景</p><p>消息队列解决的具体问题是什么？ – 通信问题。</p><h3 id="1-2-使用同步的通讯方式来解决多个服务之间的通讯"><a href="#1-2-使用同步的通讯方式来解决多个服务之间的通讯" class="headerlink" title="1.2 使用同步的通讯方式来解决多个服务之间的通讯"></a>1.2 使用同步的通讯方式来解决多个服务之间的通讯</h3><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linux%E8%AE%A2%E5%8D%95%E5%9C%BA%E6%99%AF.png" alt="订单场景"></p><p>同步的通讯方式会存在性能和稳定性的问题。</p><h3 id="1-3-使用异步通讯方式"><a href="#1-3-使用异步通讯方式" class="headerlink" title="1.3 使用异步通讯方式"></a>1.3 使用异步通讯方式</h3><p>在业务的上游与下游间加入 通讯模块 （消息队列 存储消息的队列）</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linux%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%80%9A%E8%AE%AF%E6%96%B9%E5%BC%8F.png" alt="消息队列通讯方式"></p><p>最终一致性</p><p>针对同步的通讯方式来说，异步的方式，可以让上游快速成功，极大提高了系统的吞吐量。而且在分布式系统中，通过下游多个服务的分布式事务保障，也能保证业务执行之后的最终一致性。</p><h2 id="二、消息队列的流派"><a href="#二、消息队列的流派" class="headerlink" title="二、消息队列的流派"></a>二、消息队列的流派</h2><h3 id="2-1-什么是MQ-？"><a href="#2-1-什么是MQ-？" class="headerlink" title="2.1 什么是MQ ？"></a>2.1 什么是MQ ？</h3><p>Message Queue（MQ），消息队列中间件。</p><p>很多人都说：</p><p>MQ 通过将消息的发送和接收分离来实现应用程序的异步和解偶，这个给人的直觉是——MQ 是异步的，用来解耦的，但是这个只是 MQ 的效果而不是目的。</p><p>MQ 真正的目的是为了通讯，屏蔽底层复杂的通讯协议，定义了一套应用层的、更加简单的通讯协议。</p><p>一个分布式系统中两个模块之间通讯要么是 HTTP，要么是自己开发的 TCP，但是这两种协议其实都是原始的协议。</p><p>HTTP 协议很难实现两端通讯——模块 A 可以调用 B，B 也可以主动调用 A，如果要做到这个两端都要背上 WebServer，而且还不支持长连接（HTTP 2.0 的库根本找不到）。<br>TCP 就更加原始了，粘包、心跳、私有的协议，想一想头皮就发麻。</p><p>MQ 所要做的就是在这些协议之上构建一个简单的“协议”——生产者&#x2F;消费者模型。</p><p>MQ 带给我的“协议”不是具体的通讯协议，而是更高层次通讯模型。<br>它定义了两个对象——发送数据的叫生产者，接收数据的叫消费者；<br>提供一个 SDK 让我们可以定义自己的生产者和消费者实现消息通讯而无视底层通讯协议。</p><h3 id="2-2-中间件选型"><a href="#2-2-中间件选型" class="headerlink" title="2.2 中间件选型"></a>2.2 中间件选型</h3><p>目前消息队列的中间件选型有很多种：</p><p>rabbit MQ：内部可玩性（功能性）是非常强的</p><p>rocket MQ :阿里内部大神根据Kafka的内部执行原理，手写的一个消息中间件。性能比肩kafka，除此之外，在功能上封装了更多的功能。（消息的逆序）<br>kafka：全球消息处理性能最快的一款MQ（纯粹）</p><p>zeroMQ</p><p>这些消息队列中间件有什么区别？</p><p>我们把消息队列分为两种</p><p>MQ，分为有Broker的MQ，和没有Broker的MQ。<br>Broker，代理，经纪人的意思。</p><h4 id="2-2-1-有broker"><a href="#2-2-1-有broker" class="headerlink" title="2.2.1 有broker"></a>2.2.1 有broker</h4><p>有broker的MQ<br>这个流派通常有一台服务器作为Broker，所有的消息都通过它中转。生产者把消息发送给它就结束自己的任务了，Broker则把消息主动推送给消费者（或者消费者主动轮询）。</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linux%E6%9C%89broker.png" alt="有broker"></p><p>重topic：Kafka 、RocketMQ 、 ActiveMQ<br>整个broker，依据topic来进行消息的中转，在重topic的消息队列里必然需要topic的存在</p><p>轻topic：RabbitMQ<br>topic只是其一种中转模式。</p><h4 id="2-2-2-无broker"><a href="#2-2-2-无broker" class="headerlink" title="2.2.2 无broker"></a>2.2.2 无broker</h4><p>在生产者和消费者之间没有使用broker，例如zeroMQ，直接使用socket进行通信</p><p>无broker的MQ代表是ZeroMQ，该作者非常睿智，他非常敏锐的意识到–MQ是更高级的Socket</p><p>它是解决通信问题的。所以ZeroMQ被设计成了一个“库”而不是一个中间件，这种实现也可以达到–没有Broker的目的。</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linux%E6%97%A0broker.png" alt="无broker"></p><h2 id="三、Kafka的基本知识"><a href="#三、Kafka的基本知识" class="headerlink" title="三、Kafka的基本知识"></a>三、Kafka的基本知识</h2><p>Kafka是最初由Linkedin公司开发，是一个分布式、支持分区的（partition）、多副本的（replica），基于zookeeper协调的分布式消息系统.</p><p>它的最大的特性就是可以实时的处理大量数据以满足各种需求场景：</p><p>比如基于hadoop的批处理系统、低延迟的实时系统、storm&#x2F;Spark流式处理引擎，web&#x2F;nginx日志、访问日志，消息服务等等，用scala语言编写，Linkedin于2010年贡献给了Apache基金会并成为顶级开源项目。</p><h3 id="3-1-Kafka的特性"><a href="#3-1-Kafka的特性" class="headerlink" title="3.1 Kafka的特性:"></a>3.1 Kafka的特性:</h3><p>高吞吐量、低延迟：kafka每秒可以处理几十万条消息，它的延迟最低只有几毫秒，每个topic可以分多个partition, consumer group 对partition进行consume操作。</p><p>可扩展性：kafka集群支持热扩展</p><p>持久性、可靠性：消息被持久化到本地磁盘，并且支持数据备份防止数据丢失</p><p>容错性：允许集群中节点失败（若副本数量为n,则允许n-1个节点失败）</p><p>高并发：支持数千个客户端同时读写</p><h3 id="3-2-Kafka的使用场景"><a href="#3-2-Kafka的使用场景" class="headerlink" title="3.2 Kafka的使用场景"></a>3.2 Kafka的使用场景</h3><p>日志收集：一个公司可以用Kafka可以收集各种服务的log，通过kafka以统一接口服务的方式开放给各种consumer，例如hadoop、Hbase、Solr等。</p><p>消息系统：解耦和生产者和消费者、缓存消息等。</p><p>用户活动跟踪：Kafka经常被用来记录web用户或者app用户的各种活动，如浏览网页、搜索、点击等活动，这些活动信息被各个服务器发布到kafka的topic中，然后订阅者通过订阅这些topic来做实时的监控分析，或者装载到hadoop、数据仓库中做离线分析和挖掘。</p><p>运营指标：Kafka也经常用来记录运营监控数据。包括收集各种分布式应用的数据，生产各种操作的集中反馈，比如报警和报告。</p><h3 id="3-2-基本概念"><a href="#3-2-基本概念" class="headerlink" title="3.2 基本概念"></a>3.2 基本概念</h3><p>kafka是一个分布式的，分区的消息(官方称之为commit log)服务。它提供一个消息系统应该具备的功能，但是确有着独特的设计。</p><p>首先，让我们来看一下基础的消息(Message)相关术语：</p><p>kafka 中有这么些复杂的概念</p><table><thead><tr><th>名称</th><th>解释</th></tr></thead><tbody><tr><td>Broker</td><td>消息中间件处理节点，一个kafka节点就是一个broker，一个或多个Broker可以组成一个kafka集群</td></tr><tr><td>Topic</td><td>kafka根据Topic对消息进行分类，发布到kafka集群的每条消息都需要指定一个Topic</td></tr><tr><td>Producer</td><td>消息生产者，向Broker发送消息的客户端</td></tr><tr><td>Consumer</td><td>消息消费者，从Broker读取消息的客户端</td></tr><tr><td>ConsumerGroup</td><td>个consumer属于一个特定的Consumer Group，一条消息可以被多个不同的Consumer消费，但是一个Consumer Group中只能有一个consumer能消费该消息</td></tr><tr><td>Partition</td><td>物理上的概念，一个topic可以分为多个partition，每个partition内部消息是有序的</td></tr></tbody></table><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.png" alt="kafka基本概念"></p><h3 id="3-3-创建主题topic"><a href="#3-3-创建主题topic" class="headerlink" title="3.3 创建主题topic"></a>3.3 创建主题topic</h3><p>topic kafka消息逻辑的划分</p><p>topic是什么概念? topic可以实现消息的分类，不同消费者订阅不同的topic。</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linux20220111104851.png"></p><p>执行以下命令创建名为”test”的topic，这个topic只有一个partition，并且备份因子也设置为1;</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-topics.sh --create --zookeeper 172.16.253.35:2181 --replication-factor 1 --partitions 1 --topic test  </code></pre></figure><p>查看当前kafka内有哪些topic</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./ kafka-topics.sh --list --zookeeper 172.16.253.35:2181  </code></pre></figure><h3 id="3-4-发送消息"><a href="#3-4-发送消息" class="headerlink" title="3.4 发送消息"></a>3.4 发送消息</h3><p>kafka自带了一个producer命令客户端，可以从本地文件中读取内容，或者我们也可以以命令行中直接输入内容，并将这些内容以消息的形式发送到kafka集群中。在默认情况下，每一个行会被当做成一个独立的消息。</p><p>使用kafka的发送消息的客户端，指定发送到的kafka服务器地址和topic</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-producer.sh --broker-list 10.31.167.10:9092 --topic test  </code></pre></figure><h3 id="3-5-消费消息"><a href="#3-5-消费消息" class="headerlink" title="3.5 消费消息"></a>3.5 消费消息</h3><p>对于consumer, kafka同样也携带了一个命令行客户端，会将获取到内容在命令中进行输出，默认是消费最新的消息。使用kafka的消费者消息的客户端，从指定kafka服务器的指定topic中消费消息</p><p>方式一:从当前主题中最后一条消息的offset（偏移量）+1开始消费</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer.sh --bootstrap-server 10.31.167.10:9092 --topic test  </code></pre></figure><p>方式二∶从当前主题中的第一条消息开始消费</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafxa-console-consumer.sh --bootstrap-server 10.31.167.10:9092 --from-beginning --topic test  </code></pre></figure><h3 id="3-6-关于消息的细节"><a href="#3-6-关于消息的细节" class="headerlink" title="3.6 关于消息的细节"></a>3.6 关于消息的细节</h3><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E6%B6%88%E8%B4%B9%E7%BB%86%E8%8A%82.png"></p><p>生产者将消息发送给broker，broker会将消息保存在本地的日志文件中</p><p><code>/usr/ local/kafka/data/kafka-logs/主题-分区/0000000o.log</code></p><p>消息的保存是有序的，通过offset偏移量来描述消息的有序性</p><p>消费者消费消息时也是通过offset来描述当前要消费的那条消息的位置</p><h3 id="3-7-单播消息"><a href="#3-7-单播消息" class="headerlink" title="3.7 单播消息"></a>3.7 单播消息</h3><p>在一个kafka的topic中，启动两个消费者，一个生产者，问:生产者发送消息，这条消息是否同时会被两个消费者消费?</p><p>如果多个消费者在同一个消费组，那么只有一个消费者可以收到订阅的topic中的消息。换言之，同一个消费组中只能有一个消费者收到一个topic中的消息。</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer.sh --bootstrap-server 172.16.253.38:9092--consumer-property group.id=testGroup --topic test  </code></pre></figure><h3 id="3-8-多播消息"><a href="#3-8-多播消息" class="headerlink" title="3.8 多播消息"></a>3.8 多播消息</h3><p>不同的消费组订阅同一个topic，那么不同的消费组中只有一个消费者能收到消息。实际上也是多个消费组中的多个消费者收到了同一个消息。</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer.sh --bootstrap-server 172.16.253.38:9092--consumer-property group.id=testGroupl --topic test  </code></pre></figure><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer.sh --bootstrap-server 172.16.253.38:9092--consumer-property group.id=testGroup2 --topic test  </code></pre></figure><p>下图就是描述多播和单播消息的区别:</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%A4%9A%E6%92%AD%E4%B8%8E%E5%8D%95%E6%92%AD%E6%B6%88%E6%81%AF%E7%9A%84%E5%8C%BA%E5%88%AB.png"></p><h3 id="3-9-查看消费组的详细信息"><a href="#3-9-查看消费组的详细信息" class="headerlink" title="3.9 查看消费组的详细信息"></a>3.9 查看消费组的详细信息</h3><p>通过以下命令可以查看到消费组的详细信息︰</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-consumer-groups.sh --bootstrap-server 172.16.253.38:9092 --describe --group testGroup  </code></pre></figure><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E6%9F%A5%E7%9C%8B%E6%B6%88%E8%B4%B9%E7%BB%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF.png"></p><p>重点关注以下几个信息∶</p><ul><li>current-offset:最后被消费的消息的偏移量</li><li>Log-end-offset:消息总量(最后一条消息的偏移量)</li><li>Lag:积压了多少条消息</li></ul><h2 id="四、Kafka-中主题和分区的概念"><a href="#四、Kafka-中主题和分区的概念" class="headerlink" title="四、Kafka 中主题和分区的概念"></a>四、Kafka 中主题和分区的概念</h2><h3 id="4-1-主题Topic"><a href="#4-1-主题Topic" class="headerlink" title="4.1 主题Topic"></a>4.1 主题Topic</h3><p>主题-topic在kafka中是一个逻辑的概念，kafka通过topic将消息进行分类。不同的topic会被订阅该topic的消费者消费。</p><p>但是有一个问题，如果说这个topic中的消息非常非常多，多到需要几T来存，因为消息是会被保存到log日志文件中的。为了解决这个文件过大的问题, kafka提出了Partition分区的概念</p><h3 id="4-2-partition-分区"><a href="#4-2-partition-分区" class="headerlink" title="4.2 partition 分区"></a>4.2 partition 分区</h3><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%88%86%E5%8C%BA.png"></p><p>1)分区的概念</p><p>通过partition将一个topic中的消息分区来存储。</p><p>这样的好处有多个:</p><ul><li><p>分区存储，可以解决统一存储文件过大的问题</p></li><li><p>提供了读写的吞吐量:读和写可以同时在多个分区中进行</p></li></ul><p>2)创建多分区的主题</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-topics.sh --create --zokeeper 172.16.253.35:2181 --replication-factor l --partitions 2 --topic test1  </code></pre></figure><h3 id="4-3-kafka-中消息日志文件中保存的内容"><a href="#4-3-kafka-中消息日志文件中保存的内容" class="headerlink" title="4.3 kafka 中消息日志文件中保存的内容"></a>4.3 kafka 中消息日志文件中保存的内容</h3><p><code>. 00000.log</code>:这个文件中保存的就是消息<br>_consumer_offsets-49</p><p>kafka内部自己创建了_consumer_offsets主题包含了50个分区。这个主题用来存放消费者消费某个主题的偏移量。</p><p>因为每个消费者都会自己维护着消费的主题的偏移量，也就是说每个消费者会把消费的主题的偏移量自主上报给kafka中的默认主题consumer_offsets。因此kafka为了提升这个主题的并发性，默认设置了50个分区。(可以通过offsets.topic.num.paritions设置)，这样可以通过加机器的方式抗大并发。</p><ul><li><p>提交到哪个分区︰通过hash函数: hash(consumerGroupld) %_consumer_offsets主题的分区数</p></li><li><p>提交到该主题中的内容是: key是consumerGroupld+topic+分区号，value就是当前offset的值</p></li><li><p>文件中保存的消息，kafka会定期清理topic里的消息，最后就保留最新的那条数据默认保存7天。七天到后消息会被删除。</p></li></ul><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-offsets50%E9%BB%98%E8%AE%A4%E4%B8%BB%E9%A2%98.png"></p><h2 id="五、Kafka集群操作"><a href="#五、Kafka集群操作" class="headerlink" title="五、Kafka集群操作"></a>五、Kafka集群操作</h2><h3 id="5-1-搭建kafka集群（三个broker）"><a href="#5-1-搭建kafka集群（三个broker）" class="headerlink" title="5.1 搭建kafka集群（三个broker）"></a>5.1 搭建kafka集群（三个broker）</h3><p>创建三个<code>server.properties</code>文件</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  \#0 1 2  broker.id=2  <p>  #9092 9093 9094<br>  listeners&#x3D;PLAINTEXT :&#x2F;&#x2F;192.168.65.60:9094  </p><p>  #kafka-logs kafka-logs-1 kafka-logs-2<br>  log.dir&#x3D;&#x2F;usr&#x2F; local&#x2F; data&#x2F; kafka-logs-2<br>  </p></code></pre><p></p></figure><p>通过命令来启动三台broker</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./ kafka-server-start.sh -daemon ../config/server.properties  ./ kafka-server-start.sh -daemon ../config/server1.properties  ./ kafka-server-start.sh -daemon ../config/server2.properties  </code></pre></figure><p>校验是否启动成功</p><p><code>进入到zk中查看/brokers/ids中过是否有三个znode (0,1,2)</code></p><h3 id="5-2-副本的概念"><a href="#5-2-副本的概念" class="headerlink" title="5.2 副本的概念"></a>5.2 副本的概念</h3><p>在创建主题时，除了指明了主题的分区数以外，还指明了副本数，那么副本是一个什么概念呢?</p><p>副本是为了为主题中的分区创建多个备份，多个副本在kafka集群的多个broker中，会有一个副本作为leader，其他是follower。 生产者与消费者只会与leader交互消息，而follower只会与leader保持同步以备不时之需。</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%89%AF%E6%9C%AC%E6%A6%82%E5%BF%B5.png"></p><ul><li><p>leader: kafka的写和读的操作，都发生在leader上。leader负责把数据同步给follower。当leader挂了，经过主从选举，从多个follower中选举产生一个新的leader</p></li><li><p>follower： 接收leader的同步的数据</p></li><li><p>isr: 可以同步和已同步的节点会被存入到isr集合中。这里有一个细节︰如果isr中的节点性能较差，会被提出isr集合。)</p></li></ul><p><strong>理解:</strong> 集群中有多个broker，创建主题时可以指明主题有多个分区(把消息拆分到不同的分区中存储)，可以为分区创建多个副本，不同的副本存放在不同的broker里。</p><h3 id="5-3-关于集群消费"><a href="#5-3-关于集群消费" class="headerlink" title="5.3 关于集群消费"></a>5.3 关于集群消费</h3><p>向集群发送消息∶</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer . sh --bootstrap-server 172.16.253.38:9092,172.16.253.38:9093,172.16.253.38:9094 --from-beginning --consumer-property group.id=testGroupl --topic my-replicated-topic  </code></pre></figure><p>从集群中消费消息</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-producer .sh --broker-list 172.16.253.38:9092,172.16.253.38:9093,172.16.253.38:9094 --topicmy-replicated-topic  </code></pre></figure><p>指定消费组来消费消息</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  ./kafka-console-consumer .sh --bootstrap-server 172.16.253.38∶9092,172.16.253.38:9093,172.16.253.38:9094 --from-beginning --consumer-property group.id=testGroupl --topic my-replicated-topic  </code></pre></figure><h3 id="5-4-分区分消费组的集群消费中的细节"><a href="#5-4-分区分消费组的集群消费中的细节" class="headerlink" title="5.4 分区分消费组的集群消费中的细节"></a>5.4 分区分消费组的集群消费中的细节</h3><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%88%86%E5%8C%BA%E5%88%86%E6%B6%88%E8%B4%B9%E7%BB%84%E7%9A%84%E9%9B%86%E7%BE%A4%E6%B6%88%E8%B4%B9%E4%B8%AD%E7%9A%84%E7%BB%86%E8%8A%82.png"></p><ol><li>一个partition只能被一个消费组中的一个消费者消费，目的是为了保证消费的顺序性，但是多个partion的多个消费者消费的总的顺序性是得不到保证的，那怎么做到消费的总顺序性呢?</li><li>partition的数量决定了消费组中消费者的数量，建议同一个消费组中消费者的数量不要超过partition的数量，否则多的消费者消费不到消息</li><li>如果消费者挂了，那么会触发rebalance机制（后面介绍)，会让其他消费者来消费该分区</li></ol><h2 id="六、专题1-Kafka-集群Controller-、Rebalance-和HW"><a href="#六、专题1-Kafka-集群Controller-、Rebalance-和HW" class="headerlink" title="六、专题1 Kafka 集群Controller 、Rebalance 和HW"></a>六、专题1 Kafka 集群Controller 、Rebalance 和HW</h2><h3 id="6-1-controller"><a href="#6-1-controller" class="headerlink" title="6.1 controller"></a>6.1 controller</h3><p>集群中谁来充当controller</p><ol><li><p>每个broker启动时会向zk创建一个临时序号节点，获得的序号最小的那个broker将会作为集群中的controller，负责这么几件事:</p></li><li><p>当集群中有一个副本的leader挂掉，需要在集群中选举出一个新的leader，选举的规则是从isr集合中最左边获得。</p></li><li><p>当集群中有broker新增或减少，controller会同步信息给其他broker</p></li></ol><h3 id="6-2-rebalance机制"><a href="#6-2-rebalance机制" class="headerlink" title="6.2 rebalance机制"></a>6.2 rebalance机制</h3><p>**前提:**消费组中的消费者没有指明分区来消费</p><p>**触发的条件:**当消费组中的消费者和分区的关系发生变化的时候</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-rebalance%E6%9C%BA%E5%88%B6.png"></p><p>**分区分配的策略:**在rebalance之前， 分区怎么分配会有这么三种策略</p><ul><li><p>range: 根据公示计算得到每个消费消费哪几个分区:前面的消费者是分区总数&#x2F;消费<br>者数量+1,之后的消费者是分区总数&#x2F;消费者数量.</p></li><li><p>轮询:大家轮着来</p></li><li><p>sticky: 粘合策略，如果需要rebalance, 会在之前已分配的基础上调整，不会改变之前的分配情况。如果这个策略没有开，那么就要进行全部的重新分配。建议开启。</p></li></ul><h2 id="七、专题2-Kafka中的优化问题-面试问题"><a href="#七、专题2-Kafka中的优化问题-面试问题" class="headerlink" title="七、专题2 Kafka中的优化问题(面试问题)"></a>七、专题2 Kafka中的优化问题(面试问题)</h2><h3 id="7-1-如何防止消息丢失"><a href="#7-1-如何防止消息丢失" class="headerlink" title="7.1 如何防止消息丢失"></a>7.1 如何防止消息丢失</h3><p>⽣产者：</p><ol><li>使⽤同步发送</li><li>把ack设成1（leader 成功写入）或者all(所有broker完成同步)，并且设置同步的分区数&gt;&#x3D;2<br>消费者：把⾃动提交改成⼿动提交</li></ol><h3 id="7-2如何防⽌重复消费"><a href="#7-2如何防⽌重复消费" class="headerlink" title="7.2如何防⽌重复消费"></a>7.2如何防⽌重复消费</h3><p>在防⽌消息丢失的⽅案中，如果⽣产者发送完消息后，因为⽹络抖动，没有收到ack，但实际 上broker已经收到了。</p><p>此时⽣产者会进⾏重试，于是broker就会收到多条相同的消息，⽽造成消费者的重复消费。</p><p><strong>怎么解决：</strong></p><p>⽣产者关闭重试：会造成丢消息（不建议）</p><p>消费者解决⾮幂等性消费问题： 所谓的幂等性：多次访问的结果是⼀样的。</p><p>对于rest的请求（get（幂等）、post（⾮幂 等）、put（幂等）、delete（幂等））</p><p>幂等：多次访问的结果是一样的</p><p><strong>解决⽅案：</strong><br>在数据库中创建联合主键，防⽌相同的主键 创建出多条记录<br>使⽤分布式锁，以业务id为锁。保证只有⼀条记录能够创建成功</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%A6%82%E4%BD%95%E9%98%B2%E2%BD%8C%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9.png"></p><h3 id="7-3-如何做到消息的顺序消费"><a href="#7-3-如何做到消息的顺序消费" class="headerlink" title="7.3 如何做到消息的顺序消费"></a>7.3 如何做到消息的顺序消费</h3><ul><li><p>⽣产者：保证消息按顺序消费，且消息不丢失——使⽤同步的发送，ack设置成⾮0的 值。</p></li><li><p>消费者：主题只能设置⼀个分区，消费组中只能有⼀个消费者</p></li></ul><p>kafka的顺序消费使⽤场景不多，因为牺牲掉了性能，但是⽐如rocketmq在这⼀块有专⻔的功能已设计好</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E6%B6%88%E6%81%AF%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%B6%88%E8%B4%B9.png"></p><h3 id="7-4-如何解决消息积压问题"><a href="#7-4-如何解决消息积压问题" class="headerlink" title="7.4 如何解决消息积压问题"></a>7.4 如何解决消息积压问题</h3><p>1）消息积压问题的出现</p><p>消息的消费者的消费速度远赶不上⽣产者的⽣产消息的速度，导致kafka中有⼤量的数据没有被消费。</p><p>随着没有被消费的数据堆积越多，消费者寻址的性能会越来越差，最后导致整个 kafka对外提供的服务的性能很差，从⽽造成其他服务也访问速度变慢，造成服务雪崩。</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E9%97%AE%E9%A2%98%E7%9A%84%E5%87%BA%E7%8E%B0.png"></p><p>2）消息积压的解决⽅案</p><ol><li><p>在这个消费者中，使⽤多线程，充分利⽤机器的性能进⾏消费消息。</p></li><li><p>通过业务的架构设计，提升业务层⾯消费的性能。</p></li><li><p>创建多个消费组，多个消费者，部署到其他机器上，⼀起消费，提⾼消费者的消费速度</p></li></ol><p>创建⼀个消费者，该消费者在kafka另建⼀个主题，配上多个分区，多个分区再配上多个 消费者。该消费者将poll下来的消息，不进⾏消费，直接转发到新建的主题上。此时，新 的主题的多个分区的多个消费者就开始⼀起消费了。——不常⽤</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E2%BD%85%E6%A1%88.png"></p><h3 id="5-实现延时队列的效果"><a href="#5-实现延时队列的效果" class="headerlink" title="5.实现延时队列的效果"></a>5.实现延时队列的效果</h3><p>1）应⽤场景 订单创建后，超过30分钟没有⽀付，则需要取消订单，这种场景可以通过延时队列来实现</p><p>2）具体⽅案</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka%E5%AE%9E%E7%8E%B0%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97%E7%9A%84%E6%95%88%E6%9E%9C.png"></p><ol><li><p>kafka中创建创建相应的主题</p></li><li><p>消费者消费该主题的消息(轮询)</p></li><li><p>消费者消费消息时判断消息的创建时间和当前时间是否超过30分钟(前提是订单没支付)</p></li><li><p>如果是:去数据库中修改订单状态为已取消</p></li><li><p>如果否:记录当前消息的offset,并不再继续消费之后的消息。等待1分钟后，再次向kafka拉取该offset及之后的消<br>息，继续进行判断，以此反复。</p></li></ol><h2 id="八、Kafka-eagle监控平台"><a href="#八、Kafka-eagle监控平台" class="headerlink" title="八、Kafka-eagle监控平台"></a>八、Kafka-eagle监控平台</h2><h3 id="8-1-搭建"><a href="#8-1-搭建" class="headerlink" title="8.1 搭建"></a>8.1 搭建</h3><p>去kafka-eagle官⽹下载压缩包<br><a href="http://download.kafka-eagle.org/">http://download.kafka-eagle.org/</a></p><p>分配⼀台虚拟机<br>虚拟机中安装jdk<br>解压缩kafka-eagle的压缩包<br>给kafka-eagle配置环境变量</p><p><code>export KE_HOME=/usr/local/kafka-eagle</code><br><code>export PATH=$PATH:$KE_HOME/bin</code></p><p>需要修改kafka-eagle内部的配置⽂件：<br>vim system-config.properties<br>修改⾥⾯的zk的地址和mysql的地址<br>进⼊到bin中，通过命令来启动</p><p><code>./ke.sh start</code></p><h3 id="8-2-使用"><a href="#8-2-使用" class="headerlink" title="8.2 使用"></a>8.2 使用</h3><p>kafka-eagle 监控面板</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-eagle-%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF.PNG"></p><p>kafka-监控查看节点信息</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-%E7%9B%91%E6%8E%A7%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF.PNG"></p><p>kafka-eagle查看消费组与消费主题信息</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-eagle%E6%9F%A5%E7%9C%8B%E6%B6%88%E8%B4%B9%E7%BB%84%E6%B6%88%E8%B4%B9%E4%B8%BB%E9%A2%98%E4%BF%A1%E6%81%AF.PNG"></p><p>kafka-eagle查看消息积压情况</p><p><img src="https://xin997.oss-cn-beijing.aliyuncs.com/xinblogs/webimg-Linuxkafka-eagle%E6%9F%A5%E7%9C%8B%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E6%83%85%E5%86%B5.PNG"></p>]]></content>
    
    
    <categories>
      
      <category>中间件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>日志处理-Grok正则捕获</title>
    <link href="/2023/04/21/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86-Grok%E6%AD%A3%E5%88%99%E6%8D%95%E8%8E%B7/"/>
    <url>/2023/04/21/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86-Grok%E6%AD%A3%E5%88%99%E6%8D%95%E8%8E%B7/</url>
    
    <content type="html"><![CDATA[<p>一般系统或服务生成的日志都是一大长串。每个字段之间用空格隔开。logstash在获取日志是整个一串获取，如果把日志中每个字段代表的意思分割开来在传给elasticsearch。这样呈现出来的数据更加清晰，而且也能让kibana更方便的绘制图形。</p><p>Grok 是 Logstash 最重要的插件。它的主要作用就是将文本格式的字符串，转换成为具体的结构化的数据，配合正则表达式使用。</p><h1 id="Grok-正则捕获"><a href="#Grok-正则捕获" class="headerlink" title="Grok 正则捕获"></a>Grok 正则捕获</h1><p>Grok 支持把预定义的 grok 表达式 写入到文件中，官方提供的预定义 grok 表达式见：<a href="https://github.com/logstash/logstash/tree/v1.4.2/patterns%E3%80%82">https://github.com/logstash/logstash/tree/v1.4.2/patterns。</a></p><p><code>%&#123;syntax:semantic&#125;</code></p><p>syntax代表的是正则表达式替代字段，semantic是代表这个表达式对应的字段名，你可以自由命名。这个命名尽量能简单易懂的表达出这个字段代表的意思。</p><p>logstash安装时就带有已经写好的正则表达式。路径如下：</p><p><code>/usr/local/logstash-2.3.4/vendor/bundle/jruby/1.9/gems/logstash-patterns-core-2.0.5/patterns</code></p><p>或者直接访问logstash-plugins&#x2F;logstash-patterns-core · GitHub</p><p>上面IPORHOST，USER等都是在里面已经定义好的！当然还有其他的，基本能满足我们的需求。</p><h2 id="grok-patterns"><a href="#grok-patterns" class="headerlink" title="grok-patterns"></a>grok-patterns</h2><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  cat /proc/cpuinfo| grep "physical id  USERNAME [a-zA-Z0-9._-]+  USER %&#123;USERNAME&#125;  EMAILLOCALPART [a-zA-Z0-9!#$%&'*+\-/=?^_`&#123;|&#125;~]&#123;1,64&#125;(?:\.[a-zA-Z0-9!#$%&'*+\-/=?^_`&#123;|&#125;~]&#123;1,62&#125;)&#123;0,63&#125;  EMAILADDRESS %&#123;EMAILLOCALPART&#125;@%&#123;HOSTNAME&#125;  INT (?:[+-]?(?:[0-9]+))  BASE10NUM (?<![0-9.+-])(?>[+-]?(?:(?:[0-9]+(?:\.[0-9]+)?)|(?:\.[0-9]+)))  NUMBER (?:%&#123;BASE10NUM&#125;)  BASE16NUM (?<![0-9A-Fa-f])(?:[+-]?(?:0x)?(?:[0-9A-Fa-f]+))  BASE16FLOAT \b(?<![0-9A-Fa-f.])(?:[+-]?(?:0x)?(?:(?:[0-9A-Fa-f]+(?:\.[0-9A-Fa-f]*)?)|(?:\.[0-9A-Fa-f]+)))\b  <p>  POSINT \b(?:[1-9][0-9]<em>)\b<br>  NONNEGINT \b(?:[0-9]+)\b<br>  WORD \b\w+\b<br>  NOTSPACE \S+<br>  SPACE \s</em><br>  DATA .<em>?<br>  GREEDYDATA .</em><br>  QUOTEDSTRING (?&gt;(?&lt;!\)(?&gt;”(?&gt;\.|[^\“]+)+”|””|(?&gt;’(?&gt;\.|[^\‘]+)+’)|’’|(?&gt;<code>(?&gt;\\.|[^\\</code>]+)+&#96;)|&#96;&#96;))<br>  UUID [A-Fa-f0-9]{8}-(?:[A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}<br>  # URN, allowing use of RFC 2141 section 2.3 reserved characters<br>  URN urn:[0-9A-Za-z][0-9A-Za-z-]{0,31}:(?:%[0-9a-fA-F]{2}|[0-9A-Za-z()+,.:&#x3D;@;$_!*’&#x2F;?#-])+  <p></p><p>  # Networking<br>  MAC (?:%{CISCOMAC}|%{WINDOWSMAC}|%{COMMONMAC})<br>  CISCOMAC (?:(?:[A-Fa-f0-9]{4}.){2}[A-Fa-f0-9]{4})<br>  WINDOWSMAC (?:(?:[A-Fa-f0-9]{2}-){5}[A-Fa-f0-9]{2})<br>  COMMONMAC (?:(?:[A-Fa-f0-9]{2}:){5}[A-Fa-f0-9]{2})<br>  IPV6 ((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?<br>  IPV4 (?&lt;![0-9])(?:(?:[0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])<a href="?:%5B0-1%5D?%5B0-9%5D%7B1,2%7D%7C2%5B0-4%5D%5B0-9%5D%7C25%5B0-5%5D">.</a><a href="?:%5B0-1%5D?%5B0-9%5D%7B1,2%7D%7C2%5B0-4%5D%5B0-9%5D%7C25%5B0-5%5D">.</a><a href="?:%5B0-1%5D?%5B0-9%5D%7B1,2%7D%7C2%5B0-4%5D%5B0-9%5D%7C25%5B0-5%5D">.</a>)(?![0-9])<br>  IP (?:%{IPV6}|%{IPV4})<br>  HOSTNAME \b(?:[0-9A-Za-z][0-9A-Za-z-]{0,62})(?:.(?:[0-9A-Za-z][0-9A-Za-z-]{0,62}))*(.?|\b)<br>  IPORHOST (?:%{IP}|%{HOSTNAME})<br>  HOSTPORT %{IPORHOST}:%{POSINT}  </p><p>  # paths (only absolute paths are matched)<br>  PATH (?:%{UNIXPATH}|%{WINPATH})<br>  UNIXPATH (&#x2F;[[[:alnum:]]_%!$@:.,+<code>~</code>-]<em>)+<br>  TTY (?:&#x2F;dev&#x2F;(pts|tty([pq])?)(\w+)?&#x2F;?(?:[0-9]+))<br>  WINPATH (?&gt;[A-Za-z]+:|\)(?:\[^\?</em>]<em>)+<br>  URIPROTO <a href="%5BA-Za-z0-9+-.%5D+">A-Za-z</a>+<br>  URIHOST %{IPORHOST}(?::%{POSINT})?<br>  # uripath comes loosely from RFC1738, but mostly from what Firefox doesn’t turn into %XX<br>  URIPATH (?:&#x2F;[A-Za-z0-9$.+!</em>‘(){},<code>~</code>:;&#x3D;@#%&amp;<em>-]<em>)+<br>  URIQUERY [A-Za-z0-9$.+!</em>‘|(){},<code>~</code>@#%&amp;&#x2F;&#x3D;:;</em>?-[]&lt;&gt;]*<br>  # deprecated (kept due compatibility):<br>  URIPARAM ?%{URIQUERY}<br>  URIPATHPARAM %{URIPATH}(?:?%{URIQUERY})?<br>  URI %{URIPROTO}:&#x2F;&#x2F;(?:%{USER}(?::[^@]*)?@)?(?:%{URIHOST})?(?:%{URIPATH}(?:?%{URIQUERY})?)?  </p><p>  # Months: January, Feb, 3, 03, 12, December<br>  MONTH \b(?:[Jj]an(?:uary|uar)?|[Ff]eb(?:ruary|ruar)?|<a href="?:a%7C%C3%A4">Mm</a>?r(?:ch|z)?|[Aa]pr(?:il)?|[Mm]a(?:y|i)?|[Jj]un(?:e|i)?|[Jj]ul(?:y|i)?|[Aa]ug(?:ust)?|[Ss]ep(?:tember)?|<a href="?:c%7Ck">Oo</a>?t(?:ober)?|[Nn]ov(?:ember)?|[Dd]e(?:c|z)(?:ember)?)\b<br>  MONTHNUM (?:0?[1-9]|1[0-2])<br>  MONTHNUM2 (?:0[1-9]|1[0-2])<br>  MONTHDAY (?:(?:0[1-9])|(?:[12][0-9])|(?:3[01])|[1-9])  </p><p>  # Days: Monday, Tue, Thu, etc…<br>  DAY (?:Mon(?:day)?|Tue(?:sday)?|Wed(?:nesday)?|Thu(?:rsday)?|Fri(?:day)?|Sat(?:urday)?|Sun(?:day)?)  </p><p>  # Years?<br>  YEAR (?&gt;\d\d){1,2}<br>  HOUR (?:2[0123]|[01]?[0-9])<br>  MINUTE (?:[0-5][0-9])<br>  # ‘60’ is a leap second in most time standards and thus is valid.<br>  SECOND (?:(?:[0-5]?[0-9]|60)(?:[:.,][0-9]+)?)<br>  TIME (?!&lt;[0-9])%{HOUR}:%{MINUTE}(?::%{SECOND})(?![0-9])<br>  # datestamp is YYYY&#x2F;MM&#x2F;DD-HH:MM:SS.UUUU (or something like it)<br>  DATE_US %{MONTHNUM}[&#x2F;-]%{MONTHDAY}[&#x2F;-]%{YEAR}<br>  DATE_EU %{MONTHDAY}[.&#x2F;-]%{MONTHNUM}[.&#x2F;-]%{YEAR}<br>  ISO8601_TIMEZONE (?:Z|[+-]%{HOUR}(?::?%{MINUTE}))<br>  ISO8601_SECOND %{SECOND}<br>  TIMESTAMP_ISO8601 %{YEAR}-%{MONTHNUM}-%{MONTHDAY}[T ]%{HOUR}:?%{MINUTE}(?::?%{SECOND})?%{ISO8601_TIMEZONE}?<br>  DATE %{DATE_US}|%{DATE_EU}<br>  DATESTAMP %{DATE}[- ]%{TIME}<br>  TZ (?:[APMCE][SD]T|UTC)<br>  DATESTAMP_RFC822 %{DAY} %{MONTH} %{MONTHDAY} %{YEAR} %{TIME} %{TZ}<br>  DATESTAMP_RFC2822 %{DAY}, %{MONTHDAY} %{MONTH} %{YEAR} %{TIME} %{ISO8601_TIMEZONE}<br>  DATESTAMP_OTHER %{DAY} %{MONTH} %{MONTHDAY} %{TIME} %{TZ} %{YEAR}<br>  DATESTAMP_EVENTLOG %{YEAR}%{MONTHNUM2}%{MONTHDAY}%{HOUR}%{MINUTE}%{SECOND}  </p><p>  # Syslog Dates: Month Day HH:MM:SS<br>  SYSLOGTIMESTAMP %{MONTH} +%{MONTHDAY} %{TIME}<br>  PROG [\x21-\x5a\x5c\x5e-\x7e]+<br>  SYSLOGPROG %{PROG:[process][name]}(?:[%{POSINT:[process][pid]:int}])?<br>  SYSLOGHOST %{IPORHOST}<br>  SYSLOGFACILITY &lt;%{NONNEGINT:[log][syslog][facility][code]:int}.%{NONNEGINT:[log][syslog][priority]:int}&gt;<br>  HTTPDATE %{MONTHDAY}&#x2F;%{MONTH}&#x2F;%{YEAR}:%{TIME} %{INT}  </p><p>  # Shortcuts<br>  QS %{QUOTEDSTRING}  </p><p>  # Log formats<br>  SYSLOGBASE %{SYSLOGTIMESTAMP:timestamp} (?:%{SYSLOGFACILITY} )?%{SYSLOGHOST:[host][hostname]} %{SYSLOGPROG}:  </p><p>  # Log Levels<br>  LOGLEVEL ([Aa]lert|ALERT|[Tt]race|TRACE|[Dd]ebug|DEBUG|[Nn]otice|NOTICE|[Ii]nfo?(?:rmation)?|INFO?(?:RMATION)?|[Ww]arn?(?:ing)?|WARN?(?:ING)?|[Ee]rr?(?:or)?|ERR?(?:OR)?|[Cc]rit?(?:ical)?|CRIT?(?:ICAL)?|[Ff]atal|FATAL|[Ss]evere|SEVERE|EMERG(?:ENCY)?|[Ee]merg(?:ency)?)<br>  </p></code></pre><p></p></figure><h2 id="案例实践"><a href="#案例实践" class="headerlink" title="案例实践"></a>案例实践</h2><p><strong>例1</strong>：将下面的日志文件格式拆分为5段</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  2016-09-19T18:19:00 [8.8.8.8:prd] DEBUG this is an example log message  </code></pre></figure><ul><li>时间</li><li>IP地址</li><li>环境</li><li>等级</li><li>信息</li></ul><p>使用Grok 默认提供的正则匹配后</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  %&#123;TIMESTAMP_ISO8601:timestamp&#125; \[%&#123;IPV4:ip&#125;;%&#123;WORD:environment&#125;\] %&#123;LOGLEVEL:log_level&#125; %&#123;GREEDYDATA:message&#125;    <p>  这样就会生成结构化结果：<br>  &#123;<br>    “timestamp”: “2016-09-19T18:19:00”,<br>    “ip”: “8.8.8.8”,<br>    “environment”: “prd”,<br>    “log_level”: “DEBUG”,<br>    “message”: “this is an example log message”<br>  &#125;<br>  </p></code></pre><p></p></figure><p><code>TIMESTAMP_ISO8601</code> 用来匹配时间</p><p><code>IPV4</code>匹配IPV4 IP地址</p><p><code>WORD</code>匹配环境</p><p><code>LOGLEVEL</code>匹配了日志等级</p><p><code>GREEDYDATA</code>匹配后面的所有内容</p><p><strong>例2</strong>：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  220.181.108.96 - - [13/Jun/2015:21:14:28 +0000] "GET /blog/geekery/xvfb-firefox.html HTTP/1.1" 200 10975 "-" "Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"  </code></pre></figure><p><strong>转换后</strong>：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  %&#123;IPORHOST:clientip&#125; %&#123;USER:ident&#125; %&#123;USER:auth&#125; \[%&#123;HTTPDATE:timestamp&#125;\] "%&#123;WORD:verb&#125; %&#123;DATA:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;" %&#123;NUMBER:response:int&#125; (?:-|%&#123;NUMBER:bytes:int&#125;) %&#123;QS:referrer&#125; %&#123;QS:agent&#125;  </code></pre></figure><p><strong>例3</strong>：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  220.181.108.96 - - [13/Jun/2015:21:14:28 +0000] "GET /blog/geekery/xvfb-firefox.html HTTP/1.1" 200 10975 "-" "Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"  </code></pre></figure><p><strong>转换后</strong>：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  %&#123;IPORHOST:clientip&#125; %&#123;USER:ident&#125; %&#123;USER:auth&#125; \[%&#123;HTTPDATE:timestamp&#125;\] "%&#123;WORD:verb&#125; %&#123;DATA:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;" %&#123;NUMBER:response:int&#125; (?:-|%&#123;NUMBER:bytes:int&#125;) %&#123;QS:referrer&#125; %&#123;QS:agent&#125;  </code></pre></figure><p><strong>例4</strong>：假设我们有三个使用“common_header：payload”格式的应用程序</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  Application 1: '8.8.8.8 process-name[666]: a b 1 2 a lot of text at the end'<p>  Application 2: ‘8.8.8.8 process-name[667]: a 1 2 3 a lot of text near the end;4’</p><p>  Application 3: ‘8.8.8.8 process-name[421]: a completely different format | 1111’<br>  </p></code></pre><p></p></figure><p><strong>转换后</strong>：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  grok &#123;  "match" => &#123; "message => [    '%&#123;IPORHOST:clientip&#125; %&#123;DATA:process_name&#125;\[%&#123;NUMBER:process_id&#125;\]: %&#123;WORD:word_1&#125; %&#123;WORD:word_2&#125; %&#123;NUMBER:number_1&#125; %&#123;NUMBER:number_2&#125; %&#123;DATA:data&#125;',    '%&#123;IPORHOST:clientip&#125; %&#123;DATA:process_name&#125;\[%&#123;NUMBER:process_id&#125;\]: %&#123;WORD:word_1&#125; %&#123;NUMBER:number_1&#125; %&#123;NUMBER:number_2&#125; %&#123;NUMBER:number_3&#125; %&#123;DATA:data&#125;;%&#123;NUMBER:number_4&#125;',    '%&#123;IPORHOST:clientip&#125; %&#123;DATA:process_name&#125;\[%&#123;NUMBER:process_id&#125;\]: %&#123;DATA:data&#125; | %&#123;NUMBER:number&#125;'    ] &#125;&#125;  </code></pre></figure><h3 id="下面针对Apache日志来分割处理"><a href="#下面针对Apache日志来分割处理" class="headerlink" title="下面针对Apache日志来分割处理"></a>下面针对Apache日志来分割处理</h3><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  192.168.10.97 - - [19/Jul/2016:16:28:52 +0800] "GET / HTTP/1.1" 200 23 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36"  </code></pre></figure><p>日志中每个字段之间空格隔开，分别对应message中的字段。</p><p>如：%{IPORHOST:addre} –&gt; 192.168.10.97</p><p>但问题是IPORHOST又不是正则表达式，怎么能匹配IP地址呢？</p><p>因为IPPRHOST是grok表达式，它代表的正则表达式如下：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  IPV6 ((([0-9A-Fa-f]&#123;1,4&#125;:)&#123;7&#125;([0-9A-Fa-f]&#123;1,4&#125;|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;6&#125;(:[0-9A-Fa-f]&#123;1,4&#125;|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;)|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;5&#125;(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,2&#125;)|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;)|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;4&#125;(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,3&#125;)|((:[0-9A-Fa-f]&#123;1,4&#125;)?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;))|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;3&#125;(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,4&#125;)|((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;0,2&#125;:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;))|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;2&#125;(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,5&#125;)|((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;0,3&#125;:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;))|:))|(([0-9A-Fa-f]&#123;1,4&#125;:)&#123;1&#125;(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,6&#125;)|((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;0,4&#125;:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;))|:))|(:(((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;1,7&#125;)|((:[0-9A-Fa-f]&#123;1,4&#125;)&#123;0,5&#125;:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d))&#123;3&#125;))|:)))(%.+)?  IPV4 (?<![0-9])(?:(?:[0-1]?[0-9]&#123;1,2&#125;|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]&#123;1,2&#125;|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]&#123;1,2&#125;|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]&#123;1,2&#125;|2[0-4][0-9]|25[0-5]))(?![0-9])  IP (?:%&#123;IPV6&#125;|%&#123;IPV4&#125;)  HOSTNAME \b(?:[0-9A-Za-z][0-9A-Za-z-]&#123;0,62&#125;)(?:\.(?:[0-9A-Za-z][0-9A-Za-z-]&#123;0,62&#125;))*(\.?|\b)  IPORHOST (?:%&#123;IP&#125;|%&#123;HOSTNAME&#125;)  </code></code></pre></figure><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  IPORHOST代表的是ipv4或者ipv6或者HOSTNAME所匹配的grok表达式。<p>  上面的IPORHOST有点复杂，我们来看看简单点的，如USER</p><p>  USERNAME [a-zA-Z0-9._-]+     </p><p>  #USERNAME是匹配由字母，数字，“.”, “_”, “-“组成的任意字符</p><p>  USER %&#123;USERNAME&#125;</p><p>  #USER代表USERNAME的正则表达式</p><p>  第一行，用普通的正则表达式来定义一个 grok 表达式；</p><p>  第二行，通过打印赋值格式，用前面定义好的 grok 表达式来定义另一个 grok 表达式。<br>  </p></code></pre><p></p></figure><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  filter &#123;    if [type] == "apache" &#123;      grok &#123;        match => ["message" => "%&#123;IPORHOST:addre&#125; %&#123;USER:ident&#125; %&#123;USER:auth&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \"%&#123;WORD:http_method&#125; %&#123;NOTSPACE:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\" %&#123;NUMBER:status&#125; (?:%&#123;NUMBER:bytes&#125;|-) \"(?:%&#123;URI:http_referer&#125;|-)\" \"%&#123;GREEDYDATA:User_Agent&#125;\""]        remove_field => ["message"]      &#125;      date &#123;        match => [ "timestamp", "dd/MMM/YYYY:HH:mm:ss Z" ]      &#125;    &#125;  &#125;  </code></pre></figure><h3 id="Httpd"><a href="#Httpd" class="headerlink" title="Httpd"></a>Httpd</h3><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  HTTPDUSER %&#123;EMAILADDRESS&#125;|%&#123;USER&#125;  HTTPDERROR_DATE %&#123;DAY&#125; %&#123;MONTH&#125; %&#123;MONTHDAY&#125; %&#123;TIME&#125; %&#123;YEAR&#125;  <p>  # Log formats<br>  HTTPD_COMMONLOG %&#123;IPORHOST:clientip&#125; %&#123;HTTPDUSER:ident&#125; %&#123;HTTPDUSER:auth&#125; [%&#123;HTTPDATE:timestamp&#125;] “(?:%&#123;WORD:verb&#125; %&#123;NOTSPACE:request&#125;(?: HTTP&#x2F;%&#123;NUMBER:httpversion&#125;)?|%&#123;DATA:rawrequest&#125;)” %&#123;NUMBER:response&#125; (?:%&#123;NUMBER:bytes&#125;|-)<br>  HTTPD_COMBINEDLOG %&#123;HTTPD_COMMONLOG&#125; %&#123;QS:referrer&#125; %&#123;QS:agent&#125;  </p><p>  # Error logs<br>  HTTPD20_ERRORLOG [%&#123;HTTPDERROR_DATE:timestamp&#125;] [%&#123;LOGLEVEL:loglevel&#125;] (?:[client %&#123;IPORHOST:clientip&#125;] )&#123;0,1&#125;%&#123;GREEDYDATA:message&#125;<br>  HTTPD24_ERRORLOG [%&#123;HTTPDERROR_DATE:timestamp&#125;] [%&#123;WORD:module&#125;:%&#123;LOGLEVEL:loglevel&#125;] [pid %&#123;POSINT:pid&#125;(:tid %&#123;NUMBER:tid&#125;)?]( (%&#123;POSINT:proxy_errorcode&#125;)%&#123;DATA:proxy_message&#125;:)?( [client %&#123;IPORHOST:clientip&#125;:%&#123;POSINT:clientport&#125;])?( %&#123;DATA:errorcode&#125;:)? %&#123;GREEDYDATA:message&#125;<br>  HTTPD_ERRORLOG %&#123;HTTPD20_ERRORLOG&#125;|%&#123;HTTPD24_ERRORLOG&#125;  </p><p>  # Deprecated<br>  COMMONAPACHELOG %&#123;HTTPD_COMMONLOG&#125;<br>  COMBINEDAPACHELOG %&#123;HTTPD_COMBINEDLOG&#125;<br>  </p></code></pre><p></p></figure><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  JAVACLASS (?:[a-zA-Z$_][a-zA-Z$_0-9]*\.)*[a-zA-Z$_][a-zA-Z$_0-9]*  <p>  #Space is an allowed character to match special cases like ‘Native Method’ or ‘Unknown Source’<br>  JAVAFILE (?:[A-Za-z0-9_. -]+)  </p><p>  #Allow special <init>, <clinit> methods<br>  JAVAMETHOD (?:(&lt;(?:cl)?init&gt;)|[a-zA-Z$_][a-zA-Z$_0-9]*)  </clinit></init></p><p>  #Line number is optional in special cases ‘Native method’ or ‘Unknown source’<br>  JAVASTACKTRACEPART %&#123;SPACE&#125;at %&#123;JAVACLASS:class&#125;.%&#123;JAVAMETHOD:method&#125;(%&#123;JAVAFILE:file&#125;(?::%&#123;NUMBER:line&#125;)?)  </p><p>  # Java Logs<br>  JAVATHREAD (?:[A-Z]&#123;2&#125;-Processor[\d]+)<br>  JAVACLASS (?:[a-zA-Z0-9-]+.)+[A-Za-z0-9$]+<br>  JAVAFILE (?:[A-Za-z0-9_.-]+)<br>  JAVALOGMESSAGE (.*)  </p><p>  # MMM dd, yyyy HH:mm:ss eg: Jan 9, 2014 7:13:13 AM<br>  CATALINA_DATESTAMP %&#123;MONTH&#125; %&#123;MONTHDAY&#125;, 20%&#123;YEAR&#125; %&#123;HOUR&#125;:?%&#123;MINUTE&#125;(?::?%&#123;SECOND&#125;) (?:AM|PM)  </p><p>  # yyyy-MM-dd HH:mm:ss,SSS ZZZ eg: 2014-01-09 17:32:25,527 -0800<br>  TOMCAT_DATESTAMP 20%&#123;YEAR&#125;-%&#123;MONTHNUM&#125;-%&#123;MONTHDAY&#125; %&#123;HOUR&#125;:?%&#123;MINUTE&#125;(?::?%&#123;SECOND&#125;) %&#123;ISO8601_TIMEZONE&#125;<br>  CATALINALOG %&#123;CATALINA_DATESTAMP:timestamp&#125; %&#123;JAVACLASS:class&#125; %&#123;JAVALOGMESSAGE:logmessage&#125;  </p><p>  # 2014-01-09 20:03:28,269 -0800 | ERROR | com.example.service.ExampleService - something compeletely unexpected happened…<br>  TOMCATLOG %&#123;TOMCAT_DATESTAMP:timestamp&#125; | %&#123;LOGLEVEL:level&#125; | %&#123;JAVACLASS:class&#125; - %&#123;JAVALOGMESSAGE:logmessage&#125;</p><p>  </p></code></pre><p></p></figure><h3 id="Grok-Debugger"><a href="#Grok-Debugger" class="headerlink" title="Grok Debugger"></a>Grok Debugger</h3><p>当我们拿到一段日志，按照上面的grok表达式一个个去匹配时，我们如何确定我们匹配的是否正确呢？</p><p><a href="https://grokconstructor.appspot.com/do/match#result">https://grokconstructor.appspot.com/do/match#result</a> 这个地址可以满足我们的测试需求。就拿上面apache的日志测试。</p><p>点击后就出现如下数据，你写的每个grok表达式都获取到值了。为了测试准确，可以多测试几条日志。</p><p>配置文件：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  \# ---------------input 输入模块-----------------------  input &#123;  beats &#123;  port => 5044  &#125;  &#125;  <p>  # —————filter 过滤模块———————–  </p><p>  filter &#123;<br>      grok &#123;<br>          match &#x3D;&gt; &#123;<br>              “message” &#x3D;&gt; “%&#123;TIMESTAMP_ISO8601:times&#125; %&#123;HOSTNAME:hosts&#125; %&#123;USERNAME:logtype&#125;: message repeated %&#123;INT:repetition_times&#125; times: [ 日志类型:(?<Operation_type>(?&lt;&#x3D;)(.&#123;4&#125;)), (?<Operation_typ1e>(?&lt;&#x3D;)(.&#123;2&#125;)):%&#123;USER:user&#125;(%&#123;HOSTNAME:connection_method&#125;)(%&#123;HOSTNAME:connection_method&#125;), IP地址:%&#123;IPV4:connection_ip&#125;, 操作对象:%&#123;GREEDYDATA:Action_log&#125;, 操作类型:(?<behaviour_t>(?&lt;&#x3D;)(.&#123;4&#125;)), 描述:(?<Behavior_performance>(?&lt;&#x3D;)(.&#123;4&#125;))]“<br>          &#125;<br>      &#125;<br>  &#125;  </Behavior_performance></behaviour_t></Operation_typ1e></Operation_type></p><p>  # —————output 输出模块———————–  </p><p>  output &#123;<br>  elasticsearch &#123;<br>  hosts &#x3D;&gt; [“<a href="http://localhost:9200" ]">http://localhost:9200&quot;]</a><br>  index &#x3D;&gt; “sangfor-af-%&#123;+YYYY.MM.dd&#125;”<br>  #user &#x3D;&gt; “elastic”<br>  #password &#x3D;&gt; “changeme”<br>  &#125;<br>  &#125;<br>  </p></code></pre><p></p></figure><h2 id="自定义grok表达式"><a href="#自定义grok表达式" class="headerlink" title="自定义grok表达式"></a>自定义grok表达式</h2><p>grok主要有两部分：自定义正则表达式和系统预定义的模式表达式。</p><p>如果你感觉logstash自带的grok表达式不能满足需要，你也可以自己定义</p><p>如：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  filter &#123;    if [type] == "apache" &#123;      grok &#123;        patterns_dir => "/usr/local/logstash-2.3.4/ownpatterns/patterns"        match => &#123;                  "message" => "%&#123;APACHE_LOG&#125;"                  &#125;        remove_field => ["message"]      &#125;      date &#123;        match => [ "timestamp", "dd/MMM/YYYY:HH:mm:ss Z" ]      &#125;    &#125;  &#125;  <p>  #patterns_dir为自定义的grok表达式的路径。<br>  #自定义的patterns中按照logstash自带的格式书写。<br>  </p></code></pre><p></p></figure><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  APACHE_LOG %&#123;IPORHOST:addre&#125; %&#123;USER:ident&#125; %&#123;USER:auth&#125; \[%&#123;HTTPDATE:timestamp&#125;\] \"%&#123;WORD:http_method&#125; %&#123;NOTSPACE:request&#125; HTTP/%&#123;NUMBER:httpversion&#125;\" %&#123;NUMBER:status&#125; (?:%&#123;NUMBER:bytes&#125;|-) \"(?:%&#123;URI:http_referer&#125;|-)\" \"%&#123;GREEDYDATA:User_Agent&#125;\"  <p>  #我只是把apache日志匹配的grok表达式写入自定义文件中，简化conf文件。单个字段的正则表达式匹配你可以自己书写测试。<br>  </p></code></pre><p></p></figure><p><strong>常用正则</strong></p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  (?<temMsg>(.*)(?=Report)/?) 获取Report之前的字符  (?<temMsg>(?=Report)(.*)/?) 获取Report之后的字符  (?<temMsg>(?<=report).*?(?=msg)) 截取report和msg之间的值 不包含report和msg本身 (?<temmsg>(report).*?(?=msg)) 截取包含report但不包含msg  (?<temMsg>(?<=report).*?(msg)) 截取不包含report但包含msg (?<temmsg>(report).*?(msg|request)) 输出以report开头,以msg或者以request结尾的所有包含头尾信息  (?<temMsg>(report).*?(?=(msg|request))) 输出以report开头,以msg或者以request结尾的不包含头尾信息  </temMsg></=report).*?(msg))></temMsg></=report).*?(?=msg))></temMsg></temMsg></temMsg></code></pre></figure><p><strong>grok截取字符中指定长度的内容</strong><br>要求利用grok截取日志消息中某一指定长度的内容。</p><p>Logstatsh需要两个必需参数input、output，以及一个可选参数filter。input用于输入数据的设置，output用于输出数据的设置。filter是实现数据过滤的设置。grok是在filter里面实现数据截取。</p><p>项目有一串协议消息如 7e8900000c040116432693324af0010180010005e98e0706000a7e，要求利用grok截取7e后面的四个字符，利用grok正则表达式即可实现。<br>实现代码如下：</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  filter&#123;   grok&#123; match => &#123;   "message" => "(?<mid>(?<=7e)(.&#123;4&#125;))" &#125; < code></=7e)(.&#123;4&#125;))"></mid></code></pre></figure><p>代码解释：</p><p><code>message</code>：即输入的数据信息。</p><p><code>mid</code>：即输出结果的名称</p><p><code>(?&lt;=7e)</code>：即表示获取7e后面的字符，但不包括7e</p><p><code>(.&#123;4&#125;)</code>：即表示获取的字符长度为4个</p>]]></content>
    
    
    <categories>
      
      <category>运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>日志</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWS数据传输费用怎么算？</title>
    <link href="/2023/04/20/AWS%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%B4%B9%E7%94%A8%E6%80%8E%E4%B9%88%E7%AE%97%EF%BC%9F/"/>
    <url>/2023/04/20/AWS%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%B4%B9%E7%94%A8%E6%80%8E%E4%B9%88%E7%AE%97%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<h2 id="AWS的数据传输类型大致有如下三类："><a href="#AWS的数据传输类型大致有如下三类：" class="headerlink" title="AWS的数据传输类型大致有如下三类："></a><strong>AWS的数据传输类型大致有如下三类</strong>：</h2><ul><li>与Internet之间的数据传输</li><li>AWS内部跨区域的数据传输</li><li>AWS内部同一区域的数据传输<br>本文将以ap-southeast-2区域中的EC2和S3为例。</li></ul><h2 id="与Internet之间的数据传输费用计算"><a href="#与Internet之间的数据传输费用计算" class="headerlink" title="与Internet之间的数据传输费用计算"></a><strong>与Internet之间的数据传输费用计算</strong></h2><p>所有从Internet到AWS的流量是免费的，所有从AWS到Internet的流量是收费的。即对AWS服务而言，上行收费，下行免费。</p><p>针对上行流量，AWS根据不同的使用量采用不同的费率，下表中展示的是ap-southeast-2区域从AWS到Internet的数据传输费率。</p><table><thead><tr><th>Rate tiers</th><th>Pricing</th></tr></thead><tbody><tr><td>Up to 1 GB &#x2F; Month</td><td>$0.00 per GB</td></tr><tr><td>Next 9.999 TB</td><td>$0.114 per GB</td></tr><tr><td>Next 40 TB &#x2F; Month</td><td>$0.098 per GB</td></tr><tr><td>Next 100 TB &#x2F; Month</td><td>$0.094 per GB</td></tr><tr><td>Greater than 150 TB &#x2F; Month</td><td>$0.092 per GB</td></tr></tbody></table><p>那么问题来了，在这一个月中S3和EC2均产生了1GB到Internet的上行流量，AWS应该收我多少钱？$0? 不是的，会产生 $0.114 费用。</p><h2 id="为啥？"><a href="#为啥？" class="headerlink" title="为啥？"></a><strong>为啥？</strong></h2><p>AWS会根据从AWS服务传输到Internet的数据总量计算数据传输费率。具体而言，AWS会将从Amazon EC2, Amazon S3, Amazon Glacier, Amazon RDS, Amazon Redshift, Amazon SES, Amazon SimpleDB, Amazon SQS, Amazon SNS, Amazon DynamoDB, AWS Storage Gateway, 和 Amazon CloudWatch Logs到Internet的流量进行合并计算数据传输费率。</p><p>比如，我们只使用了EC2和S3服务，在本月我们已经使用了10TB，那么接下来EC2或者S3到Internet的费用到会按照$0.098&#x2F;GB收费，知道使用到下一个费率标准。</p><p>简单说，下行免费，上行收费，费率算总量。</p><h2 id="跨区域的数据传输费用计算"><a href="#跨区域的数据传输费用计算" class="headerlink" title="跨区域的数据传输费用计算"></a><strong>跨区域的数据传输费用计算</strong></h2><p>不同区域对跨区域数据传输的费率是不一样的。对于上行的数据传输会按照费率收取费用，对于下行的数据传输不收费。</p><p>比如现在有2台EC2实例A和B，A在悉尼(ap-southeast-2)，B在新加坡(ap-southeast-1)。这两台实例之间如何收取数据传输费用？</p><p>已知从悉尼ap-southeast-2到其他区域的数据传输费用为 $0.14&#x2F;GB，从新加坡ap-southeast-1到其他区域的数据传输费用为 $0.09&#x2F;GB</p><p>则从A给B传输1GB的数据，A需要付出数据传输费用 $0.14，B不需要付费。从B给A传输1GB的数据，A不需要付费，B需要付费 $0.09。</p><p>下行免费，上行收费，费率分区域。</p><h2 id="到CloudFront的数据传输费用计算"><a href="#到CloudFront的数据传输费用计算" class="headerlink" title="到CloudFront的数据传输费用计算"></a><strong>到CloudFront的数据传输费用计算</strong></h2><p>无论EC2还是S3到CloudFront的数据传输都是免费的。</p><h2 id="同一区域内的数据传输费用计算"><a href="#同一区域内的数据传输费用计算" class="headerlink" title="同一区域内的数据传输费用计算"></a><strong>同一区域内的数据传输费用计算</strong></h2><h2 id="S3"><a href="#S3" class="headerlink" title="S3"></a><strong>S3</strong></h2><p>S3 bucket之间在同一区域进行数据传输不收费。</p><p>S3和其他AWS服务在同一区域进行数据传输不收费。比如EC2和S3之间传输数据是免费的。</p><h2 id="EC2"><a href="#EC2" class="headerlink" title="EC2"></a><strong>EC2</strong></h2><ul><li><p>Amazon EC2，Amazon RDS，Amazon Redshift，Amazon DynamoDB Accelerator（DAX），Amazon ElastiCach 和 Elastic Network Interfaces进行跨可用区或使用VPC对等连接传输数据，上下行都需要收费，$0.01&#x2F;GB<br>比如在可用区A中有1台EC2 EC2-A，在可用区B中有1台EC EC2-B。当EC2-A向EC2-B传输1G数据，EC2-A需要支付 $0.01 上行数据传输费用，EC2-B需要支付 $0.01 下行数据传输费用。总共需要 $0.02 数据传输费用。</p></li><li><p>同一个区域内，使用公网IPv4或者弹性IPv4地址传输数据，上下行都需要收费，$0.01&#x2F;GB。<br>比如在可用区A中有两台EC2 EC2-A和EC2-B，它们之间使用公网IP传输数据是需要收费的，假如EC2-A向EC2-B发送1GB的数据，EC2-A需要支付 $0.01 上行数据传输费用，EC2-B需要支付 $0.01 下行数据传输费用。总共需要 $0.02 数据传输费用。</p></li></ul><p>Q: 跨可用区使用Public IP传输数据如何收费？<br>跨区域使用Public IP或者EIP传输数据只会收一次费用。<br>比如在可用区A中有1台EC2 EC2-A，在可用区B中有1台EC EC2-B。当EC2-A通过EIP向EC2-B传输1G数据，EC2-A需要支付 $0.01 上行数据传输费用，EC2-B需要支付 $0.01 下行数据传输费用。总共需要 $0.02 数据传输费用。</p><ul><li><p>同一个区域内，使用IPv6跨VPC传输数据，上下行都需要收费，$0.01&#x2F;GB。</p></li><li><p>同一个可用区内Amazon EC2, Amazon RDS, Amazon Redshift, Amazon ElastiCache instances 和 Elastic Network Interfaces 之间传输数据免费。如果使用VPC对等连接，则需要按照VPC对等连接的费率收费。</p></li></ul><p>比如在可用区A中有两台EC2 EC2-A和EC2-B，它们之间使用私有IP传输数据是免费的。</p><ul><li><p>在同一区域中内 Amazon S3、Amazon Glacier、Amazon DynamoDB、Amazon SES、Amazon SQS、Amazon Kinesis、Amazon ECR、Amazon SNS、Amazon SimpleDB 和 Amazon EC2 实例之间传输数据是免费的。通过PrivateLink终端节点访问的AWS服务将产生标准PrivateLink费用。</p></li><li><p>使用私有 IP 地址从 Amazon Classic Elastic Load Balancer 和 Amazon Application Elastic Load Balancer与EC2 实例之间传输数据是免费的。</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p><strong>EC2</strong><br><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/20/AWS%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%B4%B9%E7%94%A8%E6%80%8E%E4%B9%88%E7%AE%97%EF%BC%9F/ec2.png?raw=true"></p><p><strong>S3</strong><br><img src="https://github.com/JohnnySXY/JohnnySXY.github.io/blob/master/2023/04/20/AWS%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%B4%B9%E7%94%A8%E6%80%8E%E4%B9%88%E7%AE%97%EF%BC%9F/s3.png?raw=true"></p>]]></content>
    
    
    <categories>
      
      <category>CLOUD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AWS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于如何在hexo博客上发布和删除博文</title>
    <link href="/2023/04/20/Hexo-Release-OR-Delete-Article/"/>
    <url>/2023/04/20/Hexo-Release-OR-Delete-Article/</url>
    
    <content type="html"><![CDATA[<p><span style="color: #519D9E; ">关于如何在hexo博客上发布和删除博文</span></p><h2 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a><strong>创建文章</strong></h2><p>进入博客目录，在 &#x2F;source&#x2F;_posts 文件夹下直接建立一个.md文件</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  hexo new “这里填入文章的标题”  </code></pre></figure><p>.md文件注意使用带有makedown语法的编辑器打开，对文章进行编辑，你可以在Hexo-&gt;Source-&gt;_post目录下看到你新创建的那个文章，还有一个配套的文件夹，里面放这边博文的图片资源</p><p>文章标题，日期，标签，分类</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  title: 文章标题  date: 2015-11-13 15:40:25  tags: 标签  categories: 分类  </code></pre></figure><p>文章插入图片需要用到一个Hexo的插件，首先cd到hexo的根目录下</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  npm install https://github.com/CodeFalling/hexo-asset-image –save  </code></pre></figure><p>然后把图片放入对应文章的配套文件夹下</p><p>如果要进行代码书写，代码样式可自行下载</p><h2 id="发布新建文章"><a href="#发布新建文章" class="headerlink" title="发布新建文章"></a><strong>发布新建文章</strong></h2><p>文章写好后，直接在git bash中执行以下命令即可直接发布文章</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  hexo d -g  </code></pre></figure><p>如果发布的时候出现错误</p><p><code>ERROR Deployer not found: git</code></p><p>执行</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  npm install hexo-deployer-git –save  </code></pre></figure><h2 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a><strong>删除文章</strong></h2><p>删除文章的过程一样也很简单，先删除本地文件，然后通过生成和部署命令进而将远程仓库中的文件也一并删除。具体来说，以最开始默认形成的helloworld.md这篇文章为例。</p><p>首先进入到source &#x2F; _post 文件夹中，找到helloworld.md文件，在本地直接执行删除。然后依次执行</p><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  hexo d -g  </code></pre></figure><p>再去主页查看你就会发现你的博客上面已经空空如也了，这就是如何删除文章的方法。</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>命令</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos查看CPU核数命令</title>
    <link href="/2023/04/20/Centos-CPU-Check-Info/"/>
    <url>/2023/04/20/Centos-CPU-Check-Info/</url>
    
    <content type="html"><![CDATA[<h1 id="总核数-x3D-物理CPU个数-X-每颗物理CPU的核数"><a href="#总核数-x3D-物理CPU个数-X-每颗物理CPU的核数" class="headerlink" title="总核数 &#x3D; 物理CPU个数 X 每颗物理CPU的核数"></a>总核数 &#x3D; 物理CPU个数 X 每颗物理CPU的核数</h1><h1 id="总逻辑CPU数-x3D-物理CPU个数-X-每颗物理CPU的核数-X-超线程数"><a href="#总逻辑CPU数-x3D-物理CPU个数-X-每颗物理CPU的核数-X-超线程数" class="headerlink" title="总逻辑CPU数 &#x3D; 物理CPU个数 X 每颗物理CPU的核数 X 超线程数"></a>总逻辑CPU数 &#x3D; 物理CPU个数 X 每颗物理CPU的核数 X 超线程数</h1><h1 id="查看物理CPU个数"><a href="#查看物理CPU个数" class="headerlink" title="查看物理CPU个数"></a>查看物理CPU个数</h1><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  cat /proc/cpuinfo| grep "physical id"| sort| uniq| wc -l  </code></pre></figure><h1 id="查看每个物理CPU中core的个数-即核数"><a href="#查看每个物理CPU中core的个数-即核数" class="headerlink" title="查看每个物理CPU中core的个数(即核数)"></a>查看每个物理CPU中core的个数(即核数)</h1><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  cat /proc/cpuinfo| grep "cpu cores"| uniq  </code></pre></figure><h1 id="查看逻辑CPU的个数"><a href="#查看逻辑CPU的个数" class="headerlink" title="查看逻辑CPU的个数"></a>查看逻辑CPU的个数</h1><figure class="highlight">  <figcaption>This is a code block</figcaption>  <pre><code class="language-shell">  cat /proc/cpuinfo| grep "processor"| wc -l  </code></pre></figure>]]></content>
    
    
    <categories>
      
      <category>SYSTEM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CENTOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
